---
title: Service mesh概述
date: 2019-02-20 14:04:47
tags: service mesh
categories: Technology
---

Linkerd处理请求的流程：

1. Linkerd应用动态路由规则决定哪一个服务是请求者将要请求的服务。请求被路由到一个生产服务还是一个staging服务？在本数据中心的服务还是云上的服务？正在测试的最新版本服务还是审查过的生产服务？所有这些路由规则是动态配置的，并且能够应用于全部或者部分分片的流量。
2. 找到正确的目标后，Linkerd从相关服务发现端点中获取相应的实例池，实例池可能存在多个。如果此信息与Linkerd实际发现的冲突，则Linkerd决定相信哪一个信息源。
3. Linkerd选择最有可能快速响应的实例，这取决于多个因素，包括最近请求的延迟时间等。
4. Linkerd尝试发送请求到这个实例，并记录结果的响应类型和延迟时间。
5. 如果实例宕机、无响应、或者发生处理错误，Linkerd在另一个实例上重试请求（只有它知道请求是幂等的情况下）。
6. 如果实例始终返回错误，Linkerd将其剔除出负载均衡池，并周期性地进行重试（实例可能会顺势失效）。
7. 如果请求超时过后，Linkerd主动地返回失败相应，而不是增加重试的流量。
8. Linkerd通过测量和分布式跟踪捕获上述行为全部方面，并记录到集中式的度量系统。

以上只是最简单的版本。Linkerd也能够使用TLS通信，执行协议升级、动态转移流量、数据中心间失效切换。

{% asset_img linkerd-service-mesh-diagram.ping linkerd-service-mesh-diagram %}

