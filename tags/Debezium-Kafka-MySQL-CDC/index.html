<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
<title>标签: Debezium, Kafka, MySQL, CDC - 自然资源部一线码农——肖飞的博客：带你走进政务系统云原生的世界</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">






<link rel="icon" href="/favicon.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet" href="/css/style.css">
<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>

</head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                <img src="/images/logo.png" alt height="28">
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item " href="/archives">文章列表</a>
            
            <a class="navbar-item " href="/categories/Lifestyle">Lifestyle</a>
            
            <a class="navbar-item " href="/categories/Music">Music</a>
            
            <a class="navbar-item " href="/categories/Technology">Technology</a>
            
            <a class="navbar-item " href="/categories/Research">Research</a>
            
            <a class="navbar-item " href="/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            
            <a class="navbar-item" href="https://github.com/xyfigo">
                
                <i class="fab fa-github"></i>
                
            </a>
               
            
        </div>
    </div>
</nav>

    <section class="section section-heading">
    <div class="container">
        <div class="content">
            <h5>#Debezium, Kafka, MySQL, CDC</h5>
        </div>
    </div>
</section>
<section class="section">
    <div class="container">
    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2020/03/04/使用Debezium和Kafka为MySQL数据库设置变化数据捕捉CDC/" itemprop="url">使用Debezium和Kafka为MySQL数据库设置变化数据捕捉CDC</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2020-03-04T05:51:00.000Z" itemprop="datePublished">10 个月前</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Technology/">Technology</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            2 小时 读完 (约 16243 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h1 id="讲解"><a href="#讲解" class="headerlink" title="讲解"></a>讲解</h1><p>本教程将引导您逐步运行Debezium 1.0.2.Final，以进行更改数据捕获（CDC）。您将使用Docker（1.9或更高版本）启动Debezium服务，运行带有简单示例数据库的MySQL数据库服务器，使用Debezium监视数据库，并查看结果事件流随着数据库中数据的更改而响应。</p>
<table>
<thead>
<tr>
<th></th>
<th>您已经完成了教程？使用Docker Compose 尝试<a href="https://debezium.io/documentation/reference/1.0/tutorial.html#docker-compose" target="_blank" rel="noopener">快速</a>入门，包括Debezium支持的所有数据库（MySQL，Postgres，MongoDB，SQL Server和Oracle）的示例设置。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<h2 id="什么是Debezium？"><a href="#什么是Debezium？" class="headerlink" title="什么是Debezium？"></a>什么是Debezium？</h2><p>Debezium是一个分布式平台，可将您现有的数据库转换为事件流，因此应用程序可以查看数据库中的每个行级更改并立即对其做出响应。Debezium建立在<a href="http://kafka.apache.org/" target="_blank" rel="noopener">Apache Kafka</a>之上，并提供<a href="http://kafka.apache.org/documentation.html#connect" target="_blank" rel="noopener">Kafka Connect</a>兼容连接器，用于监视特定的数据库管理系统。Debezium在Kafka日志中记录数据更改的历史记录，您的应用程序从该位置开始使用它们。这使您的应用程序可以轻松，正确，完全使用所有事件。即使您的应用程序停止（或崩溃），在重新启动后，它也会开始使用中断处的事件，因此不会丢失任何内容。</p>
<p>Debezium 1.0.2.Final通过其<a href="https://debezium.io/documentation/reference/1.0/connectors/mysql.html" target="_blank" rel="noopener">MySQL连接器</a>支持监视MySQL数据库服务器，这就是本演示中将使用的内容。在将来的版本中将添加对其他DBMS的支持。</p>
<h2 id="使用Docker运行Debezium"><a href="#使用Docker运行Debezium" class="headerlink" title="使用Docker运行Debezium"></a>使用Docker运行Debezium</h2><p>运行Debezium涉及三项主要服务：<a href="http://zookeeper.apache.org/" target="_blank" rel="noopener">ZooKeeper</a>，Kafka和Debezium的连接器服务。本教程将引导您使用<a href="http://docker.com/" target="_blank" rel="noopener">Docker</a>和<a href="https://hub.docker.com/u/debezium/" target="_blank" rel="noopener">Debezium的Docker映像</a>启动这些服务的单个实例。另一方面，生产环境要求运行每个服务的多个实例以提供性能，可靠性，复制和容错能力。这可以通过<a href="https://www.openshift.com/" target="_blank" rel="noopener">OpenShift</a>和<a href="http://kubernetes.io/" target="_blank" rel="noopener">Kubernetes之</a>类的平台来完成，该平台管理在多个主机和机器上运行的多个Docker容器，但是通常您需要将其<a href="https://debezium.io/documentation/reference/1.0/install.html" target="_blank" rel="noopener">安装在专用硬件上</a>。</p>
<h2 id="启动Docker"><a href="#启动Docker" class="headerlink" title="启动Docker"></a>启动Docker</h2><p>确保Docker已<a href="https://docs.docker.com/engine/installation/" target="_blank" rel="noopener">安装并</a>在Linux，OS X或Windows上运行。我们强烈建议在这些平台上使用最新版本的Docker，并且牢记这些说明。（通过Docker Machine在虚拟机中运行Docker不再是首选方法，Docker建议您升级。）</p>
<h2 id="从Debezium开始简单"><a href="#从Debezium开始简单" class="headerlink" title="从Debezium开始简单"></a>从Debezium开始简单</h2><p>为了进行简单的评估和实验，本教程将引导您在本地计算机上的单独容器中启动每个服务的单个实例。ZooKeeper和Kafka都在容器内部本地存储数据，正常使用需要将主机目录作为卷安装在主机上，以便在容器停止时保留持久数据。尽管我们的<a href="https://hub.docker.com/r/debezium/" target="_blank" rel="noopener">Docker映像</a>的文档描述了如何执行此操作，但在本教程中我们将跳过该操作。这意味着，当删除容器时，所有持久数据将丢失。这实际上是我们实验的理想选择，因为完成后您的计算机上将没有任何东西，而且您可以多次运行此实验，而不必清理它们之间的任何内容。</p>
<p>在本地运行多个服务可能会造成混乱，因此我们将使用一个单独的终端在前台运行每个容器。这样，容器的所有输出将显示在用于运行它的终端中。</p>
<table>
<thead>
<tr>
<th></th>
<th>这不是运行Docker容器的唯一方法。<code>-it</code>Docker无需在前台运行容器（使用），而是让您以<em>分离</em>模式运行容器（使用<code>-d</code>），在该模式下，容器已启动，并且Docker命令立即返回。分离模式容器不会在终端中显示其输出，尽管您始终可以使用来查看输出<code>docker logs --follow --name &lt;container-name&gt;</code>。这是我们为运行的每个容器命名的原因之一。有关更多详细信息，请参阅Docker文档。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<h3 id="启动ZooKeeper"><a href="#启动ZooKeeper" class="headerlink" title="启动ZooKeeper"></a>启动ZooKeeper</h3><p>在组成Debezium的所有不同服务/过程中，第一个启动的是ZooKeeper。运行以下命令，启动一个新的终端并使用ZooKeeper启动一个容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --name zookeeper -p 2181:2181 -p 2888:2888 -p 3888:3888 debezium/zookeeper:1.0</span><br></pre></td></tr></table></figure>
<p>这将使用<code>debezium/zookeeper</code>映像的1.0版运行一个新容器，并将名称分配<code>zookeeper</code>给该容器。该<code>-it</code>标志使容器具有交互性，这意味着它将终端的标准输入和输出附加到容器，以便您可以看到容器中正在发生的事情。该<code>--rm</code>标志指示Docker在停止时删除容器。这三个<code>-p</code>选项将容器的三个端口（例如2181、2888和3888）映射到Docker主机上的相同端口，以便其他容器（和容器外部的软件）可以与ZooKeeper进行通信。</p>
<p>您应该在终端中看到ZooKeeper的典型输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Starting up <span class="keyword">in</span> standalone mode</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /zookeeper/conf/zoo.cfg</span><br><span class="line">2017-09-21 07:15:55,417 - INFO  [main:QuorumPeerConfig@134] - Reading configuration from: /zookeeper/conf/zoo.cfg</span><br><span class="line">2017-09-21 07:15:55,419 - INFO  [main:DatadirCleanupManager@78] - autopurge.snapRetainCount <span class="built_in">set</span> to 3</span><br><span class="line">2017-09-21 07:15:55,419 - INFO  [main:DatadirCleanupManager@79] - autopurge.purgeInterval <span class="built_in">set</span> to 1</span><br><span class="line">2017-09-21 07:15:55,420 - WARN  [main:QuorumPeerMain@113] - Either no config or no quorum defined <span class="keyword">in</span> config, running  <span class="keyword">in</span> standalone mode</span><br><span class="line">2017-09-21 07:15:55,420 - INFO  [PurgeTask:DatadirCleanupManager<span class="variable">$PurgeTask</span>@138] - Purge task started.</span><br><span class="line">2017-09-21 07:15:55,425 - INFO  [PurgeTask:DatadirCleanupManager<span class="variable">$PurgeTask</span>@144] - Purge task completed.</span><br><span class="line">2017-09-21 07:15:55,427 - INFO  [main:QuorumPeerConfig@134] - Reading configuration from: /zookeeper/conf/zoo.cfg</span><br><span class="line">2017-09-21 07:15:55,427 - INFO  [main:ZooKeeperServerMain@96] - Starting server</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:zookeeper.version=3.4.10-39d3a4f269333c922ed3db283be479f9deacaa0f, built on 03/23/2017 10:13 GMT</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:host.name=51b46dd211d0</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:java.version=1.8.0_131</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:java.vendor=Oracle Corporation</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:java.home=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.131-3.b12.el7_3.x86_64/jre</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:java.class.path=/zookeeper/bin/../build/classes:/zookeeper/bin/../build/lib/*.jar:/zookeeper/bin/../lib/slf4j-log4j12-1.6.1.jar:/zookeeper/bin/../lib/slf4j-api-1.6.1.jar:/zookeeper/bin/../lib/netty-3.10.5.Final.jar:/zookeeper/bin/../lib/log4j-1.2.16.jar:/zookeeper/bin/../lib/jline-0.9.94.jar:/zookeeper/bin/../zookeeper-3.4.10.jar:/zookeeper/bin/../src/java/lib/*.jar:/zookeeper/conf:</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:java.io.tmpdir=/tmp</span><br><span class="line">2017-09-21 07:15:55,433 - INFO  [main:Environment@100] - Server environment:java.compiler=&lt;NA&gt;</span><br><span class="line">2017-09-21 07:15:55,433 - INFO  [main:Environment@100] - Server environment:os.name=Linux</span><br><span class="line">2017-09-21 07:15:55,433 - INFO  [main:Environment@100] - Server environment:os.arch=amd64</span><br><span class="line">2017-09-21 07:15:55,433 - INFO  [main:Environment@100] - Server environment:os.version=4.4.0-93-generic</span><br><span class="line">2017-09-21 07:15:55,433 - INFO  [main:Environment@100] - Server environment:user.name=zookeeper</span><br><span class="line">2017-09-21 07:15:55,433 - INFO  [main:Environment@100] - Server environment:user.home=/zookeeper</span><br><span class="line">2017-09-21 07:15:55,433 - INFO  [main:Environment@100] - Server environment:user.dir=/zookeeper</span><br><span class="line">2017-09-21 07:15:55,435 - INFO  [main:ZooKeeperServer@829] - tickTime <span class="built_in">set</span> to 2000</span><br><span class="line">2017-09-21 07:15:55,435 - INFO  [main:ZooKeeperServer@838] - minSessionTimeout <span class="built_in">set</span> to -1</span><br><span class="line">2017-09-21 07:15:55,435 - INFO  [main:ZooKeeperServer@847] - maxSessionTimeout <span class="built_in">set</span> to -1</span><br><span class="line">2017-09-21 07:15:55,440 - INFO  [main:NIOServerCnxnFactory@89] - binding to port 0.0.0.0/0.0.0.0:2181</span><br></pre></td></tr></table></figure>
<p>最后一行很重要，它报告ZooKeeper已准备就绪并且正在侦听端口2181。在ZooKeeper生成该终端时，终端将继续显示其他输出。</p>
<h3 id="启动卡夫卡"><a href="#启动卡夫卡" class="headerlink" title="启动卡夫卡"></a>启动卡夫卡</h3><p>打开一个新终端，并通过运行以下命令使用它在新容器中启动Kafka：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --name kafka -p 9092:9092 --link zookeeper:zookeeper debezium/kafka:1.0</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th></th>
<th>在本教程中，我们总是从Docker容器中连接到Kafka，<code>kafka</code>只要我们链接到该<code>kafka</code>容器，他们就始终能够看到该容器并与之通信。如果我们想从Docker容器<em>外部</em>连接到Kafka ，则希望Kafka 通过Docker主机<em>发布</em>其地址，我们可以通过添加Docker主机<code>-e ADVERTISED_HOST_NAME=</code>的IP地址或可解析的主机名来实现， Mac上的Linux或Docker，这是主机的IP地址（不是<code>localhost</code>）。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>这将使用<code>debezium/kafka</code>映像的1.0版运行一个新容器，并将名称分配<code>kafka</code>给该容器。该<code>-it</code>标志使容器具有交互性，这意味着它将终端的标准输入和输出附加到容器，以便您可以看到容器中正在发生的事情。该<code>--rm</code>标志指示Docker在停止时删除容器。该命令将容器中的端口9092映射到Docker主机上的同一端口，以便容器外部的软件可以与Kafka进行通信。最后，命令使用<code>--link zookeeper:zookeeper</code>参数告诉容器它可以在<code>zookeeper</code>运行在同一Docker主机上的容器中找到ZooKeeper 。</p>
<p>您应该在终端中看到Kafka的典型输出，结尾为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:16:59,085 - INFO  [main-EventThread:ZkClient@713] - zookeeper state changed (SyncConnected)</span><br><span class="line">2017-09-21 07:16:59,218 - INFO  [main:Logging$class@70] - Cluster ID = LPtcBFxzRvOzDSXhc6AamA</span><br><span class="line">2017-09-21 07:16:59,221 - WARN  [main:Logging$class@85] - No meta.properties file under dir /kafka/data/1/meta.properties</span><br><span class="line">2017-09-21 07:16:59,247 - INFO  [ThrottledRequestReaper-Fetch:Logging$class@70] - [ThrottledRequestReaper-Fetch]: Starting</span><br><span class="line">2017-09-21 07:16:59,247 - INFO  [ThrottledRequestReaper-Produce:Logging$class@70] - [ThrottledRequestReaper-Produce]: Starting</span><br><span class="line">2017-09-21 07:16:59,248 - INFO  [ThrottledRequestReaper-Request:Logging$class@70] - [ThrottledRequestReaper-Request]: Starting</span><br><span class="line">2017-09-21 07:16:59,308 - INFO  [main:Logging$class@70] - Loading logs.</span><br><span class="line">2017-09-21 07:16:59,312 - INFO  [main:Logging$class@70] - Logs loading complete in 4 ms.</span><br><span class="line">2017-09-21 07:16:59,349 - INFO  [main:Logging$class@70] - Starting log cleanup with a period of 300000 ms.</span><br><span class="line">2017-09-21 07:16:59,353 - INFO  [main:Logging$class@70] - Starting log flusher with a default period of 9223372036854775807 ms.</span><br><span class="line">2017-09-21 07:16:59,385 - INFO  [main:Logging$class@70] - Awaiting socket connections on 172.17.0.4:9092.</span><br><span class="line">2017-09-21 07:16:59,387 - INFO  [main:Logging$class@70] - [Socket Server on Broker 1], Started 1 acceptor threads</span><br><span class="line">2017-09-21 07:16:59,394 - INFO  [ExpirationReaper-1-Produce:Logging$class@70] - [ExpirationReaper-1-Produce]: Starting</span><br><span class="line">2017-09-21 07:16:59,395 - INFO  [ExpirationReaper-1-Fetch:Logging$class@70] - [ExpirationReaper-1-Fetch]: Starting</span><br><span class="line">2017-09-21 07:16:59,395 - INFO  [ExpirationReaper-1-DeleteRecords:Logging$class@70] - [ExpirationReaper-1-DeleteRecords]: Starting</span><br><span class="line">2017-09-21 07:16:59,435 - INFO  [ExpirationReaper-1-topic:Logging$class@70] - [ExpirationReaper-1-topic]: Starting</span><br><span class="line">2017-09-21 07:16:59,441 - INFO  [ExpirationReaper-1-Heartbeat:Logging$class@70] - [ExpirationReaper-1-Heartbeat]: Starting</span><br><span class="line">2017-09-21 07:16:59,442 - INFO  [controller-event-thread:Logging$class@70] - Creating /controller (is it secure? false)</span><br><span class="line">2017-09-21 07:16:59,447 - INFO  [ExpirationReaper-1-Rebalance:Logging$class@70] - [ExpirationReaper-1-Rebalance]: Starting</span><br><span class="line">2017-09-21 07:16:59,456 - INFO  [controller-event-thread:Logging$class@70] - Result of znode creation is: OK</span><br><span class="line">2017-09-21 07:16:59,458 - INFO  [main:Logging$class@70] - [GroupCoordinator 1]: Starting up.</span><br><span class="line">2017-09-21 07:16:59,459 - INFO  [main:Logging$class@70] - [GroupCoordinator 1]: Startup complete.</span><br><span class="line">2017-09-21 07:16:59,460 - INFO  [group-metadata-manager-0:Logging$class@70] - [Group Metadata Manager on Broker 1]: Removed 0 expired offsets in 1 milliseconds.</span><br><span class="line">2017-09-21 07:16:59,487 - INFO  [main:Logging$class@70] - [ProducerId Manager 1]: Acquired new producerId block (brokerId:1,blockStartProducerId:0,blockEndProducerId:999) by writing to Zk with path version 1</span><br><span class="line">2017-09-21 07:16:59,530 - INFO  [main:Logging$class@70] - [Transaction Coordinator 1]: Starting up.</span><br><span class="line">2017-09-21 07:16:59,532 - INFO  [TxnMarkerSenderThread-1:Logging$class@70] - [Transaction Marker Channel Manager 1]: Starting</span><br><span class="line">2017-09-21 07:16:59,532 - INFO  [main:Logging$class@70] - [Transaction Coordinator 1]: Startup complete.</span><br><span class="line">2017-09-21 07:16:59,551 - INFO  [main:Logging$class@70] - Will not load MX4J, mx4j-tools.jar is not in the classpath</span><br><span class="line">2017-09-21 07:16:59,590 - INFO  [main:Logging$class@70] - Creating /brokers/ids/1 (is it secure? false)</span><br><span class="line">2017-09-21 07:16:59,604 - INFO  [main:Logging$class@70] - Result of znode creation is: OK</span><br><span class="line">2017-09-21 07:16:59,605 - INFO  [main:Logging$class@70] - Registered broker 1 at path /brokers/ids/1 with addresses: EndPoint(172.17.0.4,9092,ListenerName(PLAINTEXT),PLAINTEXT)</span><br><span class="line">2017-09-21 07:16:59,606 - WARN  [main:Logging$class@85] - No meta.properties file under dir /kafka/data/1/meta.properties</span><br><span class="line">2017-09-21 07:16:59,648 - INFO  [main:AppInfoParser$AppInfo@83] - Kafka version : 0.11.0.0</span><br><span class="line">2017-09-21 07:16:59,648 - INFO  [main:AppInfoParser$AppInfo@84] - Kafka commitId : cb8625948210849f</span><br><span class="line">2017-09-21 07:16:59,649 - INFO  [main:Logging$class@70] - [Kafka Server 1], started</span><br></pre></td></tr></table></figure>
<p>上面显示的最后一行报告说，Kafka代理已成功启动并且已准备好进行客户端连接。随着Kafka的生成，终端将继续显示其他输出。</p>
<table>
<thead>
<tr>
<th></th>
<th>Debezium 1.0.2.Final需要Kafka Connect 2.4.0，在本教程中，我们还将使用Kafka Broker的2.4.0版本。查看有关不同版本的Kafka Connect和Kafka代理之间兼容性的<a href="http://kafka.apache.org/documentation.html" target="_blank" rel="noopener">Kafka文档</a>。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<h3 id="启动一个MySQL数据库"><a href="#启动一个MySQL数据库" class="headerlink" title="启动一个MySQL数据库"></a>启动一个MySQL数据库</h3><p>至此，我们已经启动了ZooKeeper和Kafka，但是还没有Debezium可以从中捕获更改的数据库服务器。现在，让我们用示例数据库启动一个MySQL服务器。</p>
<p>打开一个新终端，并使用它来启动一个新容器，该容器运行一个预先配置有<code>inventory</code>数据库的MySQL数据库服务器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=debezium -e MYSQL_USER=mysqluser -e MYSQL_PASSWORD=mysqlpw debezium/example-mysql:1.0</span><br></pre></td></tr></table></figure>
<p>这将运行使用的版本1.0中的新的容器<code>debezium/example-mysql</code>的图像，这是<a href="https://github.com/debezium/docker-images/blob/master/examples/mysql/0.1/Dockerfile" target="_blank" rel="noopener">基于</a>所述<a href="https://hub.docker.com/r/_/mysql/" target="_blank" rel="noopener">的MySQL：5.7</a>图像，限定并填充的样品的“库存”数据库，并创建一个<code>debezium</code>用户与密码<code>dbz</code>具有由Debezium的MySQL的连接器所需的最小特权。该命令将名称分配给<code>mysql</code>容器，以便以后可以方便地引用它。该<code>-it</code>标志使容器具有交互性，这意味着它将终端的标准输入和输出附加到容器，以便您可以看到容器中正在发生的事情。的<code>--rm</code>标志指示Docker在停止时删除容器。该命令将容器中的端口3306（默认的MySQL端口）映射到Docker主机上的同一端口，以便容器外部的软件可以连接到数据库服务器。最后，该机还采用了<code>-e</code>选项三次的设置<code>MYSQL_ROOT_PASSWORD</code>，<code>MYSQL_USER</code>以及<code>MYSQL_PASSWORD</code>环境变量设置为特定值。</p>
<p>您应该在终端中看到以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">017-09-21T07:18:50.824629Z 0 [Note] mysqld: ready for connections.</span><br><span class="line">Version: &apos;5.7.19-log&apos;  socket: &apos;/var/run/mysqld/mysqld.sock&apos;  port: 3306  MySQL Community Server (GPL)</span><br></pre></td></tr></table></figure>
<p>请注意，随着修改配置，MySQL服务器会启动和停止几次。上面列出的最后一行报告MySQL服务器正在运行并且可以使用。</p>
<h3 id="启动MySQL命令行客户端"><a href="#启动MySQL命令行客户端" class="headerlink" title="启动MySQL命令行客户端"></a>启动MySQL命令行客户端</h3><p>打开一个新终端，并使用它为MySQL命令行客户端启动一个新容器，并将其连接到在该<code>mysql</code>容器中运行的MySQL服务器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --name mysqlterm --link mysql --rm mysql:5.7 sh -c <span class="string">'exec mysql -h"$MYSQL_PORT_3306_TCP_ADDR" -P"$MYSQL_PORT_3306_TCP_PORT" -uroot -p"$MYSQL_ENV_MYSQL_ROOT_PASSWORD"'</span></span><br></pre></td></tr></table></figure>
<p>在这里，我们使用<a href="https://hub.docker.com/r/_/mysql/" target="_blank" rel="noopener">mysql：5.7</a>映像启动容器，命名该容器<code>mysqlterm</code>并将其链接到<code>mysql</code>运行数据库服务器的容器。该<code>--rm</code>选项告诉Docker在停止时删除容器，该命令的其余部分定义了容器应运行的shell命令。此shell命令运行MySQL命令行客户端，并指定正确的选项，以便可以正确连接。</p>
<p>容器应输出类似于以下内容的行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql: [Warning] Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 3</span><br><span class="line">Server version: 5.7.17-log MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">'\c'</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>
<p>与其他容器不同，此容器运行一个产生提示的过程。我们将使用提示与数据库进行交互。首先，切换到“库存”数据库：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use inventory;</span><br></pre></td></tr></table></figure>
<p>然后列出数据库中的表：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br></pre></td></tr></table></figure>
<p>然后应显示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+<span class="comment">---------------------+</span></span><br><span class="line">| Tables_in_inventory |</span><br><span class="line">+<span class="comment">---------------------+</span></span><br><span class="line">| customers           |</span><br><span class="line">| orders              |</span><br><span class="line">| products            |</span><br><span class="line">| products_on_hand    |</span><br><span class="line">+<span class="comment">---------------------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>使用MySQL命令行客户端浏览数据库并查看数据库中预加载的数据。例如：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM customers;</span><br></pre></td></tr></table></figure>
<h3 id="启动Kafka-Connect"><a href="#启动Kafka-Connect" class="headerlink" title="启动Kafka Connect"></a>启动Kafka Connect</h3><p>打开一个新终端，并通过运行以下命令使用它在新容器中启动Kafka Connect服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --name connect -p 8083:8083 -e GROUP_ID=1 -e CONFIG_STORAGE_TOPIC=my_connect_configs -e OFFSET_STORAGE_TOPIC=my_connect_offsets -e STATUS_STORAGE_TOPIC=my_connect_statuses --link zookeeper:zookeeper --link kafka:kafka --link mysql:mysql debezium/connect:1.0</span><br></pre></td></tr></table></figure>
<p>这将运行一个<code>connect</code>使用该<code>debezium/connect</code>映像的1.0版命名的新Docker容器。该<code>-it</code>标志使容器具有交互性，这意味着它将终端的标准输入和输出附加到容器，以便您可以看到容器中正在发生的事情。该<code>--rm</code>标志指示Docker在停止时删除容器。该命令将容器中的端口8083映射到Docker主机上的相同端口，以便容器外部的软件可以使用Kafka Connect的REST API来设置和管理新的连接器实例。该命令使用<code>--link zookeeper:zookeeper</code>，<code>--link kafka:kafka</code>以及<code>--link mysql:mysql</code>，参数告诉容器，它可以找到的ZooKeeper中指定的容器中运行<code>zookeeper</code>，卡夫卡经纪人在名为容器中运行<code>kafka</code>，以及在名为的容器中运行的MySQL服务器<code>mysql</code>，它们均在同一Docker主机上运行。最后，该机还采用了<code>-e</code>选择三次设置<code>GROUP_ID</code>，<code>CONFIG_STORAGE_TOPIC</code>，<code>OFFSET_STORAGE_TOPIC</code>，和<code>STATUS_STORAGE_TOPIC</code>环境变量，它们都通过这个Debezium图像所需（尽管您可以根据需要使用不同的值）。</p>
<p>您应该在终端中看到Kafka Connect终端的典型输出，结尾为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:21:14,912 INFO   ||  Kafka version : 0.11.0.0   [org.apache.kafka.common.utils.AppInfoParser]</span><br><span class="line">2017-09-21 07:21:14,912 INFO   ||  Kafka commitId : cb8625948210849f   [org.apache.kafka.common.utils.AppInfoParser]</span><br><span class="line">2017-09-21 07:21:14,929 INFO   ||  Discovered coordinator 172.17.0.4:9092 (id: 2147483646 rack: null) for group 1.   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:21:14,931 INFO   ||  Finished reading KafkaBasedLog for topic my_connect_configs   [org.apache.kafka.connect.util.KafkaBasedLog]</span><br><span class="line">2017-09-21 07:21:14,932 INFO   ||  Started KafkaBasedLog for topic my_connect_configs   [org.apache.kafka.connect.util.KafkaBasedLog]</span><br><span class="line">2017-09-21 07:21:14,932 INFO   ||  Started KafkaConfigBackingStore   [org.apache.kafka.connect.storage.KafkaConfigBackingStore]</span><br><span class="line">2017-09-21 07:21:14,932 INFO   ||  Herder started   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:21:14,938 INFO   ||  Discovered coordinator 172.17.0.4:9092 (id: 2147483646 rack: null) for group 1.   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:21:14,940 INFO   ||  (Re-)joining group 1   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:21:15,022 INFO   ||  Successfully joined group 1 with generation 1   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:21:15,022 INFO   ||  Joined group and got assignment: Assignment&#123;error=0, leader=&apos;connect-1-4d60cb71-cb93-4388-8908-6f0d299a9d94&apos;, leaderUrl=&apos;http://172.17.0.7:9092/&apos;, offset=-1, connectorIds=[], taskIds=[]&#125;   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:21:15,023 INFO   ||  Starting connectors and tasks using config offset -1   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:21:15,023 INFO   ||  Finished starting connectors and tasks   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br></pre></td></tr></table></figure>
<p>上面显示的最后几行报告该服务已启动并且已准备好进行连接。随着Kafka Connect服务生成该终端，该终端将继续显示其他输出。</p>
<h4 id="使用Kafka-Connect-REST-API"><a href="#使用Kafka-Connect-REST-API" class="headerlink" title="使用Kafka Connect REST API"></a>使用Kafka Connect REST API</h4><p>Kafka Connect服务公开了RESTful API来管理连接器集，因此让我们通过<code>curl</code>命令行工具使用该API 。因为我们已将<code>connect</code>容器（运行Kafka Connect服务的端口）中的端口8083 映射到Docker主机上的端口8083，所以我们可以通过将请求发送到Docker主机上的端口8083来与该服务进行通信，然后将请求转发到Docker主机上。 Kafka Connect服务。我们<code>localhost</code>在示例中使用的是非本地Docker平台的用户（例如Windows和OS X上的Docker Toolbox用户），应替换<code>localhost</code>为其Docker主机的IP地址。</p>
<p>打开一个新终端，并使用它来检查Kafka Connect服务的状态：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -H <span class="string">"Accept:application/json"</span> localhost:8083/</span><br></pre></td></tr></table></figure>
<p>Kafka Connect服务应返回类似于以下内容的JSON响应消息：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"version"</span>:<span class="string">"2.4.0"</span>,<span class="attr">"commit"</span>:<span class="string">"cb8625948210849f"</span>&#125;</span><br></pre></td></tr></table></figure>
<p>这表明我们正在运行Kafka Connect 2.4.0版本。接下来，再次检查连接器列表，再次使用您的IP地址代替<code>localhost</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -H <span class="string">"Accept:application/json"</span> localhost:8083/connectors/</span><br></pre></td></tr></table></figure>
<p>应该返回以下内容：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[]</span><br></pre></td></tr></table></figure>
<p>这确认Kafka Connect服务正在运行，我们可以与之交谈，并且当前没有连接器。让我们补救一下，方法是启动一个连接器，该连接器将从MySQL数据库中捕获更改。</p>
<h3 id="监控MySQL数据库"><a href="#监控MySQL数据库" class="headerlink" title="监控MySQL数据库"></a>监控MySQL数据库</h3><p>此时，我们正在运行Debezium服务，带有示例<code>inventory</code>数据库的MySQL数据库服务器以及连接到数据库的MySQL命令行客户端。下一步是注册一个连接器，该连接器将开始监视MySQL数据库服务器的binlog，并为已更改（或将要更改）的每一行生成更改事件。由于这是一个新的连接器，因此在启动时它将从MySQL二进制日志的开头开始读取，该日志记录了所有事务，包括单个行的更改和对模式的更改。</p>
<table>
<thead>
<tr>
<th></th>
<th>通常，我们可能希望使用Kafka工具来手动创建必要的主题，包括指定副本数。但是，对于本教程，Kafka配置为仅使用1个副本自动创建主题。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>在同一终端上，我们将使用<code>curl</code>我们要启动的连接器信息向我们的Kafka Connect服务提交JSON请求消息。由于此命令将不在Docker容器中，因此我们需要使用Docker主机的IP地址（因此Windows和OS X上的Docker Toolbox用户应替换<code>localhost</code>为其IP地址）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -i -X POST -H <span class="string">"Accept:application/json"</span> -H <span class="string">"Content-Type:application/json"</span> localhost:8083/connectors/ -d <span class="string">'&#123; "name": "inventory-connector", "config": &#123; "connector.class": "io.debezium.connector.mysql.MySqlConnector", "tasks.max": "1", "database.hostname": "mysql", "database.port": "3306", "database.user": "debezium", "database.password": "dbz", "database.server.id": "184054", "database.server.name": "dbserver1", "database.whitelist": "inventory", "database.history.kafka.bootstrap.servers": "kafka:9092", "database.history.kafka.topic": "dbhistory.inventory" &#125; &#125;'</span></span><br></pre></td></tr></table></figure>
<p>|      | Windows用户可能需要转义双引号，如下所示：<figure class="highlight bash"><figcaption><span>$ curl -i -X POST -H "Accept:application/json" -H "Content-Type:application/json" localhost:8083/connectors/ -d '&#123; \"name\": \"inventory-connector\", \"config\": &#123; \"connector.class\": \"io.debezium.connector.mysql.MySqlConnector\", \"tasks.max\": \"1\", \"database.hostname\": \"mysql\", \"database.port\": \"3306\", \"database.user\": \"debezium\", \"database.password\": \"dbz\", \"database.server.id\": \"184054\", \"database.server.name\": \"dbserver1\", \"database.whitelist\": \"inventory\", \"database.history.kafka.bootstrap.servers\": \"kafka:9092\", \"database.history.kafka.topic\": \"dbhistory.inventory\" &#125; &#125;'`为避免此错误：`&#123;"error_code":500,"message":"Unexpected character ('n' (code 110)): was expecting double-quote to start field name\n at [Source: (org.glassfish.jersey.message.internal.ReaderInterceptorExecutor$UnCloseableInputStream); line: 1, column: 4]"&#125;``` |</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">| ---- | ------------------------------------------------------------ |</span><br><span class="line">|      | ```json &#123;<span class="string">"error_code"</span>:500,<span class="string">"message"</span>:<span class="string">"Unexpected character ('n' (code 110)): was expecting double-quote to start field name\n at [Source: (org.glassfish.jersey.message.internal.ReaderInterceptorExecutor<span class="variable">$UnCloseableInputStream</span>); line: 1, column: 4]"</span>&#125;``` |</span><br><span class="line"></span><br><span class="line">此命令使用Kafka Connect服务的RESTful API提交带有描述我们新连接器的JSON文档的资源`POST`请求`/connectors`。这是一条更具可读性的JSON消息：</span><br><span class="line"></span><br><span class="line">```json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"inventory-connector"</span>,</span><br><span class="line">  <span class="string">"config"</span>: &#123;</span><br><span class="line">    <span class="string">"connector.class"</span>: <span class="string">"io.debezium.connector.mysql.MySqlConnector"</span>,</span><br><span class="line">    <span class="string">"tasks.max"</span>: <span class="string">"1"</span>,</span><br><span class="line">    <span class="string">"database.hostname"</span>: <span class="string">"mysql"</span>,</span><br><span class="line">    <span class="string">"database.port"</span>: <span class="string">"3306"</span>,</span><br><span class="line">    <span class="string">"database.user"</span>: <span class="string">"debezium"</span>,</span><br><span class="line">    <span class="string">"database.password"</span>: <span class="string">"dbz"</span>,</span><br><span class="line">    <span class="string">"database.server.id"</span>: <span class="string">"184054"</span>,</span><br><span class="line">    <span class="string">"database.server.name"</span>: <span class="string">"dbserver1"</span>,</span><br><span class="line">    <span class="string">"database.whitelist"</span>: <span class="string">"inventory"</span>,</span><br><span class="line">    <span class="string">"database.history.kafka.bootstrap.servers"</span>: <span class="string">"kafka:9092"</span>,</span><br><span class="line">    <span class="string">"database.history.kafka.topic"</span>: <span class="string">"schema-changes.inventory"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>JSON消息将连接器名称指定为<code>inventory-connector</code>，并提供<a href="https://debezium.io/documentation/reference/1.0/connectors/mysql.html#connector-properties" target="_blank" rel="noopener">我们的MySQL连接器</a>的详细<a href="https://debezium.io/documentation/reference/1.0/connectors/mysql.html#connector-properties" target="_blank" rel="noopener">配置属性</a>：</p>
<ul>
<li>一项任务应该恰好在任何时候运行。由于MySQL连接读取MySQL服务器的binlog，因此使用单个连接器任务是确保正确顺序和所有事件得到正确处理的唯一方法。</li>
<li>数据库主机指定为<code>mysql</code>，这是运行MySQL服务器的Docker容器的名称。回想一下，Docker在我们的容器中操纵了网络堆栈，以便可以通过<code>/etc/hosts</code>使用容器名称作为主机名来解析每个链接的容器。如果MySQL在正常网络上运行，我们只需为此值指定IP地址或可解析的主机名即可。</li>
<li>指定了MySQL服务器的端口。</li>
<li>我们正在运行的MySQL数据库已<code>debezium</code>为我们的目的明确设置了一个用户，因此我们在此处指定该用户名和密码。</li>
<li>给出了唯一的服务器ID和名称。服务器名称是MySQL服务器或服务器集群的逻辑标识符，将用作所有Kafka主题的前缀。</li>
<li>我们只想检测<code>inventory</code>数据库中的更改，因此我们使用白名单。</li>
<li>连接器应使用命名的代理（与我们将事件发送到的代理相同）和主题名称在Kafka中存储数据库架构的历史记录。重新启动后，连接器将恢复连接器应开始读取时二进制日志中存在的时间点的数据库模式。</li>
</ul>
<p>此命令应产生类似于以下内容的响应（也许更紧凑）：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">201</span> Created</span><br><span class="line"><span class="attribute">Date</span>: Tue, 07 Feb 2017 20:49:34 GMT</span><br><span class="line"><span class="attribute">Location</span>: http://localhost:8083/connectors/inventory-connector</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json</span><br><span class="line"><span class="attribute">Content-Length</span>: 471</span><br><span class="line"><span class="attribute">Server</span>: Jetty(9.2.15.v20160210)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "name": "inventory-connector",</span><br><span class="line">  "config": &#123;</span><br><span class="line">    "connector.class": "io.debezium.connector.mysql.MySqlConnector",</span><br><span class="line">    "tasks.max": "1",</span><br><span class="line">    "database.hostname": "mysql",</span><br><span class="line">    "database.port": "3306",</span><br><span class="line">    "database.user": "debezium",</span><br><span class="line">    "database.password": "dbz",</span><br><span class="line">    "database.server.id": "184054",</span><br><span class="line">    "database.server.name": "dbserver1",</span><br><span class="line">    "database.whitelist": "inventory",</span><br><span class="line">    "database.history.kafka.bootstrap.servers": "kafka:9092",</span><br><span class="line">    "database.history.kafka.topic": "dbhistory.inventory",</span><br><span class="line">    "name": "inventory-connector"</span><br><span class="line">  &#125;,</span><br><span class="line">  "tasks": []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此响应描述了<code>/connectors/inventory-connector</code>服务刚刚创建的连接器资源，并包括连接器的配置和有关任务的信息。由于连接器是刚刚创建的，因此该服务尚未完成启动任务。</p>
<p>我们甚至可以使用RESTful API来验证我们的连接器是否包含在连接器列表中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -H <span class="string">"Accept:application/json"</span> localhost:8083/connectors/</span><br></pre></td></tr></table></figure>
<p>应该返回以下内容：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">"inventory-connector"</span>]</span><br></pre></td></tr></table></figure>
<p>回想一下，Kafka Connect服务使用连接器启动一个或多个完成该任务的任务，并且它将自动在Kafka Connect服务群集中分配正在运行的任务。如果任何服务停止或崩溃，这些任务将重新分配给正在运行的服务。当我们获得连接器的状态时，我们可以看到任务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -i -X GET -H <span class="string">"Accept:application/json"</span> localhost:8083/connectors/inventory-connector</span><br></pre></td></tr></table></figure>
<p>返回：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Date</span>: Mon, 27 Mar 2017 17:09:28 GMT</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json</span><br><span class="line"><span class="attribute">Content-Length</span>: 515</span><br><span class="line"><span class="attribute">Server</span>: Jetty(9.2.15.v20160210)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "name": "inventory-connector",</span><br><span class="line">  "config": &#123;</span><br><span class="line">    "name": "inventory-connector",</span><br><span class="line">    "connector.class": "io.debezium.connector.mysql.MySqlConnector",</span><br><span class="line">    "tasks.max": "1",</span><br><span class="line">    "database.hostname": "mysql",</span><br><span class="line">    "database.port": "3306",</span><br><span class="line">    "database.user": "debezium",</span><br><span class="line">    "database.password": "dbz",</span><br><span class="line">    "database.server.id": "184054",</span><br><span class="line">    "database.server.name": "dbserver1",</span><br><span class="line">    "database.whitelist": "inventory",</span><br><span class="line">    "database.history.kafka.bootstrap.servers": "kafka:9092",</span><br><span class="line">    "database.history.kafka.topic": "dbhistory.inventory"</span><br><span class="line">  &#125;,</span><br><span class="line">  "tasks": [</span><br><span class="line">    &#123;</span><br><span class="line">      "connector": "inventory-connector",</span><br><span class="line">      "task": 0</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这里，我们可以看到连接器正在运行一个任务（例如任务0）以完成其工作。MySQL连接器仅支持一个任务，因为MySQL将其所有活动记录在一个连续的二进制日志中，因此MySQL连接器仅需要一个读取器即可获得所有这些事件的一致且完全有序的视图。</p>
<p>如果我们查看<code>connect</code>容器的输出，我们会看到连接器产生了很多输出。与我们的连接器相关的前几行是由Kafka Connect输出的，并以以下内容开头：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:23:59,051 INFO   ||  Connector inventory-connector config updated   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:23:59,550 INFO   ||  Rebalance started   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:23:59,550 INFO   ||  Finished stopping tasks in preparation for rebalance   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:23:59,550 INFO   ||  (Re-)joining group 1   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:23:59,556 INFO   ||  Successfully joined group 1 with generation 2   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:23:59,556 INFO   ||  Joined group and got assignment: Assignment&#123;error=0, leader=&apos;connect-1-4d60cb71-cb93-4388-8908-6f0d299a9d94&apos;, leaderUrl=&apos;http://172.17.0.7:9092/&apos;, offset=1, connectorIds=[inventory-connector], taskIds=[]&#125;   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:23:59,557 INFO   ||  Starting connectors and tasks using config offset 1   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:23:59,557 INFO   ||  Starting connector inventory-connector   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>接下来是Kafka Connect的大量输出，内容涉及启动此连接器以及各种生产者和消费者配置。最终，我们<em>从MySQL连接器</em>看到以下输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:24:01,151 INFO   MySQL|dbserver1|task  Kafka version : 0.11.0.0   [org.apache.kafka.common.utils.AppInfoParser]</span><br><span class="line">2017-09-21 07:24:01,151 INFO   MySQL|dbserver1|task  Kafka commitId : cb8625948210849f   [org.apache.kafka.common.utils.AppInfoParser]</span><br><span class="line">2017-09-21 07:24:01,584 INFO   MySQL|dbserver1|task  Found no existing offset, so preparing to perform a snapshot   [io.debezium.connector.mysql.MySqlConnectorTask]</span><br><span class="line">2017-09-21 07:24:01,614 INFO   ||  Source task WorkerSourceTask&#123;id=inventory-connector-0&#125; finished initialization and start   [org.apache.kafka.connect.runtime.WorkerSourceTask]</span><br><span class="line">2017-09-21 07:24:01,615 INFO   MySQL|dbserver1|snapshot  Starting snapshot for jdbc:mysql://mysql:3306/?useInformationSchema=true&amp;nullCatalogMeansCurrent=false&amp;useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;characterSetResults=UTF-8&amp;zeroDateTimeBehavior=convertToNull with user &apos;debezium&apos;   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,617 INFO   MySQL|dbserver1|snapshot  Snapshot is using user &apos;debezium&apos; with these MySQL grants:   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,618 INFO   MySQL|dbserver1|snapshot         GRANT SELECT, RELOAD, SHOW DATABASES, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &apos;debezium&apos;@&apos;%&apos;   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>首先，Debezium日志输出使用<em>映射的诊断上下文</em>（即MDC），它允许日志消息包括特定于线程的信息，例如连接器类型（例如，<code>MySQL</code>在上面的“ INFO”或“ WARN”字段之后的日志消息中），连接器（例如，逻辑名<code>dbserver1</code>同上），并且连接器的活动（例如，<code>task</code>，<code>snapshot</code>和<code>binlog</code>）。希望这些将使您更容易理解多线程Kafka Connect服务中的情况。</p>
<p>前几行涉及<code>task</code>连接器的活动，并且基本上报告一些簿记信息，以使连接器在没有任何偏移的情况下启动。新的三行内容涉及<code>snapshot</code>连接器的活动，特别是正在使用<code>debezium</code>MySQL用户以及与该用户关联的MySQL授权启动快照。</p>
<table>
<thead>
<tr>
<th></th>
<th>如果连接器无法连接或看不到任何表或Binlog，请检查这些授予以确保包括上面列出的所有授予。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>连接器输出的下一条消息如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:24:01,618 INFO   MySQL|dbserver1|snapshot  MySQL server variables related to change data capture:   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,625 INFO   MySQL|dbserver1|snapshot  	binlog_cache_size                             = 32768                                           [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,625 INFO   MySQL|dbserver1|snapshot  	binlog_checksum                               = CRC32                                           [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,625 INFO   MySQL|dbserver1|snapshot  	binlog_direct_non_transactional_updates       = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,625 INFO   MySQL|dbserver1|snapshot  	binlog_error_action                           = ABORT_SERVER                                    [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_format                                 = ROW                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_group_commit_sync_delay                = 0                                               [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_group_commit_sync_no_delay_count       = 0                                               [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_gtid_simple_recovery                   = ON                                              [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_max_flush_queue_time                   = 0                                               [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_order_commits                          = ON                                              [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_row_image                              = FULL                                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_rows_query_log_events                  = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_stmt_cache_size                        = 32768                                           [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_set_client                          = utf8                                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_set_connection                      = utf8                                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_set_database                        = latin1                                          [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_set_filesystem                      = binary                                          [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_set_results                         = utf8                                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_set_server                          = latin1                                          [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_set_system                          = utf8                                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_sets_dir                            = /usr/share/mysql/charsets/                      [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	collation_connection                          = utf8_general_ci                                 [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	collation_database                            = latin1_swedish_ci                               [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	collation_server                              = latin1_swedish_ci                               [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	enforce_gtid_consistency                      = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	gtid_executed_compression_period              = 1000                                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	gtid_mode                                     = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	gtid_next                                     = AUTOMATIC                                       [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	gtid_owned                                    =                                                 [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	gtid_purged                                   =                                                 [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	innodb_api_enable_binlog                      = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	innodb_locks_unsafe_for_binlog                = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	innodb_version                                = 5.7.19                                          [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	log_statements_unsafe_for_binlog              = ON                                              [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	max_binlog_cache_size                         = 18446744073709547520                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	max_binlog_size                               = 1073741824                                      [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	max_binlog_stmt_cache_size                    = 18446744073709547520                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	protocol_version                              = 10                                              [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	session_track_gtids                           = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	slave_type_conversions                        =                                                 [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	sync_binlog                                   = 1                                               [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	system_time_zone                              = UTC                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	time_zone                                     = SYSTEM                                          [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	tls_version                                   = TLSv1,TLSv1.1                                   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	tx_isolation                                  = REPEATABLE-READ                                 [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	tx_read_only                                  = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	version                                       = 5.7.19-log                                      [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	version_comment                               = MySQL Community Server (GPL)                    [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	version_compile_machine                       = x86_64                                          [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,628 INFO   MySQL|dbserver1|snapshot  	version_compile_os                            = Linux                                           [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>这将报告由我们的MySQL连接器找到的相关MySQL服务器设置。最重要的一项是<code>binlog_format</code>，它被设置为<code>ROW</code>。这些行之后是构成快照操作的9个步骤的输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:24:01,628 INFO   MySQL|dbserver1|snapshot  Step 0: disabling autocommit and enabling repeatable <span class="built_in">read</span> transactions   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,631 INFO   MySQL|dbserver1|snapshot  Step 1: start transaction with consistent snapshot   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,634 INFO   MySQL|dbserver1|snapshot  Step 2: flush and obtain global <span class="built_in">read</span> lock to prevent writes to database   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,636 INFO   MySQL|dbserver1|snapshot  Step 3: <span class="built_in">read</span> binlog position of MySQL master   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,638 INFO   MySQL|dbserver1|snapshot  	 using binlog <span class="string">'mysql-bin.000003'</span> at position <span class="string">'154'</span> and gtid <span class="string">''</span>   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,638 INFO   MySQL|dbserver1|snapshot  Step 4: <span class="built_in">read</span> list of available databases   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,638 INFO   MySQL|dbserver1|snapshot  	 list of available databases is: [information_schema, inventory, mysql, performance_schema, sys]   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,639 INFO   MySQL|dbserver1|snapshot  Step 5: <span class="built_in">read</span> list of available tables <span class="keyword">in</span> each database   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,641 INFO   MySQL|dbserver1|snapshot  	 including <span class="string">'inventory.customers'</span>   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,641 INFO   MySQL|dbserver1|snapshot  	 including <span class="string">'inventory.orders'</span>   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,641 INFO   MySQL|dbserver1|snapshot  	 including <span class="string">'inventory.products'</span>   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,641 INFO   MySQL|dbserver1|snapshot  	 including <span class="string">'inventory.products_on_hand'</span>   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,642 INFO   MySQL|dbserver1|snapshot  	 <span class="string">'mysql.columns_priv'</span> is filtered out, discarding   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">...</span><br><span class="line">2017-09-21 07:24:01,670 INFO   MySQL|dbserver1|snapshot  	snapshot continuing with database(s): [inventory]   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,670 INFO   MySQL|dbserver1|snapshot  Step 6: generating DROP and CREATE statements to reflect current database schemas:   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,679 INFO   MySQL|dbserver1|snapshot  	SET character_set_server=latin1, collation_server=latin1_swedish_ci;   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,724 WARN   MySQL|dbserver1|task  Error <span class="keyword">while</span> fetching metadata with correlation id 1 : &#123;dbhistory.inventory=LEADER_NOT_AVAILABLE&#125;   [org.apache.kafka.clients.NetworkClient]</span><br><span class="line">2017-09-21 07:24:01,853 INFO   MySQL|dbserver1|snapshot  	DROP TABLE IF EXISTS `inventory`.`products_on_hand`   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,861 INFO   MySQL|dbserver1|snapshot  	DROP TABLE IF EXISTS `inventory`.`customers`   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,864 INFO   MySQL|dbserver1|snapshot  	DROP TABLE IF EXISTS `inventory`.`orders`   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,866 INFO   MySQL|dbserver1|snapshot  	DROP TABLE IF EXISTS `inventory`.`products`   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,881 INFO   MySQL|dbserver1|snapshot  	DROP DATABASE IF EXISTS `inventory`   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,889 INFO   MySQL|dbserver1|snapshot  	CREATE DATABASE `inventory`   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,893 INFO   MySQL|dbserver1|snapshot  	USE `inventory`   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,914 INFO   MySQL|dbserver1|snapshot  	CREATE TABLE `customers` (</span><br><span class="line">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `first_name` varchar(255) NOT NULL,</span><br><span class="line">  `last_name` varchar(255) NOT NULL,</span><br><span class="line">  `email` varchar(255) NOT NULL,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  UNIQUE KEY `email` (`email`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1005 DEFAULT CHARSET=latin1   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,932 INFO   MySQL|dbserver1|snapshot  	CREATE TABLE `orders` (</span><br><span class="line">  `order_number` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `order_date` date NOT NULL,</span><br><span class="line">  `purchaser` int(11) NOT NULL,</span><br><span class="line">  `quantity` int(11) NOT NULL,</span><br><span class="line">  `product_id` int(11) NOT NULL,</span><br><span class="line">  PRIMARY KEY (`order_number`),</span><br><span class="line">  KEY `order_customer` (`purchaser`),</span><br><span class="line">  KEY `ordered_product` (`product_id`),</span><br><span class="line">  CONSTRAINT `orders_ibfk_1` FOREIGN KEY (`purchaser`) REFERENCES `customers` (`id`),</span><br><span class="line">  CONSTRAINT `orders_ibfk_2` FOREIGN KEY (`product_id`) REFERENCES `products` (`id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=10005 DEFAULT CHARSET=latin1   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,937 INFO   MySQL|dbserver1|snapshot  	CREATE TABLE `products` (</span><br><span class="line">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `name` varchar(255) NOT NULL,</span><br><span class="line">  `description` varchar(512) DEFAULT NULL,</span><br><span class="line">  `weight` <span class="built_in">float</span> DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=110 DEFAULT CHARSET=latin1   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,941 INFO   MySQL|dbserver1|snapshot  	CREATE TABLE `products_on_hand` (</span><br><span class="line">  `product_id` int(11) NOT NULL,</span><br><span class="line">  `quantity` int(11) NOT NULL,</span><br><span class="line">  PRIMARY KEY (`product_id`),</span><br><span class="line">  CONSTRAINT `products_on_hand_ibfk_1` FOREIGN KEY (`product_id`) REFERENCES `products` (`id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=latin1   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,947 INFO   MySQL|dbserver1|snapshot  Step 7: releasing global <span class="built_in">read</span> lock to <span class="built_in">enable</span> MySQL writes   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,949 INFO   MySQL|dbserver1|snapshot  Step 7: blocked writes to MySQL <span class="keyword">for</span> a total of 00:00:00.312   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,950 INFO   MySQL|dbserver1|snapshot  Step 8: scanning contents of 4 tables <span class="keyword">while</span> still <span class="keyword">in</span> transaction   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,953 INFO   MySQL|dbserver1|snapshot  Step 8: - scanning table <span class="string">'inventory.customers'</span> (1 of 4 tables)   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,958 INFO   MySQL|dbserver1|snapshot  Step 8: - Completed scanning a total of 4 rows from table <span class="string">'inventory.customers'</span> after 00:00:00.005   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,959 INFO   MySQL|dbserver1|snapshot  Step 8: - scanning table <span class="string">'inventory.orders'</span> (2 of 4 tables)   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,014 INFO   MySQL|dbserver1|snapshot  Step 8: - Completed scanning a total of 4 rows from table <span class="string">'inventory.orders'</span> after 00:00:00.055   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,016 INFO   MySQL|dbserver1|snapshot  Step 8: - scanning table <span class="string">'inventory.products'</span> (3 of 4 tables)   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,017 INFO   MySQL|dbserver1|snapshot  Step 8: - Completed scanning a total of 9 rows from table <span class="string">'inventory.products'</span> after 00:00:00.001   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,018 INFO   MySQL|dbserver1|snapshot  Step 8: - scanning table <span class="string">'inventory.products_on_hand'</span> (4 of 4 tables)   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,019 INFO   MySQL|dbserver1|snapshot  Step 8: - Completed scanning a total of 9 rows from table <span class="string">'inventory.products_on_hand'</span> after 00:00:00.001   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,020 INFO   MySQL|dbserver1|snapshot  Step 8: scanned 26 rows <span class="keyword">in</span> 4 tables <span class="keyword">in</span> 00:00:00.069   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,020 INFO   MySQL|dbserver1|snapshot  Step 9: committing transaction   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,021 INFO   MySQL|dbserver1|snapshot  Completed snapshot <span class="keyword">in</span> 00:00:00.405   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>这些步骤中的每一个都报告连接器正在执行的操作，以执行一致的快照。例如，步骤6涉及对捕获的表的DDL create语句进行反向工程；步骤7在获取全局写锁后仅0.3秒就释放了它，步骤8读取每个表中的所有行，并报告花费的时间和找到的行数。请注意，在我们的示例数据库中，MySQL连接器仅用0.38秒即可完成其一致的快照。</p>
<table>
<thead>
<tr>
<th></th>
<th>对于您的数据库，此过程将花费更长的时间，但是连接器将输出足够的日志消息，以便即使表具有大量行，您也可以跟踪其正在执行的操作。而且，尽管在快照过程开始时使用了排他写锁定，但即使对于大型数据库，此锁定也应该很短。在复制任何数据之前，将释放此锁定。有关更多详细信息，请参见<a href="https://debezium.io/documentation/reference/1.0/connectors/mysql.html" target="_blank" rel="noopener">MySQL连接器文档</a>。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>Kafka Connect的新五行听起来不祥，但基本上告诉我们，已经创建了<em>新的</em> Kafka主题，而Kafka必须为每一个主题指定新的领导者：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:24:02,632 WARN   ||  Error <span class="keyword">while</span> fetching metadata with correlation id 1 : &#123;dbserver1=LEADER_NOT_AVAILABLE&#125;   [org.apache.kafka.clients.NetworkClient]</span><br><span class="line">2017-09-21 07:24:02,775 WARN   ||  Error <span class="keyword">while</span> fetching metadata with correlation id 5 : &#123;dbserver1.inventory.customers=LEADER_NOT_AVAILABLE&#125;   [org.apache.kafka.clients.NetworkClient]</span><br><span class="line">2017-09-21 07:24:02,910 WARN   ||  Error <span class="keyword">while</span> fetching metadata with correlation id 9 : &#123;dbserver1.inventory.orders=LEADER_NOT_AVAILABLE&#125;   [org.apache.kafka.clients.NetworkClient]</span><br><span class="line">2017-09-21 07:24:03,045 WARN   ||  Error <span class="keyword">while</span> fetching metadata with correlation id 13 : &#123;dbserver1.inventory.products=LEADER_NOT_AVAILABLE&#125;   [org.apache.kafka.clients.NetworkClient]</span><br><span class="line">2017-09-21 07:24:03,179 WARN   ||  Error <span class="keyword">while</span> fetching metadata with correlation id 17 : &#123;dbserver1.inventory.products_on_hand=LEADER_NOT_AVAILABLE&#125;   [org.apache.kafka.clients.NetworkClient]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>最后，我们看到一行报告，表明连接器已从其快照模式转换为连续读取MySQL服务器的binlog：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">Sep 21, 2017 7:24:03 AM com.github.shyiko.mysql.binlog.BinaryLogClient connect</span><br><span class="line">INFO: Connected to mysql:3306 at mysql-bin.000003/154 (sid:184054, cid:7)</span><br><span class="line">2017-09-21 07:24:03,373 INFO   MySQL|dbserver1|binlog  Connected to MySQL binlog at mysql:3306, starting at binlog file <span class="string">'mysql-bin.000003'</span>, pos=154, skipping 0 events plus 0 rows   [io.debezium.connector.mysql.BinlogReader]</span><br><span class="line">2017-09-21 07:25:01,096 INFO   ||  Finished WorkerSourceTask&#123;id=inventory-connector-0&#125; commitOffsets successfully <span class="keyword">in</span> 18 ms   [org.apache.kafka.connect.runtime.WorkerSourceTask]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="查看变更事件"><a href="#查看变更事件" class="headerlink" title="查看变更事件"></a>查看变更事件</h3><p>我们在连接器的输出中看到，事件被写入五个主题：</p>
<ul>
<li><code>dbserver1</code></li>
<li><code>dbserver1.inventory.products</code></li>
<li><code>dbserver1.inventory.products_on_hand</code></li>
<li><code>dbserver1.inventory.customers</code></li>
<li><code>dbserver1.inventory.orders</code></li>
</ul>
<p>如<a href="https://debezium.io/documentation/reference/1.0/connectors/mysql.html#topic-names" target="_blank" rel="noopener">MySQL连接器文档中所述</a>，每个主题名称均以开头<code>dbserver1</code>，这是我们为连接器赋予的逻辑名称。第一个是我们所有DDL语句都写入到的<a href="https://debezium.io/documentation/reference/1.0/connectors/mysql.html#schema-change-topic" target="_blank" rel="noopener">架构更改主题</a>。其余四个主题用于捕获四个表中每个表的更改事件，它们的主题名称包括数据库名称（例如<code>inventory</code>）和表名称。</p>
<p>让我们看一下该<code>dbserver1.inventory.customers</code>主题中的所有数据更改事件。我们将使用<code>debezium/kafka</code>Docker映像来启动一个新容器，该容器运行Kafka的一个实用程序来从主题开始观看该主题：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --name watcher --rm --link zookeeper:zookeeper --link kafka:kafka debezium/kafka:1.0 watch-topic -a -k dbserver1.inventory.customers</span><br></pre></td></tr></table></figure>
<p>再次使用<code>--rm</code>标记，因为我们希望容器在停止时被删除，并且使用<code>-a</code>标记on <code>watch-topic</code>表示我们希望查看自主题开始以来的<em>所有</em>事件。（如果要删除该<code>-a</code>标志，则在开始观看<em>之后</em>，我们只会看到记录在主题中的事件。）该<code>-k</code>标志指定输出应包含事件的键，在我们的例子中，该键包含该行的主键。这是输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Using ZOOKEEPER_CONNECT=172.17.0.3:2181</span><br><span class="line">Using KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://172.17.0.8:9092</span><br><span class="line">Contents of topic dbserver1.inventory.customers:</span><br><span class="line">Using the ConsoleConsumer with old consumer is deprecated and will be removed <span class="keyword">in</span> a future major release. Consider using the new consumer by passing [bootstrap-server] instead of [zookeeper].</span><br><span class="line">&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Key"</span>&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"id"</span>:1001&#125;&#125;	&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"before"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"after"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"version"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"server_id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"ts_sec"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"gtid"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"file"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"pos"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"row"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"boolean"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"snapshot"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"thread"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"db"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"table"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"io.debezium.connector.mysql.Source"</span>,<span class="string">"field"</span>:<span class="string">"source"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"op"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"ts_ms"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Envelope"</span>,<span class="string">"version"</span>:1&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"before"</span>:null,<span class="string">"after"</span>:&#123;<span class="string">"id"</span>:1001,<span class="string">"first_name"</span>:<span class="string">"Sally"</span>,<span class="string">"last_name"</span>:<span class="string">"Thomas"</span>,<span class="string">"email"</span>:<span class="string">"sally.thomas@acme.com"</span>&#125;,<span class="string">"source"</span>:&#123;<span class="string">"version"</span>:<span class="string">"1.0.2.Final"</span>,<span class="string">"name"</span>:<span class="string">"dbserver1"</span>,<span class="string">"server_id"</span>:0,<span class="string">"ts_sec"</span>:0,<span class="string">"gtid"</span>:null,<span class="string">"file"</span>:<span class="string">"mysql-bin.000003"</span>,<span class="string">"pos"</span>:154,<span class="string">"row"</span>:0,<span class="string">"snapshot"</span>:<span class="literal">true</span>,<span class="string">"thread"</span>:null,<span class="string">"db"</span>:<span class="string">"inventory"</span>,<span class="string">"table"</span>:<span class="string">"customers"</span>&#125;,<span class="string">"op"</span>:<span class="string">"c"</span>,<span class="string">"ts_ms"</span>:1490634537160&#125;&#125;</span><br><span class="line">&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Key"</span>&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"id"</span>:1002&#125;&#125;	&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"before"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"after"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"version"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"server_id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"ts_sec"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"gtid"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"file"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"pos"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"row"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"boolean"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"snapshot"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"thread"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"db"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"table"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"io.debezium.connector.mysql.Source"</span>,<span class="string">"field"</span>:<span class="string">"source"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"op"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"ts_ms"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Envelope"</span>,<span class="string">"version"</span>:1&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"before"</span>:null,<span class="string">"after"</span>:&#123;<span class="string">"id"</span>:1002,<span class="string">"first_name"</span>:<span class="string">"George"</span>,<span class="string">"last_name"</span>:<span class="string">"Bailey"</span>,<span class="string">"email"</span>:<span class="string">"gbailey@foobar.com"</span>&#125;,<span class="string">"source"</span>:&#123;<span class="string">"version"</span>:<span class="string">"1.0.2.Final"</span>,<span class="string">"name"</span>:<span class="string">"dbserver1"</span>,<span class="string">"server_id"</span>:0,<span class="string">"ts_sec"</span>:0,<span class="string">"gtid"</span>:null,<span class="string">"file"</span>:<span class="string">"mysql-bin.000003"</span>,<span class="string">"pos"</span>:154,<span class="string">"row"</span>:0,<span class="string">"snapshot"</span>:<span class="literal">true</span>,<span class="string">"thread"</span>:null,<span class="string">"db"</span>:<span class="string">"inventory"</span>,<span class="string">"table"</span>:<span class="string">"customers"</span>&#125;,<span class="string">"op"</span>:<span class="string">"c"</span>,<span class="string">"ts_ms"</span>:1490634537160&#125;&#125;</span><br><span class="line">&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Key"</span>&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"id"</span>:1003&#125;&#125;	&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"before"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"after"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"version"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"server_id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"ts_sec"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"gtid"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"file"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"pos"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"row"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"boolean"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"snapshot"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"thread"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"db"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"table"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"io.debezium.connector.mysql.Source"</span>,<span class="string">"field"</span>:<span class="string">"source"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"op"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"ts_ms"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Envelope"</span>,<span class="string">"version"</span>:1&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"before"</span>:null,<span class="string">"after"</span>:&#123;<span class="string">"id"</span>:1003,<span class="string">"first_name"</span>:<span class="string">"Edward"</span>,<span class="string">"last_name"</span>:<span class="string">"Walker"</span>,<span class="string">"email"</span>:<span class="string">"ed@walker.com"</span>&#125;,<span class="string">"source"</span>:&#123;<span class="string">"version"</span>:<span class="string">"1.0.2.Final"</span>,<span class="string">"name"</span>:<span class="string">"dbserver1"</span>,<span class="string">"server_id"</span>:0,<span class="string">"ts_sec"</span>:0,<span class="string">"gtid"</span>:null,<span class="string">"file"</span>:<span class="string">"mysql-bin.000003"</span>,<span class="string">"pos"</span>:154,<span class="string">"row"</span>:0,<span class="string">"snapshot"</span>:<span class="literal">true</span>,<span class="string">"thread"</span>:null,<span class="string">"db"</span>:<span class="string">"inventory"</span>,<span class="string">"table"</span>:<span class="string">"customers"</span>&#125;,<span class="string">"op"</span>:<span class="string">"c"</span>,<span class="string">"ts_ms"</span>:1490634537160&#125;&#125;</span><br><span class="line">&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Key"</span>&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"id"</span>:1004&#125;&#125;	&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"before"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"after"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"version"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"server_id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"ts_sec"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"gtid"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"file"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"pos"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"row"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"boolean"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"snapshot"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"thread"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"db"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"table"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"io.debezium.connector.mysql.Source"</span>,<span class="string">"field"</span>:<span class="string">"source"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"op"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"ts_ms"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Envelope"</span>,<span class="string">"version"</span>:1&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"before"</span>:null,<span class="string">"after"</span>:&#123;<span class="string">"id"</span>:1004,<span class="string">"first_name"</span>:<span class="string">"Anne"</span>,<span class="string">"last_name"</span>:<span class="string">"Kretchmar"</span>,<span class="string">"email"</span>:<span class="string">"annek@noanswer.org"</span>&#125;,<span class="string">"source"</span>:&#123;<span class="string">"version"</span>:<span class="string">"1.0.2.Final"</span>,<span class="string">"name"</span>:<span class="string">"dbserver1"</span>,<span class="string">"server_id"</span>:0,<span class="string">"ts_sec"</span>:0,<span class="string">"gtid"</span>:null,<span class="string">"file"</span>:<span class="string">"mysql-bin.000003"</span>,<span class="string">"pos"</span>:154,<span class="string">"row"</span>:0,<span class="string">"snapshot"</span>:<span class="literal">true</span>,<span class="string">"thread"</span>:null,<span class="string">"db"</span>:<span class="string">"inventory"</span>,<span class="string">"table"</span>:<span class="string">"customers"</span>&#125;,<span class="string">"op"</span>:<span class="string">"c"</span>,<span class="string">"ts_ms"</span>:1490634537160&#125;&#125;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th></th>
<th>该实用程序一直在监视，因此只要该实用程序继续运行，任何新事件都会自动出现。而且该<code>watch-topic</code>实用程序非常简单，并且功能和实用性受到限制-我们在这里使用它只是为了了解我们的连接器生成的事件的种类。想要使用事件的应用程序将改为使用Kafka使用者，而这些使用者库提供了更大的灵活性和功能。实际上，正确配置的客户端使我们的应用程序永远不会错过任何事件，即使那些应用程序崩溃或正常关闭也是如此。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>这些事件碰巧是用JSON编码的，因为这就是我们配置Kafka Connect服务的方式。每个事件都包含一个JSON文档作为密钥，并包含一个JSON文档。让我们通过首先重新格式化事件的<em>键</em>使其更易于阅读来更详细地查看最后一个事件：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schema"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Key"</span></span><br><span class="line">    <span class="string">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"fields"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"id"</span>,</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"payload"</span>: &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">1004</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>事件的键分为两部分：a <code>schema</code>和<code>payload</code>。该<code>schema</code>包含卡夫卡连接架构描述什么是有效载荷，并在我们的情况下这意味着<code>payload</code>是一个命名结构<code>dbserver1.inventory.customers.Key</code>是不可选的，有一个名为必填字段<code>id</code>类型<code>int32</code>。</p>
<p>如果我们查看键<code>payload</code>字段的值，就会发现它确实是一个结构（在JSON中只是一个对象），只有一个<code>id</code>字段，其值为<code>1004</code>。</p>
<p>因此，我们将此事件解释为适用于主键列的值为的<code>inventory.customers</code>表中的行（来自名为的连接器的输出<code>dbserver1</code>）。<code>id`</code>1004`</p>
<p>现在让我们看一下同一事件的<em>value</em>，我们再次将其重新格式化以使其更易于阅读：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schema"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">    <span class="attr">"fields"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">        <span class="attr">"fields"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"id"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"first_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"last_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"email"</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Value"</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"before"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">        <span class="attr">"fields"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"id"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"first_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"last_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"email"</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Value"</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"after"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">        <span class="attr">"fields"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"version"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"server_id"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"ts_sec"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"gtid"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"file"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"pos"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"row"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"boolean"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"snapshot"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"thread"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"db"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"table"</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"io.debezium.connector.mysql.Source"</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"source"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"op"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"ts_ms"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Envelope"</span>,</span><br><span class="line">    <span class="attr">"version"</span>: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"payload"</span>: &#123;</span><br><span class="line">    <span class="attr">"before"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"after"</span>: &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="number">1004</span>,</span><br><span class="line">      <span class="attr">"first_name"</span>: <span class="string">"Anne"</span>,</span><br><span class="line">      <span class="attr">"last_name"</span>: <span class="string">"Kretchmar"</span>,</span><br><span class="line">      <span class="attr">"email"</span>: <span class="string">"annek@noanswer.org"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"source"</span>: &#123;</span><br><span class="line">      <span class="attr">"version"</span>: <span class="string">"1.0.2.Final"</span>,</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"dbserver1"</span>,</span><br><span class="line">      <span class="attr">"server_id"</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">"ts_sec"</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">"gtid"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"file"</span>: <span class="string">"mysql-bin.000003"</span>,</span><br><span class="line">      <span class="attr">"pos"</span>: <span class="number">154</span>,</span><br><span class="line">      <span class="attr">"row"</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">"snapshot"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">"thread"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"db"</span>: <span class="string">"inventory"</span>,</span><br><span class="line">      <span class="attr">"table"</span>: <span class="string">"customers"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"op"</span>: <span class="string">"c"</span>,</span><br><span class="line">    <span class="attr">"ts_ms"</span>: <span class="number">1486500577691</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>事件的这一部分要大得多，但是像事件的<em>键一样</em>，它也有a <code>schema</code>和a <code>payload</code>。<code>schema</code>包含一个名为<code>dbserver1.inventory.customers.Envelope</code>（版本1）的Kafka Connect模式，该模式可以包含5个字段：</p>
<ul>
<li><code>op</code>是必填字段，其中包含描述操作类型的字符串值。MySQL连接器的值用于<code>c</code>创建（或插入），<code>u</code>用于更新，<code>d</code>用于删除和<code>r</code>用于读取（在非初始快照的情况下）。</li>
<li><code>before</code>是一个可选字段，如果存在，则包含事件发生<em>之前</em>行的状态。该结构将由<code>dbserver1.inventory.customers.Value</code>Kafka Connect模式描述，连接<code>dbserver1</code>器将其用于<code>inventory.customers</code>表中的所有行。</li>
<li><code>after</code>是一个可选字段，如果存在，则包含事件发生<em>后行</em>的状态。该结构由中使用的相同的<code>dbserver1.inventory.customers.Value</code>Kafka Connect模式描述<code>before</code>。</li>
<li><code>source</code> 是必填字段，包含描述事件源元数据的结构，在MySQL中，该字段包含多个字段：连接器名称，记录事件的binlog文件的名称，binlog文件在其中的位置。事件出现，事件中的行（如果有多个），受影响的数据库和表的名称，进行更改的MySQL线程ID，此事件是否是快照的一部分以及MySQL服务器（如果有） ID，以及以秒为单位的时间戳。</li>
<li><code>ts_ms</code> 是可选的，如果存在，则包含连接器处理事件的时间（使用运行Kafka Connect任务的JVM中的系统时钟）。</li>
</ul>
<p>如果我们看一下<code>payload</code>事件的的<em>价值</em>，我们可以看到在事件的信息，即它是在描述该行的创建，包含<code>id</code>，<code>first_name</code>，<code>last_name</code>和<code>email</code>插入行。</p>
<table>
<thead>
<tr>
<th></th>
<th>您可能已经注意到，事件的JSON表示比它们描述的行大得多。这是因为Kafka Connect附带了每个事件密钥，并重视描述<em>有效负载</em>的<em>架构</em>。随着时间的流逝，这种结构可能会发生变化，并且事件本身具有键和值的架构会使得使用应用程序的用户更容易理解消息，尤其是随着时间的发展。Debezium MySQL连接器根据数据库表的结构来构造这些模式。如果使用DDL语句更改MySQL数据库中的表定义，则连接器将读取这些DDL语句并更新其Kafka Connect模式。这是每个事件的结构完全类似于事件发生时的来源表的唯一方式。但是包含单个表的所有事件的Kafka主题可能具有与表定义的每种状态相对应的事件。JSON转换器确实会产生非常冗长的事件，因为它在每条消息中都包含键和值模式。该<a href="http://docs.confluent.io/3.1.2/schema-registry/docs/index.html" target="_blank" rel="noopener">Avro的转换器</a>，在另一方面，是远远聪明，结果小得多事件消息。Avro转换器将每个Kafka Connect架构转换为Avro架构，并将Avro架构存储在单独的架构注册表服务中。因此，当Avro转换器对事件消息进行序列化时，它将仅放置该模式的唯一标识符以及该值的Avro编码的二进制表示形式。因此，通过网络传输并存储在Kafka中的序列化消息比上面显示的要小得多。实际上，Avro Converter能够使用Avro模式演变技术来维护模式注册表中每个模式的历史记录。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>我们可以将它们与数据库状态进行比较。返回到运行MySQL命令行客户端的终端，并运行以下语句：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM customers;</span><br></pre></td></tr></table></figure>
<p>产生以下输出：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+<span class="comment">------+------------+-----------+-----------------------+</span></span><br><span class="line">| id   | first_name | last_name | email                 |</span><br><span class="line">+<span class="comment">------+------------+-----------+-----------------------+</span></span><br><span class="line">| 1001 | Sally      | Thomas    | sally.thomas@acme.com |</span><br><span class="line">| 1002 | George     | Bailey    | gbailey@foobar.com    |</span><br><span class="line">| 1003 | Edward     | Walker    | ed@walker.com         |</span><br><span class="line">| 1004 | Anne       | Kretchmar | annek@noanswer.org    |</span><br><span class="line">+<span class="comment">------+------------+-----------+-----------------------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>如我们所见，所有事件记录都与数据库匹配。</p>
<p>现在我们正在监视更改，<strong>更改</strong>数据库中的记录之一会发生什么？在MySQL命令行客户端中运行以下语句：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; UPDATE customers SET first_name='Anne Marie' WHERE id=1004;</span><br></pre></td></tr></table></figure>
<p>产生以下输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Query OK, 1 row affected (0.05 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br></pre></td></tr></table></figure>
<p>重新运行该<code>select …</code>语句以查看更新的表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from customers;</span><br><span class="line">+<span class="comment">------+------------+-----------+-----------------------+</span></span><br><span class="line">| id   | first_name | last_name | email                 |</span><br><span class="line">+<span class="comment">------+------------+-----------+-----------------------+</span></span><br><span class="line">| 1001 | Sally      | Thomas    | sally.thomas@acme.com |</span><br><span class="line">| 1002 | George     | Bailey    | gbailey@foobar.com    |</span><br><span class="line">| 1003 | Edward     | Walker    | ed@walker.com         |</span><br><span class="line">| 1004 | Anne Marie | Kretchmar | annek@noanswer.org    |</span><br><span class="line">+<span class="comment">------+------------+-----------+-----------------------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>现在，回到终端运行<code>watch-topic</code>，我们应该看到一个<em>新的</em>第五事件：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"schema"</span>:&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Key"</span>&#125;,<span class="attr">"payload"</span>:&#123;<span class="attr">"id"</span>:<span class="number">1004</span>&#125;&#125;	&#123;<span class="attr">"schema"</span>:&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"email"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="attr">"field"</span>:<span class="string">"before"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"email"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="attr">"field"</span>:<span class="string">"after"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"version"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"server_id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"ts_sec"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"gtid"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"file"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"pos"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"row"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"boolean"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"snapshot"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"thread"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"db"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"table"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"io.debezium.connector.mysql.Source"</span>,<span class="attr">"field"</span>:<span class="string">"source"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"op"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"ts_ms"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Envelope"</span>,<span class="attr">"version"</span>:<span class="number">1</span>&#125;,<span class="attr">"payload"</span>:&#123;<span class="attr">"before"</span>:&#123;<span class="attr">"id"</span>:<span class="number">1004</span>,<span class="attr">"first_name"</span>:<span class="string">"Anne"</span>,<span class="attr">"last_name"</span>:<span class="string">"Kretchmar"</span>,<span class="attr">"email"</span>:<span class="string">"annek@noanswer.org"</span>&#125;,<span class="attr">"after"</span>:&#123;<span class="attr">"id"</span>:<span class="number">1004</span>,<span class="attr">"first_name"</span>:<span class="string">"Anne Marie"</span>,<span class="attr">"last_name"</span>:<span class="string">"Kretchmar"</span>,<span class="attr">"email"</span>:<span class="string">"annek@noanswer.org"</span>&#125;,<span class="attr">"source"</span>:&#123;<span class="attr">"version"</span>:<span class="string">"1.0.2.Final"</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1"</span>,<span class="attr">"server_id"</span>:<span class="number">223344</span>,<span class="attr">"ts_sec"</span>:<span class="number">1490635059</span>,<span class="attr">"gtid"</span>:<span class="literal">null</span>,<span class="attr">"file"</span>:<span class="string">"mysql-bin.000003"</span>,<span class="attr">"pos"</span>:<span class="number">364</span>,<span class="attr">"row"</span>:<span class="number">0</span>,<span class="attr">"snapshot"</span>:<span class="literal">null</span>,<span class="attr">"thread"</span>:<span class="number">3</span>,<span class="attr">"db"</span>:<span class="string">"inventory"</span>,<span class="attr">"table"</span>:<span class="string">"customers"</span>&#125;,<span class="attr">"op"</span>:<span class="string">"u"</span>,<span class="attr">"ts_ms"</span>:<span class="number">1490635059389</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>让我们重新格式化新事件的<em>键</em>，以便于阅读：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schema"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Key"</span></span><br><span class="line">    <span class="string">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"fields"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"id"</span>,</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"payload"</span>: &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">1004</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该密钥与我们在第四条记录中看到的密钥完全相同。这是新事件的<em>值，其</em>格式设置为更易于阅读：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schema"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">    <span class="attr">"fields"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">        <span class="attr">"fields"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"id"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"first_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"last_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"email"</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Value"</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"before"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">        <span class="attr">"fields"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"id"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"first_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"last_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"email"</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Value"</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"after"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">        <span class="attr">"fields"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"version"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"server_id"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"ts_sec"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"gtid"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"file"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"pos"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"row"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"boolean"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"snapshot"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"thread"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"db"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"table"</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"io.debezium.connector.mysql.Source"</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"source"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"op"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"ts_ms"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Envelope"</span>,</span><br><span class="line">    <span class="attr">"version"</span>: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"payload"</span>: &#123;</span><br><span class="line">    <span class="attr">"before"</span>: &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="number">1004</span>,</span><br><span class="line">      <span class="attr">"first_name"</span>: <span class="string">"Anne"</span>,</span><br><span class="line">      <span class="attr">"last_name"</span>: <span class="string">"Kretchmar"</span>,</span><br><span class="line">      <span class="attr">"email"</span>: <span class="string">"annek@noanswer.org"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"after"</span>: &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="number">1004</span>,</span><br><span class="line">      <span class="attr">"first_name"</span>: <span class="string">"Anne Marie"</span>,</span><br><span class="line">      <span class="attr">"last_name"</span>: <span class="string">"Kretchmar"</span>,</span><br><span class="line">      <span class="attr">"email"</span>: <span class="string">"annek@noanswer.org"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"source"</span>: &#123;</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"1.0.2.Final"</span>,</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"dbserver1"</span>,</span><br><span class="line">      <span class="attr">"server_id"</span>: <span class="number">223344</span>,</span><br><span class="line">      <span class="attr">"ts_sec"</span>: <span class="number">1486501486</span>,</span><br><span class="line">      <span class="attr">"gtid"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"file"</span>: <span class="string">"mysql-bin.000003"</span>,</span><br><span class="line">      <span class="attr">"pos"</span>: <span class="number">364</span>,</span><br><span class="line">      <span class="attr">"row"</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">"snapshot"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"thread"</span>: <span class="number">3</span>,</span><br><span class="line">      <span class="attr">"db"</span>: <span class="string">"inventory"</span>,</span><br><span class="line">      <span class="attr">"table"</span>: <span class="string">"customers"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"op"</span>: <span class="string">"u"</span>,</span><br><span class="line">    <span class="attr">"ts_ms"</span>: <span class="number">1486501486308</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们将其与第四个事件中的值进行比较时，在该<code>schema</code>部分中没有看到任何更改，而在该部分中看到了一些更改<code>payload</code>：</p>
<ul>
<li>该<code>op</code>字段的值是现在<code>u</code>，表示此行被更改，因为更新</li>
<li><code>before</code>现在，该字段具有行状态以及数据库提交前的值</li>
<li><code>after</code>现在，该字段具有该行的更新状态，在这里可以看到该<code>first_name</code>值是now <code>Anne Marie</code>。</li>
<li>该<code>source</code>场结构具有许多相同的价值观和以前一样，除了<code>ts_sec</code>和<code>pos</code>领域发生了变化（而<code>file</code>可能在其他情况下发生了变化）。</li>
<li>该<code>ts_ms</code>节目的时间戳Debezium处理此事件。</li>
</ul>
<p>仅看本<code>payload</code>节，我们可以学到几件事。我们可以比较<code>before</code>和<code>after</code>结构，以确定由于提交而实际更改的内容。该<code>source</code>结构告诉我们有关MySQL更改记录的信息（提供可追溯性），但更重要的是，它具有可以与本主题和其他主题中的其他事件进行比较的信息，以了解此事件是在同一MySQL之前，之后还是作为其一部分发生的像其他事件一样提交。</p>
<p>到目前为止，我们已经看到了<em>创建</em>和<em>更新</em>事件的示例。现在，让我们看一下<em>删除</em>事件。由于Anne Marie尚未下任何订单，因此我们可以使用MySQL命令行客户端从数据库中删除她的记录：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; DELETE FROM customers WHERE id=1004;</span><br></pre></td></tr></table></figure>
<p>|      | 如果以上命令因违反外键约束而失败，则必须使用以下语句从<em>地址</em>表中删除客户地址的引用：<figure class="highlight plain"><figcaption><span>DELETE FROM addresses WHERE customer_id</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">| ---- | ------------------------------------------------------------ |</span><br><span class="line">|      |                                                              |</span><br><span class="line"></span><br><span class="line">在运行的终端中`watch-topic`，我们看到*两个*新事件：</span><br><span class="line"></span><br><span class="line">```json</span><br><span class="line">&#123;&quot;schema&quot;:&#123;&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[&#123;&quot;type&quot;:&quot;int32&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;id&quot;&#125;],&quot;optional&quot;:false,&quot;name&quot;:&quot;dbserver1.inventory.customers.Key&quot;&#125;,&quot;payload&quot;:&#123;&quot;id&quot;:1004&#125;&#125;	&#123;&quot;schema&quot;:&#123;&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[&#123;&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[&#123;&quot;type&quot;:&quot;int32&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;id&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;first_name&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;last_name&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;email&quot;&#125;],&quot;optional&quot;:true,&quot;name&quot;:&quot;dbserver1.inventory.customers.Value&quot;,&quot;field&quot;:&quot;before&quot;&#125;,&#123;&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[&#123;&quot;type&quot;:&quot;int32&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;id&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;first_name&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;last_name&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;email&quot;&#125;],&quot;optional&quot;:true,&quot;name&quot;:&quot;dbserver1.inventory.customers.Value&quot;,&quot;field&quot;:&quot;after&quot;&#125;,&#123;&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;version&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;name&quot;&#125;,&#123;&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;server_id&quot;&#125;,&#123;&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;ts_sec&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;gtid&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;file&quot;&#125;,&#123;&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;pos&quot;&#125;,&#123;&quot;type&quot;:&quot;int32&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;row&quot;&#125;,&#123;&quot;type&quot;:&quot;boolean&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;snapshot&quot;&#125;,&#123;&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;thread&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;db&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;table&quot;&#125;],&quot;optional&quot;:false,&quot;name&quot;:&quot;io.debezium.connector.mysql.Source&quot;,&quot;field&quot;:&quot;source&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;op&quot;&#125;,&#123;&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;ts_ms&quot;&#125;],&quot;optional&quot;:false,&quot;name&quot;:&quot;dbserver1.inventory.customers.Envelope&quot;,&quot;version&quot;:1&#125;,&quot;payload&quot;:&#123;&quot;before&quot;:&#123;&quot;id&quot;:1004,&quot;first_name&quot;:&quot;Anne Marie&quot;,&quot;last_name&quot;:&quot;Kretchmar&quot;,&quot;email&quot;:&quot;annek@noanswer.org&quot;&#125;,&quot;after&quot;:null,&quot;source&quot;:&#123;&quot;version&quot;:&quot;1.0.2.Final&quot;,&quot;name&quot;:&quot;dbserver1&quot;,&quot;server_id&quot;:223344,&quot;ts_sec&quot;:1490635100,&quot;gtid&quot;:null,&quot;file&quot;:&quot;mysql-bin.000003&quot;,&quot;pos&quot;:725,&quot;row&quot;:0,&quot;snapshot&quot;:null,&quot;thread&quot;:3,&quot;db&quot;:&quot;inventory&quot;,&quot;table&quot;:&quot;customers&quot;&#125;,&quot;op&quot;:&quot;d&quot;,&quot;ts_ms&quot;:1490635100301&#125;&#125;</span><br><span class="line">&#123;&quot;schema&quot;:&#123;&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[&#123;&quot;type&quot;:&quot;int32&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;id&quot;&#125;],&quot;optional&quot;:false,&quot;name&quot;:&quot;dbserver1.inventory.customers.Key&quot;&#125;,&quot;payload&quot;:&#123;&quot;id&quot;:1004&#125;&#125;	&#123;&quot;schema&quot;:null,&quot;payload&quot;:null&#125;</span><br></pre></td></tr></table></figure></p>
<p>发生了什么？我们只删除了一行，但是现在有两个事件。要了解MySQL连接器的作用，让我们看一下两个新消息中的第一个。重新格式化后的<em>键</em>更易于阅读：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schema"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Key"</span></span><br><span class="line">    <span class="string">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"fields"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"id"</span>,</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"payload"</span>: &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">1004</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再次，此密钥与我们查看的前两个事件完全相同。这是第一个新事件的<em>值</em>，其格式设置为更易于阅读：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "schema": &#123;...&#125;,</span><br><span class="line">  "payload": &#123;</span><br><span class="line">    "before": &#123;</span><br><span class="line">      "id": 1004,</span><br><span class="line">      "first_name": "Anne Marie",</span><br><span class="line">      "last_name": "Kretchmar",</span><br><span class="line">      "email": "annek@noanswer.org"</span><br><span class="line">    &#125;,</span><br><span class="line">    "after": null,</span><br><span class="line">    "source": &#123;</span><br><span class="line">      "name": "1.0.2.Final",</span><br><span class="line">      "name": "dbserver1",</span><br><span class="line">      "server_id": 223344,</span><br><span class="line">      "ts_sec": 1486501558,</span><br><span class="line">      "gtid": null,</span><br><span class="line">      "file": "mysql-bin.000003",</span><br><span class="line">      "pos": 725,</span><br><span class="line">      "row": 0,</span><br><span class="line">      "snapshot": null,</span><br><span class="line">      "thread": 3,</span><br><span class="line">      "db": "inventory",</span><br><span class="line">      "table": "customers"</span><br><span class="line">    &#125;,</span><br><span class="line">    "op": "d",</span><br><span class="line">    "ts_ms": 1486501558315</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再次，<code>schema</code>与前面的消息相同，但是该<code>payload</code>片段有一些注意事项：</p>
<ul>
<li>该<code>op</code>字段的值是现在<code>d</code>，这标志着该行已被删除</li>
<li><code>before</code>现在，该字段具有通过数据库提交删除的行的状态</li>
<li>该<code>after</code>字段为空，表示该行不再存在</li>
<li>该<code>source</code>场结构具有许多相同的价值观和以前一样，除了<code>ts_sec</code>和<code>pos</code>领域发生了变化（而<code>file</code>可能在其他情况下发生了变化）。</li>
<li>该<code>ts_ms</code>节目的时间戳Debezium处理此事件。</li>
</ul>
<p>此事件为使用者提供了可用于处理删除此行的各种信息。我们之所以包含旧值，是因为某些消费者可能会要求他们以正确处理删除内容，而没有删除它们，他们可能不得不诉诸更为复杂的行为。</p>
<p>还记得删除行时看到的两个事件吗？让我们看看第二个事件。这是活动的<em>关键</em>：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schema"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Key"</span></span><br><span class="line">    <span class="string">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"fields"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"id"</span>,</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"payload"</span>: &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">1004</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再次，此密钥与我们查看的前三个事件完全相同。这是同一事件的<em>值</em>：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schema"</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">"payload"</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>是什么赋予了？好吧，可以将MySQL连接器写入的所有Kafka主题设置为<em>日志压缩</em>，这意味着Kafka可以从该主题中删除较旧的消息，只要该主题后面至少有一条消息完全相同即可。键。这是卡夫卡收集垃圾的方法。这最后一个事件是Debezium所谓的<em>逻辑删除</em>事件，并且由于它具有一个键和一个空值，Kafka理解它可以使用此键删除所有先前的消息。</p>
<p>Kafka日志压缩很棒，因为它仍然允许消费者从一开始就阅读主题，而不会错过任何事件。</p>
<h3 id="重新启动Kafka-Connect服务"><a href="#重新启动Kafka-Connect服务" class="headerlink" title="重新启动Kafka Connect服务"></a>重新启动Kafka Connect服务</h3><p>Kafka Connect服务的一项功能是，它可以自动管理已注册连接器的任务。并且，由于它将数据存储在Kafka中，因此如果正在运行的服务停止或完全消失，则在重新启动（可能在另一台主机上）时，服务器将启动所有非运行任务。为了说明这一点，让我们停止我们的Kafka Connect服务，更改数据库中的某些数据，然后重新启动我们的服务。</p>
<p>在新的终端中，使用以下Docker命令停止<code>connect</code>运行我们的Kafka Connect服务的容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker stop connect</span><br></pre></td></tr></table></figure>
<p>像这样停止容器将停止在其中运行的进程，但是Kafka Connect服务会通过正常关闭来处理该过程。并且由于我们使用<code>--rm</code>标志运行容器，因此Docker在停止容器后将其删除。</p>
<p>服务关闭时，让我们回到MySQL命令行客户端并添加一些记录：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; INSERT INTO customers VALUES (default, "Sarah", "Thompson", "kitt@acme.com");</span><br><span class="line">mysql&gt; INSERT INTO customers VALUES (default, "Kenneth", "Anderson", "kander@acme.com");</span><br></pre></td></tr></table></figure>
<p>注意，在我们运行的终端中<code>watch-topic</code>，没有更新。另外，由于Kafka仍在运行，因此我们仍然可以观看该主题。</p>
<table>
<thead>
<tr>
<th></th>
<th>在生产系统中，您将有足够的代理来处理生产者和使用者，并为每个主题维护最少数量的同步副本。因此，如果有足够的经纪人失败，以致没有最小的ISR，Kafka应该变得不可用。生产商（例如Debezium连接器）和消费者将只耐心地等待Kafka群集或网络恢复。是的，这意味着您的使用者在数据库中更改数据时可能暂时看不到任何更改事件，但这是因为未生成任何更改事件。一旦Kafka群集重新启动或网络恢复，Debezium将继续产生变更事件，而您的使用者将继续使用中断的事件。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>现在，在新终端中，使用之前使用的<em>相同</em>命令启动新容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --name connect -p 8083:8083 -e GROUP_ID=1 -e CONFIG_STORAGE_TOPIC=my_connect_configs -e OFFSET_STORAGE_TOPIC=my_connect_offsets -e STATUS_STORAGE_TOPIC=my_connect_statuses --link zookeeper:zookeeper --link kafka:kafka --link mysql:mysql debezium/connect:1.0</span><br></pre></td></tr></table></figure>
<p>这将创建一个运行Kafka Connect分布式服务的全新容器，并且由于我们已使用相同的主题信息对其进行了初始化，因此该新服务将连接到Kafka，读取先前服务的配置，并启动已注册的连接器，该连接器将继续在他们最后一次离开。</p>
<p>这是此重启服务的最后几行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:38:48,385 INFO   MySQL|dbserver1|task  Kafka version : 0.11.0.0   [org.apache.kafka.common.utils.AppInfoParser]</span><br><span class="line">2017-09-21 07:38:48,386 INFO   MySQL|dbserver1|task  Kafka commitId : cb8625948210849f   [org.apache.kafka.common.utils.AppInfoParser]</span><br><span class="line">2017-09-21 07:38:48,390 INFO   MySQL|dbserver1|task  Discovered coordinator 172.17.0.4:9092 (id: 2147483646 rack: null) <span class="keyword">for</span> group inventory-connector-dbhistory.   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:38:48,390 INFO   MySQL|dbserver1|task  Revoking previously assigned partitions [] <span class="keyword">for</span> group inventory-connector-dbhistory   [org.apache.kafka.clients.consumer.internals.ConsumerCoordinator]</span><br><span class="line">2017-09-21 07:38:48,391 INFO   MySQL|dbserver1|task  (Re-)joining group inventory-connector-dbhistory   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:38:48,402 INFO   MySQL|dbserver1|task  Successfully joined group inventory-connector-dbhistory with generation 1   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:38:48,403 INFO   MySQL|dbserver1|task  Setting newly assigned partitions [dbhistory.inventory-0] <span class="keyword">for</span> group inventory-connector-dbhistory   [org.apache.kafka.clients.consumer.internals.ConsumerCoordinator]</span><br><span class="line">2017-09-21 07:38:48,888 INFO   MySQL|dbserver1|task  Step 0: Get all known binlogs from MySQL   [io.debezium.connector.mysql.MySqlConnectorTask]</span><br><span class="line">2017-09-21 07:38:48,903 INFO   MySQL|dbserver1|task  MySQL has the binlog file <span class="string">'mysql-bin.000003'</span> required by the connector   [io.debezium.connector.mysql.MySqlConnectorTask]</span><br><span class="line">Sep 21, 2017 7:38:49 AM com.github.shyiko.mysql.binlog.BinaryLogClient connect</span><br><span class="line">INFO: Connected to mysql:3306 at mysql-bin.000003/154 (sid:184054, cid:10)</span><br><span class="line">2017-09-21 07:38:49,045 INFO   MySQL|dbserver1|binlog  Connected to MySQL binlog at mysql:3306, starting at binlog file <span class="string">'mysql-bin.000003'</span>, pos=154, skipping 0 events plus 0 rows   [io.debezium.connector.mysql.BinlogReader]</span><br><span class="line">2017-09-21 07:38:49,046 INFO   ||  Source task WorkerSourceTask&#123;id=inventory-connector-0&#125; finished initialization and start   [org.apache.kafka.connect.runtime.WorkerSourceTask]</span><br></pre></td></tr></table></figure>
<p>如您所见，这些行显示该服务在关闭之前找到了上一个任务先前记录的偏移量，然后它连接到MySQL数据库，开始从该位置读取binlog，并根据任何更改生成事件从那时起在MySQL数据库中运行。</p>
<p>跳回到运行中的终端<code>watch-topic</code>，您现在应该看到两个新记录的事件：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"schema"</span>:&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Key"</span>&#125;,<span class="attr">"payload"</span>:&#123;<span class="attr">"id"</span>:<span class="number">1005</span>&#125;&#125;	&#123;<span class="attr">"schema"</span>:&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"email"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="attr">"field"</span>:<span class="string">"before"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"email"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="attr">"field"</span>:<span class="string">"after"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"version"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"server_id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"ts_sec"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"gtid"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"file"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"pos"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"row"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"boolean"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"snapshot"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"thread"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"db"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"table"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"io.debezium.connector.mysql.Source"</span>,<span class="attr">"field"</span>:<span class="string">"source"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"op"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"ts_ms"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Envelope"</span>,<span class="attr">"version"</span>:<span class="number">1</span>&#125;,<span class="attr">"payload"</span>:&#123;<span class="attr">"before"</span>:<span class="literal">null</span>,<span class="attr">"after"</span>:&#123;<span class="attr">"id"</span>:<span class="number">1005</span>,<span class="attr">"first_name"</span>:<span class="string">"Sarah"</span>,<span class="attr">"last_name"</span>:<span class="string">"Thompson"</span>,<span class="attr">"email"</span>:<span class="string">"kitt@acme.com"</span>&#125;,<span class="attr">"source"</span>:&#123;<span class="attr">"version"</span>:<span class="string">"1.0.2.Final"</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1"</span>,<span class="attr">"server_id"</span>:<span class="number">223344</span>,<span class="attr">"ts_sec"</span>:<span class="number">1490635153</span>,<span class="attr">"gtid"</span>:<span class="literal">null</span>,<span class="attr">"file"</span>:<span class="string">"mysql-bin.000003"</span>,<span class="attr">"pos"</span>:<span class="number">1046</span>,<span class="attr">"row"</span>:<span class="number">0</span>,<span class="attr">"snapshot"</span>:<span class="literal">null</span>,<span class="attr">"thread"</span>:<span class="number">3</span>,<span class="attr">"db"</span>:<span class="string">"inventory"</span>,<span class="attr">"table"</span>:<span class="string">"customers"</span>&#125;,<span class="attr">"op"</span>:<span class="string">"c"</span>,<span class="attr">"ts_ms"</span>:<span class="number">1490635181455</span>&#125;&#125;</span><br><span class="line">&#123;<span class="attr">"schema"</span>:&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Key"</span>&#125;,<span class="attr">"payload"</span>:&#123;<span class="attr">"id"</span>:<span class="number">1006</span>&#125;&#125;	&#123;<span class="attr">"schema"</span>:&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"email"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="attr">"field"</span>:<span class="string">"before"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"email"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="attr">"field"</span>:<span class="string">"after"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"version"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"server_id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"ts_sec"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"gtid"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"file"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"pos"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"row"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"boolean"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"snapshot"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"thread"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"db"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"table"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"io.debezium.connector.mysql.Source"</span>,<span class="attr">"field"</span>:<span class="string">"source"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"op"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"ts_ms"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Envelope"</span>,<span class="attr">"version"</span>:<span class="number">1</span>&#125;,<span class="attr">"payload"</span>:&#123;<span class="attr">"before"</span>:<span class="literal">null</span>,<span class="attr">"after"</span>:&#123;<span class="attr">"id"</span>:<span class="number">1006</span>,<span class="attr">"first_name"</span>:<span class="string">"Kenneth"</span>,<span class="attr">"last_name"</span>:<span class="string">"Anderson"</span>,<span class="attr">"email"</span>:<span class="string">"kander@acme.com"</span>&#125;,<span class="attr">"source"</span>:&#123;<span class="attr">"version"</span>:<span class="string">"1.0.2.Final"</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1"</span>,<span class="attr">"server_id"</span>:<span class="number">223344</span>,<span class="attr">"ts_sec"</span>:<span class="number">1490635160</span>,<span class="attr">"gtid"</span>:<span class="literal">null</span>,<span class="attr">"file"</span>:<span class="string">"mysql-bin.000003"</span>,<span class="attr">"pos"</span>:<span class="number">1356</span>,<span class="attr">"row"</span>:<span class="number">0</span>,<span class="attr">"snapshot"</span>:<span class="literal">null</span>,<span class="attr">"thread"</span>:<span class="number">3</span>,<span class="attr">"db"</span>:<span class="string">"inventory"</span>,<span class="attr">"table"</span>:<span class="string">"customers"</span>&#125;,<span class="attr">"op"</span>:<span class="string">"c"</span>,<span class="attr">"ts_ms"</span>:<span class="number">1490635181456</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>这些事件是与我们之前看到的事件类似的<em>创建</em>事件。但是，需要理解的重要一点是，只要在MySQL数据库开始清除我们从其binlog中错过的提交之前重新启动，即使Debezium仍在运行时，它仍将报告数据库中的所有更改。</p>
<h3 id="探索"><a href="#探索" class="headerlink" title="探索"></a>探索</h3><p>继续并使用MySQL命令行客户端在数据库表中添加，修改和删除行，然后查看对主题的影响。您可能需要<code>watch-topic</code>为每个主题运行单独的命令。请记住，您不能删除外键引用的行。玩得开心！</p>
<h3 id="清理"><a href="#清理" class="headerlink" title="清理"></a>清理</h3><p>您可以使用Docker停止所有正在运行的容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker stop mysqlterm watcher connect mysql kafka zookeeper</span><br></pre></td></tr></table></figure>
<p>同样，由于我们<code>--rm</code>在启动连接器时使用了该标志，因此Docker应该在停止连接器后立即将其删除。我们可以验证所有其他进程都已停止并删除：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps -a</span><br></pre></td></tr></table></figure>
<p>当然，如果仍在运行，只需使用<code>docker stop &lt;name&gt;</code>或停止它们<code>docker stop &lt;containerId&gt;</code>。</p>
<h2 id="Docker-Compose设置"><a href="#Docker-Compose设置" class="headerlink" title="Docker Compose设置"></a>Docker Compose设置</h2><p>如果您已经完成了本教程，并且想快速进行设置，那么可以使用<a href="https://github.com/debezium/debezium-examples/tree/master/tutorial" target="_blank" rel="noopener">示例存储库中</a>的本教程的<a href="https://docs.docker.com/compose/" target="_blank" rel="noopener">Docker Compose</a>版本。我们提供Docker Compose文件，用于与MySQL，Postgres，MongoDB，SQL Server和Oracle一起运行本教程。请按照<a href="https://github.com/debezium/debezium-examples/blob/master/tutorial/README.md" target="_blank" rel="noopener">自述文件中</a>描述的步骤进行<a href="https://github.com/debezium/debezium-examples/blob/master/tutorial/README.md" target="_blank" rel="noopener">操作</a>。</p>

    
    </div>
    
    
</article>




    
    
    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2020 肖飞&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow has-text-black" href="https://github.com/xyfigo">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        //plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {matchFontHeight: false},
        SVG: {matchFontHeight: false},
        CommonHTML: {matchFontHeight: false}
    });
</script>

    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    

    


<script src="/js/script.js"></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="站内搜索">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js"></script>
    
</body>
</html>