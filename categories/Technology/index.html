<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
<title>分类: Technology - 自然资源部一线码农——肖飞的博客：带你走进政务系统云原生的世界</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">






<link rel="icon" href="/favicon.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet" href="/css/style.css">
<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>

</head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                <img src="/images/logo.png" alt height="28">
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item " href="/archives">文章列表</a>
            
            <a class="navbar-item " href="/categories/Lifestyle">Lifestyle</a>
            
            <a class="navbar-item " href="/categories/Music">Music</a>
            
            <a class="navbar-item is-active" href="/categories/Technology">Technology</a>
            
            <a class="navbar-item " href="/categories/Research">Research</a>
            
            <a class="navbar-item " href="/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            
            <a class="navbar-item" href="https://github.com/xyfigo">
                
                <i class="fab fa-github"></i>
                
            </a>
               
            
        </div>
    </div>
</nav>

    <section class="section section-heading">
    <div class="container">
        <div class="content">
            <h5><i class="far fa-folder"></i>Technology</h5>
        </div>
    </div>
</section>
<section class="section">
    <div class="container">
    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2020/12/29/精通Pandas探索性分析（二）：数据选择/" itemprop="url">精通Pandas探索性分析（二）：数据选择</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2020-12-29T12:22:42.000Z" itemprop="datePublished">2 小时前</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Technology/">Technology</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            19 分钟 读完 (约 2919 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>在本章中，我们将学习使用 Pandas 进行数据选择的高级技术，如何选择数据子集，如何从数据集中选择多个行和列，如何对 Pandas 数据帧或一序列数据进行排序，如何过滤 Pandas 数据帧的角色，还学习如何将多个过滤器应用于 Pandas 数据帧。 我们还将研究如何在 Pandas 中使用<code>axis</code>参数以及在 Pandas 中使用字符串方法。 最后，我们将学习如何更改 Pandas 序列的数据类型。</p>
<p>首先，我们将学习如何从 Pandas 数据帧中选择数据子集并创建序列对象。 我们将从导入真实数据集开始。 我们将介绍一些 Pandas 数据选择方法，并将这些方法应用于实际数据集，以演示数据子集的选择。</p>
<p>在本章中，我们将讨论以下主题：</p>
<ul>
<li>从数据集中选择数据</li>
<li>排序数据集</li>
<li>使用 Pandas 数据帧过滤行</li>
<li>使用多个条件（例如 AND，OR 和 ISIN）过滤数据</li>
<li>在 Pandas 中使用<code>axis</code>参数</li>
<li>更改 Pandas 序列的数据类型</li>
</ul>
<h2 id="数据集简介"><a href="#数据集简介" class="headerlink" title="数据集简介"></a>数据集简介</h2><p>我们将使用 <a href="https://www.zillow.com/" target="_blank" rel="noopener">zillow.com</a> 的真实数据集，这是一个在线房地产市场，其发布房价数据集是他们研究工作的一部分。 这些数据集可在公共领域获得，并在归属于 <a href="https://www.zillow.com/" target="_blank" rel="noopener">zillow.com</a> 后可免费使用。 我们将使用<a href="https://www.zillow.com/research/data/" target="_blank" rel="noopener">有关美国地区平均房价的最新数据</a>。 它是 CSV 数据集，或带有 CSV 的文本文件。 让我们首先将 pandas 模块导入到 Jupyter 笔记本中，如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">data = pd.read_csv(<span class="string">'data-zillow.csv'</span>, sep=<span class="string">','</span>)</span><br></pre></td></tr></table></figure>
<h2 id="从数据集中选择数据"><a href="#从数据集中选择数据" class="headerlink" title="从数据集中选择数据"></a>从数据集中选择数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">regions = data[<span class="string">'RegionName'</span>] <span class="comment">#根据列名选择</span></span><br><span class="line">type(regions) <span class="comment">#series对象</span></span><br></pre></td></tr></table></figure>
<h2 id="多列选择"><a href="#多列选择" class="headerlink" title="多列选择"></a>多列选择</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">region_n_state = data[[<span class="string">'RegionName'</span>, <span class="string">'State'</span>]] <span class="comment">#传递列名数组，选择多个列</span></span><br><span class="line">region_n_state.head() </span><br><span class="line">type(region_n_state)<span class="comment">#DataFrame对象</span></span><br></pre></td></tr></table></figure>
<h2 id="点表示法"><a href="#点表示法" class="headerlink" title="点表示法"></a>点表示法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data.State<span class="comment">#选择单列</span></span><br><span class="line">data[<span class="string">'Address'</span>] = data.County + <span class="string">', '</span> + data.Metro + <span class="string">', '</span> + data.State<span class="comment">#生成新列</span></span><br></pre></td></tr></table></figure>
<h2 id="从-Pandas-数据帧中选择多个行和列"><a href="#从-Pandas-数据帧中选择多个行和列" class="headerlink" title="从 Pandas 数据帧中选择多个行和列"></a>从 Pandas 数据帧中选择多个行和列</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zillow.loc[<span class="number">7</span>, <span class="string">'Metro'</span>] <span class="comment">#行索引7，列名为Metro</span></span><br><span class="line">zillow.iloc[<span class="number">7</span>,<span class="number">4</span>]<span class="comment">#行索引7，列索引4</span></span><br></pre></td></tr></table></figure>
<h2 id="选择单行和多列"><a href="#选择单行和多列" class="headerlink" title="选择单行和多列"></a>选择单行和多列</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zillow.loc[<span class="number">7</span>, [<span class="string">'Metro'</span>, <span class="string">'County'</span>]] </span><br><span class="line">zillow.iloc[<span class="number">7</span>,[<span class="number">4</span>,<span class="number">5</span>]]</span><br><span class="line">zillow.loc[<span class="number">11</span>,:]</span><br></pre></td></tr></table></figure>
<h2 id="选择多行和单列"><a href="#选择多行和单列" class="headerlink" title="选择多行和单列"></a>选择多行和单列</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zillow.loc[<span class="number">101</span>:<span class="number">105</span>, <span class="string">'Metro'</span>]</span><br></pre></td></tr></table></figure>
<h2 id="选择多行和多列"><a href="#选择多行和多列" class="headerlink" title="选择多行和多列"></a>选择多行和多列</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zillow.loc[<span class="number">201</span>:<span class="number">204</span>, <span class="string">"State"</span>:<span class="string">"County"</span>] </span><br><span class="line">zillow.iloc[<span class="number">201</span>:<span class="number">205</span>, <span class="number">3</span>:<span class="number">6</span>] </span><br><span class="line">zillow.loc[<span class="number">201</span>:<span class="number">205</span>, [<span class="string">'RegionName'</span>, <span class="string">'State'</span>]]</span><br></pre></td></tr></table></figure>
<h2 id="从行和所有列的范围中选择值"><a href="#从行和所有列的范围中选择值" class="headerlink" title="从行和所有列的范围中选择值"></a>从行和所有列的范围中选择值</h2><p>在这里，我们将使用<code>loc</code>方法查看行和列序列中的值。 为此，<code>loc</code>方法的第一个参数是要选择的行的范围索引。 由于我们需要所有列中的值，因此我们将冒号（<code>:</code>）作为第二个参数，如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zillow.loc[<span class="number">201</span>:<span class="number">205</span>, :] </span><br><span class="line">zillow.loc[[<span class="number">0</span>,<span class="number">5</span>,<span class="number">10</span>], :]  <span class="comment">#选择不连续的行</span></span><br><span class="line">zillow.loc[zillow.County==<span class="string">"Queens"</span>] <span class="comment">#选择County列的值为Queens的行</span></span><br><span class="line">zillow.loc[zillow.Metro==<span class="string">"New York"</span>, <span class="string">"County"</span>] <span class="comment">#从County列中选择Metro列为New York的行</span></span><br></pre></td></tr></table></figure>
<h2 id="对pandas数据帧排序"><a href="#对pandas数据帧排序" class="headerlink" title="对pandas数据帧排序"></a>对pandas数据帧排序</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">zillow.sort_values(<span class="string">'Metro'</span>) <span class="comment">#对Metro列排序（默认升序）</span></span><br><span class="line">sorted = zillow.sort_values(<span class="string">'Metro'</span>, ascending=<span class="literal">False</span>) <span class="comment">#降序排序</span></span><br><span class="line">sorted = zillow.sort_values(by=[<span class="string">'Metro'</span>,<span class="string">'County'</span>]) <span class="comment">#按Metro首先对数据进行排序，然后按County列进行排</span></span><br><span class="line">sorted = zillow.sort_values(by=[<span class="string">'Metro'</span>,<span class="string">'County'</span>, <span class="string">'Zhvi'</span>], ascending=[<span class="literal">True</span>, <span class="literal">True</span>, <span class="literal">False</span>]) </span><br><span class="line">regions = zillow.RegionID</span><br><span class="line">regions.sort_values() <span class="comment">#对Series对象排序</span></span><br></pre></td></tr></table></figure>
<h2 id="过滤-Pandas-数据帧的行"><a href="#过滤-Pandas-数据帧的行" class="headerlink" title="过滤 Pandas 数据帧的行"></a>过滤 Pandas 数据帧的行</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">filtered_data = data.filter(items=[<span class="string">'State'</span>, <span class="string">'Metro'</span>]) <span class="comment">#使用filter方法过滤列</span></span><br><span class="line">filtered_data = data.filter(regex=<span class="string">'Region'</span>, axis=<span class="number">1</span>) <span class="comment">#使用正则表达式过滤列名称</span></span><br><span class="line">price_filter_series = data[<span class="string">'Zhvi'</span>] &gt; <span class="number">500000</span> </span><br><span class="line">data[price_filter_series]</span><br><span class="line">data[data.Zhvi &gt;= <span class="number">1000000</span>]  <span class="comment">#过滤Zhvi列大于1000000的行</span></span><br></pre></td></tr></table></figure>
<h2 id="将多个过滤条件应用于-Pandas-数据帧"><a href="#将多个过滤条件应用于-Pandas-数据帧" class="headerlink" title="将多个过滤条件应用于 Pandas 数据帧"></a>将多个过滤条件应用于 Pandas 数据帧</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data[(data[<span class="string">'Zhvi'</span>] &gt; <span class="number">1000000</span>) &amp; (data[<span class="string">'State'</span>] == <span class="string">'NY'</span>)]  <span class="comment">#选择价格值大于 1,000,000 且State为New York的行</span></span><br><span class="line">data[((data[<span class="string">'State'</span>] == <span class="string">'CA'</span>) | (data[<span class="string">'State'</span>] == <span class="string">'NY'</span>))]</span><br></pre></td></tr></table></figure>
<h2 id="使用isin方法进行过滤"><a href="#使用isin方法进行过滤" class="headerlink" title="使用isin方法进行过滤"></a>使用<code>isin</code>方法进行过滤</h2><p>筛选数据的另一种方法是使用<code>isin</code>方法。 我们可以使用<code>isin</code>方法通过一个或多个特定列的值列表来过滤数据集。 在这里，我们仅从<code>Metro</code>列中选择值<code>New York</code>或<code>San Francisco</code>的那些记录。</p>
<p>我们在<code>Metro</code>列上调用<code>isin</code>方法，并将其传递给包含我们要选择的城市的列表。 这将创建一个布尔序列。 然后，我们将布尔序列传递给数据集数据帧进行必要的过滤和选择，如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filter = data[<span class="string">'Metro'</span>].isin([<span class="string">'New York'</span>, <span class="string">'San Francisco'</span>]) </span><br><span class="line">data[filter].head()</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/7b51ee0f-ccbe-4363-a616-5a693a8e4b30.png" alt="img"></p>
<h2 id="在多个条件下使用isin方法"><a href="#在多个条件下使用isin方法" class="headerlink" title="在多个条件下使用isin方法"></a>在多个条件下使用<code>isin</code>方法</h2><p>我们还可以使用<code>isin</code>方法根据来自多列的值过滤行。 为了执行此操作，我们传递了一个字典对象，其中的键是列名，而值是我们要从中选择记录的那些列的值的列表。</p>
<p>举个例子，让我们选择<code>State</code>参数为<code>California</code>和<code>Metro</code>参数为<code>San Francisco</code>的值。 我们使用包含要选择的值的这两列创建一个字典对象，然后将该字典项传递给<code>isin</code>方法，并在数据集上调用<code>isin</code>方法。 然后，将过滤器传递给数据帧并选择我们的记录，如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filter = data.isin(&#123;<span class="string">'State'</span>: [<span class="string">'CA'</span>], <span class="string">'Metro'</span>: [<span class="string">'San Francisco'</span>]&#125;) </span><br><span class="line">data[filter].head()</span><br></pre></td></tr></table></figure>
<h2 id="在-Pandas-中使用axis参数"><a href="#在-Pandas-中使用axis参数" class="headerlink" title="在 Pandas 中使用axis参数"></a>在 Pandas 中使用<code>axis</code>参数</h2><p>在本节中，我们将学习在 Pandas 中进行数据分析时何时何地使用<code>axis</code>参数或关键字。 我们将介绍<code>axis</code>参数，并逐步介绍可以将<code>axis</code>关键字设置为的各种值。 我们将演示如何将<code>axis</code>设置为行或列来改变方法的行为。 我们还将展示一些使用<code>axis</code>关键字的代码示例。</p>
<h2 id="axis参数的用法"><a href="#axis参数的用法" class="headerlink" title="axis参数的用法"></a><code>axis</code>参数的用法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.axes</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/25d4ab25-5e9f-4de6-a627-76f9c2d5b2d4.png" alt="img"></p>
<p>在<code>axis</code>用法示例中，我们计算数据集中值的平均值。 我们已将<code>axis</code>传递为<code>0</code>。 这意味着将沿着行<code>axis</code>计算平均值，如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.mean(axis=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/a764a72c-d397-4f59-bcac-229a1a5924ef.png" alt="img"></p>
<p>接下来，我们将<code>axis</code>设置为<code>1</code>。 我们在同一数据集上使用完全相同的方法； 但是，我们正在将<code>axis</code>从<code>0</code>更改为<code>1</code>。 由于我们将<code>axis</code>设置为<code>1</code>，因此<code>mean</code>的计算如下：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.mean(axis=<span class="number">1</span>).head()</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/193b4742-a7e8-4868-9053-147075cb3dbf.png" alt="img"></p>
<p>有时很难记住<code>0</code>或<code>1</code>是用于行还是用于列。 因此，您可以将<code>axis</code>设置为<code>rows</code>而不是使用<code>axis0</code>：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.mean(axis=<span class="string">'rows'</span>)</span><br></pre></td></tr></table></figure>
<p>输出为以下内容：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/7f4de7ab-7c2c-48c0-8603-8e931992a1d5.png" alt="img"></p>
<p>对于列，您可以将<code>axis</code>设置为<code>columns</code>。 与使用<code>0</code>或<code>1</code>具有相同的效果：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.mean(axis=<span class="string">'columns'</span>).head()</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/e1672cd1-4c1d-4905-a005-1360a6a3b98e.png" alt="img"></p>
<h2 id="axis关键字的更多示例"><a href="#axis关键字的更多示例" class="headerlink" title="axis关键字的更多示例"></a><code>axis</code>关键字的更多示例</h2><p>在这里，我们使用<code>drop</code>方法删除行或记录。 我们通过将关键字<code>axis</code>传递为<code>0</code>来告诉<code>drop</code>方法将记录删除到<code>0</code>的索引处：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data.drop(<span class="number">0</span>, axis=<span class="number">0</span>) <span class="comment">#删除第0行</span></span><br><span class="line">data.drop(<span class="string">'Date'</span>, axis=<span class="number">1</span>).head <span class="comment">#删除带有Date标签的列</span></span><br></pre></td></tr></table></figure>
<h2 id="axis关键字"><a href="#axis关键字" class="headerlink" title="axis关键字"></a><code>axis</code>关键字</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.filter(regex=<span class="string">'Region'</span>, axis=<span class="number">1</span>) <span class="comment">#过滤列名为正则表达式'Region'的列</span></span><br></pre></td></tr></table></figure>
<h2 id="在-Pandas-中使用字符串方法"><a href="#在-Pandas-中使用字符串方法" class="headerlink" title="在 Pandas 中使用字符串方法"></a>在 Pandas 中使用字符串方法</h2><p>在本节中，我们将学习在 Pandas 序列中使用各种字符串方法。 我们将把真实的数据集读入 Pandas。 我们将探索一些字符串方法，并将使用这些字符串方法从数据集中选择和更改值。</p>
<h2 id="检查子串"><a href="#检查子串" class="headerlink" title="检查子串"></a>检查子串</h2><p>为了学习如何使用字符串方法检查 Pandas 序列的子字符串，我们使用<code>str</code>包中的<code>contains</code>方法。</p>
<p>在这里，我们从数据集中调用<code>RegionName</code>序列上的<code>str.contains</code>方法。 我们正在寻找包含<code>New</code>子字符串的记录。 它打印出一个布尔序列，打印<code>True</code>找到一个子字符串，而<code>False</code>找到一个子字符串：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data[data.RegionName.str.contains(<span class="string">'New'</span>)] <span class="comment">#过滤RegionName列中包含New字符串的行</span></span><br></pre></td></tr></table></figure>
<h2 id="将序列或列值更改为大写"><a href="#将序列或列值更改为大写" class="headerlink" title="将序列或列值更改为大写"></a>将序列或列值更改为大写</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.RegionName.str.upper()</span><br></pre></td></tr></table></figure>
<h2 id="将值更改为小写"><a href="#将值更改为小写" class="headerlink" title="将值更改为小写"></a>将值更改为小写</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data.County.str.lower()</span><br><span class="line">data.County.str.len()<span class="comment">#查找列中每个值的长度</span></span><br><span class="line">data.RegionName.str.lstrip()<span class="comment">#删除空格</span></span><br><span class="line">data.RegionName.str.replace(<span class="string">' '</span>,<span class="string">''</span>)<span class="comment">#空格替换为无空格</span></span><br></pre></td></tr></table></figure>
<h2 id="更改-Pandas-序列的数据类型"><a href="#更改-Pandas-序列的数据类型" class="headerlink" title="更改 Pandas 序列的数据类型"></a>更改 Pandas 序列的数据类型</h2><p>在本节中，我们将学习如何更改 Pandas 序列的数据类型。 我们将看到读取其中的数据后如何更改数据类型。 我们还将学习在读取 Pandas 数据时如何更改数据类型。 我们将通过一个示例将<code>int</code>列更改为<code>float</code>。 我们还将看到如何将字符串值列转换为<code>datetime</code>数据类型。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data[<span class="string">'Zhvi'</span>] = data.Zhvi.astype(float) <span class="comment">#将int数据类型列更改为float</span></span><br></pre></td></tr></table></figure>
<h2 id="读取数据时更改数据类型"><a href="#读取数据时更改数据类型" class="headerlink" title="读取数据时更改数据类型"></a>读取数据时更改数据类型</h2><p>在将数据读入 pandas 之后，我们只是更改了列的数据类型。 另外，我们可以在读取数据时更改数据类型。 为此，我们将列名和数据类型传递到要更改为<code>read</code>数据方法的列中。 我们想要的<code>float</code>列已导入为<code>float64</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data2 = pd.read_csv(<span class="string">'data-zillow.csv'</span>, sep=<span class="string">','</span>, dtype=&#123;<span class="string">'Zhvi'</span>:float&#125;) </span><br><span class="line">data2.dtypes</span><br></pre></td></tr></table></figure>
<h2 id="将字符串转换为日期时间"><a href="#将字符串转换为日期时间" class="headerlink" title="将字符串转换为日期时间"></a>将字符串转换为日期时间</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.to_datetime(data2.Date,infer_datetime_format=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/2?id=总结" target="_blank" rel="noopener">总结</a></h1><p>在本章中，我们学习了从 Pandas 数据帧中选择数据子集的方法。 我们还了解了如何将这些方法应用于真实数据集。 我们还了解了从已读入 Pandas 的数据集中选择多个行和列的方法，并将这些方法应用于实际数据集以演示选择数据子集的方法。 我们了解了 Pandas <code>sort_values</code>方法。 我们看到了使用<code>sort_values</code>方法对 Pandas 数据帧中的数据进行排序的各种方法。 我们还学习了如何对 Pandas 序列对象进行排序。 我们了解了用于从 Pandas 数据帧过滤行和列的方法。 我们介绍了几种方法来实现此目的。 我们了解了 Pandas 的<code>filter</code>方法以及如何在实际数据集中使用它。 我们还学习了根据从数据创建的布尔序列过滤数据的方法，并且学习了如何将过滤数据的条件直接传递给数据帧。 我们学习了 Pandas 数据选择的各种技术，以及如何选择数据子集。 我们还学习了如何从数据集中选择多个角色和列。 我们学习了如何对 Pandas 数据帧或序列进行排序。 我们逐步介绍了如何过滤 Pandas 数据帧的行，如何对此类数据帧应用多个过滤器以及如何在 Pandas 中使用<code>axis</code>参数。 我们还研究了字符串方法在 Pandas 中的使用，最后，我们学习了如何更改 Pandas 序列的数据类型。</p>
<p>在下一章中，我们将学习处理，转换和重塑数据的技术。</p>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2020/12/28/精通 Pandas 探索性分析（一）/" itemprop="url">精通Pandas探索性分析</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2020-12-28T15:19:36.000Z" itemprop="datePublished">1 天前</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Technology/">Technology</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            1 小时 读完 (约 10577 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2 id="从-CSV-文件读取数据时使用高级选项"><a href="#从-CSV-文件读取数据时使用高级选项" class="headerlink" title="从 CSV 文件读取数据时使用高级选项"></a>从 CSV 文件读取数据时使用高级选项</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">df = pd.read_csv(<span class="string">'IMDB.csv'</span>, encoding=<span class="string">"UTF-8"</span>,</span><br><span class="line">                 header=<span class="number">2</span>,<span class="comment">#指定行为列名</span></span><br><span class="line">                 index_col=<span class="string">"Title"</span>,<span class="comment">#指定列为索引</span></span><br><span class="line">                 usecols=[<span class="string">'Title'</span>,<span class="string">'Genre1'</span>],<span class="comment">#选择要读取的列的子集</span></span><br><span class="line">                 na_values[<span class="string">''</span>],<span class="comment">#将视为NaN的值列表传递给读取函数</span></span><br><span class="line">                 skip_blank_lines=<span class="literal">False</span>,<span class="comment">#默认情况下，read_csv会忽略空白行，但是我们可以通过将skip_blank_lines设置为False来关闭此行</span></span><br><span class="line">                 skiprows=[<span class="number">1</span>,<span class="number">3</span>,<span class="number">7</span>],<span class="comment">#选择跳过哪些行</span></span><br><span class="line">                 skipfooter=<span class="number">2</span>,<span class="comment">#从页脚或文件末尾跳过行</span></span><br><span class="line">                 nrows=<span class="number">100</span>,<span class="comment">#仅读取数据集中的前一百行</span></span><br><span class="line">                )</span><br></pre></td></tr></table></figure>
<h3 id="查看数据"><a href="#查看数据" class="headerlink" title="查看数据"></a>查看数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df.head()</span><br><span class="line">df.tail()</span><br><span class="line">df.shape</span><br></pre></td></tr></table></figure>
<h2 id="从-Excel-文件读取数据"><a href="#从-Excel-文件读取数据" class="headerlink" title="从 Excel 文件读取数据"></a>从 Excel 文件读取数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>, sheetname=<span class="number">0</span>)</span><br><span class="line">xls_file = pd.ExcelFile(<span class="string">'IMDB.xlsx'</span>)</span><br><span class="line">xls_file.sheet_names</span><br><span class="line"><span class="comment">#读取多个工作表</span></span><br><span class="line">df1 = xls_file.parse(<span class="string">'movies'</span>)</span><br><span class="line">df2 = xls_file.parse(<span class="string">'by genre'</span>)</span><br><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>, </span><br><span class="line">                   sheetname=<span class="number">1</span>, <span class="comment">#读取第2个表格</span></span><br><span class="line">                   header=<span class="number">3</span>,<span class="comment">#第4行为标题</span></span><br><span class="line">                   header=<span class="literal">None</span>,<span class="comment">#没有标题</span></span><br><span class="line">                   skiprows=<span class="number">7</span>,<span class="comment">#跳过开头的行</span></span><br><span class="line">                   ski_footer=<span class="number">10</span>,<span class="comment">#跳过末尾的行</span></span><br><span class="line">                   parse_cols=<span class="number">2</span>,<span class="comment">#读取前三列</span></span><br><span class="line">                   names=[<span class="string">'X'</span>,<span class="string">'Title'</span>,<span class="string">'Rating'</span>],<span class="comment">#设置列名</span></span><br><span class="line">                   index_col=<span class="string">'Title'</span>,<span class="comment">#设置索引列</span></span><br><span class="line">                   na_values=[<span class="string">' '</span>],<span class="comment">#将列表中的数据视为丢失数据</span></span><br><span class="line">                  )</span><br></pre></td></tr></table></figure>
<h2 id="将-JSON-数据读入-Pandas"><a href="#将-JSON-数据读入-Pandas" class="headerlink" title="将 JSON 数据读入 Pandas"></a>将 JSON 数据读入 Pandas</h2><p>为了读取 JSON 数据，pandas 提供了一种名为<code>read_json</code>的方法，其中我们传递了要读取的 JSON 数据文件的文件名和位置。 文件位置可以是本地文件，甚至可以是具有有效 URL 方案的互联网。 我们将结果数据帧分配给变量<code>DF</code>。</p>
<p><code>read_json</code>方法读取 JSON 数据并将其转换为 Pandas 数据帧对象，即表格数据格式，如以下代码所示。 JSON 数据现在可以以数据帧格式轻松访问，可以更轻松地进行操作和浏览：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">movies_json = pd.read_json(<span class="string">'IMDB.json'</span>)</span><br><span class="line">movies_json.head()</span><br></pre></td></tr></table></figure>
<h2 id="读取-HTML-数据"><a href="#读取-HTML-数据" class="headerlink" title="读取 HTML 数据"></a>读取 HTML 数据</h2><p>pandas 内部使用<code>lxml</code> Python 模块读取 HTML 数据。 您可以通过执行<code>conda install lxml</code>，从命令行程序安装它，如以下屏幕截图所示：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/7b60aa19-d51d-43a7-bd80-bd26473a7a62.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.read_html(<span class="string">'IMDB.html'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="读取-PICKLE-文件"><a href="#读取-PICKLE-文件" class="headerlink" title="读取 PICKLE 文件"></a>读取 PICKLE 文件</h2><p>PICKLE 是将任何类型的 Python 对象（包括列表，字典等）转换为字符串的一种方式。 这个想法是，该字符串包含在另一个 Python 脚本中重构对象所需的所有信息。</p>
<p>我们使用<code>read_pickle</code>方法读取我们的 PICKLE 文件，如以下代码所示。 与其他数据格式一样，Pandas 根据读取的数据创建数据帧：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_pickle(<span class="string">'IMDB.p'</span>)</span><br><span class="line">df.head()</span><br></pre></td></tr></table></figure>
<h2 id="ApacheCN-数据科学和机器学习译文集"><a href="#ApacheCN-数据科学和机器学习译文集" class="headerlink" title="ApacheCN 数据科学和机器学习译文集"></a><a href="https://ds.apachecn.org/" target="_blank" rel="noopener">ApacheCN 数据科学和机器学习译文集</a></h2><ul>
<li><a href="https://ds.apachecn.org/#/docs/tutorialspoint-numpy" target="_blank" rel="noopener">TutorialsPoint NumPy 教程</a></li>
<li>NumPy 秘籍中文第二版<ul>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch00" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch01" target="_blank" rel="noopener">一、使用 IPython</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch02" target="_blank" rel="noopener">二、高级索引和数组概念</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch03" target="_blank" rel="noopener">三、掌握常用函数</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch04" target="_blank" rel="noopener">四、将 NumPy 与世界的其他地方连接</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch05" target="_blank" rel="noopener">五、音频和图像处理</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch06" target="_blank" rel="noopener">六、特殊数组和通用函数</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch07" target="_blank" rel="noopener">七、性能分析和调试</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch08" target="_blank" rel="noopener">八、质量保证</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch09" target="_blank" rel="noopener">九、使用 Cython 加速代码</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch10" target="_blank" rel="noopener">十、Scikits 的乐趣</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch11" target="_blank" rel="noopener">十一、最新最强的 NumPy</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch12" target="_blank" rel="noopener">十二、使用 NumPy 进行探索性和预测性数据分析</a></li>
</ul>
</li>
<li>NumPy 初学者指南中文第三版<ul>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch00" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch01" target="_blank" rel="noopener">一、NumPy 快速入门</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch02" target="_blank" rel="noopener">二、从 NumPy 基本原理开始</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch03" target="_blank" rel="noopener">三、熟悉常用函数</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch04" target="_blank" rel="noopener">四、为您带来便利的便利函数</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch05" target="_blank" rel="noopener">五、使用矩阵和 ufunc</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch06" target="_blank" rel="noopener">六、深入探索 NumPy 模块</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch07" target="_blank" rel="noopener">七、了解特殊例程</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch08" target="_blank" rel="noopener">八、通过测试确保质量</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch09" target="_blank" rel="noopener">九、matplotlib 绘图</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch10" target="_blank" rel="noopener">十、当 NumPy 不够用时 - SciPy 及更多</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch11" target="_blank" rel="noopener">十一、玩转 Pygame</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch12" target="_blank" rel="noopener">附录 A：小测验答案</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch13" target="_blank" rel="noopener">附录 B：其他在线资源</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch14" target="_blank" rel="noopener">附录 C：NumPy 函数的参考</a></li>
</ul>
</li>
<li>NumPy 基础知识<ul>
<li><a href="https://ds.apachecn.org/#/docs/numpy-essentials/0" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-essentials/1" target="_blank" rel="noopener">一、NumPy 简介</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-essentials/2" target="_blank" rel="noopener">二、NumPy <code>ndarray</code>对象</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-essentials/3" target="_blank" rel="noopener">三、使用 NumPy 数组</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-essentials/4" target="_blank" rel="noopener">四、NumPy 核心和子模块</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-essentials/5" target="_blank" rel="noopener">五、NumPy 中的线性代数</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-essentials/6" target="_blank" rel="noopener">六、NumPy 中的傅立叶分析</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-essentials/7" target="_blank" rel="noopener">七、构建和分发 NumPy 代码</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-essentials/8" target="_blank" rel="noopener">八、使用 Cython 加速 NumPy</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-essentials/9" target="_blank" rel="noopener">九、NumPy C-API 简介</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-essentials/10" target="_blank" rel="noopener">十、扩展阅读</a></li>
</ul>
</li>
<li>精通 NumPy 数值分析<ul>
<li><a href="https://ds.apachecn.org/#/docs/master-num-comp-numpy/0" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-num-comp-numpy/1" target="_blank" rel="noopener">一、使用 NumPy 数组</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-num-comp-numpy/2" target="_blank" rel="noopener">二、NumPy 线性代数</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-num-comp-numpy/3" target="_blank" rel="noopener">三、使用 NumPy 统计函数对波士顿住房数据进行探索性数据分析</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-num-comp-numpy/4" target="_blank" rel="noopener">四、使用线性回归预测房价</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-num-comp-numpy/5" target="_blank" rel="noopener">五、使用 NumPy 对批发分销商的客户进行聚类</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-num-comp-numpy/6" target="_blank" rel="noopener">六、NumPy，SciPy，Pandas 和 Scikit-Learn</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-num-comp-numpy/7" target="_blank" rel="noopener">七、高级 NumPy</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-num-comp-numpy/8" target="_blank" rel="noopener">八、高性能数值计算库概述</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-num-comp-numpy/9" target="_blank" rel="noopener">九、性能基准</a></li>
</ul>
</li>
<li>NumPy 数组学习手册<ul>
<li><a href="https://ds.apachecn.org/#/docs/learn-numpy-array/0" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learn-numpy-array/1" target="_blank" rel="noopener">一、NumPy 入门</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learn-numpy-array/2" target="_blank" rel="noopener">二、NumPy 基础</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learn-numpy-array/3" target="_blank" rel="noopener">三、使用 NumPy 的基本数据分析</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learn-numpy-array/4" target="_blank" rel="noopener">四、使用 NumPy 的简单预测性分析</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learn-numpy-array/5" target="_blank" rel="noopener">五、信号处理技术</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learn-numpy-array/6" target="_blank" rel="noopener">六、性能分析，调试和测试</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learn-numpy-array/7" target="_blank" rel="noopener">七、Python 科学生态系统</a></li>
</ul>
</li>
<li>精通 SciPy<ul>
<li><a href="https://ds.apachecn.org/#/docs/master-scipy/0" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-scipy/1" target="_blank" rel="noopener">一、数值线性代数</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-scipy/2" target="_blank" rel="noopener">二、插值和近似</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-scipy/3" target="_blank" rel="noopener">三、微分与积分</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-scipy/4" target="_blank" rel="noopener">四、非线性方程式和最优化</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-scipy/5" target="_blank" rel="noopener">五、常微分方程的初值问题</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-scipy/6" target="_blank" rel="noopener">六、计算几何</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-scipy/7" target="_blank" rel="noopener">七、描述性统计</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-scipy/8" target="_blank" rel="noopener">八、推断和数据分析</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-scipy/9" target="_blank" rel="noopener">九、数字图像处理</a></li>
</ul>
</li>
<li>Pandas 秘籍<ul>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch00" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch01" target="_blank" rel="noopener">一、Pandas 基础</a></li>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch02" target="_blank" rel="noopener">二、数据帧基本操作</a></li>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch03" target="_blank" rel="noopener">三、开始数据分析</a></li>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch04" target="_blank" rel="noopener">四、选择数据子集</a></li>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch05" target="_blank" rel="noopener">五、布尔索引</a></li>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch06" target="_blank" rel="noopener">六、索引对齐</a></li>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch07" target="_blank" rel="noopener">七、分组以进行汇总，过滤和转换</a></li>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch08" target="_blank" rel="noopener">八、将数据重组为整齐的表格</a></li>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch09" target="_blank" rel="noopener">九、组合 Pandas 对象</a></li>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch10" target="_blank" rel="noopener">十、时间序列分析</a></li>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch11" target="_blank" rel="noopener">十一、Pandas，Matplotlib 和 Seaborn 的可视化</a></li>
</ul>
</li>
<li>Pandas 学习手册中文第二版<ul>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/0" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/1" target="_blank" rel="noopener">一、Pandas 与数据分析</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/2" target="_blank" rel="noopener">二、启动和运行 Pandas</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/3" target="_blank" rel="noopener">三、用序列表示单变量数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/4" target="_blank" rel="noopener">四、用数据帧表示表格和多元数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/5" target="_blank" rel="noopener">五、数据帧的结构操作</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/6" target="_blank" rel="noopener">六、索引数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/7" target="_blank" rel="noopener">七、类别数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/8" target="_blank" rel="noopener">八、数值统计方法</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/9" target="_blank" rel="noopener">九、存取数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/10" target="_blank" rel="noopener">十、整理数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/11" target="_blank" rel="noopener">十一、合并，连接和重塑数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/12" target="_blank" rel="noopener">十二、数据聚合</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/13" target="_blank" rel="noopener">十三、时间序列建模</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/14" target="_blank" rel="noopener">十四、可视化</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/15" target="_blank" rel="noopener">十五、历史股价分析</a></li>
</ul>
</li>
<li>精通 Pandas<ul>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/0" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/1" target="_blank" rel="noopener">一、Pandas 和数据分析简介</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/2" target="_blank" rel="noopener">二、Pandas 安装和支持软件</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/3" target="_blank" rel="noopener">三、Pandas 数据结构</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/4" target="_blank" rel="noopener">四、Pandas 的操作，第一部分 – 索引和选择</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/5" target="_blank" rel="noopener">五、Pandas 的操作，第二部分 – 数据的分组，合并和重塑</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/6" target="_blank" rel="noopener">六、处理缺失数据，时间序列和 Matplotlib 绘图</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/7" target="_blank" rel="noopener">七、统计之旅 – 经典方法</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/8" target="_blank" rel="noopener">八、贝叶斯统计简介</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/9" target="_blank" rel="noopener">九、Pandas 库体系结构</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/10" target="_blank" rel="noopener">十、R 与 Pandas 的比较</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/11" target="_blank" rel="noopener">十一、机器学习简介</a></li>
</ul>
</li>
<li>NumPy 和 Pandas 数据分析实用指南<ul>
<li><a href="https://ds.apachecn.org/#/docs/handson-data-analysis-numpy-pandas/0" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/handson-data-analysis-numpy-pandas/1" target="_blank" rel="noopener">一、配置 Python 数据分析环境</a></li>
<li><a href="https://ds.apachecn.org/#/docs/handson-data-analysis-numpy-pandas/2" target="_blank" rel="noopener">二、探索 NumPy</a></li>
<li><a href="https://ds.apachecn.org/#/docs/handson-data-analysis-numpy-pandas/3" target="_blank" rel="noopener">三、NumPy 数组上的运算</a></li>
<li><a href="https://ds.apachecn.org/#/docs/handson-data-analysis-numpy-pandas/4" target="_blank" rel="noopener">四、Pandas 很有趣！ 什么是 Pandas？</a></li>
<li><a href="https://ds.apachecn.org/#/docs/handson-data-analysis-numpy-pandas/5" target="_blank" rel="noopener">五、Pandas 的算术，函数应用以及映射</a></li>
<li><a href="https://ds.apachecn.org/#/docs/handson-data-analysis-numpy-pandas/6" target="_blank" rel="noopener">六、排序，索引和绘图</a></li>
</ul>
</li>
<li>精通 Pandas 探索性分析<ul>
<li><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/0" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1" target="_blank" rel="noopener">一、处理不同种类的数据集</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/2" target="_blank" rel="noopener">二、数据选择</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/3" target="_blank" rel="noopener">三、处理，转换和重塑数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4" target="_blank" rel="noopener">四、像专业人士一样可视化数据</a></li>
</ul>
</li>
<li>Matplotlib 3.0 秘籍<ul>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/0" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/1" target="_blank" rel="noopener">一、Matplotlib 的剖析</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/2" target="_blank" rel="noopener">二、基本绘图入门</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/3" target="_blank" rel="noopener">三、绘制多个图表和子图</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/4" target="_blank" rel="noopener">四、开发可视化来提高发布质量</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/5" target="_blank" rel="noopener">五、使用高级功能的绘图</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/6" target="_blank" rel="noopener">六、嵌入文本和表达式</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/7" target="_blank" rel="noopener">七、以不同格式保存图形</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/8" target="_blank" rel="noopener">八、开发交互式绘图</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/9" target="_blank" rel="noopener">九、在图形用户界面中嵌入绘图</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/10" target="_blank" rel="noopener">十、使用<code>mplot3d</code>工具包绘制 3D 图形</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/11" target="_blank" rel="noopener">十一、使用<code>axisartist</code>工具包</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/12" target="_blank" rel="noopener">十二、使用<code>axes_grid1</code>工具包</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/13" target="_blank" rel="noopener">十三、使用 Cartopy 工具包绘制地理地图</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/14" target="_blank" rel="noopener">十四、使用 Seaborn 工具包的探索性数据分析</a></li>
</ul>
</li>
<li>Matplotlib 绘图秘籍<ul>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-plot-cookbook/ch00" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-plot-cookbook/ch01" target="_blank" rel="noopener">一、第一步</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-plot-cookbook/ch02" target="_blank" rel="noopener">二、自定义颜色和样式</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-plot-cookbook/ch03" target="_blank" rel="noopener">三、处理标注</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-plot-cookbook/ch04" target="_blank" rel="noopener">四、处理图形</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-plot-cookbook/ch05" target="_blank" rel="noopener">五、文件输出</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-plot-cookbook/ch06" target="_blank" rel="noopener">六、处理地图</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-plot-cookbook/ch07" target="_blank" rel="noopener">七、处理 3D 图形</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-plot-cookbook/ch08" target="_blank" rel="noopener">八、用户界面</a></li>
</ul>
</li>
<li>Sklearn 秘籍<ul>
<li><a href="https://ds.apachecn.org/#/docs/sklearn-cookbook/1" target="_blank" rel="noopener">第一章 模型预处理</a></li>
<li><a href="https://ds.apachecn.org/#/docs/sklearn-cookbook/2" target="_blank" rel="noopener">第二章 处理线性模型</a></li>
<li><a href="https://ds.apachecn.org/#/docs/sklearn-cookbook/3" target="_blank" rel="noopener">第三章 使用距离向量构建模型</a></li>
<li><a href="https://ds.apachecn.org/#/docs/sklearn-cookbook/4" target="_blank" rel="noopener">第四章 使用 scikit-learn 对数据分类</a></li>
<li><a href="https://ds.apachecn.org/#/docs/sklearn-cookbook/5" target="_blank" rel="noopener">第五章 模型后处理</a></li>
</ul>
</li>
<li>Sklearn 学习手册<ul>
<li><a href="https://ds.apachecn.org/#/docs/learning-sklearn/ch01" target="_blank" rel="noopener">一、机器学习 - 温和的介绍</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-sklearn/ch02" target="_blank" rel="noopener">二、监督学习</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-sklearn/ch03" target="_blank" rel="noopener">三、无监督学习</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-sklearn/ch04" target="_blank" rel="noopener">四、高级功能</a></li>
</ul>
</li>
<li>UCSD COGS108 数据科学实战中文笔记<ul>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/00-Introduction" target="_blank" rel="noopener">零、数据科学实战</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/01-JupyterNotebooks" target="_blank" rel="noopener">一、Jupyter 笔记本</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/02-DataAnalysis" target="_blank" rel="noopener">二、数据分析</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/03-Python" target="_blank" rel="noopener">三、Python</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/04-DataSciencePython" target="_blank" rel="noopener">四、Python 中的数据科学</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/05-DataGathering" target="_blank" rel="noopener">五、数据收集</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/06-DataWrangling" target="_blank" rel="noopener">六、数据整理</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/07-DataCleaning" target="_blank" rel="noopener">七、数据清理</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/08-DataPrivacy&amp;Anonymization" target="_blank" rel="noopener">八、数据隐私和匿名化</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/09-DataVisualization" target="_blank" rel="noopener">九、使用 Python 进行数据可视化</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/10-Distributions" target="_blank" rel="noopener">十、分布</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/11-TestingDistributions" target="_blank" rel="noopener">十一、检验分布</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/13-OrdinaryLeastSquares" target="_blank" rel="noopener">十三、普通最小二乘</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/14-LinearModels" target="_blank" rel="noopener">十四、线性模型</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/15-Clustering" target="_blank" rel="noopener">十五、聚类</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/16-DimensionalityReduction" target="_blank" rel="noopener">十六、降维</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/17-Classification" target="_blank" rel="noopener">十七、分类</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/18-NaturalLanguageProcessing" target="_blank" rel="noopener">十八、自然语言处理</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/A1-PythonPackages" target="_blank" rel="noopener">附录一、有用的 Python 数据科学包</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/A2-Git" target="_blank" rel="noopener">附录二、git/Github 版本控制工具</a></li>
</ul>
</li>
<li>USF MSDS501 计算数据科学中文讲义<ul>
<li>一、起步<ul>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/1.1_sound" target="_blank" rel="noopener">1.1 一些动机（音频处理）</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/1.2_hello" target="_blank" rel="noopener">1.2 Python 工具的初次尝试</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/1.3_sound" target="_blank" rel="noopener">1.3 播放声音</a></li>
</ul>
</li>
<li>二、设计和构建程序<ul>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/2.1_programming" target="_blank" rel="noopener">2.1 编程导论</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/2.2_data-in-memory" target="_blank" rel="noopener">2.2 在内存中表示数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/2.3_computation" target="_blank" rel="noopener">2.3 计算模型</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/2.4_python-patterns" target="_blank" rel="noopener">2.4 Python 中的编程模式</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/2.5_aliasing" target="_blank" rel="noopener">2.5 数据别名</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/2.6_functions" target="_blank" rel="noopener">2.6 使用函数组织你的代码</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/2.7_reading-code" target="_blank" rel="noopener">2.7 如何阅读代码</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/2.8_OO" target="_blank" rel="noopener">2.8 面向对象编程</a></li>
</ul>
</li>
<li>三、关键编程模式<ul>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/3.1_files" target="_blank" rel="noopener">3.1 加载文件</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/3.2_dataframes" target="_blank" rel="noopener">3.2 数据帧</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/3.3_data" target="_blank" rel="noopener">3.3 操纵和可视化数据</a></li>
</ul>
</li>
<li>四、用于计算和优化的迭代式方法<ul>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/4.1_random-uniform" target="_blank" rel="noopener">4.1 生成均匀的随机数</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/4.2_sqrt" target="_blank" rel="noopener">4.2 近似平方根</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/4.3_gradient-descent" target="_blank" rel="noopener">4.3 单变量梯度下降</a></li>
</ul>
</li>
<li>五、常见编程工具<ul>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/5.1_bash-intro" target="_blank" rel="noopener">5.1 使用 bash 走向胜利</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/5.2_git" target="_blank" rel="noopener">5.2 使用 git 版本控制工具</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/5.3_aws" target="_blank" rel="noopener">5.3 在 Amazon Web Services 上启动虚拟机</a></li>
</ul>
</li>
<li>六、可选<ul>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/6.1_linked-list" target="_blank" rel="noopener">6.1 链表</a></li>
</ul>
</li>
</ul>
</li>
<li>fast.ai 数值线性代数讲义中文版 v2<ul>
<li><a href="https://ds.apachecn.org/#/docs/fastai-num-linalg-v2/1" target="_blank" rel="noopener">一、我们为什么在这里</a></li>
<li><a href="https://ds.apachecn.org/#/docs/fastai-num-linalg-v2/2" target="_blank" rel="noopener">二、SVD 背景消除</a></li>
<li><a href="https://ds.apachecn.org/#/docs/fastai-num-linalg-v2/3" target="_blank" rel="noopener">三、使用 NMF 和 SVD 的主题建模</a></li>
<li><a href="https://ds.apachecn.org/#/docs/fastai-num-linalg-v2/4" target="_blank" rel="noopener">四、随机化 SVD</a></li>
<li><a href="https://ds.apachecn.org/#/docs/fastai-num-linalg-v2/5" target="_blank" rel="noopener">五、LU 分解</a></li>
<li><a href="https://ds.apachecn.org/#/docs/fastai-num-linalg-v2/6" target="_blank" rel="noopener">六、使用鲁棒回归的 CT 扫描的压缩感知</a></li>
<li><a href="https://ds.apachecn.org/#/docs/fastai-num-linalg-v2/7" target="_blank" rel="noopener">七、线性回归和健康结果</a></li>
<li><a href="https://ds.apachecn.org/#/docs/fastai-num-linalg-v2/8" target="_blank" rel="noopener">八、如何实现线性回归</a></li>
<li><a href="https://ds.apachecn.org/#/docs/fastai-num-linalg-v2/9" target="_blank" rel="noopener">九、PageRank 和特征值分解</a></li>
<li><a href="https://ds.apachecn.org/#/docs/fastai-num-linalg-v2/10" target="_blank" rel="noopener">十、实现 QR 分解</a></li>
</ul>
</li>
<li>SciPyCon 2018 sklearn 教程<ul>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/1" target="_blank" rel="noopener">一、Python 机器学习简介</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/2" target="_blank" rel="noopener">二、Python 中的科学计算工具</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/3" target="_blank" rel="noopener">三、数据表示和可视化</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/4" target="_blank" rel="noopener">四、训练和测试数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/5" target="_blank" rel="noopener">五、监督学习第一部分：分类</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/6" target="_blank" rel="noopener">六、监督学习第二部分：回归分析</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/7" target="_blank" rel="noopener">七、无监督学习第一部分：变换</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/8" target="_blank" rel="noopener">八、无监督学习第二部分：聚类</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/9" target="_blank" rel="noopener">九、sklearn 估计器接口回顾</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/10" target="_blank" rel="noopener">十、案例学习：泰坦尼克幸存者</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/11" target="_blank" rel="noopener">十一、文本特征提取</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/12" target="_blank" rel="noopener">十二、案例学习：用于 SMS 垃圾检测的文本分类</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/13" target="_blank" rel="noopener">十三、交叉验证和得分方法</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/14" target="_blank" rel="noopener">十四、参数选择、验证和测试</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/15" target="_blank" rel="noopener">十五、估计器流水线</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/16" target="_blank" rel="noopener">十六、模型评估、得分指标和处理不平衡类别</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/17" target="_blank" rel="noopener">十七、深入：线性模型</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/18" target="_blank" rel="noopener">十八、深入：决策树与森林</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/19" target="_blank" rel="noopener">十九、自动特征选择</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/20" target="_blank" rel="noopener">二十、无监督学习：层次和基于密度的聚类算法</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/21" target="_blank" rel="noopener">二十一、无监督学习：非线性降维</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/22" target="_blank" rel="noopener">二十二、无监督学习：异常检测</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/23" target="_blank" rel="noopener">二十三、核外学习 - 用于语义分析的大规模文本分类</a></li>
</ul>
</li>
<li>社交媒体挖掘<ul>
<li>第一部分 数据挖掘<ul>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/1" target="_blank" rel="noopener">1 应了解的编程语言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/2" target="_blank" rel="noopener">2 从哪里获取数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/3" target="_blank" rel="noopener">3 用代码获取数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/4" target="_blank" rel="noopener">4 收集自己的 FACEBOOK 数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/5" target="_blank" rel="noopener">5 抓取实时站点</a></li>
</ul>
</li>
<li>第二部分 数据分析<ul>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/6" target="_blank" rel="noopener">6 数据分析导论</a></li>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/7" target="_blank" rel="noopener">7 数据可视化</a></li>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/8" target="_blank" rel="noopener">8 数据分析的高级工具</a></li>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/8" target="_blank" rel="noopener">9 在 REDDIT 数据中寻找趋势</a></li>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/10" target="_blank" rel="noopener">10 测量公众人物的 Twitter 活动</a></li>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/11" target="_blank" rel="noopener">11 何去何从</a></li>
</ul>
</li>
<li>附录<ul>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/101" target="_blank" rel="noopener">1 编写程序通过 API 获取网站的信息</a></li>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/102" target="_blank" rel="noopener">2 通过解析网页直接获取哔哩某播主的详细信息</a></li>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/103" target="_blank" rel="noopener">3 在离线表格软件中打开和处理 csv 文件</a></li>
</ul>
</li>
</ul>
</li>
<li>Python 机器学习在线指南<ul>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/3" target="_blank" rel="noopener">作者</a></li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/5" target="_blank" rel="noopener">引言</a></li>
<li>核心概念<ul>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/7" target="_blank" rel="noopener">交叉验证</a></li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/8" target="_blank" rel="noopener">线性回归</a></li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/9" target="_blank" rel="noopener">过拟合和欠拟合</a></li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/10" target="_blank" rel="noopener">正则化</a></li>
</ul>
</li>
<li>监督学习<ul>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/12" target="_blank" rel="noopener">逻辑回归</a></li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/13" target="_blank" rel="noopener">朴素贝叶斯分类</a></li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/14" target="_blank" rel="noopener">决策树</a></li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/15" target="_blank" rel="noopener">k 最近邻</a></li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/16" target="_blank" rel="noopener">线性支持向量机</a></li>
</ul>
</li>
<li>无监督学习<ul>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/18" target="_blank" rel="noopener">聚类</a></li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/19" target="_blank" rel="noopener">主成分分析</a></li>
</ul>
</li>
<li>深度学习<ul>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/21" target="_blank" rel="noopener">多层感知机</a></li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/22" target="_blank" rel="noopener">卷积神经网络</a></li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/23" target="_blank" rel="noopener">自编码器</a></li>
</ul>
</li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/25" target="_blank" rel="noopener">原文的协议</a></li>
</ul>
</li>
<li>数据科学和人工智能技术笔记<ul>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/1" target="_blank" rel="noopener">一、向量、矩阵和数组</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/2" target="_blank" rel="noopener">二、数据准备</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/3" target="_blank" rel="noopener">三、数据预处理</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/4" target="_blank" rel="noopener">四、图像预处理</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/5" target="_blank" rel="noopener">五、文本预处理</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/6" target="_blank" rel="noopener">六、日期时间预处理</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/7" target="_blank" rel="noopener">七、特征工程</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/8" target="_blank" rel="noopener">八、特征选择</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/9" target="_blank" rel="noopener">九、模型验证</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/10" target="_blank" rel="noopener">十、模型选择</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/11" target="_blank" rel="noopener">十一、线性回归</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/12" target="_blank" rel="noopener">十二、逻辑回归</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/13" target="_blank" rel="noopener">十三、树和森林</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/14" target="_blank" rel="noopener">十四、K 最近邻</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/15" target="_blank" rel="noopener">十五、支持向量机</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/16" target="_blank" rel="noopener">十六、朴素贝叶斯</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/17" target="_blank" rel="noopener">十七、聚类</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/18" target="_blank" rel="noopener">十八、Keras</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/19.1" target="_blank" rel="noopener">十九、数据整理（上）</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/19.2" target="_blank" rel="noopener">十九、数据整理（下）</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/20" target="_blank" rel="noopener">二十、数据可视化</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/21" target="_blank" rel="noopener">二十一、统计学</a></li>
</ul>
</li>
<li>写给人类的机器学习<ul>
<li><a href="https://ds.apachecn.org/#/docs/ml-for-humans/1" target="_blank" rel="noopener">一、为什么机器学习重要</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ml-for-humans/2.1" target="_blank" rel="noopener">2.1 监督学习</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ml-for-humans/2.2" target="_blank" rel="noopener">2.2 监督学习 II</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ml-for-humans/2.3" target="_blank" rel="noopener">2.3 监督学习 III</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ml-for-humans/3" target="_blank" rel="noopener">三、无监督学习</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ml-for-humans/4" target="_blank" rel="noopener">四、神经网络和深度学习</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ml-for-humans/5" target="_blank" rel="noopener">五、强化学习</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ml-for-humans/6" target="_blank" rel="noopener">六、最好的机器学习资源</a></li>
</ul>
</li>
<li><a href="https://ds.apachecn.org/#/docs/super-machine-learning-revision-notes/README" target="_blank" rel="noopener">机器学习超级复习笔记</a></li>
</ul>
<h1 id="一、处理不同种类的数据集"><a href="#一、处理不同种类的数据集" class="headerlink" title="一、处理不同种类的数据集"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=一、处理不同种类的数据集" target="_blank" rel="noopener">一、处理不同种类的数据集</a></h1><p>在本章中，我们将学习如何在 Pandas 中使用不同种类的数据集格式。 我们将学习如何使用 Pandas 导入的 CSV 文件提供的高级选项。 我们还将研究如何在 Pandas 中使用 Excel 文件，以及如何使用<code>read_excel</code>方法的高级选项。 我们将探讨其他一些使用流行数据格式的 Pandas 方法，例如 HTML，JSON，PKL 文件，SQL 等。</p>
<h1 id="从-CSV-文件读取数据时使用高级选项-1"><a href="#从-CSV-文件读取数据时使用高级选项-1" class="headerlink" title="从 CSV 文件读取数据时使用高级选项"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=从-csv-文件读取数据时使用高级选项" target="_blank" rel="noopener">从 CSV 文件读取数据时使用高级选项</a></h1><p>在本部分中，我们将 CSV 和 Pandas 结合使用，并学习如何使用<code>read_csv</code>方法读取 CSV 数据集以及高级选项。</p>
<h1 id="导入模块"><a href="#导入模块" class="headerlink" title="导入模块"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=导入模块" target="_blank" rel="noopener">导入模块</a></h1><p>首先，我们将使用以下命令导入<code>pandas</code>模块：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>要读取 CSV 文件，我们使用<code>read_csv</code>方法，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'IMDB.csv'</span>, encoding = <span class="string">"ISO-8859-1"</span>)</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>为了执行基本导入，请将数据集的文件名传递给<code>read_csv</code>，并将结果数据帧分配给变量。 在以下屏幕截图中，我们可以看到 Pandas 已将数据集转换为表格格式：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/cfe3ed2e-29c2-480d-8033-c65564c39388.png" alt="img"></p>
<h1 id="高级读取选项"><a href="#高级读取选项" class="headerlink" title="高级读取选项"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=高级读取选项" target="_blank" rel="noopener">高级读取选项</a></h1><p>在 Python 中，pandas 具有<code>read_csv</code>方法的许多高级选项，您可以在其中控制如何从 CSV 文件读取数据。</p>
<h1 id="处理列，索引位置和名称"><a href="#处理列，索引位置和名称" class="headerlink" title="处理列，索引位置和名称"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=处理列，索引位置和名称" target="_blank" rel="noopener">处理列，索引位置和名称</a></h1><p>默认情况下，<code>read_csv</code>将 CSV 文件第一行中的条目视为列名。 我们可以通过将<code>header</code>设置为<code>None</code>来关闭此功能，如以下代码块所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'IMDB.csv'</span>, encoding = <span class="string">"ISO-8859-1"</span>, header=<span class="literal">None</span>)</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/e1f24ca1-344b-4700-bb36-38a6102167a3.png" alt="img"></p>
<h1 id="指定另一行作为标题"><a href="#指定另一行作为标题" class="headerlink" title="指定另一行作为标题"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=指定另一行作为标题" target="_blank" rel="noopener">指定另一行作为标题</a></h1><p>您还可以通过将行号传递给<code>header</code>选项，从而从其他行（而不是默认的第一行）设置列名，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'IMDB.csv'</span>, encoding = <span class="string">"ISO-8859-1"</span>, header=<span class="number">2</span>)</span><br><span class="line">df.head()</span><br><span class="line">复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/7bf7d1c8-8b22-4fe1-bdcf-82a45d868d85.png" alt="img"></p>
<h1 id="将列指定为索引"><a href="#将列指定为索引" class="headerlink" title="将列指定为索引"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=将列指定为索引" target="_blank" rel="noopener">将列指定为索引</a></h1><p>默认情况下，<code>read_csv</code>在读取数据时分配一个默认的数字索引，该索引从零开始。 但是，您可以通过将列名传递给索引列选项来更改此行为。 然后，Pandas 会将索引设置为此列，如以下代码所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'IMDB.csv'</span>, encoding = <span class="string">"ISO-8859-1"</span>, index_col=<span class="string">'Title'</span>)</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>在这里，我们传递了电影标题作为索引名称。 现在，索引名称为<code>Title</code>，而不是默认的数字索引，如以下屏幕截图所示：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/478b7fde-0165-48fc-a2a6-9b8207751094.png" alt="img"></p>
<h1 id="选择要读取的列的子集"><a href="#选择要读取的列的子集" class="headerlink" title="选择要读取的列的子集"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=选择要读取的列的子集" target="_blank" rel="noopener">选择要读取的列的子集</a></h1><p>我们还可以选择读取 CSV 文件中特定列的子集。 为此，我们将列名作为列表传递，以使用<code>columns</code>选项，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'IMDB.csv'</span>, encoding = <span class="string">"ISO-8859-1"</span>, usecols=[<span class="string">'Title'</span>, <span class="string">'Genre1'</span>])</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>前面的代码段的输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/0f20610e-b198-4572-9084-ab850b82c096.png" alt="img"></p>
<h1 id="处理缺失和不适用的数据"><a href="#处理缺失和不适用的数据" class="headerlink" title="处理缺失和不适用的数据"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=处理缺失和不适用的数据" target="_blank" rel="noopener">处理缺失和不适用的数据</a></h1><p>接下来，我们将看到如何通过读取 CSV 文件来处理丢失的数据。 默认情况下，<code>read_csv</code>认为缺少以下值并将其标记为<code>NaN</code>：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/c330d7f5-b1c0-4fc8-8fb2-d4bf7a5eb8a7.png" alt="img"></p>
<p>但是，您可以添加到此列表。 为此，只需将要视为<code>NaN</code>的值列表传递给，如以下代码所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'IMDB.csv'</span>, encoding = <span class="string">"ISO-8859-1"</span>, na_values=[<span class="string">''</span>])复制ErrorOK!</span><br></pre></td></tr></table></figure>
<h1 id="选择是否跳过空白行"><a href="#选择是否跳过空白行" class="headerlink" title="选择是否跳过空白行"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=选择是否跳过空白行" target="_blank" rel="noopener">选择是否跳过空白行</a></h1><p>有时整行没有值； 因此，我们可以在读取数据时选择处理这些行。 默认情况下，<code>read_csv</code>会忽略空白行，但是我们可以通过将<code>skip_blank_lines</code>设置为<code>False</code>来关闭此行，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'IMDB.csv'</span>, encoding = <span class="string">"ISO-8859-1"</span>, skip_blank_lines=<span class="literal">False</span>)复制ErrorOK!</span><br></pre></td></tr></table></figure>
<h1 id="数据解析选项"><a href="#数据解析选项" class="headerlink" title="数据解析选项"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=数据解析选项" target="_blank" rel="noopener">数据解析选项</a></h1><p>我们可以通过读取 CSV 文件来选择跳过哪些行。 我们可以将行号作为列表传递给<code>skiprows</code>选项。 第一行的索引为零，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'IMDB.csv'</span>, encoding = <span class="string">"ISO-8859-1"</span>, skiprows = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">7</span>])</span><br><span class="line">df.head()</span><br><span class="line">复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/80076b18-0c73-4252-b86f-f088e6ed6dad.png" alt="img"></p>
<h1 id="从文件的页脚或结尾跳过行"><a href="#从文件的页脚或结尾跳过行" class="headerlink" title="从文件的页脚或结尾跳过行"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=从文件的页脚或结尾跳过行" target="_blank" rel="noopener">从文件的页脚或结尾跳过行</a></h1><p>要从页脚或文件末尾跳过行，请使用<code>skipfooter</code>选项并传递一个数字，该数字指定要跳过的行数。 在以下代码中，我们通过了<code>2</code>。 如我们所见，在跳过最后两行之后，我们创建的上一个数据帧与我们创建的数据帧之间存在差异：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df.tail(<span class="number">2</span>)</span><br><span class="line">df = pd.read_csv(<span class="string">'IMDB.csv'</span>, encoding = <span class="string">"ISO-8859-1"</span>, skipfooter=<span class="number">2</span>, engine=<span class="string">'python'</span>)</span><br><span class="line">df.tail(<span class="number">2</span>)复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>以下屏幕截图显示了输出：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/c874e464-2cf3-4677-9828-2202c05a536b.png" alt="img"></p>
<h1 id="读取文件的子集或一定数量的行"><a href="#读取文件的子集或一定数量的行" class="headerlink" title="读取文件的子集或一定数量的行"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=读取文件的子集或一定数量的行" target="_blank" rel="noopener">读取文件的子集或一定数量的行</a></h1><p>有时数据文件太大，我们只想看一下前几行。 我们可以通过将要导入的行数传递到<code>nrows</code>选项来做到这一点，如以下代码所示。 在这里，我们将<code>100</code>传递给<code>nrows</code>，然后<code>nrows</code>仅读取数据集中的前一百行：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'IMDB.csv'</span>, encoding = <span class="string">"ISO-8859-1"</span>, nrows=<span class="number">100</span>)</span><br><span class="line">df.shape复制ErrorOK!</span><br></pre></td></tr></table></figure>
<h1 id="从-Excel-文件读取数据-1"><a href="#从-Excel-文件读取数据-1" class="headerlink" title="从 Excel 文件读取数据"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=从-excel-文件读取数据" target="_blank" rel="noopener">从 Excel 文件读取数据</a></h1><p>在本节中，我们将学习如何使用 Pandas 使用 Excel 数据来处理表格，以及如何使用 Pandas 的<code>read_excel</code>方法从 Excel 文件中读取数据。 我们将阅读并探索一个真实的 Excel 数据集，并使用 xplore 解析一些可用于解析 Excel 数据的高级选项。</p>
<p>熊猫内部使用 Python Excel 库<code>rd</code>从 Excel 文件中提取数据。 我们可以通过执行<code>conda install xlrd</code>来安装它。</p>
<p>首先，请确保命令行程序在安装前以管理员模式运行，如以下屏幕截图所示：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/aa1344e7-c572-4fdf-add1-89fc1e472e84.png" alt="img"></p>
<p>以下屏幕截图显示了我们将使用 Pandas 阅读和探索的 Excel 数据集：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/184c0d1e-e396-4c78-91af-0ba3ee54aaab.png" alt="img"></p>
<p>上一个屏幕截图是电影分级的集合，<a href="https://github.com/saipranava/IMDB" target="_blank" rel="noopener">可以在这里找到它</a>。</p>
<h1 id="基本的-Excel-读取"><a href="#基本的-Excel-读取" class="headerlink" title="基本的 Excel 读取"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=基本的-excel-读取" target="_blank" rel="noopener">基本的 Excel 读取</a></h1><p>我们正在使用 Pandas 的<code>read_excel</code>方法读取此数据。 以最简单的格式，我们只是将想要的 Excel 数据集的文件名传递给<code>read_excel</code>方法。 pandas 将 Excel 文件中的数据转换为 Pandas 数据帧。 Pandas 内部为此使用 Excel <code>rd</code>库。 在这里，Pandas 已读取数据并在内存中创建了表格数据对象，我们可以在我们的代码中访问，浏览和操作，如以下代码所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>)</span><br><span class="line">df.head()</span><br><span class="line">复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>前一个代码块的输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/2815fd21-3be7-4ffa-829b-85e735677409.png" alt="img"></p>
<p>pandas 有很多高级选项，我们可以使用它们来控制应如何读取数据。如以下屏幕截图所示：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/5a286568-dfd0-4d26-8ce9-1805adc4690b.png" alt="img"></p>
<h1 id="指定应读取的工作表"><a href="#指定应读取的工作表" class="headerlink" title="指定应读取的工作表"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=指定应读取的工作表" target="_blank" rel="noopener">指定应读取的工作表</a></h1><p>要指定应读取的纸张，请将值传递给<code>sheetname</code>选项。 如下面的屏幕快照所示，我们只是传递<code>0</code>，它是 Excel 工作表中第一张工作表的索引值。 这非常方便，尤其是当我们不知道确切的工作表名称时：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>, sheetname=<span class="number">0</span>)</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/821fc1c4-66e5-4d78-8833-5a18bd54d4dd.png" alt="img"></p>
<h1 id="从多张表读取数据"><a href="#从多张表读取数据" class="headerlink" title="从多张表读取数据"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=从多张表读取数据" target="_blank" rel="noopener">从多张表读取数据</a></h1><p>Excel 数据集文件附带数据和多个工作表。 实际上，这是许多用户更喜欢 Excel 而不是 CSV 的主要原因之一。 幸运的是，Pandas 支持从多张纸中读取数据。</p>
<h1 id="查找工作表名称"><a href="#查找工作表名称" class="headerlink" title="查找工作表名称"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=查找工作表名称" target="_blank" rel="noopener">查找工作表名称</a></h1><p>要找出工作表的名称，请将 Excel 文件传递到<code>ExcelFile</code>类，然后在结果对象上调用<code>sheet_names</code>属性。 该类将 Excel 文件中的图纸名称打印为列表。 如果我们想从名为<code>data-movies</code>的工作表中读取数据，它将类似于以下代码片段：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xls_file = pd.ExcelFile(<span class="string">'IMDB.xlsx'</span>)</span><br><span class="line">xls_file.sheet_names复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>接下来，我们在之前创建的 Excel 文件对象上调用<code>parse</code>方法，并传入我们想要读取的工作表名称。 然后我们将结果分配给两个单独的数据帧对象，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df1 = xls_file.parse(<span class="string">'movies'</span>)</span><br><span class="line">df2 = xls_file.parse(<span class="string">'by genre'</span>)</span><br><span class="line">df1.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>现在，我们从两个单独的数据帧，中的两个工作表中获取数据，如以下屏幕截图所示：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/51df758b-0331-47f7-9f5a-d53195e29b7f.png" alt="img"></p>
<h1 id="选择标题或列标签"><a href="#选择标题或列标签" class="headerlink" title="选择标题或列标签"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=选择标题或列标签" target="_blank" rel="noopener">选择标题或列标签</a></h1><p>默认情况下，pandas 会将列名称或标题设置为 Excel 文件中第一个非空白行的值。 但是，我们可以更改此行为。 在以下屏幕截图中，我们将值<code>3</code>传递给<code>header</code>选项，该选项告诉<code>read_excel</code>方法设置索引行<code>3</code>中的标题名称：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>, sheetname=<span class="number">1</span>, header=<span class="number">3</span>)</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>前面代码的输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/12d7f628-5b08-4cfa-9919-306cca42da97.png" alt="img"></p>
<h1 id="没有标题"><a href="#没有标题" class="headerlink" title="没有标题"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=没有标题" target="_blank" rel="noopener">没有标题</a></h1><p>我们还可以告诉<code>read_excel</code>忽略标题并将所有行都视为记录。 只要 Excel 没有标题行，就很方便。 为此，我们将<code>header</code>设置为<code>None</code>和，如以下代码所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>, sheetname=<span class="number">1</span>, header=<span class="literal">None</span>)</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/a1b88a66-420f-4bb6-ac46-103fd63509d4.png" alt="img"></p>
<h1 id="在开头跳过行"><a href="#在开头跳过行" class="headerlink" title="在开头跳过行"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=在开头跳过行" target="_blank" rel="noopener">在开头跳过行</a></h1><p>要跳过文件开头的行，只需将<code>skiprows</code>设置为要跳过的行数，如以下代码所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>, sheetname=<span class="number">1</span>, skiprows=<span class="number">7</span>)复制ErrorOK!</span><br></pre></td></tr></table></figure>
<h1 id="在末尾跳过行"><a href="#在末尾跳过行" class="headerlink" title="在末尾跳过行"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=在末尾跳过行" target="_blank" rel="noopener">在末尾跳过行</a></h1><p>为此，我们使用<code>skip_footer</code>选项，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>, sheetname=<span class="number">1</span>, ski_footer=<span class="number">10</span>)复制ErrorOK!</span><br></pre></td></tr></table></figure>
<h1 id="选择列"><a href="#选择列" class="headerlink" title="选择列"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=选择列" target="_blank" rel="noopener">选择列</a></h1><p>我们还可以选择只读取列的子集。 这是通过将<code>parse_cols</code>选项设置为数值来完成的，这将导致将列从<code>0</code>读取到我们设置解析列值的任何索引。 我们在这种情况下设置了<code>parse_cols=2</code>，它将读取 Excel 文件中的前三列，如以下代码片段所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>, sheetname= <span class="number">0</span>, parse_cols=<span class="number">2</span>)</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>以下是输出：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/cbc17e06-e0cb-4693-a19d-1d2e8101bc39.png" alt="img"></p>
<h1 id="列名"><a href="#列名" class="headerlink" title="列名"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=列名" target="_blank" rel="noopener">列名</a></h1><p>我们可以选择给列使用不同的名称，而不是标题行中提供的默认名称。 为此，我们将列名列表传递给<code>names</code>参数，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>, sheetname=<span class="number">0</span>, parse_cols = <span class="number">2</span>, names=[<span class="string">'X'</span>,<span class="string">'Title'</span>,</span><br><span class="line">   <span class="string">'Rating'</span>], )</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>在下面的屏幕截图中，我们将列名设置为读取时传递的名称：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/cb689dbe-dff6-448e-ad42-896429b363f3.png" alt="img"></p>
<h1 id="读取数据时设置索引"><a href="#读取数据时设置索引" class="headerlink" title="读取数据时设置索引"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=读取数据时设置索引" target="_blank" rel="noopener">读取数据时设置索引</a></h1><p>默认情况下，<code>read_excel</code>用数字索引标记零，从<code>0</code>开始。 我们可以将索引或行标签设置为更高的值或我们的选择。 为此，我们将数据集的列名传递给<code>index_col</code>选项。 在以下代码中，我们将索引设置为<code>Title</code>列：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>, sheetname=<span class="number">0</span>, index_col=<span class="string">'Title'</span>)</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/75fb95a9-93d5-4196-aff7-d4bfa3c1541e.png" alt="img"></p>
<h1 id="读取时处理丢失的数据"><a href="#读取时处理丢失的数据" class="headerlink" title="读取时处理丢失的数据"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=读取时处理丢失的数据" target="_blank" rel="noopener">读取时处理丢失的数据</a></h1><p><code>read_excel</code>方法有一个值列表，它将被视为丢失，然后将其设置为<code>NaN</code>。 我们可以在使用<code>na_values</code>参数传递值列表时添加此代码，如以下代码所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>, sheetname= <span class="number">0</span>, na_values=[<span class="string">' '</span>])复制ErrorOK!</span><br></pre></td></tr></table></figure>
<h1 id="读取其他流行格式的数据"><a href="#读取其他流行格式的数据" class="headerlink" title="读取其他流行格式的数据"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=读取其他流行格式的数据" target="_blank" rel="noopener">读取其他流行格式的数据</a></h1><p>在本节中，我们将探索 Pandas 的功能，以读取和使用各种流行的数据格式。 我们还将学习如何从 JSON 格式，HTML 文件和 PICKLE 数据集中读取数据，并且可以从基于 SQL 的数据库中读取数据。</p>
<h1 id="读取-JSON-文件"><a href="#读取-JSON-文件" class="headerlink" title="读取 JSON 文件"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=读取-json-文件" target="_blank" rel="noopener">读取 JSON 文件</a></h1><p>JSON 是用于结构化数据的最小可读格式。 它主要用于在服务器和 Web 应用之间传输数据，以替代 XML，如以下屏幕快照所示：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/c67f9d24-a64c-43d4-9f07-d5eccf714d35.png" alt="img"></p>
<h1 id="将-JSON-数据读入-Pandas-1"><a href="#将-JSON-数据读入-Pandas-1" class="headerlink" title="将 JSON 数据读入 Pandas"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=将-json-数据读入-pandas" target="_blank" rel="noopener">将 JSON 数据读入 Pandas</a></h1><p>为了读取 JSON 数据，pandas 提供了一种名为<code>read_json</code>的方法，其中我们传递了要读取的 JSON 数据文件的文件名和位置。 文件位置可以是本地文件，甚至可以是具有有效 URL 方案的互联网。 我们将结果数据帧分配给变量<code>DF</code>。</p>
<p><code>read_json</code>方法读取 JSON 数据并将其转换为 Pandas 数据帧对象，即表格数据格式，如以下代码所示。 JSON 数据现在可以以数据帧格式轻松访问，可以更轻松地进行操作和浏览：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">movies_json = pd.read_json(<span class="string">'IMDB.json'</span>)</span><br><span class="line">movies_json.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>上一个代码块将产生以下输出：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/4a1818ca-391b-48cb-9593-35960d5553bf.png" alt="img"></p>
<h1 id="读取-HTML-数据-1"><a href="#读取-HTML-数据-1" class="headerlink" title="读取 HTML 数据"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=读取-html-数据" target="_blank" rel="noopener">读取 HTML 数据</a></h1><p>pandas 内部使用<code>lxml</code> Python 模块读取 HTML 数据。 您可以通过执行<code>conda install lxml</code>，从命令行程序安装它，如以下屏幕截图所示：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/7b60aa19-d51d-43a7-bd80-bd26473a7a62.png" alt="img"></p>
<p>我们还可以从本地文件甚至直接从互联网导入 HTML 数据：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/5ef932a6-3683-46dd-ac95-62d223a07840.png" alt="img"></p>
<p>在这里，我们将 HTML 文件或 URL 的位置传递给<code>read_html</code>方法。<code>read_html</code>从 HTML 提取表格数据，然后将其转换为 Pandas 数据帧。 在以下代码中，我们以表格格式获取了从 HTML 文件提取的数据：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.read_html(<span class="string">'IMDB.html'</span>)复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/86a8b673-bec2-4b09-82aa-a733b9ab7cdc.png" alt="img"></p>
<h2 id="读取-PICKLE-文件-1"><a href="#读取-PICKLE-文件-1" class="headerlink" title="读取 PICKLE 文件"></a>读取 PICKLE 文件</h2><p>酸洗是将任何类型的 Python 对象（包括列表，字典等）转换为字符串的一种方式。 这个想法是，该字符串包含在另一个 Python 脚本中重构对象所需的所有信息。</p>
<p>我们使用<code>read_pickle</code>方法读取我们的 PICKLE 文件，如以下代码所示。 与其他数据格式一样，Pandas 根据读取的数据创建数据帧：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_pickle(<span class="string">'IMDB.p'</span>)</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/db67347d-5356-40ff-a4ec-38485abb9f6b.png" alt="img"></p>
<h2 id="读取-SQL-数据"><a href="#读取-SQL-数据" class="headerlink" title="读取 SQL 数据"></a>读取 SQL 数据</h2><p>在这里，我们将从流行的数据库浏览器 SQLite 中读取 SQL 数据，可以通过执行以下命令进行安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install sqlite</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line">conn = sqlite3.connect(<span class="string">"IMDB.sqlite"</span>)</span><br><span class="line">df = pd.read_sql_query(<span class="string">"SELECT * FROM IMDB;"</span>, conn)</span><br><span class="line">df.head()</span><br></pre></td></tr></table></figure>
<h2 id="从剪贴板读取数据"><a href="#从剪贴板读取数据" class="headerlink" title="从剪贴板读取数据"></a>从剪贴板读取数据</h2><p>使用 pandas 的<code>read_clipboard</code>方法读取数据并创建一个数据帧，如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_clipboard()</span><br><span class="line">df.head()</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在本章中，我们学习了如何在 Pandas 中使用不同种类的数据集格式。 我们学习了在导入 CSV 文件时如何使用 Pandas 提供的高级选项。 我们还看到了如何使用 Excel 数据集，并且探讨了可用于处理各种数据格式（例如 HTML，JSON，PICKLE 文件，SQL 等）的方法。</p>
<p>在下一章中，我们将学习如何在高级数据选择中使用 Pandas 技术。</p>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2020/03/04/使用Debezium和Kafka为MySQL数据库设置变化数据捕捉CDC/" itemprop="url">使用Debezium和Kafka为MySQL数据库设置变化数据捕捉CDC</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2020-03-04T05:51:00.000Z" itemprop="datePublished">10 个月前</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Technology/">Technology</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            2 小时 读完 (约 16243 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h1 id="讲解"><a href="#讲解" class="headerlink" title="讲解"></a>讲解</h1><p>本教程将引导您逐步运行Debezium 1.0.2.Final，以进行更改数据捕获（CDC）。您将使用Docker（1.9或更高版本）启动Debezium服务，运行带有简单示例数据库的MySQL数据库服务器，使用Debezium监视数据库，并查看结果事件流随着数据库中数据的更改而响应。</p>
<table>
<thead>
<tr>
<th></th>
<th>您已经完成了教程？使用Docker Compose 尝试<a href="https://debezium.io/documentation/reference/1.0/tutorial.html#docker-compose" target="_blank" rel="noopener">快速</a>入门，包括Debezium支持的所有数据库（MySQL，Postgres，MongoDB，SQL Server和Oracle）的示例设置。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<h2 id="什么是Debezium？"><a href="#什么是Debezium？" class="headerlink" title="什么是Debezium？"></a>什么是Debezium？</h2><p>Debezium是一个分布式平台，可将您现有的数据库转换为事件流，因此应用程序可以查看数据库中的每个行级更改并立即对其做出响应。Debezium建立在<a href="http://kafka.apache.org/" target="_blank" rel="noopener">Apache Kafka</a>之上，并提供<a href="http://kafka.apache.org/documentation.html#connect" target="_blank" rel="noopener">Kafka Connect</a>兼容连接器，用于监视特定的数据库管理系统。Debezium在Kafka日志中记录数据更改的历史记录，您的应用程序从该位置开始使用它们。这使您的应用程序可以轻松，正确，完全使用所有事件。即使您的应用程序停止（或崩溃），在重新启动后，它也会开始使用中断处的事件，因此不会丢失任何内容。</p>
<p>Debezium 1.0.2.Final通过其<a href="https://debezium.io/documentation/reference/1.0/connectors/mysql.html" target="_blank" rel="noopener">MySQL连接器</a>支持监视MySQL数据库服务器，这就是本演示中将使用的内容。在将来的版本中将添加对其他DBMS的支持。</p>
<h2 id="使用Docker运行Debezium"><a href="#使用Docker运行Debezium" class="headerlink" title="使用Docker运行Debezium"></a>使用Docker运行Debezium</h2><p>运行Debezium涉及三项主要服务：<a href="http://zookeeper.apache.org/" target="_blank" rel="noopener">ZooKeeper</a>，Kafka和Debezium的连接器服务。本教程将引导您使用<a href="http://docker.com/" target="_blank" rel="noopener">Docker</a>和<a href="https://hub.docker.com/u/debezium/" target="_blank" rel="noopener">Debezium的Docker映像</a>启动这些服务的单个实例。另一方面，生产环境要求运行每个服务的多个实例以提供性能，可靠性，复制和容错能力。这可以通过<a href="https://www.openshift.com/" target="_blank" rel="noopener">OpenShift</a>和<a href="http://kubernetes.io/" target="_blank" rel="noopener">Kubernetes之</a>类的平台来完成，该平台管理在多个主机和机器上运行的多个Docker容器，但是通常您需要将其<a href="https://debezium.io/documentation/reference/1.0/install.html" target="_blank" rel="noopener">安装在专用硬件上</a>。</p>
<h2 id="启动Docker"><a href="#启动Docker" class="headerlink" title="启动Docker"></a>启动Docker</h2><p>确保Docker已<a href="https://docs.docker.com/engine/installation/" target="_blank" rel="noopener">安装并</a>在Linux，OS X或Windows上运行。我们强烈建议在这些平台上使用最新版本的Docker，并且牢记这些说明。（通过Docker Machine在虚拟机中运行Docker不再是首选方法，Docker建议您升级。）</p>
<h2 id="从Debezium开始简单"><a href="#从Debezium开始简单" class="headerlink" title="从Debezium开始简单"></a>从Debezium开始简单</h2><p>为了进行简单的评估和实验，本教程将引导您在本地计算机上的单独容器中启动每个服务的单个实例。ZooKeeper和Kafka都在容器内部本地存储数据，正常使用需要将主机目录作为卷安装在主机上，以便在容器停止时保留持久数据。尽管我们的<a href="https://hub.docker.com/r/debezium/" target="_blank" rel="noopener">Docker映像</a>的文档描述了如何执行此操作，但在本教程中我们将跳过该操作。这意味着，当删除容器时，所有持久数据将丢失。这实际上是我们实验的理想选择，因为完成后您的计算机上将没有任何东西，而且您可以多次运行此实验，而不必清理它们之间的任何内容。</p>
<p>在本地运行多个服务可能会造成混乱，因此我们将使用一个单独的终端在前台运行每个容器。这样，容器的所有输出将显示在用于运行它的终端中。</p>
<table>
<thead>
<tr>
<th></th>
<th>这不是运行Docker容器的唯一方法。<code>-it</code>Docker无需在前台运行容器（使用），而是让您以<em>分离</em>模式运行容器（使用<code>-d</code>），在该模式下，容器已启动，并且Docker命令立即返回。分离模式容器不会在终端中显示其输出，尽管您始终可以使用来查看输出<code>docker logs --follow --name &lt;container-name&gt;</code>。这是我们为运行的每个容器命名的原因之一。有关更多详细信息，请参阅Docker文档。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<h3 id="启动ZooKeeper"><a href="#启动ZooKeeper" class="headerlink" title="启动ZooKeeper"></a>启动ZooKeeper</h3><p>在组成Debezium的所有不同服务/过程中，第一个启动的是ZooKeeper。运行以下命令，启动一个新的终端并使用ZooKeeper启动一个容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --name zookeeper -p 2181:2181 -p 2888:2888 -p 3888:3888 debezium/zookeeper:1.0</span><br></pre></td></tr></table></figure>
<p>这将使用<code>debezium/zookeeper</code>映像的1.0版运行一个新容器，并将名称分配<code>zookeeper</code>给该容器。该<code>-it</code>标志使容器具有交互性，这意味着它将终端的标准输入和输出附加到容器，以便您可以看到容器中正在发生的事情。该<code>--rm</code>标志指示Docker在停止时删除容器。这三个<code>-p</code>选项将容器的三个端口（例如2181、2888和3888）映射到Docker主机上的相同端口，以便其他容器（和容器外部的软件）可以与ZooKeeper进行通信。</p>
<p>您应该在终端中看到ZooKeeper的典型输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Starting up <span class="keyword">in</span> standalone mode</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /zookeeper/conf/zoo.cfg</span><br><span class="line">2017-09-21 07:15:55,417 - INFO  [main:QuorumPeerConfig@134] - Reading configuration from: /zookeeper/conf/zoo.cfg</span><br><span class="line">2017-09-21 07:15:55,419 - INFO  [main:DatadirCleanupManager@78] - autopurge.snapRetainCount <span class="built_in">set</span> to 3</span><br><span class="line">2017-09-21 07:15:55,419 - INFO  [main:DatadirCleanupManager@79] - autopurge.purgeInterval <span class="built_in">set</span> to 1</span><br><span class="line">2017-09-21 07:15:55,420 - WARN  [main:QuorumPeerMain@113] - Either no config or no quorum defined <span class="keyword">in</span> config, running  <span class="keyword">in</span> standalone mode</span><br><span class="line">2017-09-21 07:15:55,420 - INFO  [PurgeTask:DatadirCleanupManager<span class="variable">$PurgeTask</span>@138] - Purge task started.</span><br><span class="line">2017-09-21 07:15:55,425 - INFO  [PurgeTask:DatadirCleanupManager<span class="variable">$PurgeTask</span>@144] - Purge task completed.</span><br><span class="line">2017-09-21 07:15:55,427 - INFO  [main:QuorumPeerConfig@134] - Reading configuration from: /zookeeper/conf/zoo.cfg</span><br><span class="line">2017-09-21 07:15:55,427 - INFO  [main:ZooKeeperServerMain@96] - Starting server</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:zookeeper.version=3.4.10-39d3a4f269333c922ed3db283be479f9deacaa0f, built on 03/23/2017 10:13 GMT</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:host.name=51b46dd211d0</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:java.version=1.8.0_131</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:java.vendor=Oracle Corporation</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:java.home=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.131-3.b12.el7_3.x86_64/jre</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:java.class.path=/zookeeper/bin/../build/classes:/zookeeper/bin/../build/lib/*.jar:/zookeeper/bin/../lib/slf4j-log4j12-1.6.1.jar:/zookeeper/bin/../lib/slf4j-api-1.6.1.jar:/zookeeper/bin/../lib/netty-3.10.5.Final.jar:/zookeeper/bin/../lib/log4j-1.2.16.jar:/zookeeper/bin/../lib/jline-0.9.94.jar:/zookeeper/bin/../zookeeper-3.4.10.jar:/zookeeper/bin/../src/java/lib/*.jar:/zookeeper/conf:</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:java.io.tmpdir=/tmp</span><br><span class="line">2017-09-21 07:15:55,433 - INFO  [main:Environment@100] - Server environment:java.compiler=&lt;NA&gt;</span><br><span class="line">2017-09-21 07:15:55,433 - INFO  [main:Environment@100] - Server environment:os.name=Linux</span><br><span class="line">2017-09-21 07:15:55,433 - INFO  [main:Environment@100] - Server environment:os.arch=amd64</span><br><span class="line">2017-09-21 07:15:55,433 - INFO  [main:Environment@100] - Server environment:os.version=4.4.0-93-generic</span><br><span class="line">2017-09-21 07:15:55,433 - INFO  [main:Environment@100] - Server environment:user.name=zookeeper</span><br><span class="line">2017-09-21 07:15:55,433 - INFO  [main:Environment@100] - Server environment:user.home=/zookeeper</span><br><span class="line">2017-09-21 07:15:55,433 - INFO  [main:Environment@100] - Server environment:user.dir=/zookeeper</span><br><span class="line">2017-09-21 07:15:55,435 - INFO  [main:ZooKeeperServer@829] - tickTime <span class="built_in">set</span> to 2000</span><br><span class="line">2017-09-21 07:15:55,435 - INFO  [main:ZooKeeperServer@838] - minSessionTimeout <span class="built_in">set</span> to -1</span><br><span class="line">2017-09-21 07:15:55,435 - INFO  [main:ZooKeeperServer@847] - maxSessionTimeout <span class="built_in">set</span> to -1</span><br><span class="line">2017-09-21 07:15:55,440 - INFO  [main:NIOServerCnxnFactory@89] - binding to port 0.0.0.0/0.0.0.0:2181</span><br></pre></td></tr></table></figure>
<p>最后一行很重要，它报告ZooKeeper已准备就绪并且正在侦听端口2181。在ZooKeeper生成该终端时，终端将继续显示其他输出。</p>
<h3 id="启动卡夫卡"><a href="#启动卡夫卡" class="headerlink" title="启动卡夫卡"></a>启动卡夫卡</h3><p>打开一个新终端，并通过运行以下命令使用它在新容器中启动Kafka：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --name kafka -p 9092:9092 --link zookeeper:zookeeper debezium/kafka:1.0</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th></th>
<th>在本教程中，我们总是从Docker容器中连接到Kafka，<code>kafka</code>只要我们链接到该<code>kafka</code>容器，他们就始终能够看到该容器并与之通信。如果我们想从Docker容器<em>外部</em>连接到Kafka ，则希望Kafka 通过Docker主机<em>发布</em>其地址，我们可以通过添加Docker主机<code>-e ADVERTISED_HOST_NAME=</code>的IP地址或可解析的主机名来实现， Mac上的Linux或Docker，这是主机的IP地址（不是<code>localhost</code>）。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>这将使用<code>debezium/kafka</code>映像的1.0版运行一个新容器，并将名称分配<code>kafka</code>给该容器。该<code>-it</code>标志使容器具有交互性，这意味着它将终端的标准输入和输出附加到容器，以便您可以看到容器中正在发生的事情。该<code>--rm</code>标志指示Docker在停止时删除容器。该命令将容器中的端口9092映射到Docker主机上的同一端口，以便容器外部的软件可以与Kafka进行通信。最后，命令使用<code>--link zookeeper:zookeeper</code>参数告诉容器它可以在<code>zookeeper</code>运行在同一Docker主机上的容器中找到ZooKeeper 。</p>
<p>您应该在终端中看到Kafka的典型输出，结尾为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:16:59,085 - INFO  [main-EventThread:ZkClient@713] - zookeeper state changed (SyncConnected)</span><br><span class="line">2017-09-21 07:16:59,218 - INFO  [main:Logging$class@70] - Cluster ID = LPtcBFxzRvOzDSXhc6AamA</span><br><span class="line">2017-09-21 07:16:59,221 - WARN  [main:Logging$class@85] - No meta.properties file under dir /kafka/data/1/meta.properties</span><br><span class="line">2017-09-21 07:16:59,247 - INFO  [ThrottledRequestReaper-Fetch:Logging$class@70] - [ThrottledRequestReaper-Fetch]: Starting</span><br><span class="line">2017-09-21 07:16:59,247 - INFO  [ThrottledRequestReaper-Produce:Logging$class@70] - [ThrottledRequestReaper-Produce]: Starting</span><br><span class="line">2017-09-21 07:16:59,248 - INFO  [ThrottledRequestReaper-Request:Logging$class@70] - [ThrottledRequestReaper-Request]: Starting</span><br><span class="line">2017-09-21 07:16:59,308 - INFO  [main:Logging$class@70] - Loading logs.</span><br><span class="line">2017-09-21 07:16:59,312 - INFO  [main:Logging$class@70] - Logs loading complete in 4 ms.</span><br><span class="line">2017-09-21 07:16:59,349 - INFO  [main:Logging$class@70] - Starting log cleanup with a period of 300000 ms.</span><br><span class="line">2017-09-21 07:16:59,353 - INFO  [main:Logging$class@70] - Starting log flusher with a default period of 9223372036854775807 ms.</span><br><span class="line">2017-09-21 07:16:59,385 - INFO  [main:Logging$class@70] - Awaiting socket connections on 172.17.0.4:9092.</span><br><span class="line">2017-09-21 07:16:59,387 - INFO  [main:Logging$class@70] - [Socket Server on Broker 1], Started 1 acceptor threads</span><br><span class="line">2017-09-21 07:16:59,394 - INFO  [ExpirationReaper-1-Produce:Logging$class@70] - [ExpirationReaper-1-Produce]: Starting</span><br><span class="line">2017-09-21 07:16:59,395 - INFO  [ExpirationReaper-1-Fetch:Logging$class@70] - [ExpirationReaper-1-Fetch]: Starting</span><br><span class="line">2017-09-21 07:16:59,395 - INFO  [ExpirationReaper-1-DeleteRecords:Logging$class@70] - [ExpirationReaper-1-DeleteRecords]: Starting</span><br><span class="line">2017-09-21 07:16:59,435 - INFO  [ExpirationReaper-1-topic:Logging$class@70] - [ExpirationReaper-1-topic]: Starting</span><br><span class="line">2017-09-21 07:16:59,441 - INFO  [ExpirationReaper-1-Heartbeat:Logging$class@70] - [ExpirationReaper-1-Heartbeat]: Starting</span><br><span class="line">2017-09-21 07:16:59,442 - INFO  [controller-event-thread:Logging$class@70] - Creating /controller (is it secure? false)</span><br><span class="line">2017-09-21 07:16:59,447 - INFO  [ExpirationReaper-1-Rebalance:Logging$class@70] - [ExpirationReaper-1-Rebalance]: Starting</span><br><span class="line">2017-09-21 07:16:59,456 - INFO  [controller-event-thread:Logging$class@70] - Result of znode creation is: OK</span><br><span class="line">2017-09-21 07:16:59,458 - INFO  [main:Logging$class@70] - [GroupCoordinator 1]: Starting up.</span><br><span class="line">2017-09-21 07:16:59,459 - INFO  [main:Logging$class@70] - [GroupCoordinator 1]: Startup complete.</span><br><span class="line">2017-09-21 07:16:59,460 - INFO  [group-metadata-manager-0:Logging$class@70] - [Group Metadata Manager on Broker 1]: Removed 0 expired offsets in 1 milliseconds.</span><br><span class="line">2017-09-21 07:16:59,487 - INFO  [main:Logging$class@70] - [ProducerId Manager 1]: Acquired new producerId block (brokerId:1,blockStartProducerId:0,blockEndProducerId:999) by writing to Zk with path version 1</span><br><span class="line">2017-09-21 07:16:59,530 - INFO  [main:Logging$class@70] - [Transaction Coordinator 1]: Starting up.</span><br><span class="line">2017-09-21 07:16:59,532 - INFO  [TxnMarkerSenderThread-1:Logging$class@70] - [Transaction Marker Channel Manager 1]: Starting</span><br><span class="line">2017-09-21 07:16:59,532 - INFO  [main:Logging$class@70] - [Transaction Coordinator 1]: Startup complete.</span><br><span class="line">2017-09-21 07:16:59,551 - INFO  [main:Logging$class@70] - Will not load MX4J, mx4j-tools.jar is not in the classpath</span><br><span class="line">2017-09-21 07:16:59,590 - INFO  [main:Logging$class@70] - Creating /brokers/ids/1 (is it secure? false)</span><br><span class="line">2017-09-21 07:16:59,604 - INFO  [main:Logging$class@70] - Result of znode creation is: OK</span><br><span class="line">2017-09-21 07:16:59,605 - INFO  [main:Logging$class@70] - Registered broker 1 at path /brokers/ids/1 with addresses: EndPoint(172.17.0.4,9092,ListenerName(PLAINTEXT),PLAINTEXT)</span><br><span class="line">2017-09-21 07:16:59,606 - WARN  [main:Logging$class@85] - No meta.properties file under dir /kafka/data/1/meta.properties</span><br><span class="line">2017-09-21 07:16:59,648 - INFO  [main:AppInfoParser$AppInfo@83] - Kafka version : 0.11.0.0</span><br><span class="line">2017-09-21 07:16:59,648 - INFO  [main:AppInfoParser$AppInfo@84] - Kafka commitId : cb8625948210849f</span><br><span class="line">2017-09-21 07:16:59,649 - INFO  [main:Logging$class@70] - [Kafka Server 1], started</span><br></pre></td></tr></table></figure>
<p>上面显示的最后一行报告说，Kafka代理已成功启动并且已准备好进行客户端连接。随着Kafka的生成，终端将继续显示其他输出。</p>
<table>
<thead>
<tr>
<th></th>
<th>Debezium 1.0.2.Final需要Kafka Connect 2.4.0，在本教程中，我们还将使用Kafka Broker的2.4.0版本。查看有关不同版本的Kafka Connect和Kafka代理之间兼容性的<a href="http://kafka.apache.org/documentation.html" target="_blank" rel="noopener">Kafka文档</a>。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<h3 id="启动一个MySQL数据库"><a href="#启动一个MySQL数据库" class="headerlink" title="启动一个MySQL数据库"></a>启动一个MySQL数据库</h3><p>至此，我们已经启动了ZooKeeper和Kafka，但是还没有Debezium可以从中捕获更改的数据库服务器。现在，让我们用示例数据库启动一个MySQL服务器。</p>
<p>打开一个新终端，并使用它来启动一个新容器，该容器运行一个预先配置有<code>inventory</code>数据库的MySQL数据库服务器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=debezium -e MYSQL_USER=mysqluser -e MYSQL_PASSWORD=mysqlpw debezium/example-mysql:1.0</span><br></pre></td></tr></table></figure>
<p>这将运行使用的版本1.0中的新的容器<code>debezium/example-mysql</code>的图像，这是<a href="https://github.com/debezium/docker-images/blob/master/examples/mysql/0.1/Dockerfile" target="_blank" rel="noopener">基于</a>所述<a href="https://hub.docker.com/r/_/mysql/" target="_blank" rel="noopener">的MySQL：5.7</a>图像，限定并填充的样品的“库存”数据库，并创建一个<code>debezium</code>用户与密码<code>dbz</code>具有由Debezium的MySQL的连接器所需的最小特权。该命令将名称分配给<code>mysql</code>容器，以便以后可以方便地引用它。该<code>-it</code>标志使容器具有交互性，这意味着它将终端的标准输入和输出附加到容器，以便您可以看到容器中正在发生的事情。的<code>--rm</code>标志指示Docker在停止时删除容器。该命令将容器中的端口3306（默认的MySQL端口）映射到Docker主机上的同一端口，以便容器外部的软件可以连接到数据库服务器。最后，该机还采用了<code>-e</code>选项三次的设置<code>MYSQL_ROOT_PASSWORD</code>，<code>MYSQL_USER</code>以及<code>MYSQL_PASSWORD</code>环境变量设置为特定值。</p>
<p>您应该在终端中看到以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">017-09-21T07:18:50.824629Z 0 [Note] mysqld: ready for connections.</span><br><span class="line">Version: &apos;5.7.19-log&apos;  socket: &apos;/var/run/mysqld/mysqld.sock&apos;  port: 3306  MySQL Community Server (GPL)</span><br></pre></td></tr></table></figure>
<p>请注意，随着修改配置，MySQL服务器会启动和停止几次。上面列出的最后一行报告MySQL服务器正在运行并且可以使用。</p>
<h3 id="启动MySQL命令行客户端"><a href="#启动MySQL命令行客户端" class="headerlink" title="启动MySQL命令行客户端"></a>启动MySQL命令行客户端</h3><p>打开一个新终端，并使用它为MySQL命令行客户端启动一个新容器，并将其连接到在该<code>mysql</code>容器中运行的MySQL服务器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --name mysqlterm --link mysql --rm mysql:5.7 sh -c <span class="string">'exec mysql -h"$MYSQL_PORT_3306_TCP_ADDR" -P"$MYSQL_PORT_3306_TCP_PORT" -uroot -p"$MYSQL_ENV_MYSQL_ROOT_PASSWORD"'</span></span><br></pre></td></tr></table></figure>
<p>在这里，我们使用<a href="https://hub.docker.com/r/_/mysql/" target="_blank" rel="noopener">mysql：5.7</a>映像启动容器，命名该容器<code>mysqlterm</code>并将其链接到<code>mysql</code>运行数据库服务器的容器。该<code>--rm</code>选项告诉Docker在停止时删除容器，该命令的其余部分定义了容器应运行的shell命令。此shell命令运行MySQL命令行客户端，并指定正确的选项，以便可以正确连接。</p>
<p>容器应输出类似于以下内容的行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql: [Warning] Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 3</span><br><span class="line">Server version: 5.7.17-log MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">'\c'</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>
<p>与其他容器不同，此容器运行一个产生提示的过程。我们将使用提示与数据库进行交互。首先，切换到“库存”数据库：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use inventory;</span><br></pre></td></tr></table></figure>
<p>然后列出数据库中的表：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br></pre></td></tr></table></figure>
<p>然后应显示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+<span class="comment">---------------------+</span></span><br><span class="line">| Tables_in_inventory |</span><br><span class="line">+<span class="comment">---------------------+</span></span><br><span class="line">| customers           |</span><br><span class="line">| orders              |</span><br><span class="line">| products            |</span><br><span class="line">| products_on_hand    |</span><br><span class="line">+<span class="comment">---------------------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>使用MySQL命令行客户端浏览数据库并查看数据库中预加载的数据。例如：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM customers;</span><br></pre></td></tr></table></figure>
<h3 id="启动Kafka-Connect"><a href="#启动Kafka-Connect" class="headerlink" title="启动Kafka Connect"></a>启动Kafka Connect</h3><p>打开一个新终端，并通过运行以下命令使用它在新容器中启动Kafka Connect服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --name connect -p 8083:8083 -e GROUP_ID=1 -e CONFIG_STORAGE_TOPIC=my_connect_configs -e OFFSET_STORAGE_TOPIC=my_connect_offsets -e STATUS_STORAGE_TOPIC=my_connect_statuses --link zookeeper:zookeeper --link kafka:kafka --link mysql:mysql debezium/connect:1.0</span><br></pre></td></tr></table></figure>
<p>这将运行一个<code>connect</code>使用该<code>debezium/connect</code>映像的1.0版命名的新Docker容器。该<code>-it</code>标志使容器具有交互性，这意味着它将终端的标准输入和输出附加到容器，以便您可以看到容器中正在发生的事情。该<code>--rm</code>标志指示Docker在停止时删除容器。该命令将容器中的端口8083映射到Docker主机上的相同端口，以便容器外部的软件可以使用Kafka Connect的REST API来设置和管理新的连接器实例。该命令使用<code>--link zookeeper:zookeeper</code>，<code>--link kafka:kafka</code>以及<code>--link mysql:mysql</code>，参数告诉容器，它可以找到的ZooKeeper中指定的容器中运行<code>zookeeper</code>，卡夫卡经纪人在名为容器中运行<code>kafka</code>，以及在名为的容器中运行的MySQL服务器<code>mysql</code>，它们均在同一Docker主机上运行。最后，该机还采用了<code>-e</code>选择三次设置<code>GROUP_ID</code>，<code>CONFIG_STORAGE_TOPIC</code>，<code>OFFSET_STORAGE_TOPIC</code>，和<code>STATUS_STORAGE_TOPIC</code>环境变量，它们都通过这个Debezium图像所需（尽管您可以根据需要使用不同的值）。</p>
<p>您应该在终端中看到Kafka Connect终端的典型输出，结尾为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:21:14,912 INFO   ||  Kafka version : 0.11.0.0   [org.apache.kafka.common.utils.AppInfoParser]</span><br><span class="line">2017-09-21 07:21:14,912 INFO   ||  Kafka commitId : cb8625948210849f   [org.apache.kafka.common.utils.AppInfoParser]</span><br><span class="line">2017-09-21 07:21:14,929 INFO   ||  Discovered coordinator 172.17.0.4:9092 (id: 2147483646 rack: null) for group 1.   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:21:14,931 INFO   ||  Finished reading KafkaBasedLog for topic my_connect_configs   [org.apache.kafka.connect.util.KafkaBasedLog]</span><br><span class="line">2017-09-21 07:21:14,932 INFO   ||  Started KafkaBasedLog for topic my_connect_configs   [org.apache.kafka.connect.util.KafkaBasedLog]</span><br><span class="line">2017-09-21 07:21:14,932 INFO   ||  Started KafkaConfigBackingStore   [org.apache.kafka.connect.storage.KafkaConfigBackingStore]</span><br><span class="line">2017-09-21 07:21:14,932 INFO   ||  Herder started   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:21:14,938 INFO   ||  Discovered coordinator 172.17.0.4:9092 (id: 2147483646 rack: null) for group 1.   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:21:14,940 INFO   ||  (Re-)joining group 1   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:21:15,022 INFO   ||  Successfully joined group 1 with generation 1   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:21:15,022 INFO   ||  Joined group and got assignment: Assignment&#123;error=0, leader=&apos;connect-1-4d60cb71-cb93-4388-8908-6f0d299a9d94&apos;, leaderUrl=&apos;http://172.17.0.7:9092/&apos;, offset=-1, connectorIds=[], taskIds=[]&#125;   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:21:15,023 INFO   ||  Starting connectors and tasks using config offset -1   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:21:15,023 INFO   ||  Finished starting connectors and tasks   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br></pre></td></tr></table></figure>
<p>上面显示的最后几行报告该服务已启动并且已准备好进行连接。随着Kafka Connect服务生成该终端，该终端将继续显示其他输出。</p>
<h4 id="使用Kafka-Connect-REST-API"><a href="#使用Kafka-Connect-REST-API" class="headerlink" title="使用Kafka Connect REST API"></a>使用Kafka Connect REST API</h4><p>Kafka Connect服务公开了RESTful API来管理连接器集，因此让我们通过<code>curl</code>命令行工具使用该API 。因为我们已将<code>connect</code>容器（运行Kafka Connect服务的端口）中的端口8083 映射到Docker主机上的端口8083，所以我们可以通过将请求发送到Docker主机上的端口8083来与该服务进行通信，然后将请求转发到Docker主机上。 Kafka Connect服务。我们<code>localhost</code>在示例中使用的是非本地Docker平台的用户（例如Windows和OS X上的Docker Toolbox用户），应替换<code>localhost</code>为其Docker主机的IP地址。</p>
<p>打开一个新终端，并使用它来检查Kafka Connect服务的状态：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -H <span class="string">"Accept:application/json"</span> localhost:8083/</span><br></pre></td></tr></table></figure>
<p>Kafka Connect服务应返回类似于以下内容的JSON响应消息：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"version"</span>:<span class="string">"2.4.0"</span>,<span class="attr">"commit"</span>:<span class="string">"cb8625948210849f"</span>&#125;</span><br></pre></td></tr></table></figure>
<p>这表明我们正在运行Kafka Connect 2.4.0版本。接下来，再次检查连接器列表，再次使用您的IP地址代替<code>localhost</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -H <span class="string">"Accept:application/json"</span> localhost:8083/connectors/</span><br></pre></td></tr></table></figure>
<p>应该返回以下内容：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[]</span><br></pre></td></tr></table></figure>
<p>这确认Kafka Connect服务正在运行，我们可以与之交谈，并且当前没有连接器。让我们补救一下，方法是启动一个连接器，该连接器将从MySQL数据库中捕获更改。</p>
<h3 id="监控MySQL数据库"><a href="#监控MySQL数据库" class="headerlink" title="监控MySQL数据库"></a>监控MySQL数据库</h3><p>此时，我们正在运行Debezium服务，带有示例<code>inventory</code>数据库的MySQL数据库服务器以及连接到数据库的MySQL命令行客户端。下一步是注册一个连接器，该连接器将开始监视MySQL数据库服务器的binlog，并为已更改（或将要更改）的每一行生成更改事件。由于这是一个新的连接器，因此在启动时它将从MySQL二进制日志的开头开始读取，该日志记录了所有事务，包括单个行的更改和对模式的更改。</p>
<table>
<thead>
<tr>
<th></th>
<th>通常，我们可能希望使用Kafka工具来手动创建必要的主题，包括指定副本数。但是，对于本教程，Kafka配置为仅使用1个副本自动创建主题。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>在同一终端上，我们将使用<code>curl</code>我们要启动的连接器信息向我们的Kafka Connect服务提交JSON请求消息。由于此命令将不在Docker容器中，因此我们需要使用Docker主机的IP地址（因此Windows和OS X上的Docker Toolbox用户应替换<code>localhost</code>为其IP地址）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -i -X POST -H <span class="string">"Accept:application/json"</span> -H <span class="string">"Content-Type:application/json"</span> localhost:8083/connectors/ -d <span class="string">'&#123; "name": "inventory-connector", "config": &#123; "connector.class": "io.debezium.connector.mysql.MySqlConnector", "tasks.max": "1", "database.hostname": "mysql", "database.port": "3306", "database.user": "debezium", "database.password": "dbz", "database.server.id": "184054", "database.server.name": "dbserver1", "database.whitelist": "inventory", "database.history.kafka.bootstrap.servers": "kafka:9092", "database.history.kafka.topic": "dbhistory.inventory" &#125; &#125;'</span></span><br></pre></td></tr></table></figure>
<p>|      | Windows用户可能需要转义双引号，如下所示：<figure class="highlight bash"><figcaption><span>$ curl -i -X POST -H "Accept:application/json" -H "Content-Type:application/json" localhost:8083/connectors/ -d '&#123; \"name\": \"inventory-connector\", \"config\": &#123; \"connector.class\": \"io.debezium.connector.mysql.MySqlConnector\", \"tasks.max\": \"1\", \"database.hostname\": \"mysql\", \"database.port\": \"3306\", \"database.user\": \"debezium\", \"database.password\": \"dbz\", \"database.server.id\": \"184054\", \"database.server.name\": \"dbserver1\", \"database.whitelist\": \"inventory\", \"database.history.kafka.bootstrap.servers\": \"kafka:9092\", \"database.history.kafka.topic\": \"dbhistory.inventory\" &#125; &#125;'`为避免此错误：`&#123;"error_code":500,"message":"Unexpected character ('n' (code 110)): was expecting double-quote to start field name\n at [Source: (org.glassfish.jersey.message.internal.ReaderInterceptorExecutor$UnCloseableInputStream); line: 1, column: 4]"&#125;``` |</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">| ---- | ------------------------------------------------------------ |</span><br><span class="line">|      | ```json &#123;<span class="string">"error_code"</span>:500,<span class="string">"message"</span>:<span class="string">"Unexpected character ('n' (code 110)): was expecting double-quote to start field name\n at [Source: (org.glassfish.jersey.message.internal.ReaderInterceptorExecutor<span class="variable">$UnCloseableInputStream</span>); line: 1, column: 4]"</span>&#125;``` |</span><br><span class="line"></span><br><span class="line">此命令使用Kafka Connect服务的RESTful API提交带有描述我们新连接器的JSON文档的资源`POST`请求`/connectors`。这是一条更具可读性的JSON消息：</span><br><span class="line"></span><br><span class="line">```json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"inventory-connector"</span>,</span><br><span class="line">  <span class="string">"config"</span>: &#123;</span><br><span class="line">    <span class="string">"connector.class"</span>: <span class="string">"io.debezium.connector.mysql.MySqlConnector"</span>,</span><br><span class="line">    <span class="string">"tasks.max"</span>: <span class="string">"1"</span>,</span><br><span class="line">    <span class="string">"database.hostname"</span>: <span class="string">"mysql"</span>,</span><br><span class="line">    <span class="string">"database.port"</span>: <span class="string">"3306"</span>,</span><br><span class="line">    <span class="string">"database.user"</span>: <span class="string">"debezium"</span>,</span><br><span class="line">    <span class="string">"database.password"</span>: <span class="string">"dbz"</span>,</span><br><span class="line">    <span class="string">"database.server.id"</span>: <span class="string">"184054"</span>,</span><br><span class="line">    <span class="string">"database.server.name"</span>: <span class="string">"dbserver1"</span>,</span><br><span class="line">    <span class="string">"database.whitelist"</span>: <span class="string">"inventory"</span>,</span><br><span class="line">    <span class="string">"database.history.kafka.bootstrap.servers"</span>: <span class="string">"kafka:9092"</span>,</span><br><span class="line">    <span class="string">"database.history.kafka.topic"</span>: <span class="string">"schema-changes.inventory"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>JSON消息将连接器名称指定为<code>inventory-connector</code>，并提供<a href="https://debezium.io/documentation/reference/1.0/connectors/mysql.html#connector-properties" target="_blank" rel="noopener">我们的MySQL连接器</a>的详细<a href="https://debezium.io/documentation/reference/1.0/connectors/mysql.html#connector-properties" target="_blank" rel="noopener">配置属性</a>：</p>
<ul>
<li>一项任务应该恰好在任何时候运行。由于MySQL连接读取MySQL服务器的binlog，因此使用单个连接器任务是确保正确顺序和所有事件得到正确处理的唯一方法。</li>
<li>数据库主机指定为<code>mysql</code>，这是运行MySQL服务器的Docker容器的名称。回想一下，Docker在我们的容器中操纵了网络堆栈，以便可以通过<code>/etc/hosts</code>使用容器名称作为主机名来解析每个链接的容器。如果MySQL在正常网络上运行，我们只需为此值指定IP地址或可解析的主机名即可。</li>
<li>指定了MySQL服务器的端口。</li>
<li>我们正在运行的MySQL数据库已<code>debezium</code>为我们的目的明确设置了一个用户，因此我们在此处指定该用户名和密码。</li>
<li>给出了唯一的服务器ID和名称。服务器名称是MySQL服务器或服务器集群的逻辑标识符，将用作所有Kafka主题的前缀。</li>
<li>我们只想检测<code>inventory</code>数据库中的更改，因此我们使用白名单。</li>
<li>连接器应使用命名的代理（与我们将事件发送到的代理相同）和主题名称在Kafka中存储数据库架构的历史记录。重新启动后，连接器将恢复连接器应开始读取时二进制日志中存在的时间点的数据库模式。</li>
</ul>
<p>此命令应产生类似于以下内容的响应（也许更紧凑）：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">201</span> Created</span><br><span class="line"><span class="attribute">Date</span>: Tue, 07 Feb 2017 20:49:34 GMT</span><br><span class="line"><span class="attribute">Location</span>: http://localhost:8083/connectors/inventory-connector</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json</span><br><span class="line"><span class="attribute">Content-Length</span>: 471</span><br><span class="line"><span class="attribute">Server</span>: Jetty(9.2.15.v20160210)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "name": "inventory-connector",</span><br><span class="line">  "config": &#123;</span><br><span class="line">    "connector.class": "io.debezium.connector.mysql.MySqlConnector",</span><br><span class="line">    "tasks.max": "1",</span><br><span class="line">    "database.hostname": "mysql",</span><br><span class="line">    "database.port": "3306",</span><br><span class="line">    "database.user": "debezium",</span><br><span class="line">    "database.password": "dbz",</span><br><span class="line">    "database.server.id": "184054",</span><br><span class="line">    "database.server.name": "dbserver1",</span><br><span class="line">    "database.whitelist": "inventory",</span><br><span class="line">    "database.history.kafka.bootstrap.servers": "kafka:9092",</span><br><span class="line">    "database.history.kafka.topic": "dbhistory.inventory",</span><br><span class="line">    "name": "inventory-connector"</span><br><span class="line">  &#125;,</span><br><span class="line">  "tasks": []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此响应描述了<code>/connectors/inventory-connector</code>服务刚刚创建的连接器资源，并包括连接器的配置和有关任务的信息。由于连接器是刚刚创建的，因此该服务尚未完成启动任务。</p>
<p>我们甚至可以使用RESTful API来验证我们的连接器是否包含在连接器列表中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -H <span class="string">"Accept:application/json"</span> localhost:8083/connectors/</span><br></pre></td></tr></table></figure>
<p>应该返回以下内容：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">"inventory-connector"</span>]</span><br></pre></td></tr></table></figure>
<p>回想一下，Kafka Connect服务使用连接器启动一个或多个完成该任务的任务，并且它将自动在Kafka Connect服务群集中分配正在运行的任务。如果任何服务停止或崩溃，这些任务将重新分配给正在运行的服务。当我们获得连接器的状态时，我们可以看到任务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -i -X GET -H <span class="string">"Accept:application/json"</span> localhost:8083/connectors/inventory-connector</span><br></pre></td></tr></table></figure>
<p>返回：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Date</span>: Mon, 27 Mar 2017 17:09:28 GMT</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json</span><br><span class="line"><span class="attribute">Content-Length</span>: 515</span><br><span class="line"><span class="attribute">Server</span>: Jetty(9.2.15.v20160210)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "name": "inventory-connector",</span><br><span class="line">  "config": &#123;</span><br><span class="line">    "name": "inventory-connector",</span><br><span class="line">    "connector.class": "io.debezium.connector.mysql.MySqlConnector",</span><br><span class="line">    "tasks.max": "1",</span><br><span class="line">    "database.hostname": "mysql",</span><br><span class="line">    "database.port": "3306",</span><br><span class="line">    "database.user": "debezium",</span><br><span class="line">    "database.password": "dbz",</span><br><span class="line">    "database.server.id": "184054",</span><br><span class="line">    "database.server.name": "dbserver1",</span><br><span class="line">    "database.whitelist": "inventory",</span><br><span class="line">    "database.history.kafka.bootstrap.servers": "kafka:9092",</span><br><span class="line">    "database.history.kafka.topic": "dbhistory.inventory"</span><br><span class="line">  &#125;,</span><br><span class="line">  "tasks": [</span><br><span class="line">    &#123;</span><br><span class="line">      "connector": "inventory-connector",</span><br><span class="line">      "task": 0</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这里，我们可以看到连接器正在运行一个任务（例如任务0）以完成其工作。MySQL连接器仅支持一个任务，因为MySQL将其所有活动记录在一个连续的二进制日志中，因此MySQL连接器仅需要一个读取器即可获得所有这些事件的一致且完全有序的视图。</p>
<p>如果我们查看<code>connect</code>容器的输出，我们会看到连接器产生了很多输出。与我们的连接器相关的前几行是由Kafka Connect输出的，并以以下内容开头：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:23:59,051 INFO   ||  Connector inventory-connector config updated   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:23:59,550 INFO   ||  Rebalance started   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:23:59,550 INFO   ||  Finished stopping tasks in preparation for rebalance   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:23:59,550 INFO   ||  (Re-)joining group 1   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:23:59,556 INFO   ||  Successfully joined group 1 with generation 2   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:23:59,556 INFO   ||  Joined group and got assignment: Assignment&#123;error=0, leader=&apos;connect-1-4d60cb71-cb93-4388-8908-6f0d299a9d94&apos;, leaderUrl=&apos;http://172.17.0.7:9092/&apos;, offset=1, connectorIds=[inventory-connector], taskIds=[]&#125;   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:23:59,557 INFO   ||  Starting connectors and tasks using config offset 1   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:23:59,557 INFO   ||  Starting connector inventory-connector   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>接下来是Kafka Connect的大量输出，内容涉及启动此连接器以及各种生产者和消费者配置。最终，我们<em>从MySQL连接器</em>看到以下输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:24:01,151 INFO   MySQL|dbserver1|task  Kafka version : 0.11.0.0   [org.apache.kafka.common.utils.AppInfoParser]</span><br><span class="line">2017-09-21 07:24:01,151 INFO   MySQL|dbserver1|task  Kafka commitId : cb8625948210849f   [org.apache.kafka.common.utils.AppInfoParser]</span><br><span class="line">2017-09-21 07:24:01,584 INFO   MySQL|dbserver1|task  Found no existing offset, so preparing to perform a snapshot   [io.debezium.connector.mysql.MySqlConnectorTask]</span><br><span class="line">2017-09-21 07:24:01,614 INFO   ||  Source task WorkerSourceTask&#123;id=inventory-connector-0&#125; finished initialization and start   [org.apache.kafka.connect.runtime.WorkerSourceTask]</span><br><span class="line">2017-09-21 07:24:01,615 INFO   MySQL|dbserver1|snapshot  Starting snapshot for jdbc:mysql://mysql:3306/?useInformationSchema=true&amp;nullCatalogMeansCurrent=false&amp;useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;characterSetResults=UTF-8&amp;zeroDateTimeBehavior=convertToNull with user &apos;debezium&apos;   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,617 INFO   MySQL|dbserver1|snapshot  Snapshot is using user &apos;debezium&apos; with these MySQL grants:   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,618 INFO   MySQL|dbserver1|snapshot         GRANT SELECT, RELOAD, SHOW DATABASES, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &apos;debezium&apos;@&apos;%&apos;   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>首先，Debezium日志输出使用<em>映射的诊断上下文</em>（即MDC），它允许日志消息包括特定于线程的信息，例如连接器类型（例如，<code>MySQL</code>在上面的“ INFO”或“ WARN”字段之后的日志消息中），连接器（例如，逻辑名<code>dbserver1</code>同上），并且连接器的活动（例如，<code>task</code>，<code>snapshot</code>和<code>binlog</code>）。希望这些将使您更容易理解多线程Kafka Connect服务中的情况。</p>
<p>前几行涉及<code>task</code>连接器的活动，并且基本上报告一些簿记信息，以使连接器在没有任何偏移的情况下启动。新的三行内容涉及<code>snapshot</code>连接器的活动，特别是正在使用<code>debezium</code>MySQL用户以及与该用户关联的MySQL授权启动快照。</p>
<table>
<thead>
<tr>
<th></th>
<th>如果连接器无法连接或看不到任何表或Binlog，请检查这些授予以确保包括上面列出的所有授予。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>连接器输出的下一条消息如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:24:01,618 INFO   MySQL|dbserver1|snapshot  MySQL server variables related to change data capture:   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,625 INFO   MySQL|dbserver1|snapshot  	binlog_cache_size                             = 32768                                           [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,625 INFO   MySQL|dbserver1|snapshot  	binlog_checksum                               = CRC32                                           [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,625 INFO   MySQL|dbserver1|snapshot  	binlog_direct_non_transactional_updates       = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,625 INFO   MySQL|dbserver1|snapshot  	binlog_error_action                           = ABORT_SERVER                                    [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_format                                 = ROW                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_group_commit_sync_delay                = 0                                               [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_group_commit_sync_no_delay_count       = 0                                               [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_gtid_simple_recovery                   = ON                                              [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_max_flush_queue_time                   = 0                                               [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_order_commits                          = ON                                              [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_row_image                              = FULL                                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_rows_query_log_events                  = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_stmt_cache_size                        = 32768                                           [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_set_client                          = utf8                                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_set_connection                      = utf8                                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_set_database                        = latin1                                          [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_set_filesystem                      = binary                                          [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_set_results                         = utf8                                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_set_server                          = latin1                                          [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_set_system                          = utf8                                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_sets_dir                            = /usr/share/mysql/charsets/                      [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	collation_connection                          = utf8_general_ci                                 [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	collation_database                            = latin1_swedish_ci                               [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	collation_server                              = latin1_swedish_ci                               [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	enforce_gtid_consistency                      = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	gtid_executed_compression_period              = 1000                                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	gtid_mode                                     = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	gtid_next                                     = AUTOMATIC                                       [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	gtid_owned                                    =                                                 [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	gtid_purged                                   =                                                 [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	innodb_api_enable_binlog                      = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	innodb_locks_unsafe_for_binlog                = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	innodb_version                                = 5.7.19                                          [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	log_statements_unsafe_for_binlog              = ON                                              [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	max_binlog_cache_size                         = 18446744073709547520                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	max_binlog_size                               = 1073741824                                      [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	max_binlog_stmt_cache_size                    = 18446744073709547520                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	protocol_version                              = 10                                              [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	session_track_gtids                           = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	slave_type_conversions                        =                                                 [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	sync_binlog                                   = 1                                               [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	system_time_zone                              = UTC                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	time_zone                                     = SYSTEM                                          [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	tls_version                                   = TLSv1,TLSv1.1                                   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	tx_isolation                                  = REPEATABLE-READ                                 [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	tx_read_only                                  = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	version                                       = 5.7.19-log                                      [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	version_comment                               = MySQL Community Server (GPL)                    [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	version_compile_machine                       = x86_64                                          [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,628 INFO   MySQL|dbserver1|snapshot  	version_compile_os                            = Linux                                           [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>这将报告由我们的MySQL连接器找到的相关MySQL服务器设置。最重要的一项是<code>binlog_format</code>，它被设置为<code>ROW</code>。这些行之后是构成快照操作的9个步骤的输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:24:01,628 INFO   MySQL|dbserver1|snapshot  Step 0: disabling autocommit and enabling repeatable <span class="built_in">read</span> transactions   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,631 INFO   MySQL|dbserver1|snapshot  Step 1: start transaction with consistent snapshot   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,634 INFO   MySQL|dbserver1|snapshot  Step 2: flush and obtain global <span class="built_in">read</span> lock to prevent writes to database   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,636 INFO   MySQL|dbserver1|snapshot  Step 3: <span class="built_in">read</span> binlog position of MySQL master   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,638 INFO   MySQL|dbserver1|snapshot  	 using binlog <span class="string">'mysql-bin.000003'</span> at position <span class="string">'154'</span> and gtid <span class="string">''</span>   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,638 INFO   MySQL|dbserver1|snapshot  Step 4: <span class="built_in">read</span> list of available databases   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,638 INFO   MySQL|dbserver1|snapshot  	 list of available databases is: [information_schema, inventory, mysql, performance_schema, sys]   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,639 INFO   MySQL|dbserver1|snapshot  Step 5: <span class="built_in">read</span> list of available tables <span class="keyword">in</span> each database   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,641 INFO   MySQL|dbserver1|snapshot  	 including <span class="string">'inventory.customers'</span>   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,641 INFO   MySQL|dbserver1|snapshot  	 including <span class="string">'inventory.orders'</span>   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,641 INFO   MySQL|dbserver1|snapshot  	 including <span class="string">'inventory.products'</span>   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,641 INFO   MySQL|dbserver1|snapshot  	 including <span class="string">'inventory.products_on_hand'</span>   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,642 INFO   MySQL|dbserver1|snapshot  	 <span class="string">'mysql.columns_priv'</span> is filtered out, discarding   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">...</span><br><span class="line">2017-09-21 07:24:01,670 INFO   MySQL|dbserver1|snapshot  	snapshot continuing with database(s): [inventory]   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,670 INFO   MySQL|dbserver1|snapshot  Step 6: generating DROP and CREATE statements to reflect current database schemas:   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,679 INFO   MySQL|dbserver1|snapshot  	SET character_set_server=latin1, collation_server=latin1_swedish_ci;   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,724 WARN   MySQL|dbserver1|task  Error <span class="keyword">while</span> fetching metadata with correlation id 1 : &#123;dbhistory.inventory=LEADER_NOT_AVAILABLE&#125;   [org.apache.kafka.clients.NetworkClient]</span><br><span class="line">2017-09-21 07:24:01,853 INFO   MySQL|dbserver1|snapshot  	DROP TABLE IF EXISTS `inventory`.`products_on_hand`   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,861 INFO   MySQL|dbserver1|snapshot  	DROP TABLE IF EXISTS `inventory`.`customers`   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,864 INFO   MySQL|dbserver1|snapshot  	DROP TABLE IF EXISTS `inventory`.`orders`   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,866 INFO   MySQL|dbserver1|snapshot  	DROP TABLE IF EXISTS `inventory`.`products`   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,881 INFO   MySQL|dbserver1|snapshot  	DROP DATABASE IF EXISTS `inventory`   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,889 INFO   MySQL|dbserver1|snapshot  	CREATE DATABASE `inventory`   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,893 INFO   MySQL|dbserver1|snapshot  	USE `inventory`   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,914 INFO   MySQL|dbserver1|snapshot  	CREATE TABLE `customers` (</span><br><span class="line">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `first_name` varchar(255) NOT NULL,</span><br><span class="line">  `last_name` varchar(255) NOT NULL,</span><br><span class="line">  `email` varchar(255) NOT NULL,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  UNIQUE KEY `email` (`email`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1005 DEFAULT CHARSET=latin1   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,932 INFO   MySQL|dbserver1|snapshot  	CREATE TABLE `orders` (</span><br><span class="line">  `order_number` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `order_date` date NOT NULL,</span><br><span class="line">  `purchaser` int(11) NOT NULL,</span><br><span class="line">  `quantity` int(11) NOT NULL,</span><br><span class="line">  `product_id` int(11) NOT NULL,</span><br><span class="line">  PRIMARY KEY (`order_number`),</span><br><span class="line">  KEY `order_customer` (`purchaser`),</span><br><span class="line">  KEY `ordered_product` (`product_id`),</span><br><span class="line">  CONSTRAINT `orders_ibfk_1` FOREIGN KEY (`purchaser`) REFERENCES `customers` (`id`),</span><br><span class="line">  CONSTRAINT `orders_ibfk_2` FOREIGN KEY (`product_id`) REFERENCES `products` (`id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=10005 DEFAULT CHARSET=latin1   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,937 INFO   MySQL|dbserver1|snapshot  	CREATE TABLE `products` (</span><br><span class="line">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `name` varchar(255) NOT NULL,</span><br><span class="line">  `description` varchar(512) DEFAULT NULL,</span><br><span class="line">  `weight` <span class="built_in">float</span> DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=110 DEFAULT CHARSET=latin1   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,941 INFO   MySQL|dbserver1|snapshot  	CREATE TABLE `products_on_hand` (</span><br><span class="line">  `product_id` int(11) NOT NULL,</span><br><span class="line">  `quantity` int(11) NOT NULL,</span><br><span class="line">  PRIMARY KEY (`product_id`),</span><br><span class="line">  CONSTRAINT `products_on_hand_ibfk_1` FOREIGN KEY (`product_id`) REFERENCES `products` (`id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=latin1   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,947 INFO   MySQL|dbserver1|snapshot  Step 7: releasing global <span class="built_in">read</span> lock to <span class="built_in">enable</span> MySQL writes   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,949 INFO   MySQL|dbserver1|snapshot  Step 7: blocked writes to MySQL <span class="keyword">for</span> a total of 00:00:00.312   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,950 INFO   MySQL|dbserver1|snapshot  Step 8: scanning contents of 4 tables <span class="keyword">while</span> still <span class="keyword">in</span> transaction   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,953 INFO   MySQL|dbserver1|snapshot  Step 8: - scanning table <span class="string">'inventory.customers'</span> (1 of 4 tables)   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,958 INFO   MySQL|dbserver1|snapshot  Step 8: - Completed scanning a total of 4 rows from table <span class="string">'inventory.customers'</span> after 00:00:00.005   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,959 INFO   MySQL|dbserver1|snapshot  Step 8: - scanning table <span class="string">'inventory.orders'</span> (2 of 4 tables)   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,014 INFO   MySQL|dbserver1|snapshot  Step 8: - Completed scanning a total of 4 rows from table <span class="string">'inventory.orders'</span> after 00:00:00.055   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,016 INFO   MySQL|dbserver1|snapshot  Step 8: - scanning table <span class="string">'inventory.products'</span> (3 of 4 tables)   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,017 INFO   MySQL|dbserver1|snapshot  Step 8: - Completed scanning a total of 9 rows from table <span class="string">'inventory.products'</span> after 00:00:00.001   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,018 INFO   MySQL|dbserver1|snapshot  Step 8: - scanning table <span class="string">'inventory.products_on_hand'</span> (4 of 4 tables)   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,019 INFO   MySQL|dbserver1|snapshot  Step 8: - Completed scanning a total of 9 rows from table <span class="string">'inventory.products_on_hand'</span> after 00:00:00.001   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,020 INFO   MySQL|dbserver1|snapshot  Step 8: scanned 26 rows <span class="keyword">in</span> 4 tables <span class="keyword">in</span> 00:00:00.069   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,020 INFO   MySQL|dbserver1|snapshot  Step 9: committing transaction   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,021 INFO   MySQL|dbserver1|snapshot  Completed snapshot <span class="keyword">in</span> 00:00:00.405   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>这些步骤中的每一个都报告连接器正在执行的操作，以执行一致的快照。例如，步骤6涉及对捕获的表的DDL create语句进行反向工程；步骤7在获取全局写锁后仅0.3秒就释放了它，步骤8读取每个表中的所有行，并报告花费的时间和找到的行数。请注意，在我们的示例数据库中，MySQL连接器仅用0.38秒即可完成其一致的快照。</p>
<table>
<thead>
<tr>
<th></th>
<th>对于您的数据库，此过程将花费更长的时间，但是连接器将输出足够的日志消息，以便即使表具有大量行，您也可以跟踪其正在执行的操作。而且，尽管在快照过程开始时使用了排他写锁定，但即使对于大型数据库，此锁定也应该很短。在复制任何数据之前，将释放此锁定。有关更多详细信息，请参见<a href="https://debezium.io/documentation/reference/1.0/connectors/mysql.html" target="_blank" rel="noopener">MySQL连接器文档</a>。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>Kafka Connect的新五行听起来不祥，但基本上告诉我们，已经创建了<em>新的</em> Kafka主题，而Kafka必须为每一个主题指定新的领导者：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:24:02,632 WARN   ||  Error <span class="keyword">while</span> fetching metadata with correlation id 1 : &#123;dbserver1=LEADER_NOT_AVAILABLE&#125;   [org.apache.kafka.clients.NetworkClient]</span><br><span class="line">2017-09-21 07:24:02,775 WARN   ||  Error <span class="keyword">while</span> fetching metadata with correlation id 5 : &#123;dbserver1.inventory.customers=LEADER_NOT_AVAILABLE&#125;   [org.apache.kafka.clients.NetworkClient]</span><br><span class="line">2017-09-21 07:24:02,910 WARN   ||  Error <span class="keyword">while</span> fetching metadata with correlation id 9 : &#123;dbserver1.inventory.orders=LEADER_NOT_AVAILABLE&#125;   [org.apache.kafka.clients.NetworkClient]</span><br><span class="line">2017-09-21 07:24:03,045 WARN   ||  Error <span class="keyword">while</span> fetching metadata with correlation id 13 : &#123;dbserver1.inventory.products=LEADER_NOT_AVAILABLE&#125;   [org.apache.kafka.clients.NetworkClient]</span><br><span class="line">2017-09-21 07:24:03,179 WARN   ||  Error <span class="keyword">while</span> fetching metadata with correlation id 17 : &#123;dbserver1.inventory.products_on_hand=LEADER_NOT_AVAILABLE&#125;   [org.apache.kafka.clients.NetworkClient]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>最后，我们看到一行报告，表明连接器已从其快照模式转换为连续读取MySQL服务器的binlog：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">Sep 21, 2017 7:24:03 AM com.github.shyiko.mysql.binlog.BinaryLogClient connect</span><br><span class="line">INFO: Connected to mysql:3306 at mysql-bin.000003/154 (sid:184054, cid:7)</span><br><span class="line">2017-09-21 07:24:03,373 INFO   MySQL|dbserver1|binlog  Connected to MySQL binlog at mysql:3306, starting at binlog file <span class="string">'mysql-bin.000003'</span>, pos=154, skipping 0 events plus 0 rows   [io.debezium.connector.mysql.BinlogReader]</span><br><span class="line">2017-09-21 07:25:01,096 INFO   ||  Finished WorkerSourceTask&#123;id=inventory-connector-0&#125; commitOffsets successfully <span class="keyword">in</span> 18 ms   [org.apache.kafka.connect.runtime.WorkerSourceTask]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="查看变更事件"><a href="#查看变更事件" class="headerlink" title="查看变更事件"></a>查看变更事件</h3><p>我们在连接器的输出中看到，事件被写入五个主题：</p>
<ul>
<li><code>dbserver1</code></li>
<li><code>dbserver1.inventory.products</code></li>
<li><code>dbserver1.inventory.products_on_hand</code></li>
<li><code>dbserver1.inventory.customers</code></li>
<li><code>dbserver1.inventory.orders</code></li>
</ul>
<p>如<a href="https://debezium.io/documentation/reference/1.0/connectors/mysql.html#topic-names" target="_blank" rel="noopener">MySQL连接器文档中所述</a>，每个主题名称均以开头<code>dbserver1</code>，这是我们为连接器赋予的逻辑名称。第一个是我们所有DDL语句都写入到的<a href="https://debezium.io/documentation/reference/1.0/connectors/mysql.html#schema-change-topic" target="_blank" rel="noopener">架构更改主题</a>。其余四个主题用于捕获四个表中每个表的更改事件，它们的主题名称包括数据库名称（例如<code>inventory</code>）和表名称。</p>
<p>让我们看一下该<code>dbserver1.inventory.customers</code>主题中的所有数据更改事件。我们将使用<code>debezium/kafka</code>Docker映像来启动一个新容器，该容器运行Kafka的一个实用程序来从主题开始观看该主题：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --name watcher --rm --link zookeeper:zookeeper --link kafka:kafka debezium/kafka:1.0 watch-topic -a -k dbserver1.inventory.customers</span><br></pre></td></tr></table></figure>
<p>再次使用<code>--rm</code>标记，因为我们希望容器在停止时被删除，并且使用<code>-a</code>标记on <code>watch-topic</code>表示我们希望查看自主题开始以来的<em>所有</em>事件。（如果要删除该<code>-a</code>标志，则在开始观看<em>之后</em>，我们只会看到记录在主题中的事件。）该<code>-k</code>标志指定输出应包含事件的键，在我们的例子中，该键包含该行的主键。这是输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Using ZOOKEEPER_CONNECT=172.17.0.3:2181</span><br><span class="line">Using KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://172.17.0.8:9092</span><br><span class="line">Contents of topic dbserver1.inventory.customers:</span><br><span class="line">Using the ConsoleConsumer with old consumer is deprecated and will be removed <span class="keyword">in</span> a future major release. Consider using the new consumer by passing [bootstrap-server] instead of [zookeeper].</span><br><span class="line">&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Key"</span>&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"id"</span>:1001&#125;&#125;	&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"before"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"after"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"version"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"server_id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"ts_sec"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"gtid"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"file"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"pos"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"row"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"boolean"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"snapshot"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"thread"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"db"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"table"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"io.debezium.connector.mysql.Source"</span>,<span class="string">"field"</span>:<span class="string">"source"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"op"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"ts_ms"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Envelope"</span>,<span class="string">"version"</span>:1&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"before"</span>:null,<span class="string">"after"</span>:&#123;<span class="string">"id"</span>:1001,<span class="string">"first_name"</span>:<span class="string">"Sally"</span>,<span class="string">"last_name"</span>:<span class="string">"Thomas"</span>,<span class="string">"email"</span>:<span class="string">"sally.thomas@acme.com"</span>&#125;,<span class="string">"source"</span>:&#123;<span class="string">"version"</span>:<span class="string">"1.0.2.Final"</span>,<span class="string">"name"</span>:<span class="string">"dbserver1"</span>,<span class="string">"server_id"</span>:0,<span class="string">"ts_sec"</span>:0,<span class="string">"gtid"</span>:null,<span class="string">"file"</span>:<span class="string">"mysql-bin.000003"</span>,<span class="string">"pos"</span>:154,<span class="string">"row"</span>:0,<span class="string">"snapshot"</span>:<span class="literal">true</span>,<span class="string">"thread"</span>:null,<span class="string">"db"</span>:<span class="string">"inventory"</span>,<span class="string">"table"</span>:<span class="string">"customers"</span>&#125;,<span class="string">"op"</span>:<span class="string">"c"</span>,<span class="string">"ts_ms"</span>:1490634537160&#125;&#125;</span><br><span class="line">&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Key"</span>&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"id"</span>:1002&#125;&#125;	&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"before"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"after"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"version"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"server_id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"ts_sec"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"gtid"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"file"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"pos"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"row"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"boolean"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"snapshot"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"thread"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"db"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"table"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"io.debezium.connector.mysql.Source"</span>,<span class="string">"field"</span>:<span class="string">"source"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"op"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"ts_ms"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Envelope"</span>,<span class="string">"version"</span>:1&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"before"</span>:null,<span class="string">"after"</span>:&#123;<span class="string">"id"</span>:1002,<span class="string">"first_name"</span>:<span class="string">"George"</span>,<span class="string">"last_name"</span>:<span class="string">"Bailey"</span>,<span class="string">"email"</span>:<span class="string">"gbailey@foobar.com"</span>&#125;,<span class="string">"source"</span>:&#123;<span class="string">"version"</span>:<span class="string">"1.0.2.Final"</span>,<span class="string">"name"</span>:<span class="string">"dbserver1"</span>,<span class="string">"server_id"</span>:0,<span class="string">"ts_sec"</span>:0,<span class="string">"gtid"</span>:null,<span class="string">"file"</span>:<span class="string">"mysql-bin.000003"</span>,<span class="string">"pos"</span>:154,<span class="string">"row"</span>:0,<span class="string">"snapshot"</span>:<span class="literal">true</span>,<span class="string">"thread"</span>:null,<span class="string">"db"</span>:<span class="string">"inventory"</span>,<span class="string">"table"</span>:<span class="string">"customers"</span>&#125;,<span class="string">"op"</span>:<span class="string">"c"</span>,<span class="string">"ts_ms"</span>:1490634537160&#125;&#125;</span><br><span class="line">&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Key"</span>&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"id"</span>:1003&#125;&#125;	&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"before"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"after"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"version"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"server_id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"ts_sec"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"gtid"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"file"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"pos"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"row"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"boolean"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"snapshot"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"thread"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"db"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"table"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"io.debezium.connector.mysql.Source"</span>,<span class="string">"field"</span>:<span class="string">"source"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"op"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"ts_ms"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Envelope"</span>,<span class="string">"version"</span>:1&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"before"</span>:null,<span class="string">"after"</span>:&#123;<span class="string">"id"</span>:1003,<span class="string">"first_name"</span>:<span class="string">"Edward"</span>,<span class="string">"last_name"</span>:<span class="string">"Walker"</span>,<span class="string">"email"</span>:<span class="string">"ed@walker.com"</span>&#125;,<span class="string">"source"</span>:&#123;<span class="string">"version"</span>:<span class="string">"1.0.2.Final"</span>,<span class="string">"name"</span>:<span class="string">"dbserver1"</span>,<span class="string">"server_id"</span>:0,<span class="string">"ts_sec"</span>:0,<span class="string">"gtid"</span>:null,<span class="string">"file"</span>:<span class="string">"mysql-bin.000003"</span>,<span class="string">"pos"</span>:154,<span class="string">"row"</span>:0,<span class="string">"snapshot"</span>:<span class="literal">true</span>,<span class="string">"thread"</span>:null,<span class="string">"db"</span>:<span class="string">"inventory"</span>,<span class="string">"table"</span>:<span class="string">"customers"</span>&#125;,<span class="string">"op"</span>:<span class="string">"c"</span>,<span class="string">"ts_ms"</span>:1490634537160&#125;&#125;</span><br><span class="line">&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Key"</span>&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"id"</span>:1004&#125;&#125;	&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"before"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"after"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"version"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"server_id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"ts_sec"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"gtid"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"file"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"pos"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"row"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"boolean"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"snapshot"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"thread"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"db"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"table"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"io.debezium.connector.mysql.Source"</span>,<span class="string">"field"</span>:<span class="string">"source"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"op"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"ts_ms"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Envelope"</span>,<span class="string">"version"</span>:1&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"before"</span>:null,<span class="string">"after"</span>:&#123;<span class="string">"id"</span>:1004,<span class="string">"first_name"</span>:<span class="string">"Anne"</span>,<span class="string">"last_name"</span>:<span class="string">"Kretchmar"</span>,<span class="string">"email"</span>:<span class="string">"annek@noanswer.org"</span>&#125;,<span class="string">"source"</span>:&#123;<span class="string">"version"</span>:<span class="string">"1.0.2.Final"</span>,<span class="string">"name"</span>:<span class="string">"dbserver1"</span>,<span class="string">"server_id"</span>:0,<span class="string">"ts_sec"</span>:0,<span class="string">"gtid"</span>:null,<span class="string">"file"</span>:<span class="string">"mysql-bin.000003"</span>,<span class="string">"pos"</span>:154,<span class="string">"row"</span>:0,<span class="string">"snapshot"</span>:<span class="literal">true</span>,<span class="string">"thread"</span>:null,<span class="string">"db"</span>:<span class="string">"inventory"</span>,<span class="string">"table"</span>:<span class="string">"customers"</span>&#125;,<span class="string">"op"</span>:<span class="string">"c"</span>,<span class="string">"ts_ms"</span>:1490634537160&#125;&#125;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th></th>
<th>该实用程序一直在监视，因此只要该实用程序继续运行，任何新事件都会自动出现。而且该<code>watch-topic</code>实用程序非常简单，并且功能和实用性受到限制-我们在这里使用它只是为了了解我们的连接器生成的事件的种类。想要使用事件的应用程序将改为使用Kafka使用者，而这些使用者库提供了更大的灵活性和功能。实际上，正确配置的客户端使我们的应用程序永远不会错过任何事件，即使那些应用程序崩溃或正常关闭也是如此。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>这些事件碰巧是用JSON编码的，因为这就是我们配置Kafka Connect服务的方式。每个事件都包含一个JSON文档作为密钥，并包含一个JSON文档。让我们通过首先重新格式化事件的<em>键</em>使其更易于阅读来更详细地查看最后一个事件：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schema"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Key"</span></span><br><span class="line">    <span class="string">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"fields"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"id"</span>,</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"payload"</span>: &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">1004</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>事件的键分为两部分：a <code>schema</code>和<code>payload</code>。该<code>schema</code>包含卡夫卡连接架构描述什么是有效载荷，并在我们的情况下这意味着<code>payload</code>是一个命名结构<code>dbserver1.inventory.customers.Key</code>是不可选的，有一个名为必填字段<code>id</code>类型<code>int32</code>。</p>
<p>如果我们查看键<code>payload</code>字段的值，就会发现它确实是一个结构（在JSON中只是一个对象），只有一个<code>id</code>字段，其值为<code>1004</code>。</p>
<p>因此，我们将此事件解释为适用于主键列的值为的<code>inventory.customers</code>表中的行（来自名为的连接器的输出<code>dbserver1</code>）。<code>id`</code>1004`</p>
<p>现在让我们看一下同一事件的<em>value</em>，我们再次将其重新格式化以使其更易于阅读：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schema"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">    <span class="attr">"fields"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">        <span class="attr">"fields"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"id"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"first_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"last_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"email"</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Value"</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"before"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">        <span class="attr">"fields"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"id"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"first_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"last_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"email"</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Value"</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"after"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">        <span class="attr">"fields"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"version"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"server_id"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"ts_sec"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"gtid"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"file"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"pos"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"row"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"boolean"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"snapshot"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"thread"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"db"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"table"</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"io.debezium.connector.mysql.Source"</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"source"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"op"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"ts_ms"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Envelope"</span>,</span><br><span class="line">    <span class="attr">"version"</span>: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"payload"</span>: &#123;</span><br><span class="line">    <span class="attr">"before"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"after"</span>: &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="number">1004</span>,</span><br><span class="line">      <span class="attr">"first_name"</span>: <span class="string">"Anne"</span>,</span><br><span class="line">      <span class="attr">"last_name"</span>: <span class="string">"Kretchmar"</span>,</span><br><span class="line">      <span class="attr">"email"</span>: <span class="string">"annek@noanswer.org"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"source"</span>: &#123;</span><br><span class="line">      <span class="attr">"version"</span>: <span class="string">"1.0.2.Final"</span>,</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"dbserver1"</span>,</span><br><span class="line">      <span class="attr">"server_id"</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">"ts_sec"</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">"gtid"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"file"</span>: <span class="string">"mysql-bin.000003"</span>,</span><br><span class="line">      <span class="attr">"pos"</span>: <span class="number">154</span>,</span><br><span class="line">      <span class="attr">"row"</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">"snapshot"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">"thread"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"db"</span>: <span class="string">"inventory"</span>,</span><br><span class="line">      <span class="attr">"table"</span>: <span class="string">"customers"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"op"</span>: <span class="string">"c"</span>,</span><br><span class="line">    <span class="attr">"ts_ms"</span>: <span class="number">1486500577691</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>事件的这一部分要大得多，但是像事件的<em>键一样</em>，它也有a <code>schema</code>和a <code>payload</code>。<code>schema</code>包含一个名为<code>dbserver1.inventory.customers.Envelope</code>（版本1）的Kafka Connect模式，该模式可以包含5个字段：</p>
<ul>
<li><code>op</code>是必填字段，其中包含描述操作类型的字符串值。MySQL连接器的值用于<code>c</code>创建（或插入），<code>u</code>用于更新，<code>d</code>用于删除和<code>r</code>用于读取（在非初始快照的情况下）。</li>
<li><code>before</code>是一个可选字段，如果存在，则包含事件发生<em>之前</em>行的状态。该结构将由<code>dbserver1.inventory.customers.Value</code>Kafka Connect模式描述，连接<code>dbserver1</code>器将其用于<code>inventory.customers</code>表中的所有行。</li>
<li><code>after</code>是一个可选字段，如果存在，则包含事件发生<em>后行</em>的状态。该结构由中使用的相同的<code>dbserver1.inventory.customers.Value</code>Kafka Connect模式描述<code>before</code>。</li>
<li><code>source</code> 是必填字段，包含描述事件源元数据的结构，在MySQL中，该字段包含多个字段：连接器名称，记录事件的binlog文件的名称，binlog文件在其中的位置。事件出现，事件中的行（如果有多个），受影响的数据库和表的名称，进行更改的MySQL线程ID，此事件是否是快照的一部分以及MySQL服务器（如果有） ID，以及以秒为单位的时间戳。</li>
<li><code>ts_ms</code> 是可选的，如果存在，则包含连接器处理事件的时间（使用运行Kafka Connect任务的JVM中的系统时钟）。</li>
</ul>
<p>如果我们看一下<code>payload</code>事件的的<em>价值</em>，我们可以看到在事件的信息，即它是在描述该行的创建，包含<code>id</code>，<code>first_name</code>，<code>last_name</code>和<code>email</code>插入行。</p>
<table>
<thead>
<tr>
<th></th>
<th>您可能已经注意到，事件的JSON表示比它们描述的行大得多。这是因为Kafka Connect附带了每个事件密钥，并重视描述<em>有效负载</em>的<em>架构</em>。随着时间的流逝，这种结构可能会发生变化，并且事件本身具有键和值的架构会使得使用应用程序的用户更容易理解消息，尤其是随着时间的发展。Debezium MySQL连接器根据数据库表的结构来构造这些模式。如果使用DDL语句更改MySQL数据库中的表定义，则连接器将读取这些DDL语句并更新其Kafka Connect模式。这是每个事件的结构完全类似于事件发生时的来源表的唯一方式。但是包含单个表的所有事件的Kafka主题可能具有与表定义的每种状态相对应的事件。JSON转换器确实会产生非常冗长的事件，因为它在每条消息中都包含键和值模式。该<a href="http://docs.confluent.io/3.1.2/schema-registry/docs/index.html" target="_blank" rel="noopener">Avro的转换器</a>，在另一方面，是远远聪明，结果小得多事件消息。Avro转换器将每个Kafka Connect架构转换为Avro架构，并将Avro架构存储在单独的架构注册表服务中。因此，当Avro转换器对事件消息进行序列化时，它将仅放置该模式的唯一标识符以及该值的Avro编码的二进制表示形式。因此，通过网络传输并存储在Kafka中的序列化消息比上面显示的要小得多。实际上，Avro Converter能够使用Avro模式演变技术来维护模式注册表中每个模式的历史记录。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>我们可以将它们与数据库状态进行比较。返回到运行MySQL命令行客户端的终端，并运行以下语句：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM customers;</span><br></pre></td></tr></table></figure>
<p>产生以下输出：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+<span class="comment">------+------------+-----------+-----------------------+</span></span><br><span class="line">| id   | first_name | last_name | email                 |</span><br><span class="line">+<span class="comment">------+------------+-----------+-----------------------+</span></span><br><span class="line">| 1001 | Sally      | Thomas    | sally.thomas@acme.com |</span><br><span class="line">| 1002 | George     | Bailey    | gbailey@foobar.com    |</span><br><span class="line">| 1003 | Edward     | Walker    | ed@walker.com         |</span><br><span class="line">| 1004 | Anne       | Kretchmar | annek@noanswer.org    |</span><br><span class="line">+<span class="comment">------+------------+-----------+-----------------------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>如我们所见，所有事件记录都与数据库匹配。</p>
<p>现在我们正在监视更改，<strong>更改</strong>数据库中的记录之一会发生什么？在MySQL命令行客户端中运行以下语句：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; UPDATE customers SET first_name='Anne Marie' WHERE id=1004;</span><br></pre></td></tr></table></figure>
<p>产生以下输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Query OK, 1 row affected (0.05 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br></pre></td></tr></table></figure>
<p>重新运行该<code>select …</code>语句以查看更新的表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from customers;</span><br><span class="line">+<span class="comment">------+------------+-----------+-----------------------+</span></span><br><span class="line">| id   | first_name | last_name | email                 |</span><br><span class="line">+<span class="comment">------+------------+-----------+-----------------------+</span></span><br><span class="line">| 1001 | Sally      | Thomas    | sally.thomas@acme.com |</span><br><span class="line">| 1002 | George     | Bailey    | gbailey@foobar.com    |</span><br><span class="line">| 1003 | Edward     | Walker    | ed@walker.com         |</span><br><span class="line">| 1004 | Anne Marie | Kretchmar | annek@noanswer.org    |</span><br><span class="line">+<span class="comment">------+------------+-----------+-----------------------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>现在，回到终端运行<code>watch-topic</code>，我们应该看到一个<em>新的</em>第五事件：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"schema"</span>:&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Key"</span>&#125;,<span class="attr">"payload"</span>:&#123;<span class="attr">"id"</span>:<span class="number">1004</span>&#125;&#125;	&#123;<span class="attr">"schema"</span>:&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"email"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="attr">"field"</span>:<span class="string">"before"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"email"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="attr">"field"</span>:<span class="string">"after"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"version"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"server_id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"ts_sec"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"gtid"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"file"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"pos"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"row"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"boolean"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"snapshot"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"thread"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"db"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"table"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"io.debezium.connector.mysql.Source"</span>,<span class="attr">"field"</span>:<span class="string">"source"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"op"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"ts_ms"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Envelope"</span>,<span class="attr">"version"</span>:<span class="number">1</span>&#125;,<span class="attr">"payload"</span>:&#123;<span class="attr">"before"</span>:&#123;<span class="attr">"id"</span>:<span class="number">1004</span>,<span class="attr">"first_name"</span>:<span class="string">"Anne"</span>,<span class="attr">"last_name"</span>:<span class="string">"Kretchmar"</span>,<span class="attr">"email"</span>:<span class="string">"annek@noanswer.org"</span>&#125;,<span class="attr">"after"</span>:&#123;<span class="attr">"id"</span>:<span class="number">1004</span>,<span class="attr">"first_name"</span>:<span class="string">"Anne Marie"</span>,<span class="attr">"last_name"</span>:<span class="string">"Kretchmar"</span>,<span class="attr">"email"</span>:<span class="string">"annek@noanswer.org"</span>&#125;,<span class="attr">"source"</span>:&#123;<span class="attr">"version"</span>:<span class="string">"1.0.2.Final"</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1"</span>,<span class="attr">"server_id"</span>:<span class="number">223344</span>,<span class="attr">"ts_sec"</span>:<span class="number">1490635059</span>,<span class="attr">"gtid"</span>:<span class="literal">null</span>,<span class="attr">"file"</span>:<span class="string">"mysql-bin.000003"</span>,<span class="attr">"pos"</span>:<span class="number">364</span>,<span class="attr">"row"</span>:<span class="number">0</span>,<span class="attr">"snapshot"</span>:<span class="literal">null</span>,<span class="attr">"thread"</span>:<span class="number">3</span>,<span class="attr">"db"</span>:<span class="string">"inventory"</span>,<span class="attr">"table"</span>:<span class="string">"customers"</span>&#125;,<span class="attr">"op"</span>:<span class="string">"u"</span>,<span class="attr">"ts_ms"</span>:<span class="number">1490635059389</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>让我们重新格式化新事件的<em>键</em>，以便于阅读：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schema"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Key"</span></span><br><span class="line">    <span class="string">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"fields"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"id"</span>,</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"payload"</span>: &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">1004</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该密钥与我们在第四条记录中看到的密钥完全相同。这是新事件的<em>值，其</em>格式设置为更易于阅读：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schema"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">    <span class="attr">"fields"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">        <span class="attr">"fields"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"id"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"first_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"last_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"email"</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Value"</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"before"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">        <span class="attr">"fields"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"id"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"first_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"last_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"email"</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Value"</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"after"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">        <span class="attr">"fields"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"version"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"server_id"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"ts_sec"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"gtid"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"file"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"pos"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"row"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"boolean"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"snapshot"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"thread"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"db"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"table"</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"io.debezium.connector.mysql.Source"</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"source"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"op"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"ts_ms"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Envelope"</span>,</span><br><span class="line">    <span class="attr">"version"</span>: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"payload"</span>: &#123;</span><br><span class="line">    <span class="attr">"before"</span>: &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="number">1004</span>,</span><br><span class="line">      <span class="attr">"first_name"</span>: <span class="string">"Anne"</span>,</span><br><span class="line">      <span class="attr">"last_name"</span>: <span class="string">"Kretchmar"</span>,</span><br><span class="line">      <span class="attr">"email"</span>: <span class="string">"annek@noanswer.org"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"after"</span>: &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="number">1004</span>,</span><br><span class="line">      <span class="attr">"first_name"</span>: <span class="string">"Anne Marie"</span>,</span><br><span class="line">      <span class="attr">"last_name"</span>: <span class="string">"Kretchmar"</span>,</span><br><span class="line">      <span class="attr">"email"</span>: <span class="string">"annek@noanswer.org"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"source"</span>: &#123;</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"1.0.2.Final"</span>,</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"dbserver1"</span>,</span><br><span class="line">      <span class="attr">"server_id"</span>: <span class="number">223344</span>,</span><br><span class="line">      <span class="attr">"ts_sec"</span>: <span class="number">1486501486</span>,</span><br><span class="line">      <span class="attr">"gtid"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"file"</span>: <span class="string">"mysql-bin.000003"</span>,</span><br><span class="line">      <span class="attr">"pos"</span>: <span class="number">364</span>,</span><br><span class="line">      <span class="attr">"row"</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">"snapshot"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"thread"</span>: <span class="number">3</span>,</span><br><span class="line">      <span class="attr">"db"</span>: <span class="string">"inventory"</span>,</span><br><span class="line">      <span class="attr">"table"</span>: <span class="string">"customers"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"op"</span>: <span class="string">"u"</span>,</span><br><span class="line">    <span class="attr">"ts_ms"</span>: <span class="number">1486501486308</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们将其与第四个事件中的值进行比较时，在该<code>schema</code>部分中没有看到任何更改，而在该部分中看到了一些更改<code>payload</code>：</p>
<ul>
<li>该<code>op</code>字段的值是现在<code>u</code>，表示此行被更改，因为更新</li>
<li><code>before</code>现在，该字段具有行状态以及数据库提交前的值</li>
<li><code>after</code>现在，该字段具有该行的更新状态，在这里可以看到该<code>first_name</code>值是now <code>Anne Marie</code>。</li>
<li>该<code>source</code>场结构具有许多相同的价值观和以前一样，除了<code>ts_sec</code>和<code>pos</code>领域发生了变化（而<code>file</code>可能在其他情况下发生了变化）。</li>
<li>该<code>ts_ms</code>节目的时间戳Debezium处理此事件。</li>
</ul>
<p>仅看本<code>payload</code>节，我们可以学到几件事。我们可以比较<code>before</code>和<code>after</code>结构，以确定由于提交而实际更改的内容。该<code>source</code>结构告诉我们有关MySQL更改记录的信息（提供可追溯性），但更重要的是，它具有可以与本主题和其他主题中的其他事件进行比较的信息，以了解此事件是在同一MySQL之前，之后还是作为其一部分发生的像其他事件一样提交。</p>
<p>到目前为止，我们已经看到了<em>创建</em>和<em>更新</em>事件的示例。现在，让我们看一下<em>删除</em>事件。由于Anne Marie尚未下任何订单，因此我们可以使用MySQL命令行客户端从数据库中删除她的记录：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; DELETE FROM customers WHERE id=1004;</span><br></pre></td></tr></table></figure>
<p>|      | 如果以上命令因违反外键约束而失败，则必须使用以下语句从<em>地址</em>表中删除客户地址的引用：<figure class="highlight plain"><figcaption><span>DELETE FROM addresses WHERE customer_id</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">| ---- | ------------------------------------------------------------ |</span><br><span class="line">|      |                                                              |</span><br><span class="line"></span><br><span class="line">在运行的终端中`watch-topic`，我们看到*两个*新事件：</span><br><span class="line"></span><br><span class="line">```json</span><br><span class="line">&#123;&quot;schema&quot;:&#123;&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[&#123;&quot;type&quot;:&quot;int32&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;id&quot;&#125;],&quot;optional&quot;:false,&quot;name&quot;:&quot;dbserver1.inventory.customers.Key&quot;&#125;,&quot;payload&quot;:&#123;&quot;id&quot;:1004&#125;&#125;	&#123;&quot;schema&quot;:&#123;&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[&#123;&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[&#123;&quot;type&quot;:&quot;int32&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;id&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;first_name&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;last_name&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;email&quot;&#125;],&quot;optional&quot;:true,&quot;name&quot;:&quot;dbserver1.inventory.customers.Value&quot;,&quot;field&quot;:&quot;before&quot;&#125;,&#123;&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[&#123;&quot;type&quot;:&quot;int32&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;id&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;first_name&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;last_name&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;email&quot;&#125;],&quot;optional&quot;:true,&quot;name&quot;:&quot;dbserver1.inventory.customers.Value&quot;,&quot;field&quot;:&quot;after&quot;&#125;,&#123;&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;version&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;name&quot;&#125;,&#123;&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;server_id&quot;&#125;,&#123;&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;ts_sec&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;gtid&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;file&quot;&#125;,&#123;&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;pos&quot;&#125;,&#123;&quot;type&quot;:&quot;int32&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;row&quot;&#125;,&#123;&quot;type&quot;:&quot;boolean&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;snapshot&quot;&#125;,&#123;&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;thread&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;db&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;table&quot;&#125;],&quot;optional&quot;:false,&quot;name&quot;:&quot;io.debezium.connector.mysql.Source&quot;,&quot;field&quot;:&quot;source&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;op&quot;&#125;,&#123;&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;ts_ms&quot;&#125;],&quot;optional&quot;:false,&quot;name&quot;:&quot;dbserver1.inventory.customers.Envelope&quot;,&quot;version&quot;:1&#125;,&quot;payload&quot;:&#123;&quot;before&quot;:&#123;&quot;id&quot;:1004,&quot;first_name&quot;:&quot;Anne Marie&quot;,&quot;last_name&quot;:&quot;Kretchmar&quot;,&quot;email&quot;:&quot;annek@noanswer.org&quot;&#125;,&quot;after&quot;:null,&quot;source&quot;:&#123;&quot;version&quot;:&quot;1.0.2.Final&quot;,&quot;name&quot;:&quot;dbserver1&quot;,&quot;server_id&quot;:223344,&quot;ts_sec&quot;:1490635100,&quot;gtid&quot;:null,&quot;file&quot;:&quot;mysql-bin.000003&quot;,&quot;pos&quot;:725,&quot;row&quot;:0,&quot;snapshot&quot;:null,&quot;thread&quot;:3,&quot;db&quot;:&quot;inventory&quot;,&quot;table&quot;:&quot;customers&quot;&#125;,&quot;op&quot;:&quot;d&quot;,&quot;ts_ms&quot;:1490635100301&#125;&#125;</span><br><span class="line">&#123;&quot;schema&quot;:&#123;&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[&#123;&quot;type&quot;:&quot;int32&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;id&quot;&#125;],&quot;optional&quot;:false,&quot;name&quot;:&quot;dbserver1.inventory.customers.Key&quot;&#125;,&quot;payload&quot;:&#123;&quot;id&quot;:1004&#125;&#125;	&#123;&quot;schema&quot;:null,&quot;payload&quot;:null&#125;</span><br></pre></td></tr></table></figure></p>
<p>发生了什么？我们只删除了一行，但是现在有两个事件。要了解MySQL连接器的作用，让我们看一下两个新消息中的第一个。重新格式化后的<em>键</em>更易于阅读：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schema"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Key"</span></span><br><span class="line">    <span class="string">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"fields"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"id"</span>,</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"payload"</span>: &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">1004</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再次，此密钥与我们查看的前两个事件完全相同。这是第一个新事件的<em>值</em>，其格式设置为更易于阅读：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "schema": &#123;...&#125;,</span><br><span class="line">  "payload": &#123;</span><br><span class="line">    "before": &#123;</span><br><span class="line">      "id": 1004,</span><br><span class="line">      "first_name": "Anne Marie",</span><br><span class="line">      "last_name": "Kretchmar",</span><br><span class="line">      "email": "annek@noanswer.org"</span><br><span class="line">    &#125;,</span><br><span class="line">    "after": null,</span><br><span class="line">    "source": &#123;</span><br><span class="line">      "name": "1.0.2.Final",</span><br><span class="line">      "name": "dbserver1",</span><br><span class="line">      "server_id": 223344,</span><br><span class="line">      "ts_sec": 1486501558,</span><br><span class="line">      "gtid": null,</span><br><span class="line">      "file": "mysql-bin.000003",</span><br><span class="line">      "pos": 725,</span><br><span class="line">      "row": 0,</span><br><span class="line">      "snapshot": null,</span><br><span class="line">      "thread": 3,</span><br><span class="line">      "db": "inventory",</span><br><span class="line">      "table": "customers"</span><br><span class="line">    &#125;,</span><br><span class="line">    "op": "d",</span><br><span class="line">    "ts_ms": 1486501558315</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再次，<code>schema</code>与前面的消息相同，但是该<code>payload</code>片段有一些注意事项：</p>
<ul>
<li>该<code>op</code>字段的值是现在<code>d</code>，这标志着该行已被删除</li>
<li><code>before</code>现在，该字段具有通过数据库提交删除的行的状态</li>
<li>该<code>after</code>字段为空，表示该行不再存在</li>
<li>该<code>source</code>场结构具有许多相同的价值观和以前一样，除了<code>ts_sec</code>和<code>pos</code>领域发生了变化（而<code>file</code>可能在其他情况下发生了变化）。</li>
<li>该<code>ts_ms</code>节目的时间戳Debezium处理此事件。</li>
</ul>
<p>此事件为使用者提供了可用于处理删除此行的各种信息。我们之所以包含旧值，是因为某些消费者可能会要求他们以正确处理删除内容，而没有删除它们，他们可能不得不诉诸更为复杂的行为。</p>
<p>还记得删除行时看到的两个事件吗？让我们看看第二个事件。这是活动的<em>关键</em>：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schema"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Key"</span></span><br><span class="line">    <span class="string">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"fields"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"id"</span>,</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"payload"</span>: &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">1004</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再次，此密钥与我们查看的前三个事件完全相同。这是同一事件的<em>值</em>：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schema"</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">"payload"</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>是什么赋予了？好吧，可以将MySQL连接器写入的所有Kafka主题设置为<em>日志压缩</em>，这意味着Kafka可以从该主题中删除较旧的消息，只要该主题后面至少有一条消息完全相同即可。键。这是卡夫卡收集垃圾的方法。这最后一个事件是Debezium所谓的<em>逻辑删除</em>事件，并且由于它具有一个键和一个空值，Kafka理解它可以使用此键删除所有先前的消息。</p>
<p>Kafka日志压缩很棒，因为它仍然允许消费者从一开始就阅读主题，而不会错过任何事件。</p>
<h3 id="重新启动Kafka-Connect服务"><a href="#重新启动Kafka-Connect服务" class="headerlink" title="重新启动Kafka Connect服务"></a>重新启动Kafka Connect服务</h3><p>Kafka Connect服务的一项功能是，它可以自动管理已注册连接器的任务。并且，由于它将数据存储在Kafka中，因此如果正在运行的服务停止或完全消失，则在重新启动（可能在另一台主机上）时，服务器将启动所有非运行任务。为了说明这一点，让我们停止我们的Kafka Connect服务，更改数据库中的某些数据，然后重新启动我们的服务。</p>
<p>在新的终端中，使用以下Docker命令停止<code>connect</code>运行我们的Kafka Connect服务的容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker stop connect</span><br></pre></td></tr></table></figure>
<p>像这样停止容器将停止在其中运行的进程，但是Kafka Connect服务会通过正常关闭来处理该过程。并且由于我们使用<code>--rm</code>标志运行容器，因此Docker在停止容器后将其删除。</p>
<p>服务关闭时，让我们回到MySQL命令行客户端并添加一些记录：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; INSERT INTO customers VALUES (default, "Sarah", "Thompson", "kitt@acme.com");</span><br><span class="line">mysql&gt; INSERT INTO customers VALUES (default, "Kenneth", "Anderson", "kander@acme.com");</span><br></pre></td></tr></table></figure>
<p>注意，在我们运行的终端中<code>watch-topic</code>，没有更新。另外，由于Kafka仍在运行，因此我们仍然可以观看该主题。</p>
<table>
<thead>
<tr>
<th></th>
<th>在生产系统中，您将有足够的代理来处理生产者和使用者，并为每个主题维护最少数量的同步副本。因此，如果有足够的经纪人失败，以致没有最小的ISR，Kafka应该变得不可用。生产商（例如Debezium连接器）和消费者将只耐心地等待Kafka群集或网络恢复。是的，这意味着您的使用者在数据库中更改数据时可能暂时看不到任何更改事件，但这是因为未生成任何更改事件。一旦Kafka群集重新启动或网络恢复，Debezium将继续产生变更事件，而您的使用者将继续使用中断的事件。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>现在，在新终端中，使用之前使用的<em>相同</em>命令启动新容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --name connect -p 8083:8083 -e GROUP_ID=1 -e CONFIG_STORAGE_TOPIC=my_connect_configs -e OFFSET_STORAGE_TOPIC=my_connect_offsets -e STATUS_STORAGE_TOPIC=my_connect_statuses --link zookeeper:zookeeper --link kafka:kafka --link mysql:mysql debezium/connect:1.0</span><br></pre></td></tr></table></figure>
<p>这将创建一个运行Kafka Connect分布式服务的全新容器，并且由于我们已使用相同的主题信息对其进行了初始化，因此该新服务将连接到Kafka，读取先前服务的配置，并启动已注册的连接器，该连接器将继续在他们最后一次离开。</p>
<p>这是此重启服务的最后几行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:38:48,385 INFO   MySQL|dbserver1|task  Kafka version : 0.11.0.0   [org.apache.kafka.common.utils.AppInfoParser]</span><br><span class="line">2017-09-21 07:38:48,386 INFO   MySQL|dbserver1|task  Kafka commitId : cb8625948210849f   [org.apache.kafka.common.utils.AppInfoParser]</span><br><span class="line">2017-09-21 07:38:48,390 INFO   MySQL|dbserver1|task  Discovered coordinator 172.17.0.4:9092 (id: 2147483646 rack: null) <span class="keyword">for</span> group inventory-connector-dbhistory.   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:38:48,390 INFO   MySQL|dbserver1|task  Revoking previously assigned partitions [] <span class="keyword">for</span> group inventory-connector-dbhistory   [org.apache.kafka.clients.consumer.internals.ConsumerCoordinator]</span><br><span class="line">2017-09-21 07:38:48,391 INFO   MySQL|dbserver1|task  (Re-)joining group inventory-connector-dbhistory   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:38:48,402 INFO   MySQL|dbserver1|task  Successfully joined group inventory-connector-dbhistory with generation 1   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:38:48,403 INFO   MySQL|dbserver1|task  Setting newly assigned partitions [dbhistory.inventory-0] <span class="keyword">for</span> group inventory-connector-dbhistory   [org.apache.kafka.clients.consumer.internals.ConsumerCoordinator]</span><br><span class="line">2017-09-21 07:38:48,888 INFO   MySQL|dbserver1|task  Step 0: Get all known binlogs from MySQL   [io.debezium.connector.mysql.MySqlConnectorTask]</span><br><span class="line">2017-09-21 07:38:48,903 INFO   MySQL|dbserver1|task  MySQL has the binlog file <span class="string">'mysql-bin.000003'</span> required by the connector   [io.debezium.connector.mysql.MySqlConnectorTask]</span><br><span class="line">Sep 21, 2017 7:38:49 AM com.github.shyiko.mysql.binlog.BinaryLogClient connect</span><br><span class="line">INFO: Connected to mysql:3306 at mysql-bin.000003/154 (sid:184054, cid:10)</span><br><span class="line">2017-09-21 07:38:49,045 INFO   MySQL|dbserver1|binlog  Connected to MySQL binlog at mysql:3306, starting at binlog file <span class="string">'mysql-bin.000003'</span>, pos=154, skipping 0 events plus 0 rows   [io.debezium.connector.mysql.BinlogReader]</span><br><span class="line">2017-09-21 07:38:49,046 INFO   ||  Source task WorkerSourceTask&#123;id=inventory-connector-0&#125; finished initialization and start   [org.apache.kafka.connect.runtime.WorkerSourceTask]</span><br></pre></td></tr></table></figure>
<p>如您所见，这些行显示该服务在关闭之前找到了上一个任务先前记录的偏移量，然后它连接到MySQL数据库，开始从该位置读取binlog，并根据任何更改生成事件从那时起在MySQL数据库中运行。</p>
<p>跳回到运行中的终端<code>watch-topic</code>，您现在应该看到两个新记录的事件：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"schema"</span>:&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Key"</span>&#125;,<span class="attr">"payload"</span>:&#123;<span class="attr">"id"</span>:<span class="number">1005</span>&#125;&#125;	&#123;<span class="attr">"schema"</span>:&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"email"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="attr">"field"</span>:<span class="string">"before"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"email"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="attr">"field"</span>:<span class="string">"after"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"version"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"server_id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"ts_sec"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"gtid"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"file"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"pos"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"row"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"boolean"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"snapshot"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"thread"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"db"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"table"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"io.debezium.connector.mysql.Source"</span>,<span class="attr">"field"</span>:<span class="string">"source"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"op"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"ts_ms"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Envelope"</span>,<span class="attr">"version"</span>:<span class="number">1</span>&#125;,<span class="attr">"payload"</span>:&#123;<span class="attr">"before"</span>:<span class="literal">null</span>,<span class="attr">"after"</span>:&#123;<span class="attr">"id"</span>:<span class="number">1005</span>,<span class="attr">"first_name"</span>:<span class="string">"Sarah"</span>,<span class="attr">"last_name"</span>:<span class="string">"Thompson"</span>,<span class="attr">"email"</span>:<span class="string">"kitt@acme.com"</span>&#125;,<span class="attr">"source"</span>:&#123;<span class="attr">"version"</span>:<span class="string">"1.0.2.Final"</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1"</span>,<span class="attr">"server_id"</span>:<span class="number">223344</span>,<span class="attr">"ts_sec"</span>:<span class="number">1490635153</span>,<span class="attr">"gtid"</span>:<span class="literal">null</span>,<span class="attr">"file"</span>:<span class="string">"mysql-bin.000003"</span>,<span class="attr">"pos"</span>:<span class="number">1046</span>,<span class="attr">"row"</span>:<span class="number">0</span>,<span class="attr">"snapshot"</span>:<span class="literal">null</span>,<span class="attr">"thread"</span>:<span class="number">3</span>,<span class="attr">"db"</span>:<span class="string">"inventory"</span>,<span class="attr">"table"</span>:<span class="string">"customers"</span>&#125;,<span class="attr">"op"</span>:<span class="string">"c"</span>,<span class="attr">"ts_ms"</span>:<span class="number">1490635181455</span>&#125;&#125;</span><br><span class="line">&#123;<span class="attr">"schema"</span>:&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Key"</span>&#125;,<span class="attr">"payload"</span>:&#123;<span class="attr">"id"</span>:<span class="number">1006</span>&#125;&#125;	&#123;<span class="attr">"schema"</span>:&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"email"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="attr">"field"</span>:<span class="string">"before"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"email"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="attr">"field"</span>:<span class="string">"after"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"version"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"server_id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"ts_sec"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"gtid"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"file"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"pos"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"row"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"boolean"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"snapshot"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"thread"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"db"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"table"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"io.debezium.connector.mysql.Source"</span>,<span class="attr">"field"</span>:<span class="string">"source"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"op"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"ts_ms"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Envelope"</span>,<span class="attr">"version"</span>:<span class="number">1</span>&#125;,<span class="attr">"payload"</span>:&#123;<span class="attr">"before"</span>:<span class="literal">null</span>,<span class="attr">"after"</span>:&#123;<span class="attr">"id"</span>:<span class="number">1006</span>,<span class="attr">"first_name"</span>:<span class="string">"Kenneth"</span>,<span class="attr">"last_name"</span>:<span class="string">"Anderson"</span>,<span class="attr">"email"</span>:<span class="string">"kander@acme.com"</span>&#125;,<span class="attr">"source"</span>:&#123;<span class="attr">"version"</span>:<span class="string">"1.0.2.Final"</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1"</span>,<span class="attr">"server_id"</span>:<span class="number">223344</span>,<span class="attr">"ts_sec"</span>:<span class="number">1490635160</span>,<span class="attr">"gtid"</span>:<span class="literal">null</span>,<span class="attr">"file"</span>:<span class="string">"mysql-bin.000003"</span>,<span class="attr">"pos"</span>:<span class="number">1356</span>,<span class="attr">"row"</span>:<span class="number">0</span>,<span class="attr">"snapshot"</span>:<span class="literal">null</span>,<span class="attr">"thread"</span>:<span class="number">3</span>,<span class="attr">"db"</span>:<span class="string">"inventory"</span>,<span class="attr">"table"</span>:<span class="string">"customers"</span>&#125;,<span class="attr">"op"</span>:<span class="string">"c"</span>,<span class="attr">"ts_ms"</span>:<span class="number">1490635181456</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>这些事件是与我们之前看到的事件类似的<em>创建</em>事件。但是，需要理解的重要一点是，只要在MySQL数据库开始清除我们从其binlog中错过的提交之前重新启动，即使Debezium仍在运行时，它仍将报告数据库中的所有更改。</p>
<h3 id="探索"><a href="#探索" class="headerlink" title="探索"></a>探索</h3><p>继续并使用MySQL命令行客户端在数据库表中添加，修改和删除行，然后查看对主题的影响。您可能需要<code>watch-topic</code>为每个主题运行单独的命令。请记住，您不能删除外键引用的行。玩得开心！</p>
<h3 id="清理"><a href="#清理" class="headerlink" title="清理"></a>清理</h3><p>您可以使用Docker停止所有正在运行的容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker stop mysqlterm watcher connect mysql kafka zookeeper</span><br></pre></td></tr></table></figure>
<p>同样，由于我们<code>--rm</code>在启动连接器时使用了该标志，因此Docker应该在停止连接器后立即将其删除。我们可以验证所有其他进程都已停止并删除：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps -a</span><br></pre></td></tr></table></figure>
<p>当然，如果仍在运行，只需使用<code>docker stop &lt;name&gt;</code>或停止它们<code>docker stop &lt;containerId&gt;</code>。</p>
<h2 id="Docker-Compose设置"><a href="#Docker-Compose设置" class="headerlink" title="Docker Compose设置"></a>Docker Compose设置</h2><p>如果您已经完成了本教程，并且想快速进行设置，那么可以使用<a href="https://github.com/debezium/debezium-examples/tree/master/tutorial" target="_blank" rel="noopener">示例存储库中</a>的本教程的<a href="https://docs.docker.com/compose/" target="_blank" rel="noopener">Docker Compose</a>版本。我们提供Docker Compose文件，用于与MySQL，Postgres，MongoDB，SQL Server和Oracle一起运行本教程。请按照<a href="https://github.com/debezium/debezium-examples/blob/master/tutorial/README.md" target="_blank" rel="noopener">自述文件中</a>描述的步骤进行<a href="https://github.com/debezium/debezium-examples/blob/master/tutorial/README.md" target="_blank" rel="noopener">操作</a>。</p>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2020/02/23/spark读取和处理Excel数据/" itemprop="url">spark读取和处理Excel数据</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2020-02-23T14:34:45.000Z" itemprop="datePublished">10 个月前</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Technology/">Technology</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            3 分钟 读完 (约 482 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>spark-excel是一个使用spark读取Excel2007格式的插件，注意只支持.xlsx格式（.xls不行）。</p>
<p>下面使用pyspark在命令行窗口中进行使用：</p>
<p>This package can be added to Spark using the <code>--packages</code> command line option. For example, to include it when starting the spark shell:</p>
<h3 id="Spark-compiled-with-Scala-2-12"><a href="#Spark-compiled-with-Scala-2-12" class="headerlink" title="Spark compiled with Scala 2.12"></a>Spark compiled with Scala 2.12</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">SPARK_HOME/bin/spark-shell --packages com.crealytics:spark-excel_2.12:0.12.5</span></span><br></pre></td></tr></table></figure>
<h3 id="Spark-compiled-with-Scala-2-11"><a href="#Spark-compiled-with-Scala-2-11" class="headerlink" title="Spark compiled with Scala 2.11"></a>Spark compiled with Scala 2.11</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">SPARK_HOME/bin/spark-shell --packages com.crealytics:spark-excel_2.11:0.12.5</span></span><br></pre></td></tr></table></figure>
<p>###读取Excel文件创建一个DataFrame</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">df = spark.read</span><br><span class="line">    .format(<span class="string">"com.crealytics.spark.excel"</span>)</span><br><span class="line">    .option(<span class="string">"dataAddress"</span>, <span class="string">"'My Sheet'!B3:C35"</span>) // Optional, default: <span class="string">"A1"</span></span><br><span class="line">    .option(<span class="string">"useHeader"</span>, <span class="string">"true"</span>) // Required</span><br><span class="line">    .option(<span class="string">"treatEmptyValuesAsNulls"</span>, <span class="string">"false"</span>) // Optional, default: true</span><br><span class="line">    .option(<span class="string">"inferSchema"</span>, <span class="string">"false"</span>) // Optional, default: false</span><br><span class="line">    .option(<span class="string">"addColorColumns"</span>, <span class="string">"true"</span>) // Optional, default: false</span><br><span class="line">    .option(<span class="string">"timestampFormat"</span>, <span class="string">"MM-dd-yyyy HH:mm:ss"</span>) // Optional, default: yyyy-mm-dd hh:mm:ss[.fffffffff]</span><br><span class="line">    .option(<span class="string">"maxRowsInMemory"</span>, <span class="number">20</span>) // Optional, default <span class="literal">None</span>. If set, uses a streaming reader which can help <span class="keyword">with</span> big files</span><br><span class="line">    .option(<span class="string">"excerptSize"</span>, <span class="number">10</span>) // Optional, default: <span class="number">10.</span> If set <span class="keyword">and</span> <span class="keyword">if</span> schema inferred, number of rows to infer schema <span class="keyword">from</span></span><br><span class="line">    .option(<span class="string">"workbookPassword"</span>, <span class="string">"pass"</span>) // Optional, default <span class="literal">None</span>. Requires unlimited strength JCE <span class="keyword">for</span> older JVMs</span><br><span class="line">    .schema(myCustomSchema) // Optional, default: Either inferred schema, <span class="keyword">or</span> all columns are Strings</span><br><span class="line">    .load(<span class="string">"Worktime.xlsx"</span>)</span><br></pre></td></tr></table></figure>
<p>为了简化操作，spark-excel的Scala版本包括一个装饰了spark.read返回的DataFrameReader的implicit，并提供一个.excel方法，接受默认和可选的属性。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql._</span><br><span class="line"><span class="keyword">import</span> com.crealytics.spark.excel._</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> spark: <span class="type">SparkSession</span> = ???</span><br><span class="line"><span class="keyword">val</span> df = spark.read.excel(</span><br><span class="line">    useHeader = <span class="literal">true</span>,  <span class="comment">// Required</span></span><br><span class="line">    dataAddress = <span class="string">"'My Sheet'!B3:C35"</span>, <span class="comment">// Optional, default: "A1"</span></span><br><span class="line">    treatEmptyValuesAsNulls = <span class="literal">false</span>,  <span class="comment">// Optional, default: true</span></span><br><span class="line">    inferSchema = <span class="literal">false</span>,  <span class="comment">// Optional, default: false</span></span><br><span class="line">    addColorColumns = <span class="literal">true</span>,  <span class="comment">// Optional, default: false</span></span><br><span class="line">    timestampFormat = <span class="string">"MM-dd-yyyy HH:mm:ss"</span>,  <span class="comment">// Optional, default: yyyy-mm-dd hh:mm:ss[.fffffffff]</span></span><br><span class="line">    maxRowsInMemory = <span class="number">20</span>,  <span class="comment">// Optional, default None. If set, uses a streaming reader which can help with big files</span></span><br><span class="line">    excerptSize = <span class="number">10</span>,  <span class="comment">// Optional, default: 10. If set and if schema inferred, number of rows to infer schema from</span></span><br><span class="line">    workbookPassword = <span class="string">"pass"</span>  <span class="comment">// Optional, default None. Requires unlimited strength JCE for older JVMs</span></span><br><span class="line">).schema(myCustomSchema) <span class="comment">// Optional, default: Either inferred schema, or all columns are Strings</span></span><br><span class="line"> .load(<span class="string">"Worktime.xlsx"</span>)</span><br></pre></td></tr></table></figure>
<p>###DataFrame保存为Excel</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">df.write</span><br><span class="line">  .format(<span class="string">"com.crealytics.spark.excel"</span>)</span><br><span class="line">  .option(<span class="string">"dataAddress"</span>, <span class="string">"'My Sheet'!B3:C35"</span>)</span><br><span class="line">  .option(<span class="string">"useHeader"</span>, <span class="string">"true"</span>)</span><br><span class="line">  .option(<span class="string">"dateFormat"</span>, <span class="string">"yy-mmm-d"</span>) // Optional, default: yy-m-d h:mm</span><br><span class="line">  .option(<span class="string">"timestampFormat"</span>, <span class="string">"mm-dd-yyyy hh:mm:ss"</span>) // Optional, default: yyyy-mm-dd hh:mm:ss<span class="number">.000</span></span><br><span class="line">  .mode(<span class="string">"append"</span>) // Optional, default: overwrite.</span><br><span class="line">  .save(<span class="string">"Worktime2.xlsx"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="DataFrame-Join"><a href="#DataFrame-Join" class="headerlink" title="DataFrame Join"></a>DataFrame Join</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">joined=excel1.join(excel2, excel1[<span class="string">"id"</span>]==excel2[<span class="string">"id"</span>]) </span><br><span class="line"><span class="comment">#或者以下格式</span></span><br><span class="line">joined=excel1.join(excel2, excel1.id==excel2.id)</span><br></pre></td></tr></table></figure>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2020/02/16/表批量读取和写入/" itemprop="url">表批量读取和写入</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2020-02-16T13:17:17.000Z" itemprop="datePublished">10 个月前</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Technology/">Technology</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            11 分钟 读完 (约 1598 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>Delta Lake支持Apache Spark DataFrame读取和写入API提供的大多数选项，用于对表执行批量读取和写入。</p>
<h1 id="建立表格"><a href="#建立表格" class="headerlink" title="建立表格"></a>建立表格</h1><p>使用<code>DataFrameWriter</code>（<a href="https://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.sql.DataFrameWriter" target="_blank" rel="noopener">Scala或Java</a> / <a href="https://spark.apache.org/docs/2.1.0/api/python/pyspark.sql.html#pyspark.sql.DataFrameWriter" target="_blank" rel="noopener">Python</a>）将数据作为原子操作写入Delta Lake。至少必须指定格式<code>delta</code>：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.write.format(<span class="string">"delta"</span>).save(<span class="string">"/delta/events"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="分区数据"><a href="#分区数据" class="headerlink" title="## 分区数据"></a>## 分区数据</h2><p>您可以对数据进行分区以加快查询或对分区列执行的带有谓词的DML。要在创建增量表时，指定分区的列对数据进行分区。常见的模式是按日期分区，例如：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.write.format(<span class="string">"delta"</span>).partitionBy(<span class="string">"date"</span>).save(<span class="string">"/delta/events"</span>)</span><br></pre></td></tr></table></figure>
<h1 id="读取表"><a href="#读取表" class="headerlink" title="读取表"></a>读取表</h1><p>您可以通过指定路径将Delta表作为DataFrame加载：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spark.read.format(<span class="string">"delta"</span>).load(<span class="string">"/delta/events"</span>)</span><br></pre></td></tr></table></figure>
<h1 id="查询表的旧快照（时间旅行）"><a href="#查询表的旧快照（时间旅行）" class="headerlink" title="查询表的旧快照（时间旅行）"></a>查询表的旧快照（时间旅行）</h1><p>Delta Lake时间旅行允许您查询Delta表的旧快照。时间旅行有许多用例，包括：</p>
<ul>
<li>重新创建分析，报告或输出（例如，机器学习模型的输出）。这对于调试或审核尤其有用，特别是在受管制的行业中。</li>
<li>编写复杂的时间查询。</li>
<li>修正数据中的错误。</li>
<li>为快速更改表的一组查询提供快照隔离。</li>
</ul>
<p>本节介绍了查询表的较旧版本时所支持的方法，数据保留问题并提供了示例。</p>
<h2 id="句法"><a href="#句法" class="headerlink" title="句法"></a>句法</h2><p>有几种查询旧版Delta表的方法。</p>
<h5 id="DataFrameReader选项"><a href="#DataFrameReader选项" class="headerlink" title="DataFrameReader选项"></a>DataFrameReader选项</h5><p>DataFrameReader选项允许您从固定到表的特定版本的Delta表创建DataFrame。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df1 = spark.read.format(<span class="string">"delta"</span>).option(<span class="string">"timestampAsOf"</span>, timestamp_string).load(<span class="string">"/delta/events"</span>)</span><br><span class="line">df2 = spark.read.format(<span class="string">"delta"</span>).option(<span class="string">"versionAsOf"</span>, version).load(<span class="string">"/delta/events"</span>)</span><br></pre></td></tr></table></figure>
<p>对于<code>timestamp_string</code>，仅接受日期或时间戳记字符串。例如<code>&quot;2019-01-01&quot;</code>和<code>&quot;2019-01-01&#39;T&#39;00:00:00.000Z&quot;</code>。</p>
<p>一种常见的模式是在执行Databricks作业期间使用Delta表的最新状态来更新下游应用程序。</p>
<h1 id="写入表格"><a href="#写入表格" class="headerlink" title="写入表格"></a>写入表格</h1><p>使用<code>append</code>模式，您可以将新数据原子添加到现有的Delta表中：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.write.format(<span class="string">"delta"</span>).mode(<span class="string">"append"</span>).save(<span class="string">"/delta/events"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="使用DataFrames覆盖"><a href="#使用DataFrames覆盖" class="headerlink" title="使用DataFrames覆盖"></a>使用DataFrames覆盖</h2><p>要自动替换表中的所有数据，可以使用<code>overwrite</code>模式：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.write.format(<span class="string">"delta"</span>).mode(<span class="string">"overwrite"</span>).save(<span class="string">"/delta/events"</span>)</span><br></pre></td></tr></table></figure>
<p>您可以有选择地仅覆盖分区列上与谓词匹配的数据。以下命令用中的数据原子替换一月<code>df</code>：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">df.write</span><br><span class="line">  .format(<span class="string">"delta"</span>)</span><br><span class="line">  .mode(<span class="string">"overwrite"</span>)</span><br><span class="line">  .option(<span class="string">"replaceWhere"</span>, <span class="string">"date &gt;= '2017-01-01' AND date &lt;= '2017-01-31'"</span>)</span><br><span class="line">  .save(<span class="string">"/delta/events"</span>)</span><br></pre></td></tr></table></figure>
<p>此示例代码将数据写入<code>df</code>，验证所有数据均位于指定分区内，并执行原子替换。</p>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>与Apache Spark中的文件API不同，Delta Lake会记住并强制执行表的架构。这意味着默认情况下，覆盖<em>不会</em>替换现有表的架构。</p>
<p>有关Delta Lake支持更新表的信息，请参阅<a href="https://docs.delta.io/latest/delta-update.html#-delta-update" target="_blank" rel="noopener">更新表</a>。</p>
<h1 id="模式验证"><a href="#模式验证" class="headerlink" title="模式验证"></a>模式验证</h1><p>Delta Lake自动验证正在写入的DataFrame的架构与表的架构兼容。Delta Lake使用以下规则来确定从DataFrame到表的写入是否兼容：</p>
<ul>
<li>所有DataFrame列都必须存在于目标表中。如果表中不存在DataFrame中的列，则会引发异常。表中存在但DataFrame中不存在的列设置为null。</li>
<li>DataFrame列数据类型必须与目标表中的列数据类型匹配。如果它们不匹配，则会引发异常。</li>
<li>DataFrame列名称不能只是大小写不同（而文字相同）。这意味着您不能在同一表中定义诸如“ Foo”和“ foo”之类的列。虽然可以在区分大小写或不区分大小写（默认）模式下使用Spark，但在存储和返回列信息时，<strong>Parquet区分大小写</strong>。Delta Lake保留大小写，但在存储模式时不敏感，并且具有此限制以避免潜在的错误，数据损坏或丢失问题。</li>
</ul>
<p>如果您指定其他选项（例如<code>partitionBy</code>与附加模式结合使用），则Delta Lake会验证它们是否匹配，并为任何不匹配项引发错误。如果<code>partitionBy</code>不存在，则append操作将自动继续按原有数据的分区。</p>
<h1 id="自动模式更新"><a href="#自动模式更新" class="headerlink" title="自动模式更新"></a>自动模式更新</h1><p>Delta Lake可以作为DML事务的一部分（附加或覆盖）自动更新表的架构，并使该架构与正在写入的数据兼容。</p>
<h2 id="添加列"><a href="#添加列" class="headerlink" title="添加列"></a>添加列</h2><p>在以下情况下，DataFrame中存在但表中缺失的列将作为写事务的一部分自动添加：</p>
<ul>
<li><code>write</code>或<code>writeStream</code>有<code>.option(&quot;mergeSchema&quot;, &quot;true&quot;)</code></li>
</ul>
<p>添加的列将追加到它们所在的结构的末尾。追加新列时将保留大小写。</p>
<h2 id="NullType-列"><a href="#NullType-列" class="headerlink" title="NullType 列"></a><code>NullType</code> 列</h2><p>由于Parquet不支持<code>NullType</code>，在写入Delta表时<code>NullType</code>会从DataFrame中被删除，但仍存储在模式中。当为该列接收到其他不同的数据类型时，Delta Lake会将模式合并到新的数据类型。如果Delta Lake收到<code>NullType</code>更换现有列，则在写入过程中将保留原有旧模式，并删除新列。</p>
<p><code>NullType</code>不支持流式传输。由于必须在使用流式传输时设置模式，因此这种情况很少见。<code>NullType</code>也不适用于诸如<code>ArrayType</code>和<code>MapType</code>等复杂类型。</p>
<h1 id="替换表架构"><a href="#替换表架构" class="headerlink" title="替换表架构"></a>替换表架构</h1><p>默认情况下，覆盖表中的数据不会覆盖架构。当使用mode(“overwrite”)<code>覆盖表而没有</code>replaceWhere<code>，你可能仍然要覆盖写入的数据的架构。通过将</code>overwriteSchema<code>选项设置为</code>true`，可以替换表的模式和分区：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.write.option(<span class="string">"overwriteSchema"</span>, <span class="string">"true"</span>)</span><br></pre></td></tr></table></figure>
<h1 id="表的视图"><a href="#表的视图" class="headerlink" title="表的视图"></a>表的视图</h1><p>Delta Lake支持在Delta表之上创建视图，就像使用数据源表一样。</p>
<p>使用视图进行操作时的核心挑战是解析模式。如果更改Delta表模式，则必须重新创建派生视图以说明对该模式的任何添加。例如，如果将新列添加到Delta表中，则必须确保该列在该基表之上构建的有关视图中可用。</p>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2020/02/16/基于Spark的新一代数据湖产品：DELTA-LAKE/" itemprop="url">基于Spark的新一代数据湖产品：DELTA LAKE</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2020-02-16T12:36:09.000Z" itemprop="datePublished">10 个月前</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Technology/">Technology</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            2 分钟 读完 (约 366 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p><a href="https://delta.io/" target="_blank" rel="noopener">Delta Lake</a>是一个<a href="https://github.com/delta-io/delta" target="_blank" rel="noopener">开源存储层</a>，可为数据湖带来可靠性。Delta Lake提供ACID事务，可伸缩的元数据处理，并统一流和批处理数据处理。Delta Lake在您现有的数据湖之上运行，并且与Apache Spark API完全兼容。</p>
<img src="/2020/02/16/基于Spark的新一代数据湖产品：DELTA-LAKE/Delta-Lake.png" title="Delta-Lake">
<p>具体来说，Delta Lake提供：</p>
<ul>
<li>Spark上的ACID事务：可序列化的隔离级别确保读者永远不会看到不一致的数据。</li>
<li>可扩展的元数据处理：利用Spark的分布式处理能力，可以轻松处理数十亿个文件的PB级表的所有元数据。</li>
<li>流和批处理的统一：Delta Lake中的表既是批处理表，又是流的源和接收器。流数据提取，批处理历史回填，交互式查询都可以直接使用。</li>
<li>模式实施：自动处理模式变化，以防止在摄取过程中插入不良记录。</li>
<li>时间旅行：数据版本控制支持回滚，完整的历史审核跟踪以及可重复的机器学习实验。</li>
<li>Upserts和Deletes：支持合并（Merge），更新和删除操作，以启用复杂的用例，例如更改数据捕获，缓慢维度变化（SCD）操作，流化Upserts等。</li>
</ul>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2019/08/22/Presto（一）用例指南/" itemprop="url">Presto（一）用例指南</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-08-22T15:07:01.000Z" itemprop="datePublished">1 年前</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Technology/">Technology</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            7 分钟 读完 (约 999 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h1 id="Presto不是什么"><a href="#Presto不是什么" class="headerlink" title="Presto不是什么"></a>Presto不是什么</h1><p>因为网上很多人错误地认为Presto是一个数据库，所以首先从反面定义Presto不是什么更有意义。</p>
<p>不要以为Presto能够解析并执行SQL就将其与标准的数据库混为一谈。Presto并不是一个普遍意义上的关系数据库。它无法替代诸如Mysql、PostgreSQL和Oracle这样的关系型数据库。Presto的设计目标不是为了处理OLTP工作，这与很多其他为优化数据仓库和分析型数据库而设计的数据库一样。</p>
<h1 id="Presto是什么"><a href="#Presto是什么" class="headerlink" title="Presto是什么"></a>Presto是什么</h1><p>Presto是一个面向大规模数据集通过分布式查询任务进行高效查询的工具。需要处理TB或PB级数据时，会经常使用与Hadoop和HDFS交互的工具。Presto的设计目标是为替换诸如Hive、Pig等使用MapReduce管道查询HDFS的工具提供另一种选择。Presto通过扩展还能够处理其他类型的数据源，包括传统关系型数据看看和其他No-SQL数据库例如Cassandra。</p>
<p>Presto设计用于处理数据仓库和数据分析业务：例如数据分析、聚合大规模数据和制作报表。这类应用场景经常被划分为OLAP范围。</p>
<h1 id="Presto核心概念"><a href="#Presto核心概念" class="headerlink" title="Presto核心概念"></a>Presto核心概念</h1><h2 id="连接器Connector"><a href="#连接器Connector" class="headerlink" title="连接器Connector"></a>连接器Connector</h2><p>连接器将Presto适配到一个数据源，例如Hive或关系型数据库。可以将连接器视为一个连接数据库的驱动。它实现了Presto的SPI，Presto依靠SPI标准接口与数据源进行互动。</p>
<p>Presto包括几个内置的连接器：JMX连接器，作为一个系统连接器提供对内置系统表的访问。Hive连接器。以及一个TPCH连接器用于服务TPC-H基准测试数据。第三方开发人员贡献了很多其他连接器，所以Presto能够适配许多不同类型的数据源。</p>
<p>每一个catalog都对应一个连接器。如果你查看catalog配置文件，会看到每个catalog都会有一个必需的配置项connector.name，它被catalog manager用于创建与catalog想匹配的连接器。可以为多个catalog指定相同的连接器，用于访问同类数据库的不同实例。例如你有两个Hive集群，你可以在一个Presto集群中配置两个catalog都使用Hive连接器，是你能够从两个Hive集群中查询数据。</p>
<h2 id="Catalog"><a href="#Catalog" class="headerlink" title="Catalog"></a>Catalog</h2><p>Presto的catalog包含schema模式和指向数据源的连接器的引用。例如，你可以配置一个JMX catalog，通过JMX连接器提供对JMX信息的访问。Presto可以在一个或多个catalog上运行SQL。其他catalog类型包括连接到Hive数据源的Hive catalog。</p>
<p>当使用Presto在解析表时，使用表的完全限定（fully-qualified）名，完全限定名以catalog为根。例如hive.test_data.test的完全限定名，表示hive库中的test_data模式中的test表。</p>
<p>catalog通过Presto配置文件目录下的属性文件进行定义。</p>
<h2 id="Schema"><a href="#Schema" class="headerlink" title="Schema"></a>Schema</h2><p>schema是一种组织表的方式。一个catalog和模式定义了一组可以被查询的表。当使用Presto访问Hive或关系型数据库例如MySQL时，schema跟目标数据库中的具有相同的概念。其他类型的连接器可能会选择以一种对底层数据源有意义的方式将表组织为模式。</p>
<h2 id="Table"><a href="#Table" class="headerlink" title="Table"></a>Table</h2><p>一个表是一组无序的行，这些行由不同类型的列组成。这与关系型数据库概念相同。源数据到表的映射关系由连接器进行定义。</p>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2019/08/19/把数据基础做实做准/" itemprop="url">把数据基础做实做准</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-08-19T00:44:00.000Z" itemprop="datePublished">1 年前</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Technology/">Technology</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            4 分钟 读完 (约 639 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>为把数据基础做实做准，需统筹考虑决策支持系统中数据从来源、分析处理到产生决策价值并提供决策使用等全生命周期的过程治理。数据基础是整个治理过程中最基本的工作，关系到后续各个过程。打牢数据基础，主要有三个方面的工作。</p>
<p>一是建立清晰的数据目录。对于决策支持系统中的每类数据建立一个数据条目，包括名称、来源、数量、业务类别、更新频率、数据类型、访问权限等信息，从数据的业务、存储、使用和持续运营的多个角度进行梳理。数据目录作为决策支持系统最基础的战略性资产，用于数据登记、管理、更新和提供服务。</p>
<p>二是做好不同类型数据的管理。用于信息研究和决策支持的数据从结构上分为三类，第一类是以舆情、情报、文献等知识数据组成的非结构化数据，第二类是以统计数据组成的非关系模式的半结构化数据，第三类是以业务系统产生的管理数据组成的结构化数据，它通常存储于关系型数据库中。上述分类可见他们在存储结构、更新方式、分析方法和使用方式上有较大的差异，需要因地制宜对每类数据使用与其相适应的管理方法和技术。</p>
<p>三是做好数据的持续运营。打牢数据基础不是一蹴而就、一气呵成的, 需要一个持续的过程。积累的数据越多，周期越长,数据价值才越大，利用数据所做的研究也越多。数据的更新和积累属于决策支持系统运行维护的日常性工作，需要坚持不懈地去做。对于每一项数据资源需要从运营的角度建立常态化更新机制，尽量运用信息化手段实现自动更新并监控更新过程。对于无法自动化处理的更新过程，需要明确更新任务和工作量，作为日常数据处理任务进行统筹安排。</p>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2019/08/14/基于MongoDB-Spark的大数据分析解决方案/" itemprop="url">基于MongoDB+Spark的大数据分析解决方案</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-08-14T14:06:13.000Z" itemprop="datePublished">1 年前</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Technology/">Technology</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            37 分钟 读完 (约 5484 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>本文转自：<a href="https://www.cnblogs.com/hanson1/p/7105288.html" target="_blank" rel="noopener">https://www.cnblogs.com/hanson1/p/7105288.html</a></p>
<h3 id="Spark介绍"><a href="#Spark介绍" class="headerlink" title="Spark介绍"></a>Spark介绍</h3><p>按照官方的定义，<a href="http://lib.csdn.net/base/spark" target="_blank" rel="noopener">Spark</a> 是一个通用，快速，适用于大规模数据的处理引擎。</p>
<ul>
<li>通用性：我们可以使用Spark SQL来执行常规分析， Spark Streaming 来流数据处理， 以及用Mlib来执行机器学习等。Java，python，scala及R语言的支持也是其通用性的表现之一。</li>
<li>快速： 这个可能是Spark成功的最初原因之一，主要归功于其基于内存的运算方式。当需要处理的数据需要反复迭代时，Spark可以直接在内存中暂存数据，而无需像Map Reduce一样需要把数据写回磁盘。官方的数据表明：它可以比传统的Map Reduce快上100倍。</li>
<li>大规模：原生支持HDFS，并且其计算节点支持弹性扩展，利用大量廉价计算资源并发的特点来支持大规模数据处理。</li>
</ul>
<h3 id="我们能用它做什么"><a href="#我们能用它做什么" class="headerlink" title="我们能用它做什么"></a>我们能用它做什么</h3><p>那我们能用Spark来做什么呢？ 场景数不胜数。</p>
<p>最简单的可以只是统计一下某一个页面多少点击量，复杂的可以通过<a href="http://lib.csdn.net/base/machinelearning" target="_blank" rel="noopener">机器学习</a>来预测。</p>
<p><em>个性化</em> 是一个常见的案例，比如说，Yahoo的网站首页使用Spark来实现快速的用户兴趣分析。应该在首页显示什么新闻？原始的做法是让用户选择分类；聪明的做法就是在用户交互的过程中揣摩用户可能喜欢的文章。另一方面就是要在新闻进来时候进行分析并确定什么样的用户是可能的受众。新闻的时效性非常高，按照常规的MapReduce做法，对于Yahoo几亿用户及海量的文章，可能需要计算一天才能得出结果。Spark的高效运算可以在这里得到充分的运用，来保证新闻推荐在数十分钟或更短时间内完成。另外，如美国最大的有线电视商Comcast用它来做节目推荐，最近刚和滴滴联姻的uber用它实时订单分析，优酷则在Spark上实现了商业<a href="http://lib.csdn.net/base/aiplanning" target="_blank" rel="noopener">智能</a>的升级版。</p>
<h3 id="Spark生态系统"><a href="#Spark生态系统" class="headerlink" title="Spark生态系统"></a>Spark生态系统</h3><p>在我们开始谈<a href="http://lib.csdn.net/base/mongodb" target="_blank" rel="noopener">MongoDB</a> 和Spark 之前，我们首先来了解一下Spark的生态系统。 Spark 作为一个大型分布式计算框架，需要和其他组件一起协同工作。</p>
<p><img src="http://img1.tuicool.com/3uQ7j2J.png!web" alt="img"></p>
<p>在Hdaoop里面，HDFS是其核心，作为一个数据层。</p>
<p>Spark是<a href="http://lib.csdn.net/base/hadoop" target="_blank" rel="noopener">Hadoop</a>生态系统的一颗新星，原生就支持HDFS。大家知道HDFS是用来管理大规模非结构化数据的存储系统，具有高可用和巨大的横向扩展能力。</p>
<p>而作为一个横向扩展的分布式集群，资源管理是其核心必备的能力，Spark 可以通过YARN或者MESOS来负责资源（CPU）分配和任务调度。如果你不需要管理节点的高可用需求，你也可以直接使用Spark standalone。</p>
<p>在有了数据层和资源管理层后， 接下来就是我们真正的计算引擎。</p>
<p><a href="http://lib.csdn.net/base/hadoop" target="_blank" rel="noopener">hadoop</a>技术的两大基石之一的MapReduce就是用来实现集群大规模并行计算。而现在就多了一个选项：Spark。 Map Reduce的特点是，用4个字来概括，简单粗暴。采用divide &amp; conquer战术，我们可以用Map Reduce来处理PB级的数据。 而Spark 作为打了鸡血的Map Reduce增强版，利用了内存价格大量下降的时代因素，充分把计算所用变量和中间结果放到内存里，并且提供了一整套机器学习的分析<a href="http://lib.csdn.net/base/datastructure" target="_blank" rel="noopener">算法</a>，在加上很多语言的支持，使之成为一个较之于Map Reduce更加优秀的选择。</p>
<p>由于Map Reduce 是一个相对并不直观的程序接口，所以为了方便使用，一系列的高层接口如<a href="http://lib.csdn.net/base/hive" target="_blank" rel="noopener">Hive</a>或者Pig应运而生。 <a href="http://lib.csdn.net/base/hive" target="_blank" rel="noopener">hive</a>可以让我们使用非常熟悉的SQL语句的方式来做一些常见的统计分析工作。同理，在Spark 引擎层也有类似的封装，如Spark SQL、RDD以及2.0版本新推出的Dataframe等。</p>
<p>所以一个完整的<a href="http://lib.csdn.net/base/hadoop" target="_blank" rel="noopener">大数据</a>解决方案，包含了存储，资源管理，计算引擎及接口层。 那么问题来了：我们画了这么大这么圆的大饼，<a href="http://lib.csdn.net/base/mongodb" target="_blank" rel="noopener">mongodb</a>可以吃哪一块呢？</p>
<p><img src="http://img1.tuicool.com/rYbm63Q.png!web" alt="img"></p>
<p>MongoDB是个什么？是个database。 所以自然而然，MongoDB可以担任的角色，就是数据存储的这一部分。在和 Spark一起使用的时候，MongoDB就可以扮演HDFS的角色来为Spark提供计算的原始数据，以及用来持久化分析计算的结果。</p>
<h3 id="HDFS-vs-MongoDB"><a href="#HDFS-vs-MongoDB" class="headerlink" title="HDFS vs. MongoDB"></a>HDFS vs. MongoDB</h3><p>既然我们说MongoDB可以用在HDFS的地方，那我们来详细看看两者之间的差异性。</p>
<p>在说区别之前，其实我们可以先来注意一下两者的共同点。HDFS和MongoDB都是基于廉价x86服务器的横向扩展<a href="http://lib.csdn.net/base/architecture" target="_blank" rel="noopener">架构</a>，都能支持到TB到PB级的数据量。数据会在多节点自动备份，来保证数据的高可用和冗余。两者都支持非结构化数据的存储，等等。</p>
<p>但是，HDFS和MongoDB更多的是差异点：</p>
<ul>
<li>如在存储方式上 HDFS的存储是以文件为单位，每个文件64MB到128MB不等。而MongoDB则是细颗粒化的、以文档为单位的存储。</li>
<li>HDFS不支持索引的概念，对数据的操作局限于扫描性质的读，MongoDB则支持基于二级索引的快速检索。</li>
<li>MongoDB可以支持常见的增删改查场景，而HDFS一般只是一次写入后就很难进行修改。</li>
<li>从响应时间上来说，HDFS一般是分钟级别而MongoDB对手请求的响应时间通常以毫秒作为单位。</li>
</ul>
<h3 id="一个日志的例子"><a href="#一个日志的例子" class="headerlink" title="一个日志的例子"></a>一个日志的例子</h3><p>如果说刚才的比较有些抽象，我们可以结合一个实际一点的例子来理解。</p>
<p>比如说，一个比较经典的案例可能是日志记录管理。在HDFS里面你可能会用日期范围来命名文件，如7月1日，7月2日等等，每个文件是个日志文本文件，可能会有几万到几十万行日志。</p>
<p>而在MongoDB里面，我们可以采用一个JSON的格式，每一条日志就是一个JSON document。我们可以对某几个关心的字段建索引，如时间戳，错误类型等。</p>
<p>我们来考虑一些场景，加入我们相对7月份所有日志做一些全量的统计，比如每个页面的所有点击量，那么这个HDFS和MongoDB都可以正常处理。</p>
<p>如果有一天你的经理告诉你：他想知道网站上每天有多少404错误在发生，这个时候如果你用HDFS，就还是需要通过全量扫描所有行，而MongoDB则可以通过索引，很快地找到所有的404日志，可能花数秒钟就可以解答你经理的问题。</p>
<p>又比如说，如果你希望对每个日志项加一个自定义的属性，在进行一些预处理后，MongoDB就会比较容易地支持到。而一般来说，HDFS是不支持更新类型操作的。</p>
<p>好的，我们了解了MongoDB为什么可以替换HDFS并且为什么有这个必要来做这个事情，下面我们就来看看Spark和MongoDB怎么玩！</p>
<h2 id="Spark-MongoDB"><a href="#Spark-MongoDB" class="headerlink" title="Spark + MongoDB"></a>Spark + MongoDB</h2><p>Spark的工作流程可以概括为三部曲：创建并发任务，对数据进行transformation操作，如map， filter，union，intersect等，然后执行运算，如reduce，count，或者简单地收集结果。</p>
<p><img src="http://img1.tuicool.com/jEne2qF.png!web" alt="img"></p>
<p>这里是Spark和MongoDB部署的一个典型架构。</p>
<p>Spark任务一般由Spark的driver节点发起，经过Spark Master进行资源调度分发。比如这里我们有4个Spark worker节点，这些节点上的几个executor 计算进程就会同时开始工作。一般一个core就对应一个executor。</p>
<p>每个executor会独立的去MongoDB取来原始数据，直接套用Spark提供的分析算法或者使用自定义流程来处理数据，计算完后把相应结果写回到MongoDB。</p>
<p>我们需要提到的是：在这里，所有和MongoDB的交互都是通过一个叫做Mongo-Spark的连接器来完成的。</p>
<p><img src="http://img0.tuicool.com/ZNb2Yz3.png!web" alt="img"></p>
<p>另一种常见的架构是结合MongoDB和HDFS的。Hadoop在非结构化数据处理的场景下要比MongoDB的普及率高。所以我们可以看到不少用户会已经将数据存放在HDFS上。这个时候你可以直接在HDFS上面架Spark来跑，Spark从HDFS取来原始数据进行计算，而MongoDB在这个场景下是用来保存处理结果。为什么要这么麻烦？几个原因：</p>
<ul>
<li>Spark处理结果数量可能会很大，比如说，个性化推荐可能会产生数百万至数千万条记录，需要一个能够支持每秒万级写入能力的数据库</li>
<li>处理结果可以直接用来驱动前台APP，如用户打开页面时获取后台已经为他准备好的推荐列表。</li>
</ul>
<h3 id="Mongo-Spark-Connector-连接器"><a href="#Mongo-Spark-Connector-连接器" class="headerlink" title="Mongo Spark Connector 连接器"></a>Mongo Spark Connector 连接器</h3><p>在这里我们在介绍下MongoDB官方提供的 <a href="https://github.com/mongodb/mongo-spark" target="_blank" rel="noopener">Mongo Spark连接器</a> 。目前有3个连接器可用，包括社区第三方开发的和之前Mongo Hadoop连接器等，这个Mongo-Spark是最新的，也是我们推荐的连接方案。</p>
<p><img src="http://img1.tuicool.com/nyMj2a2.png!web" alt="img"></p>
<p>这个连接器是专门为Spark打造的，支持双向数据，读出和写入。但是最关键的是 条件下推 ，也就是说：如果你在Spark端指定了查询或者限制条件的情况下，这个条件会被下推到MongoDB去执行，这样可以保证从MongoDB取出来、经过网络传输到Spark计算节点的数据确实都是用得着的。没有下推支持的话，每次操作很可能需要从MongoDB读取全量的数据，性能体验将会很糟糕。拿刚才的日志例子来说，如果我们只想对404错误日志进行分析，看那些错误都是哪些页面，以及每天错误页面数量的变化，如果有条件下推，那么我们可以给MongoDB一个限定条件：错误代码=404， 这个条件会在MongoDB服务器端执行，这样我们只需要通过网络传输可能只是全部日志的0.1%的数据，而不是没有条件下推情况下的全部数据。</p>
<p>另外，这个最新的连接器还支持和Spark计算节点Co-Lo 部署。就是说在同一个节点上同时部署Spark实例和MongoDB实例。这样做可以减少数据在网络上的传输带来的资源消耗及时延。当然，这种部署方式需要注意内存资源和CPU资源的隔离。隔离的方式可以通过Linux的cgroups。</p>
<h2 id="Spark-MongoDB-成功案例"><a href="#Spark-MongoDB-成功案例" class="headerlink" title="Spark + MongoDB 成功案例"></a>Spark + MongoDB 成功案例</h2><p>目前已经有很多案例在不同的应用场景中使用Spark+MongoDB。</p>
<p>法国航空是法国最大的航空公司，为了提高客户体验，在最近施行的360度客户视图中，使用Spark对已经收集在MongoDB里面的客户数据进行分类及行为分析，并把结果（如客户的类别、标签等信息）写回到MongoDB内每一个客户的文档结构里。</p>
<p>Stratio是美国硅谷一家著名的金融大数据公司。他们最近在一家在31个国家有分支机构的跨国银行实施了一个实时监控平台。该银行希望通过对日志的监控和分析来保证客户服务的响应时间以及实时监测一些可能的违规或者金融欺诈行为。在这个应用内， 他们使用了：</p>
<p>Stratio是美国硅谷一家著名的金融大数据公司。他们最近在一家在31个国家有分支机构的跨国银行实施了一个实时监控平台。该银行希望通过对日志的监控和分析来保证客户服务的响应时间以及实时监测一些可能的违规或者金融欺诈行为。在这个应用内， 他们使用了：</p>
<ul>
<li>Apache Flume 来收集log</li>
<li>Spark来处理实时的log</li>
<li>MongoDB来存储收集的log以及Spark分析的结果，如Key Performance Indicators等</li>
</ul>
<p>东方航空最近刚完成一个Spark运价的POC测试。</p>
<h3 id="东方航空的挑战"><a href="#东方航空的挑战" class="headerlink" title="东方航空的挑战"></a>东方航空的挑战</h3><p>东方航空作为国内的3大行之一，每天有1000多个航班，服务26万多乘客。过去，顾客在网站上订购机票，平均资料库查询200次就会下单订购机票，但是现在平均要查询1.2万次才会发生一次订购行为，同样的订单量，查询量却成长百倍。按照50%直销率这个目标计算，东航的运价系统要支持每天16亿的运价请求。</p>
<h3 id="思路：空间换时间"><a href="#思路：空间换时间" class="headerlink" title="思路：空间换时间"></a>思路：空间换时间</h3><p>当前的运价是通过实时计算的，按照现在的计算能力，需要对已有系统进行100多倍的扩容。另一个常用的思路，就是采用空间换时间的方式。与其对每一次的运价请求进行耗时300ms的运算，不如事先把所有可能的票价查询组合穷举出来并进行批量计算，然后把结果存入MongoDB里面。当需要查询运价时，直接按照 出发+目的地+日期的方式做一个快速的DB查询，响应时间应该可以做到几十毫秒。</p>
<p>那为什么要用MongoDB？因为我们要处理的数据量庞大无比。按照1000多个航班，365天，26个仓位，100多渠道以及数个不同的航程类型，我们要实时存取的运价记录有数十亿条之多。这个已经远远超出常规RDBMS可以承受的范围。</p>
<p>MongoDB基于内存缓存的数据管理方式决定了对并发读写的响应可以做到很低延迟，水平扩展的方式可以通过多台节点同时并发处理海量请求。</p>
<p>事实上，全球最大的航空分销商，管理者全世界95%航空库存的Amadeus也正是使用MongoDB作为其1000多亿运价缓存的存储方案。</p>
<h3 id="Spark-MongoDB-方案"><a href="#Spark-MongoDB-方案" class="headerlink" title="Spark + MongoDB 方案"></a>Spark + MongoDB 方案</h3><p>我们知道MongoDB可以用来做我们海量运价数据的存储方案，在大规模并行计算方案上，就可以用到崭新的Spark技术。</p>
<p><img src="http://img0.tuicool.com/rUjuYv.png!web" alt="img"></p>
<p>这里是一个运价系统的架构图。 左边是发起航班查询请求的客户端，首先会有API服务器进行预处理。一般航班请求会分为库存查询和运价查询。库存查询会直接到东航已有的库存系统（Seat Inventory），同样是实现在MongoDB上面的。在确定库存后根据库存结果再从Fare Cache系统内查询相应的运价。</p>
<p>Spark集群则是另外一套计算集群，通过Spark MongoDB连接套件和MongoDB Fare Cache集群连接。Spark 计算任务会定期触发（如每天一次或者每4小时一次），这个任务会对所有的可能的运价组合进行全量计算，然后存入MongoDB，以供查询使用。右半边则把原来实时运算的集群换成了Spark+MongoDB。Spark负责批量计算一年内所有航班所有仓位的所有价格，并以高并发的形式存储到MongoDB里面。每秒钟处理的运价可以达到数万条。</p>
<p>当来自客户端的运价查询达到服务端以后，服务端直接就向MongoDB发出按照日期，出发到达机场为条件的mongo查询。</p>
<h3 id="批处理计算流程"><a href="#批处理计算流程" class="headerlink" title="批处理计算流程"></a>批处理计算流程</h3><p><img src="http://img2.tuicool.com/MNruymF.png!web" alt="img"></p>
<p>这里是Spark计算任务的流程图。需要计算的任务，也就是所有日期航班仓位的组合，事先已经存放到MongoDB里面。</p>
<p>任务递交到master，然后预先加载所需参考数据，broadcast就是把这些在内存里的数据复制到每一个Spark计算节点的JVM，然后所有计算节点多线程并发执行，从Mongodb里取出需要计算的仓位，调用东航自己的运价逻辑，得出结果以后，并保存回MongoDB。</p>
<h3 id="Spark-任务入口程序"><a href="#Spark-任务入口程序" class="headerlink" title="Spark 任务入口程序"></a>Spark 任务入口程序</h3><p>Spark和MongoDB的连接使用非常简单，下面就是一个代码示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// initialization dependencies including base prices, pricing rules and some reference data</span><br><span class="line">Map dependencies = MyDependencyManager.loadDependencies();</span><br><span class="line">// broadcasting dependencies</span><br><span class="line">javaSparkContext.broadcast(dependencies);</span><br><span class="line"></span><br><span class="line">// create job rdd</span><br><span class="line">cabinsRDD = MongoSpark.load(javaSparkContext).withPipeline(pipeline)</span><br><span class="line"></span><br><span class="line">// for each cabin, date, airport pair, calculate the price</span><br><span class="line">cabinsRDD.map(function calc_price);</span><br><span class="line"></span><br><span class="line">// collect the result, which will cause the data to be stored into MongoDB</span><br><span class="line">cabinsRDD.collect()</span><br><span class="line">cabinsRDD.saveToMongo()</span><br></pre></td></tr></table></figure>
<h3 id="处理能力和响应时间比较"><a href="#处理能力和响应时间比较" class="headerlink" title="处理能力和响应时间比较"></a>处理能力和响应时间比较</h3><p>这里是一个在东航POC的简单测试结果。从吞吐量的角度，新的API服务器单节点就可以处理3400个并发的运价请求。在显著提高了并发的同时，响应延迟则降低了10几倍，平均10ms就可以返回运价结果。按照这个性能，6台 API服务器就可以应付将来每天16亿的运价查询。</p>
<p><img src="http://img0.tuicool.com/3u6fqe.png!web" alt="img"></p>
<h2 id="Spark-＋-MongoDB-演示"><a href="#Spark-＋-MongoDB-演示" class="headerlink" title="Spark ＋ MongoDB 演示"></a>Spark ＋ MongoDB 演示</h2><p>接下来是一个简单的Spark+MongoDB演示。</p>
<h3 id="安装-Spark"><a href="#安装-Spark" class="headerlink" title="安装 Spark"></a>安装 Spark</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># curl -OL http://d3kbcqa49mib13.cloudfront.net/spark-1.6.0-bin-hadoop2.6.tgz</span><br><span class="line"># mkdir -p ~/spark</span><br><span class="line"># tar -xvf spark-1.6.0-bin-hadoop2.6.tgz -C ~/spark --strip-components=1</span><br></pre></td></tr></table></figure>
<h3 id="测试连接器"><a href="#测试连接器" class="headerlink" title="测试连接器"></a>测试连接器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># cd ～／spark</span><br><span class="line"># ./bin/spark-shell \</span><br><span class="line">--conf &quot;spark.mongodb.input.uri=mongodb://127.0.0.1/flights.av&quot; \</span><br><span class="line">--conf &quot;spark.mongodb.output.uri=mongodb://127.0.0.1/flights.output&quot; \</span><br><span class="line">--packages org.mongodb.spark:mongo-spark-connector_2.10:1.0.0</span><br><span class="line"></span><br><span class="line">import com.mongodb.spark._</span><br><span class="line">import org.bson.Document</span><br><span class="line"></span><br><span class="line">MongoSpark.load(sc).take(10).foreach(println)</span><br></pre></td></tr></table></figure>
<h3 id="简单分组统计"><a href="#简单分组统计" class="headerlink" title="简单分组统计"></a>简单分组统计</h3><p>数据： 365天，所有航班库存信息，500万文档</p>
<p>任务： 按航班统计一年内所有余票量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MongoSpark.load(sc)</span><br><span class="line">     .map(doc=&gt;(doc.getString(&quot;flight&quot;) ,doc.getLong(&quot;seats&quot;)))</span><br><span class="line">     .reduceByKey((x,y)=&gt;(x+y))</span><br><span class="line">      .take(10)</span><br><span class="line">     .foreach(println)</span><br></pre></td></tr></table></figure>
<h3 id="简单分组统计加条件过滤"><a href="#简单分组统计加条件过滤" class="headerlink" title="简单分组统计加条件过滤"></a>简单分组统计加条件过滤</h3><p>数据： 365天，所有航班库存信息，500万文档</p>
<p>任务： 按航班统计一年内所有库存，但是只处理昆明出发的航班</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import org.bson.Document</span><br><span class="line"></span><br><span class="line">MongoSpark.load(sc)</span><br><span class="line">          .withPipeline(Seq(Document.parse(&quot;&#123; $match: &#123; orig :  &apos;KMG&apos;  &#125; &#125;&quot;)))</span><br><span class="line">    .map(doc=&gt;(doc.getString(&quot;flight&quot;) ,doc.getLong(&quot;seats&quot;)))</span><br><span class="line">    .reduceByKey((x,y)=&gt;(x+y))</span><br><span class="line">    .take(10)</span><br><span class="line">    .foreach(println)</span><br></pre></td></tr></table></figure>
<h3 id="性能优化事项"><a href="#性能优化事项" class="headerlink" title="性能优化事项"></a>性能优化事项</h3><ul>
<li>使用合适的chunksize (MB)<br>Total data size / chunksize = chunks = RDD partitions = spark tasks</li>
<li>不要将所有CPU核分配给Spark<br>预留1-2个core给操作系统及其他管理进程</li>
<li>同机部署<br>适当情况可以同机部署Spark+MongoDB，利用本地IO提高性能</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>上面只是一些简单的演示，实际上Spark + MongoDB的使用可以通过Spark的很多种形式来使用。我们来总结一下Spark ＋ Mongo的应用场景。在座的同学可能很多人已经使用了MongoDB，也有些人已经使用了Hadoop。我们可以从两个角度来考虑这个事情：</p>
<ul>
<li>对那些已经使用MongoDB的用户，如果你希望在你的MongoDB驱动的应用上提供个性化功能，比如说像Yahoo一样为你找感兴趣的新闻，能够在你的MongoDB数据上利用到Spark强大的机器学习或者流处理，你就可以考虑在MongoDB集群上部署Spark来实现这些功能。</li>
<li>如果你已经使用Hadoop而且数据已经在HDFS里面，你可以考虑使用Spark来实现更加实时更加快速的分析型需求，并且如果你的分析结果有数据量大、格式多变以及这些结果数据要及时提供给前台APP使用的需求，那么MongoDB可以用来作为你分析结果的一个存储方案。</li>
</ul>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2019/07/23/Oracle备份的概念和术语/" itemprop="url">Oracle备份的概念和术语</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-07-23T04:25:37.000Z" itemprop="datePublished">1 年前</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Technology/">Technology</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            4 分钟 读完 (约 584 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>Oracle备份是Oracle运维工作中非常重要的一个环节。Oracle备份的概念比较多，容易引起混淆。下面就具体概念和术语进行一个简单的辨析。</p>
<h1 id="概念辨析"><a href="#概念辨析" class="headerlink" title="概念辨析"></a>概念辨析</h1><ol>
<li>用操作系统命令执行的备份被称为<strong>用户管理备份</strong>。使用RMAN执行的备份被称为<strong>服务器管理的备份</strong>。</li>
<li>关闭状态的备份在数据库关闭期间执行，也称为<strong>冷备份、一致备份或脱机备份</strong>。打开状态的备份在数据库使用期间执行，也称为<strong>热备份、非一致备份或联机备份</strong>。</li>
<li>打开状态的备份只能在数据库处于<strong>归档日志模式</strong>下才能进行。</li>
<li><strong>全部备份</strong>指的是备份所有数据文件和控制文件。<strong>局部备份</strong>只备份其子集。在大部分情况下，局部备份只能在数据库处于<strong>归档日志模式</strong>下才能进行。</li>
<li><strong>完整备份</strong>备份所有使用的文件块。<strong>增量备份</strong>只包括自上次备份以来更改的块。</li>
<li>增量备份可以是累积增量备份或差异增量备份。<strong>累积增量备份</strong>指自上一次完整备份以来更改的所有块。<strong>差异增量备份</strong>指自上一次增量备份以来更改的所有块。</li>
</ol>
<h1 id="使用RMAN-Backup命令创建备份"><a href="#使用RMAN-Backup命令创建备份" class="headerlink" title="使用RMAN Backup命令创建备份"></a>使用RMAN Backup命令创建备份</h1><h2 id="1-服务器管理的一致备份"><a href="#1-服务器管理的一致备份" class="headerlink" title="1.服务器管理的一致备份"></a>1.服务器管理的一致备份</h2><p>RMAN备份脚本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">run &#123;                                                                                 </span><br><span class="line">shutdown immediate;                                                                   </span><br><span class="line">startup mount;                                                                       </span><br><span class="line">allocate channel d1 type disk;                                                      </span><br><span class="line">backup as backupset database format &apos;/home/oracle/Documents/offline_full_whole%U.bus&apos;;</span><br><span class="line">alter database open;                                                     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用RMAN运行一致性备份：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rman target sys/密码@orcl @/home/oracle/Documents/offline_all.rman</span><br></pre></td></tr></table></figure>
<p>如果遇到报错，可以按照如下方式进行处理：</p>
<p>[linuxidc@rhel55 ~]$rman target sys/<a href="http://www.linuxidc.com/topicnews.aspx?tid=12" target="_blank" rel="noopener">Oracle</a>@orcl</p>
<p>ORA-12514: TNS:listener does not currently know of service requested in connect descriptor<br>[linuxidc@rhel55 ~]$lsnrctl stop</p>
<p>[linuxidc@rhel55 ~]$cd $ORACLE_HOME</p>
<p>[linuxidc@rhel55 db_1]$vim listener.ora</p>
<p>修改/u01/app/oracle/product/11.2.0/db_1/network/admin/listener.ora文件<br>加上<br>SID_LIST_LISTENER =<br>  (SID_LIST =<br>    (SID_DESC =<br>      (SID_NAME = orcl)<br>      (ORACLE_HOME = /u01/app/oracle/product/11.2.0/db_1)<br>    )<br>  )<br>然后重启lisener服务，就ok了</p>
<p>[linuxidc@rhel55 ~]$lsnrctl start</p>
<h2 id="2-服务器管理的打开状态的备份"><a href="#2-服务器管理的打开状态的备份" class="headerlink" title="2. 服务器管理的打开状态的备份"></a>2. 服务器管理的打开状态的备份</h2><p>使用BACKUP命令执行绝对可靠的打开备份。</p>

    
    </div>
    
    
</article>




    
    
        
<nav class="pagination is-centered is-rounded" role="navigation" aria-label="pagination">
    <div class="pagination-previous is-invisible is-hidden-mobile">
        <a href="/categories/Technology/page/0/">上一页</a>
    </div>
    <div class="pagination-next">
        <a href="/categories/Technology/page/2/">下一页</a>
    </div>
    <ul class="pagination-list is-hidden-mobile">
        
        <li><a class="pagination-link is-current" href="/categories/Technology/">1</a></li>
        
        <li><a class="pagination-link" href="/categories/Technology/page/2/">2</a></li>
        
        <li><span class="pagination-ellipsis">&hellip;</span></li>
        
        <li><a class="pagination-link" href="/categories/Technology/page/5/">5</a></li>
        
    </ul>
</nav>
    
    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2020 肖飞&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow has-text-black" href="https://github.com/xyfigo">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        //plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {matchFontHeight: false},
        SVG: {matchFontHeight: false},
        CommonHTML: {matchFontHeight: false}
    });
</script>

    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    

    


<script src="/js/script.js"></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="站内搜索">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js"></script>
    
</body>
</html>