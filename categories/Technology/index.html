<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
<title>分类: Technology - 自然资源大数据分析——肖飞的博客</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">






<link rel="icon" href="/favicon.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet" href="/css/style.css">
<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>

</head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                <img src="/images/logo.png" alt height="28">
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item " href="/archives">文章列表</a>
            
            <a class="navbar-item " href="/categories/Lifestyle">Lifestyle</a>
            
            <a class="navbar-item " href="/categories/Music">Music</a>
            
            <a class="navbar-item is-active" href="/categories/Technology">Technology</a>
            
            <a class="navbar-item " href="/categories/Research">Research</a>
            
            <a class="navbar-item " href="/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            
            <a class="navbar-item" href="https://github.com/xyfigo">
                
                <i class="fab fa-github"></i>
                
            </a>
               
            
        </div>
    </div>
</nav>

    <section class="section section-heading">
    <div class="container">
        <div class="content">
            <h5><i class="far fa-folder"></i>Technology</h5>
        </div>
    </div>
</section>
<section class="section">
    <div class="container">
    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2020/12/31/精通Pandas探索性分析（四）：像专业人士一样可视化数据/" itemprop="url">精通Pandas探索性分析（四）：像专业人士一样可视化数据</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2020-12-30T16:38:53.000Z" itemprop="datePublished">19 分钟前</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Technology/">Technology</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            37 分钟 读完 (约 5491 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>在本章中，我们将学习使用 seaborn 数据可视化库的数据可视化的高级技术。</p>
<p>特别是，我们将涵盖以下主题：</p>
<ul>
<li>如何启用 Seaborn</li>
<li>Seaborn 的特性</li>
<li>绘制不同类型的绘图</li>
<li>用 seaborn 绘制分类图</li>
<li>使用数据感知网格进行绘图</li>
</ul>
<h1 id="控制绘图美学"><a href="#控制绘图美学" class="headerlink" title="控制绘图美学"></a>控制绘图美学</h1><p>在本节中，我们将学习如何使用 seaborn 绘图库来控制绘图美学。 我们将学习如何安装 seaborn 并开始使用 seaborn，以及我们需要导入的模型。 我们将探索一些海洋绘图方法来绘制几种不同类型的绘图。 我们还将看到如何使用各种 seaborn 方法和属性来控制和更改绘图美观性。</p>
<p>在开始用 seaborn 创建绘图之前，我们需要先安装它。 在本书中，我们一直在使用 Anaconda 来安装各种 Python 库，因此我们将继续进行下去。 要安装 seaborn，请执行以下命令：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install seaborn复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>执行命令之前，请确保在管理员模式下运行命令行程序。 现在，我们需要导入本节所需的 Python 模块，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>我们需要导入 Pandas 的 Matplotlib 和 seaborn 模块。 我们正在使用 Matplotlib 的 inline magic 命令来确保我们的绘图连同代码一起正确显示在 Jupyter 笔记本中。</p>
<p>接下来，我们使用 pandas 和以下命令读取数据集：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'data-alcohol.csv'</span>)</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>我们的数据集是 CSV 文件。 它由各个国家的酒精消费数据组成。 <a href="https://github.com/fivethirtyeight/data/tree/master/alcohol-consumption" target="_blank" rel="noopener">该数据可通过这里获得</a>。</p>
<h1 id="我们的第一个-seaborn-绘图"><a href="#我们的第一个-seaborn-绘图" class="headerlink" title="我们的第一个 seaborn 绘图"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=我们的第一个-seaborn-绘图" target="_blank" rel="noopener">我们的第一个 seaborn 绘图</a></h1><p>在本节中，我们将仅使用一个变量来创建分布图，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.distplot(df.beer_servings)复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>在这里，<code>sns</code>指的是 seaborn，我们之前将其导入为<code>sns</code>。 现在我们需要将 seaborn 方法称为<code>distplot</code>，并从我们之前阅读的数据中传入列名。 如下面的屏幕快照所示，这应该可以使我们通过一行代码就能得到一个不错的分布图：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/b0d2ef7c-aee8-49ea-9796-a0a088d6674e.png" alt="img"></p>
<p>此单行显示了 seaborn 库的强大功能和简单性。</p>
<h1 id="使用set-style更改绘图样式"><a href="#使用set-style更改绘图样式" class="headerlink" title="使用set_style更改绘图样式"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=使用set_style更改绘图样式" target="_blank" rel="noopener">使用<code>set_style</code>更改绘图样式</a></h1><p>现在是时候让 Seaborn 改变绘图美学了。 在此过程中，我们还将探索许多不同的绘图类型，可以使用 seaborn 进行绘制。</p>
<h1 id="将绘图背景设置为白色网格"><a href="#将绘图背景设置为白色网格" class="headerlink" title="将绘图背景设置为白色网格"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=将绘图背景设置为白色网格" target="_blank" rel="noopener">将绘图背景设置为白色网格</a></h1><p>默认的打印样式是蓝色网格。 我们可以使用以下命令将其更改为<code>whitegrid</code>：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sns.set()</span><br><span class="line">sns.set_style(<span class="string">"whitegrid"</span>)</span><br><span class="line">sns.lmplot(x=<span class="string">'beer_servings'</span>, y=<span class="string">'wine_servings'</span>, data=df);复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>Seaborn 提供了一种称为<code>set_style</code>的方法，我们将其称为<code>whitegrid</code>作为参数。 然后，我们调用绘图方法来绘制散点图。 我们正在使用 seaborn 的<code>lmplot</code>方法。 然后，我们从数据集中传递两个列名称为<code>x</code>和<code>y</code>，并将 data 参数设置为我们的 Pandas 数据帧。 现在，我们应该有一个带有白色网格背景的散点图，如以下屏幕截图所示：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/2be5dce7-fead-49cb-8a24-3b4d67d0e26f.png" alt="img"></p>
<h1 id="将绘图背景设置为黑色"><a href="#将绘图背景设置为黑色" class="headerlink" title="将绘图背景设置为黑色"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=将绘图背景设置为黑色" target="_blank" rel="noopener">将绘图背景设置为黑色</a></h1><p>现在我们将研究如何将绘图背景设置为<code>dark</code>并且没有网格。 为此，我们使用以下命令将样式设置为<code>dark</code>：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sns.set()</span><br><span class="line">sns.set_style(<span class="string">"dark"</span>)</span><br><span class="line">sns.lmplot(x=<span class="string">'beer_servings'</span>, y=<span class="string">'wine_servings'</span>, data=df, fit_reg=<span class="literal">False</span>);复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>您可能已经注意到，我们在开始时还有另一行代码<code>sns.set()</code>。 通过调用此命令，我们在进行任何更改之前将绘图美感重置为默认值。 我们这样做是为了确保我们之前所做的更改不会影响我们的总体规划，如下所示：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/be86bd8c-0185-4aca-aecc-f8d634c11527.png" alt="img"></p>
<h1 id="将背景设置为白色"><a href="#将背景设置为白色" class="headerlink" title="将背景设置为白色"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=将背景设置为白色" target="_blank" rel="noopener">将背景设置为白色</a></h1><p>我们还可以使用以下代码将图的背景设置为实心<code>white</code>且没有网格。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sns.set()</span><br><span class="line">sns.set_style(<span class="string">"white"</span>)</span><br><span class="line">sns.swarmplot(x=<span class="string">'country'</span>, y=<span class="string">'wine_servings'</span>, data=df);复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/0e71d677-a461-4fed-9a30-e55a93f3040c.png" alt="img"></p>
<h1 id="添加刻度"><a href="#添加刻度" class="headerlink" title="添加刻度"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=添加刻度" target="_blank" rel="noopener">添加刻度</a></h1><p>我们可以通过将<code>style</code>设置为<code>ticks</code>来添加刻度线，如以下代码所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sns.set()</span><br><span class="line">sns.set_style(<span class="string">"ticks"</span>)</span><br><span class="line">sns.boxplot(data=df);复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>前面的代码应为我们提供以下输出：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/6e4bce65-cb38-4b77-983d-595408f9ce57.png" alt="img"></p>
<h1 id="自定义样式"><a href="#自定义样式" class="headerlink" title="自定义样式"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=自定义样式" target="_blank" rel="noopener">自定义样式</a></h1><p>在 seaborn 中，我们可以自定义预设样式，甚至比以前讨论的更多。 让我们向您展示我们可以做什么！</p>
<h1 id="样式参数"><a href="#样式参数" class="headerlink" title="样式参数"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=样式参数" target="_blank" rel="noopener">样式参数</a></h1><p>首先让我们看一下这些样式组成的所有参数。 我们可以通过在 seaborn 上调用<code>axes_style</code>方法来获取参数，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.axes_style()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>前面代码的输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/b3f25f42-b193-4150-960f-89706c491673.png" alt="img"></p>
<p>可以进一步自定义上述每个参数。 让我们尝试自定义其中之一，如以下代码片段所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sns.set()</span><br><span class="line">sns.set_style(<span class="string">"ticks"</span>, &#123;<span class="string">"axes.facecolor"</span>: <span class="string">".1"</span>&#125;)</span><br><span class="line">sns.boxplot(data=df);复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>在前面的代码中，我们将<code>style</code>设置为<code>ticks</code>，背景为纯白色，但是我们可以通过分别设置<code>facecolor</code>来进一步自定义。 对于前面的代码，我们将获得以下输出：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/2fb4ce29-9976-4776-a0cc-54fa85f0d18d.png" alt="img"></p>
<p>请注意，我们可以向此字典添加更多参数，然后继续自定义绘图。</p>
<h1 id="绘图的预定的上下文"><a href="#绘图的预定的上下文" class="headerlink" title="绘图的预定的上下文"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=绘图的预定的上下文" target="_blank" rel="noopener">绘图的预定的上下文</a></h1><p>Seaborn 还提供了一些预设样式上下文。 例如，到目前为止，我们一直在使用的默认样式上下文称为<code>notebook</code>。 但是，还有更多，包括一个叫做<code>paper</code>的。 使用称为<code>set_context</code>的方法设置此上下文，我们将<code>paper</code>作为参数传递，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sns.set()</span><br><span class="line">sns.set_context(<span class="string">"paper"</span>)</span><br><span class="line">sns.lmplot(x=<span class="string">'beer_servings'</span>, y=<span class="string">'wine_servings'</span>, data=df);复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>先前代码的输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/6300181e-ff24-41ef-b2c9-d37611f9b055.png" alt="img"></p>
<p>还有更多可用的上下文。 例如，称为<code>talk</code>的一个。 我们可以使用<code>talk</code>设置该上下文，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sns.set()</span><br><span class="line">sns.set_context(<span class="string">"talk"</span>)</span><br><span class="line">plt.figure(figsize=(<span class="number">8</span>, <span class="number">6</span>))</span><br><span class="line">sns.lmplot(x=<span class="string">'beer_servings'</span>, y=<span class="string">'wine_servings'</span>, data=df);复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>前面代码的输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/5221647e-fd80-4d8d-a585-9eefd791c824.png" alt="img"></p>
<p>我们可以使用的另一个上下文称为<code>poster</code>，它使用以下代码设置：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sns.set()</span><br><span class="line">sns.set_context(<span class="string">"poster"</span>)</span><br><span class="line">plt.figure(figsize=(<span class="number">8</span>, <span class="number">6</span>))</span><br><span class="line">sns.lmplot(x=<span class="string">'beer_servings'</span>, y=<span class="string">'wine_servings'</span>, data=df);复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/9d69bf21-08fc-49fd-a377-fd0d19f6afe4.png" alt="img"></p>
<h1 id="选择绘图的颜色"><a href="#选择绘图的颜色" class="headerlink" title="选择绘图的颜色"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=选择绘图的颜色" target="_blank" rel="noopener">选择绘图的颜色</a></h1><p>在本节中，我们将学习使用调色板自定义 seaborn 中的绘图颜色。 我们将探索 seaborn 和 Matplotlib 提供的一些调色板。 我们将学习如何通过设置不同的调色板来更改绘图的颜色，并且还将学习如何使用自定义颜色创建自己的调色板。</p>
<p>首先，使用以下代码导入 Jupyter 笔记本中所需的模块：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>我们需要导入 Pandas，Matplotlib 和 seaborn。 然后，我们需要读取 CSV 数据集； 我们使用<code>read_csv</code>方法执行此操作，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'data-alcohol.csv'</span>)</span><br><span class="line">df.head()</span><br><span class="line">复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>前面代码的输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/98b18755-a40a-43ca-9624-8ecde7786e22.png" alt="img"></p>
<p>现在我们需要使用 seaborn 来调用<code>color_palette</code>方法来获取当前的调色板，该调色板是默认设置的。 然后我们使用<code>palplot</code>方法显示这些颜色，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.palplot(sns.color_palette())复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>前面代码的输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/9d461c2b-6706-4a46-bfa7-a115da2b89e7.png" alt="img"></p>
<p>现在让我们看一下该调色板在绘图中的外观：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sns.set()</span><br><span class="line">sns.boxplot(data=df);复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>前面代码的输出应类似于以下屏幕截图：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/1dc4aba2-9a88-4b12-a479-5b51d0a3fccd.png" alt="img"></p>
<p>在这里，我们在数据集上绘制了箱形图。 您可能会注意到，配色方案看上去与我们在打印默认调色板时看到的相似。</p>
<h1 id="更改调色板"><a href="#更改调色板" class="headerlink" title="更改调色板"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=更改调色板" target="_blank" rel="noopener">更改调色板</a></h1><p>让我们继续并更改调色板，以了解它如何影响绘图的颜色。 以下代码将调色板设置为<code>bright</code>（seaborn 的预定义调色板之一）：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.set_palette(<span class="string">"bright"</span>)复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>让我们看看如何使用以下命令来改变绘图的颜色：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.boxplot(data=df);复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>现在，输出应类似于以下屏幕截图：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/4ff23533-1998-4789-b9c9-0a94efe7a80d.png" alt="img"></p>
<p>如您所见，由于我们设置了新的调色板，我们图的配色方案已经完全改变。<code>bright</code>不是 seaborn 中唯一的预定义调色板； 还有其他一些，包括<code>deep</code>，<code>muted</code>，<code>pastel</code>，<code>bright</code>，<code>dark</code>和<code>colorblind</code>，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sns.palplot(sns.color_palette(<span class="string">"deep"</span>, <span class="number">7</span>))</span><br><span class="line">sns.palplot(sns.color_palette(<span class="string">"muted"</span>, <span class="number">7</span>))</span><br><span class="line">sns.palplot(sns.color_palette(<span class="string">"pastel"</span>, <span class="number">7</span>))</span><br><span class="line">sns.palplot(sns.color_palette(<span class="string">"bright"</span>, <span class="number">7</span>))</span><br><span class="line">sns.palplot(sns.color_palette(<span class="string">"dark"</span>, <span class="number">7</span>))</span><br><span class="line">sns.palplot(sns.color_palette(<span class="string">"colorblind"</span>, <span class="number">7</span>))复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>每个调色板的输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/5270c402-8780-4e51-b734-008f68522c1e.png" alt="img"></p>
<p>Seaborn 还可以将 Matplotlib 的颜色图设置为调色板。 例如：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sns.palplot(sns.color_palette(<span class="string">"RdBu"</span>, <span class="number">7</span>))</span><br><span class="line">sns.palplot(sns.color_palette(<span class="string">"Blues_d"</span>, <span class="number">7</span>))复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>上一条命令的输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/29fe0163-bde3-4693-8b4b-aeaca56a2678.png" alt="img"></p>
<p>现在让我们使用 Matplotlib 颜色图之一作为调色板。 我们使用以下命令执行此操作：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.set_palette(<span class="string">"Blues_d"</span>)复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>在这里，我们将调色板设置为<code>Blues_d</code>，这是 Matplotlib 颜色图。 现在，让我们使用以下代码重绘图以查看其影响：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.boxplot(data=df);复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>前面命令的输出应类似于以下屏幕截图：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/7cc9c7ea-7c91-4ec4-9992-dbdc86dcc15d.png" alt="img"></p>
<p>如您所见，我们的绘图现在具有来自蓝色色图的调色板。</p>
<h1 id="建立自定义调色板"><a href="#建立自定义调色板" class="headerlink" title="建立自定义调色板"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=建立自定义调色板" target="_blank" rel="noopener">建立自定义调色板</a></h1><p>要构建自定义调色板，我们首先需要创建一个列表并为其分配所需的颜色，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">my_palette = [<span class="string">'#4B0082'</span>, <span class="string">'#0000FF'</span>, <span class="string">'#00FF00'</span>, <span class="string">'#FFFF00'</span>, <span class="string">'#FF7F00'</span>, </span><br><span class="line">  <span class="string">'#FF0000'</span>]</span><br><span class="line">sns.set_palette(my_palette)</span><br><span class="line">sns.palplot(sns.color_palette())复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/f9d916a8-d1c6-41a2-b2b2-2fca38e86f57.png" alt="img"></p>
<p>在前面的屏幕截图中，我们创建了一个名为<code>my_palette</code>的新调色板，具有七种颜色。 然后，我们将调色板设置为新创建的调色板，该调色板向我们展示颜色的外观。</p>
<p>让我们使用以下命令，通过新的自定义调色板查看绘图的外观：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.boxplot(data=df);复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>前面命令的输出应类似于以下屏幕截图：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/92e431d6-8ef1-4a05-9d70-66c442ca9b00.png" alt="img"></p>
<h1 id="绘制分类数据"><a href="#绘制分类数据" class="headerlink" title="绘制分类数据"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=绘制分类数据" target="_blank" rel="noopener">绘制分类数据</a></h1><p>在本节中，我们将了解 seaborn 支持的各种分类图以及如何绘制它们。 我们将演示如何绘制包括散点图，实线图，箱形图，条形图等的图。 我们还将学习如何绘制宽形的分类图。</p>
<p>让我们开始使用以下代码在 Jupyter 笔记本中导入我们的 pandas 模块：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>除了 Pandas，我们还需要导入 Matplotlib 和 Seaborn Python 库。 然后，我们读取 CSV 数据集，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'data_simpsons_episodes.csv'</span>)</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>本节中的数据集用于著名的动画电视连续剧《辛普森一家》：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/03f9d858-76e1-4341-826c-319fa7ffebe1.png" alt="img"></p>
<p>前面的数据集包含每个《辛普森一家》绘图的发行日期，收视率数字，评分以及其他观察结果的序列。</p>
<h1 id="散点图"><a href="#散点图" class="headerlink" title="散点图"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=散点图" target="_blank" rel="noopener">散点图</a></h1><p>让我们从绘制散点图开始； 我们使用以下命令执行此操作：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.stripplot(x=<span class="string">"season"</span>, y=<span class="string">"us_viewers_in_millions"</span>, data=df);复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出应如下所示：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/2674856c-cac5-4a03-a251-4a593d215195.png" alt="img"></p>
<p>在这里，我们使用了 Seaborn 的<code>stripplot</code>方法。 我们在 <em>x</em> 轴上绘制了季节编号，并在 <em>y</em> 轴上绘制了以百万计的美国观众。 我们还指定了使用的数据帧的名称。</p>
<h1 id="群图"><a href="#群图" class="headerlink" title="群图"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=群图" target="_blank" rel="noopener">群图</a></h1><p>现在让我们绘制<code>swarmplot</code>。 为此，我们使用 seaborn 的<code>swarmplot</code>方法：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.swarmplot(x=<span class="string">"season"</span>, y=<span class="string">"us_viewers_in_millions"</span>, data=df);复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/4a6c8120-148d-4896-b712-258e29deab1e.png" alt="img"></p>
<p>在这里，我们还通过了 <em>x</em> 轴上的季节编号，并在 <em>y</em> 轴上使用了数百万的观众。</p>
<h1 id="箱形图"><a href="#箱形图" class="headerlink" title="箱形图"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=箱形图" target="_blank" rel="noopener">箱形图</a></h1><p>现在，我们使用相同的数据并使用<code>boxplot</code>方法创建箱形图，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.boxplot(x=<span class="string">"season"</span>, y=<span class="string">"us_viewers_in_millions"</span>, data=df);复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>上一条命令的输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/184e947e-d097-4f38-bd17-ac28855b2b81.png" alt="img"></p>
<h1 id="提琴图"><a href="#提琴图" class="headerlink" title="提琴图"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=提琴图" target="_blank" rel="noopener">提琴图</a></h1><p>使用<code>violinplot()</code>方法创建小提琴图，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.violinplot(x=<span class="string">"season"</span>, y=<span class="string">"us_viewers_in_millions"</span>, data=df);复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>前面代码的输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/5f0100a2-ea47-491d-8af6-873fef4d1e3e.png" alt="img"></p>
<h1 id="条形图"><a href="#条形图" class="headerlink" title="条形图"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=条形图" target="_blank" rel="noopener">条形图</a></h1><p>要绘制条形图，我们使用以下<code>barplot</code>方法：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.barplot(x=<span class="string">"season"</span>, y=<span class="string">"us_viewers_in_millions"</span>, data=df);复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/f790e027-d61f-435d-8ad3-7128816cd263.png" alt="img"></p>
<p>请注意，还有另一种条形图可用，这些条形图是使用<code>countplot</code>方法绘制的，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.countplot(x=<span class="string">"season"</span>, data=df);复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>前面代码的输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/7ea2484a-7d1d-48c2-ac21-89d0fd6deda9.png" alt="img"></p>
<p>当您要显示每个类别中的观察次数而不是计算第二个变量的状态时，可以使用这种样式的图。</p>
<h1 id="宽形图"><a href="#宽形图" class="headerlink" title="宽形图"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=宽形图" target="_blank" rel="noopener">宽形图</a></h1><p>Seaborn 还支持宽格式的数据图。 让我们阅读以下数据集来演示一个：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'data-alcohol.csv'</span>)</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/37b39dd4-7b5e-4af1-b22c-894456c56974.png" alt="img"></p>
<p>我们可以使用以下命令创建宽形箱形图：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.boxplot(data=df, orient=<span class="string">"h"</span>);复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>前面代码的输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/994c67a1-d2e6-4d9b-98b1-d2c098e7b34d.png" alt="img"></p>
<p>在这里，我们通过传入数据集并将方向作为<code>h</code>来创建宽幅箱形图。</p>
<h1 id="使用数据感知网格进行绘图"><a href="#使用数据感知网格进行绘图" class="headerlink" title="使用数据感知网格进行绘图"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=使用数据感知网格进行绘图" target="_blank" rel="noopener">使用数据感知网格进行绘图</a></h1><p>在本节中，我们将学习在数据集的不同子集上绘制同一图的多个实例。 我们将学习使用 seaborn 的<code>FacetGrid</code>方法进行网格绘图。 我们还将探索 seaborn 的<code>PairGrid</code>和<code>PairPlot</code>方法进行网格绘图。</p>
<p>让我们从下面的代码在 Jupyter 笔记本中导入 Python 模块开始：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>现在，我们需要使用以下代码读取第一个 CSV 数据集：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'data-titanic.csv'</span>)</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>The output from the preceding command is as follows:</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/70f9e628-bf1d-40d4-9502-a4ae4a9e9915.png" alt="img"></p>
<h1 id="使用FacetGrid-方法进行绘图"><a href="#使用FacetGrid-方法进行绘图" class="headerlink" title="使用FacetGrid()方法进行绘图"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=使用facetgrid方法进行绘图" target="_blank" rel="noopener">使用<code>FacetGrid()</code>方法进行绘图</a></h1><p>让我们开始研究如何使用<code>FacetGrid</code>方法绘制多维图，如以下代码所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">g = sns.FacetGrid(df, col=<span class="string">"Sex"</span>, hue=<span class="string">'Survived'</span>)</span><br><span class="line">g.map(plt.hist, <span class="string">"Age"</span>);</span><br><span class="line">g.add_legend();复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>前面代码的输出应类似于以下屏幕截图：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/d8dd3a1e-bc48-44b1-bbd7-749484b4852e.png" alt="img"></p>
<p>在这里，我们已经使用<code>FacetGrid</code>方法绘制了男性和女性乘客的两个并排直方图。 这种并排显示有助于我们比较按年龄划分的男女乘客的存活率。 为了进行绘制，我们首先使用<code>FacetGrid</code>方法创建了一个网格。 然后，我们将数据集的数据帧列传递为<code>Sex</code>，将<code>hue</code>传递为<code>Survived</code>。 <strong>色相</strong>代表绘图的深度。 然后，这创建了带有两个分别用于男性和女性乘客的绘图的网格。 然后我们在网格上调用<code>map</code>方法并传递了<code>plt.hist</code>和<code>Age</code>参数，它们绘制了我们的两个直方图。 最后，我们使用<code>add_legend</code>方法添加了图例。</p>
<h1 id="使用PairGrid-方法进行绘图"><a href="#使用PairGrid-方法进行绘图" class="headerlink" title="使用PairGrid()方法进行绘图"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=使用pairgrid方法进行绘图" target="_blank" rel="noopener">使用<code>PairGrid()</code>方法进行绘图</a></h1><p>现在让我们看看如何使用<code>PairGrid</code>方法绘制可识别网格的图。 我们正在为此使用 MLB 球员数据集，如以下代码所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mlb = pd.read_csv(<span class="string">'data-mlb-players.csv'</span>)</span><br><span class="line">mlb.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/ff10718c-542e-4f2b-9365-0441ab9e9775.png" alt="img"></p>
<p>(Source: <a href="http://wiki.stat.ucla.edu/socr/index.php/SOCR_Data_MLB_HeightsWeights" target="_blank" rel="noopener">http://wiki.stat.ucla.edu/socr/index.php/SOCR_Data_MLB_HeightsWeights</a>)</p>
<p>让我们用以下代码创建一个图：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">g = sns.PairGrid(mlb, vars=[<span class="string">"Height"</span>, <span class="string">"Weight"</span>], hue=<span class="string">"Position"</span>)</span><br><span class="line">g.map(plt.scatter);</span><br><span class="line">g.add_legend();复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>在这里，我们已经传递了 MLB 球员的数据集，并将<code>vars</code>设置为包含球员的<code>Height</code>和<code>Weight</code>的列表。 然后我们将<code>hue</code>设置为<code>Position</code>。 然后我们在此网格上使用<code>scatterplot</code>方法调用<code>map</code>。 最后，我们添加了图例，该图例提供了一个<code>2 x 2</code>网格，其中包括身高和体重曲线的所有组合，如以下屏幕截图所示：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/71249b13-c74e-429e-b3a2-1e6e08dbbfeb.png" alt="img"></p>
<p>这些位置的深度由玩家位置列提供。</p>
<h1 id="使用PairPlot-方法进行绘图"><a href="#使用PairPlot-方法进行绘图" class="headerlink" title="使用PairPlot()方法进行绘图"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=使用pairplot方法进行绘图" target="_blank" rel="noopener">使用<code>PairPlot()</code>方法进行绘图</a></h1><p>通过传递数据集可以直接调用<code>PairPlot</code>，如下所示。 深度由<code>hue</code>和<code>size</code>参数组成：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.pairplot(mlb, hue=<span class="string">"Position"</span>, size=<span class="number">2.5</span>);复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>前面的命令为我们提供了<code>3 x 3</code>网格中的多图。 这是因为我们对每个位置都有三个观察值或列，如以下屏幕截图所示：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/8a95ca98-79fa-4bc7-a54a-0f00a453ab12.png" alt="img"></p>
<p>当前观察到的是<code>Height</code>，<code>Weight</code>和<code>Age</code>。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4?id=总结" target="_blank" rel="noopener">总结</a></h1><p>在本章中，我们了解了使用 Seaborn 的数据可视化库进行数据可视化的高级技术。 我们学习了如何开始 seaborn，然后探索了其中的一些功能，包括如何控制绘图的美感，如何选择绘图的颜色等等。 我们学习了如何绘制几种不同类型的图，以及如何使用 seaborn 绘制分类数据。 最后，我们学习了如何使用数据感知网格来创建图。</p>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2020/12/29/精通Pandas探索性分析（三）：处理，转换和重塑数据/" itemprop="url">精通Pandas探索性分析（三）：处理，转换和重塑数据</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2020-12-29T14:43:17.000Z" itemprop="datePublished">1 天前</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Technology/">Technology</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            1 小时 读完 (约 8280 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>在本章中，我们将学习以下主题：</p>
<ul>
<li>使用<code>inplace</code>参数修改 Pandas 数据帧</li>
<li>使用<code>groupby</code>方法的场景</li>
<li>如何处理 Pandas 中的缺失值</li>
<li>探索 Pandas 数据帧中的索引</li>
<li>重命名和删除 Pandas 数据帧中的列</li>
<li>处理和转换日期和时间数据</li>
<li>处理<code>SettingWithCopyWarning</code></li>
<li>将函数应用于 Pandas 序列或数据帧</li>
<li>将多个数据帧合并并连接成一个</li>
</ul>
<h1 id="使用-inplace-参数修改-Pandas-数据帧"><a href="#使用-inplace-参数修改-Pandas-数据帧" class="headerlink" title="使用 inplace 参数修改 Pandas 数据帧"></a>使用 inplace 参数修改 Pandas 数据帧</h1><p>在本节中，我们将学习如何使用<code>inplace</code>参数修改数据帧。 我们首先将一个真实的数据集读入 Pandas。 然后我们将介绍 pandas 的<code>inplace</code>参数，并查看它如何影响方法的执行最终结果。 我们还将执行带有和不带有<code>inplace</code>参数的方法，以演示<code>inplace</code>的效果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">top_movies = pd.read_table(<span class="string">'data-movies-top-grossing.csv'</span>, sep=<span class="string">','</span>)</span><br></pre></td></tr></table></figure>
<p>由于它是 CSV 文件，因此我们正在使用 Pandas 的<code>read_csv</code>函数。 现在我们已经将数据集读入了数据帧中，让我们看一些记录：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top_movies</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/2b57a793-76e7-4bb3-8722-99ee9379fc20.png" alt="img"></p>
<p>我们正在使用的数据来自维基百科； 这是迄今为止全球顶级电影的交叉附件数据。 大多数 Pandas 数据帧方法都返回一个新的数据帧。 但是，您可能想使用一种方法来修改原始数据帧本身。 这是<code>inplace</code>参数有用的地方。 让我们在不带<code>inplace</code>参数的数据帧上调用方法以查看其在代码中的工作方式：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top_movies.set_index(<span class="string">'Rank'</span>).head()</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/2250367b-1ad4-45f4-8dca-c0412ea2c22e.png" alt="img"></p>
<p>在这里，我们将其中一列设置为数据帧的索引。 我们可以看到索引已在内存中设置。 现在，让我们检查一下它是否已修改原始数据帧：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top_movies.head()</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/3f43c24f-abbc-43df-bad9-437bfc5c1758.png" alt="img"></p>
<p>我们可以看到在原始数据帧中没有任何变化。<code>set_index</code>方法仅在内存中全新的数据帧中创建了更改，我们可以将其保存在新的数据帧中。 现在让我们看看如果传递<code>inplace</code>参数，它将如何工作：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top_movies.set_index(<span class="string">'Rank'</span>, inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>我们将<code>inplace=True</code>传递给该方法。 现在让我们检查原始的数据帧：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top_movies.head()</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/71e7b6bd-5548-49ac-9737-07003f8af8e6.png" alt="img"></p>
<p>我们可以看到传递<code>inplace=True</code>确实修改了原始数据帧。 并非所有方法都需要使用<code>inplace</code>参数来修改原始数据帧。 例如，<code>rename(columns)</code>方法修改原始的数据帧，而不需要<code>inplace</code>参数：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top_movies.rename(columns = &#123;<span class="string">'Year'</span>: <span class="string">'Release Year'</span>&#125;).head()</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/efb5daf0-637e-491f-a173-53603813802c.png" alt="img"></p>
<p>熟悉哪些方法需要<code>inplace</code>，哪些不需要<code>inplace</code>，这是一个好主意。 在本节中，我们学习了如何使用<code>inplace</code>参数修改数据帧。 我们介绍了 Pandas <code>inplace</code>参数，以及它如何影响方法的执行最终结果。 我们探讨了带有<code>inplace</code>参数和不带有<code>inplace</code>参数的方法的执行情况，以证明结果的差异。 在下一节中，我们将学习如何使用<code>groupby</code>方法。</p>
<h1 id="使用groupby方法"><a href="#使用groupby方法" class="headerlink" title="使用groupby方法"></a>使用<code>groupby</code>方法</h1><p>在本节中，我们将学习如何使用<code>groupby</code>方法将数据拆分和聚合为组。 我们将通过分成几部分来探讨<code>groupby</code>方法的工作方式。 我们将用统计方法和其他方法演示<code>groupby</code>。 我们还将学习<code>groupby</code>方法迭代组数据的能力如何做有趣的事情。</p>
<p>我们将像上一节中一样将<code>pandas</code>模块导入 Jupyter 笔记本中：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br></pre></td></tr></table></figure>
<p>然后，我们将读取 CSV 数据集：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data = pd.read_table(<span class="string">'data-zillow.csv'</span>, sep=<span class="string">','</span>)</span><br><span class="line">data.head()</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/daa11ec1-af5d-4dc8-aca7-5a6d1a9b2277.png" alt="img"></p>
<p>让我们先问一个问题，看看 Pandas 的<code>groupby</code>方法是否可以帮助我们获得答案。 我们想要获取每个<code>State</code>的平均值<code>Price</code>值：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grouped_data = data[[<span class="string">'State'</span>, <span class="string">'Price'</span>]].groupby(<span class="string">'State'</span>).mean()</span><br><span class="line">grouped_data.head()</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/3b48a2f4-2580-49f1-9803-f5cd2ddfb04f.png" alt="img"></p>
<p>在这里，我们使用<code>groupby</code>方法按状态汇总数据，并获得每个<code>State</code>的平均值<code>Price</code>。 在后台，<code>groupby</code>方法将数据分成几组，然后我们然后将函数应用于拆分后的数据，然后将结果放在一起并显示出来。</p>
<p>让我们将这段代码分成几部分，看看它是如何发生的。 首先，按以下步骤进行分组：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grouped_data = data[[<span class="string">'State'</span>, <span class="string">'Price'</span>]].groupby(<span class="string">'State'</span>)</span><br></pre></td></tr></table></figure>
<p>我们选择了仅具有<code>State</code>和<code>Price</code>列的数据子集。 然后，我们对该数据调用<code>groupby</code>方法，并将其传递到<code>State</code>列中，因为这是我们希望对数据进行分组的列。 然后，我们将数据存储在一个对象中。 让我们使用<code>list</code>方法打印出这些数据：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list(grouped_data)</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/e32fc39c-048e-4d07-a3d5-fbb768d98908.png" alt="img"></p>
<p>我们还可以遍历拆分组，并对其进行有趣的操作，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> state, grouped_data <span class="keyword">in</span> data.groupby(<span class="string">'State'</span>):</span><br><span class="line">    print(state, <span class="string">'\n'</span>, grouped_data)</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/9910d97f-112b-4cad-b88c-2fbba51637e2.png" alt="img"></p>
<p>在这里，我们通过<code>State</code>迭代组数据，并以<code>State</code>作为标题发布结果，然后是该<code>State</code>的所有记录的表。</p>
<p>在本节中，我们学习了如何使用<code>groupby</code>方法将数据拆分和聚合为组。 我们将<code>groupby</code>方法分解为多个部分，以探讨其工作方式。 我们用统计方法和其他方法演示了<code>groupby</code>，并且还通过遍历组数据学习了如何通过<code>groupby</code>做有趣的事情。 在下一节中，我们将学习如何使用 Pandas 处理数据中的缺失值。</p>
<h1 id="处理-Pandas-中的缺失值"><a href="#处理-Pandas-中的缺失值" class="headerlink" title="处理 Pandas 中的缺失值"></a>处理 Pandas 中的缺失值</h1><p>在本节中，我们将探索如何使用各种 Pandas 技术来处理数据集中的缺失数据。 我们将学习如何找出缺少的数据以及从哪些列中找出数据。 我们将看到如何删除所有或大量记录丢失数据的行或列。 我们还将学习如何（而不是删除数据）如何用零或剩余值的平均值填充丢失的记录。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">data = pd.read_csv(<span class="string">'data-titanic.csv'</span>)</span><br><span class="line">data.head()</span><br><span class="line">data.shape</span><br><span class="line">data.count()<span class="comment">#每一列中的记录数</span></span><br></pre></td></tr></table></figure>
<p>总记录与每列计数之间的差表示该列中缺少的记录数。 在<code>12</code>列中，我们有 3 列缺少值。 例如，<code>Age</code>的<code>891</code>行总数中只有<code>714</code>值；<code>Cabin</code>仅具有<code>204</code>记录的值；<code>Embarked</code>具有<code>889</code>记录的值。 我们可以使用不同的方法来处理这些缺失的值。 一种方法是删除缺少值的任何行，即使是单列也是如此，如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data_missing_dropped = data.dropna()<span class="comment">#删除只要有空值的行</span></span><br><span class="line">data_missing_dropped.shape</span><br></pre></td></tr></table></figure>
<p>当运行此放置行方法时，我们将结果分配回新的数据帧中。 在<code>891.</code>总数中，仅剩下<code>183</code>记录，但是，这可能会导致丢失大量数据，并且可能无法接受。</p>
<p>另一种方法是只删除那些缺少所有值的行。 这是一个例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data_all_missing_dropped = data.dropna(how=<span class="string">"all"</span>)<span class="comment">#删除所有行为空的行</span></span><br><span class="line">data_all_missing_dropped.shape</span><br></pre></td></tr></table></figure>
<p>为此，我们将<code>dropna</code>方法的<code>how</code>参数设置为<code>all</code>。</p>
<p>代替删除行，另一种方法是用一些数据填充缺少的值。 例如，我们可以使用<code>0</code>填写缺失值，如以下屏幕截图所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data_filled_zeros = data.fillna(<span class="number">0</span>)</span><br><span class="line">data_filled_zeros.count()</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/2a5371d6-9d72-42b0-a39c-07f5598f5416.png" alt="img"></p>
<p>在这里，我们使用 pandas 的<code>fillna</code>方法，并将<code>0</code>的数值传递到应填充数据的列。您可以看到，现在我们已经用<code>0</code>填充了所有缺少的值，并且因此，所有列的计数已增加到数据集中记录总数。</p>
<p>另外，除了用<code>0</code>填充缺失值外，我们还可以用剩余的现有值的平均值填充它们。 为此，我们在要填充值的列上调用<code>fillna</code>方法，然后将列的平均值作为参数传递：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data_filled_in_mean = data.copy()</span><br><span class="line">data_filled_in_mean.Age.fillna(data.Age.mean(), inplace=<span class="literal">True</span>) data_filled_in_mean.count()</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/1cca3e52-b596-42bf-b62c-7890457146f6.png" alt="img"></p>
<p>例如，在这里，我们用现有值的平均值填充<code>Age</code>的缺失值。</p>
<p>在本节中，我们探讨了如何使用各种 Pandas 技术来处理数据集中的缺失数据。 我们学习了如何找出丢失的数据量以及从哪几列中查找。 我们看到了如何删除所有或很多记录丢失数据的行或列。 我们还看到了如何代替删除，也可以用<code>0</code>或剩余值的平均值来填写缺失的记录。 在下一节中，我们将学习如何在 Pandas 数据帧中进行数据集索引。</p>
<h1 id="在-Pandas-数据帧中建立索引"><a href="#在-Pandas-数据帧中建立索引" class="headerlink" title="在 Pandas 数据帧中建立索引"></a>在 Pandas 数据帧中建立索引</h1><p>在本节中，我们将探讨如何设置索引并将其用于 Pandas 中的数据分析。 我们将学习如何在读取数据后以及读取数据时在<code>DataFrame</code>上设置索引。 我们还将看到如何使用该索引进行数据选择。</p>
<p>与往常一样，我们首先将<code>pandas</code>模块导入 Jupyter 笔记本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br></pre></td></tr></table></figure>
<p>然后，我们读取数据集：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data = pd.read_csv(<span class="string">'data-titanic.csv'</span>)</span><br></pre></td></tr></table></figure>
<p>以下是我们的默认索引现在的样子，它是一个从<code>0</code>开始的数字索引：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.head()</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/7d027993-f97d-416e-8622-379b53312ea5.png" alt="img"></p>
<p>让我们将其设置为我们选择的列。 在这里，我们使用<code>set_index</code>方法根据我们的数据将索引设置为乘客的姓名：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.set_index(<span class="string">'Name'</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/968d10dc-3dca-49ae-bac1-c15bc0f4250f.png" alt="img"></p>
<p>如您所见，索引已从<code>0</code>的简单数值更改为数据集中乘客的姓名。</p>
<p>接下来，我们将看到在读取数据时如何设置索引。 为此，我们将一个额外的参数<code>index_col</code>传递给<code>read</code>方法：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data = pd.read_table(<span class="string">'data-titanic.csv'</span>, sep=<span class="string">','</span>, index_col=<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/bcba9d47-28a9-4d40-b9f8-15bfd8913ebe.png" alt="img"></p>
<p><code>index_col</code>参数采用单个数字值或值的序列。 在这里，我们传递<code>Name</code>列的索引。</p>
<p>接下来，让我们看看如何使用索引进行数据选择。 在以下屏幕截图中，我们在数据帧上调用<code>loc</code>方法，并传入我们要选择的记录的索引级别：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dta.loc[<span class="string">'Braund, Mr.Owen Harris'</span>,:]</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/fd5a5afa-b8d4-4943-a8a2-e9264f74ab55.png" alt="img"></p>
<p>在这种情况下，它是数据集中一位乘客的名字。 之所以可以这样做，是因为我们先前将名称设置为数据集的索引。</p>
<p>最后，我们可以将索引重置为更改之前的值。 我们为此使用<code>reset_index</code>方法：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.reset_index(inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>我们正在传递<code>inplace=True</code>，因为我们想在原始数据帧本身中将其重置。</p>
<p>在本节中，我们探讨了如何设置索引并将其用于 Pandas 中的数据分析。 我们还学习了在读取数据后如何在数据帧上设置索引。 我们还看到了如何在从 CSV 文件读取数据时设置索引。 最后，我们看到了一些使我们可以使用索引进行数据选择的方法。 在下一节中，我们将学习如何重命名 Pandas 数据帧中的列。</p>
<h1 id="重命名-Pandas-数据帧中的列"><a href="#重命名-Pandas-数据帧中的列" class="headerlink" title="重命名 Pandas 数据帧中的列"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/3?id=重命名-pandas-数据帧中的列" target="_blank" rel="noopener">重命名 Pandas 数据帧中的列</a></h1><p>在本节中，我们将学习在 Pandas 中重命名列标签的各种方法。 我们将学习如何在读取数据后和读取数据时重命名列，并且还将看到如何重命名所有列或特定列。 首先，将<code>pandas</code>模块导入 Jupyter 笔记本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br></pre></td></tr></table></figure>
<p>我们可以通过几种方法来重命名 Pandas 数据帧中的列。 一种方法是在从数据集中读取数据时重命名列。 为此，我们需要将列名作为列表传递给<code>read_csv</code>方法的<code>names</code>参数：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">list_columns= [<span class="string">'Date'</span>, <span class="string">'Region ID'</span>, Region Name<span class="string">', '</span>State<span class="string">', '</span>City<span class="string">', '</span>County<span class="string">', '</span>Size Rank<span class="string">', '</span>Price<span class="string">']</span></span><br><span class="line"><span class="string">data = pd.read_csv('</span>data-zillow.csv<span class="string">', names = list_columns)</span></span><br><span class="line"><span class="string">data.head()</span></span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/7bf99171-513b-44da-b65c-285f46dc494a.png" alt="img"></p>
<p>在前面的示例中，我们首先创建了所需列名称的列表； 此数字应与实际数据集中的列数相同。 然后，将列表传递给<code>read_csv</code>方法中的<code>names</code>参数。 然后，我们看到我们拥有所需的列名，因此<code>read_csv</code>方法已将列名从默认情况下的文本文件更改为我们提供的名称。</p>
<p>读取数据后，我们还可以重命名列名称。 让我们再次从 CSV 文件中读取数据集，但是这次不提供任何列名。 我们可以使用<code>rename</code>方法重命名列。 让我们首先看一下数据集中的列：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.columns</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/dc94d700-3bad-474a-8854-c18c41b9e5bf.png" alt="img"></p>
<p>现在，我们在数据帧上调用<code>rename</code>方法，并将列名（旧值和新值）传递给<code>columns</code>参数：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.rename(columns=&#123;<span class="string">'RegionName'</span>:<span class="string">'Region'</span>, <span class="string">'Metro'</span>:<span class="string">'City'</span>&#125;, inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>在前面的代码块中，我们仅更改了一些列名，而不是全部。 让我们再次调用<code>columns</code>属性，以查看是否确实更改了列名 ， ：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.columns</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/d44bbd71-03ce-466a-86aa-48cd8c2db99c.png" alt="img"></p>
<p>现在，我们在数据集中有了新的列名。</p>
<p>读取数据后，我们还可以重命名所有列，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.columns = [<span class="string">'Date'</span>, <span class="string">'Region ID'</span>, <span class="string">'Region Name'</span>, <span class="string">'State'</span>, <span class="string">'City'</span>, <span class="string">'County'</span>, <span class="string">'Size Rank'</span>,<span class="string">'Price'</span>]</span><br></pre></td></tr></table></figure>
<p>我们已经将<code>columns</code>属性设置为一个名称列表，我们希望将所有列都重命名为该名称。</p>
<p>在本节中，我们了解了重命名 Pandas 中列级别的各种方法。 我们学习了在读取数据后如何重命名列，并学习了在从 CSV 文件读取数据时如何重命名列。 我们还看到了如何重命名所有列或特定列。</p>
<h1 id="从-Pandas-数据帧中删除列"><a href="#从-Pandas-数据帧中删除列" class="headerlink" title="从 Pandas 数据帧中删除列"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/3?id=从-pandas-数据帧中删除列" target="_blank" rel="noopener">从 Pandas 数据帧中删除列</a></h1><p>在本节中，我们将研究如何从 Pandas 的数据集中删除列或行。 我们将详细了解<code>drop()</code>方法及其参数的功能。</p>
<p>首先，我们首先将<code>pandas</code>模块导入 Jupyter 笔记本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br></pre></td></tr></table></figure>
<p>之后，我们使用以下代码读取 CSV 数据集：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data = pd.read_csv(<span class="string">'data-titanic.csv'</span>, index_col=<span class="number">3</span>)</span><br><span class="line">data.head()</span><br></pre></td></tr></table></figure>
<p>数据集应类似于以下内容：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/b94fa784-3caf-4a62-9513-afd0af6c9d69.png" alt="img"></p>
<p>要从我们的数据集中删除单个列，请使用 pandas <code>drop()</code>方法。<code>drop()</code>方法由两个参数组成。 第一个参数是需要删除的列的名称； 第二个参数是<code>axis</code>。 此参数告诉<code>drop</code>方法是否应该删除行或列，并将<code>inplace</code>设置为<code>True</code>，这告诉该方法将其从原始数据帧本身删除。</p>
<p>在此示例中，我们考虑删除<code>Ticket</code>或列。 的代码如下：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.drop(<span class="string">'Ticket'</span>, axis=<span class="number">1</span>, inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>执行此操作后，我们的数据集应类似于以下内容：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.head()</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/357347cb-1dd3-47b1-8bc5-a7cb7c741f89.png" alt="img"></p>
<p>如果我们仔细观察，很明显<code>Ticket</code>列已从我们的数据集中删除或删除。</p>
<p>要删除多个列，我们将需要删除的列作为列表传递给<code>drop()</code>方法。<code>drop()</code>方法的所有其他参数将保持不变。</p>
<p>让我们看一个如何使用<code>drop()</code>方法消除行的示例。</p>
<p>在此示例中，我们将删除多行。 因此，与其传递列名，不如传递一个列表形式的行索引标签。 以下代码将用于执行此操作：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data.drop([<span class="string">'Parch'</span>, <span class="string">'Fare'</span>], axis=<span class="number">1</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">data.head()</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/6ae81b44-5a53-478c-849f-7e14f851f251.png" alt="img"></p>
<p>结果，传递给<code>drop()</code>方法的对应于乘客姓名的两行将从数据集中删除。</p>
<p>现在，我们将继续仔细研究如何处理日期和时间数据。</p>
<h1 id="处理日期和时间序列数据"><a href="#处理日期和时间序列数据" class="headerlink" title="处理日期和时间序列数据"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/3?id=处理日期和时间序列数据" target="_blank" rel="noopener">处理日期和时间序列数据</a></h1><p>在本节中，我们将仔细研究如何处理 Pandas 中的日期和时间序列数据。 我们还将看到如何：</p>
<ul>
<li>将字符串转换为<code>datetime</code>类型，以进行高级<code>datetime</code>序列操作</li>
<li>选择并过滤<code>datetime</code>序列数据</li>
<li>探索序列数据的属性</li>
</ul>
<p>我们首先将<code>pandas</code>模块导入到我们的 Jupyter 笔记本中：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br></pre></td></tr></table></figure>
<p>对于此示例，让我们创建自己的数据帧数据集。 我们可以使用以下代码来做到这一点：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dataset = pd.DataFrame(&#123;<span class="string">'DOB'</span>: [<span class="string">'1976-06-01'</span>, <span class="string">'1980-09-23'</span>, <span class="string">'1984-03-30'</span>, <span class="string">'1991-12-31'</span>, <span class="string">'1994-10-2'</span>, <span class="string">'1973-11-11'</span>], </span><br><span class="line">                        <span class="string">'Sex'</span>: [<span class="string">'F'</span>, <span class="string">'M'</span>, <span class="string">'F'</span>, <span class="string">'M'</span>, <span class="string">'M'</span>, <span class="string">'F'</span>], </span><br><span class="line">                        <span class="string">'State'</span>: [<span class="string">'CA'</span>, <span class="string">'NY'</span>, <span class="string">'OH'</span>, <span class="string">'OR'</span>, <span class="string">'TX'</span>, <span class="string">'CA'</span>], </span><br><span class="line">                        <span class="string">'Name'</span>: [<span class="string">'Jane'</span>, <span class="string">'John'</span>, <span class="string">'Cathy'</span>, <span class="string">'Jo'</span>, <span class="string">'Sam'</span>, <span class="string">'Tai'</span>]&#125;))</span><br></pre></td></tr></table></figure>
<p>该数据集包含对应于五个虚构人物的四列和五行。 我们的数据集中存在的行之一是<code>DOB</code>，其中包含五个人的出生日期。</p>
<p>必须检查，，，，<code>DOB</code>，， 列中的数据是否正确。 为此，我们使用以下代码：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataset.dtypes</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/073f703e-6f64-4164-9a92-802429388ac8.png" alt="img"></p>
<p>从输出中可以看出，在创建过程中<code>DOB</code>列可能设置为<code>object</code>或<code>string</code>数据类型。 要将其更改为<code>datetime</code>数据类型，我们使用<code>to_datetime()</code>方法并将<code>DOB</code>列传递给它，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataset.DOB = pd.to_datetime(dataset.DOB)</span><br></pre></td></tr></table></figure>
<p>再次，我们可以使用以下代码来验证是否已将<code>DOB</code>设置为<code>datetime</code>数据类型：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataset.dtypes</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/7b086aac-88af-4f96-8b99-4859ed2360ac.png" alt="img"></p>
<p>在继续选择和过滤<code>datetime</code>序列之前，我们需要确保为<code>DOB</code>列设置了索引。 为此，我们使用以下代码：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataset.set_index(<span class="string">'DOB'</span>, inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>之后，我们的<code>DOB</code>列已准备好进行探索。 如果要查看数据集，可以使用代码字<code>dataset</code>如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataset</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/d977b14b-0c26-4f86-a117-d83fb064a619.png" alt="img"></p>
<p>在开始过滤之前，我们需要了解有四种可能的方法可以过滤<code>DOB</code>列中的数据。 它们如下：</p>
<ul>
<li><strong>一年的记录</strong>：要显示一年的记录，我们使用以下代码：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataset[<span class="string">'1980'</span>]</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/c26af422-8f77-4a73-b433-394939ce560d.png" alt="img"></p>
<p>此代码表示将显示当年<code>1980</code>存在的所有记录。 Pandas 不需要我们提及整个日期，因为即使是日期的一部分也会帮助我们产生结果。</p>
<ul>
<li><strong>特定年份和之后的记录</strong>：要显示特定年份和之后的所有记录，我们使用以下代码：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataset[<span class="string">'1980'</span>:]</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/f19cecbe-02c6-4392-8544-f0c54f2e645f.png" alt="img"></p>
<ul>
<li><strong>直到特定年份的记录</strong>：要显示直到特定年份（包括该年份）的所有记录，我们需要使用以下代码：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataset[<span class="string">':1980'</span>]</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/98d4869b-c510-4549-a96f-10726c3c0056.png" alt="img"></p>
<ul>
<li><strong>几年范围内的记录</strong>：要显示给定年份范围内的记录，我们可以使用以下代码：</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataset[<span class="string">'1980'</span>:<span class="string">'1984'</span>]</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/b091769a-0f76-43e2-a739-4db062f757d6.png" alt="img"></p>
<p>我们还可以使用时间序列属性来最有效地利用<code>datetime</code>序列数据。 使用此功能的缺点是<code>datetime</code>字段必须是列，而不是行。</p>
<p>这可以通过将<code>DOB</code>重置为索引来完成。 这样做如下：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataset.reset_index(inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>我们还需要为<code>datetime</code>列中的每个值获取一年中的相应日期。 可以通过调用<code>dayofyear</code>属性来完成此操作，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataset.DOB.dt.dayofyear</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/44031484-6432-40ed-8db2-c9921e7c7f67.png" alt="img"></p>
<p>我们还可以通过调用<code>weekday_name</code>属性来显示星期几，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataset.DOB.dt.weekday_name</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/5f7bc3d4-27ab-44ea-9a41-7151729f87c6.png" alt="img"></p>
<p>这些是<code>datetime</code>序列数据的方法和属性的一些示例。 在 Pandas 的参考文档中可以找到更多内容，网址为。</p>
<h1 id="处理SettingWithCopyWarning"><a href="#处理SettingWithCopyWarning" class="headerlink" title="处理SettingWithCopyWarning"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/3?id=处理settingwithcopywarning" target="_blank" rel="noopener">处理<code>SettingWithCopyWarning</code></a></h1><p>在本节中，我们将学习<code>SettingWithCopyWarning</code>警告以及解决方法。</p>
<p>我们还将看一下可能遇到<code>SettingWithCopyWarning</code>的一些情况，以便我们了解如何摆脱它。</p>
<p>Pandas 的狂热用户肯定会遇到<code>SettingWithCopyWarning</code>。 各种网站，例如 Stack Overflow 和其他论坛，都充斥着有关处理此警告的查询。 它看起来像以下内容：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/99c1872a-2a06-4e79-a76d-456171b7396f.png" alt="img"></p>
<p>要了解如何摆脱它，我们需要了解<code>SettingWithCopyWarning</code>实际代表什么。</p>
<p>我们都知道，Pandas 中的不同数据操作会返回数据视图或副本。 修改数据时，这可能会引起问题。<code>SettingWithCopyWarning</code>的目的是警告我们，当我们想修改副本时，我们可能正在尝试修改原始数据，反之亦然。 这种情况通常在链接分配期间发生。</p>
<p>解决方案是使用<code>block</code>方法将患者链合并为一个手术。 这可以帮助 Pandas 知道必须修改哪个数据帧。</p>
<p>为了更好地理解这一点，让我们看下面的示例。</p>
<p>与往常一样，我们首先将<code>pandas</code>模块导入到 Jupyter 笔记本中，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br></pre></td></tr></table></figure>
<p>然后，我们读取 CSV 数据集：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data = pd.read_csv(<span class="string">'data-titanic.csv'</span>)</span><br><span class="line">data.head()</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/d34ecd82-06cf-446d-8c30-668e0f7a85c3.png" alt="img"></p>
<p>此后，我们继续创建一个可能遇到<code>SettingWithCopyWarning</code>的场景。 对于此示例，我们选择<code>Age</code>列为空的记录，并将它们设置为等于<code>Age</code>列中值的平均值。 以下是生成的错误：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data[data.Age.isnull()].Age = data.Age.mean()</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/c41fb03e-5e39-42bb-916d-c404bc71c93b.png" alt="img"></p>
<p>为了确认我们的代码不起作用，我们需要检查是否还有<code>Age</code>为空的记录。 这是通过使用以下代码完成的：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data[data.Age.isnull()].Age.head()</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/fec17d8d-d5b8-45b7-aad8-5eabae2ad04f.png" alt="img"></p>
<p>很明显，存在这样的记录。 为了处理这种情况，我们使用<code>loc</code>方法，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.loc[data.Age.isnull(), <span class="string">'Age'</span>] = data.Age.mean</span><br></pre></td></tr></table></figure>
<p>此时，我们需要返回以确认该方法是否已解决<code>SettingWithCopyWarning</code>，我们通过使用以下代码行来完成此操作：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data[data.Age.isnull()]</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/ecee02f7-d9d7-4a75-a907-34e25836c8c9.png" alt="img"></p>
<p>我们可以看到，问题尚未解决，因此处理警告的另一种方法是将其关闭。 我们需要记住，我们能够并且应该将其关闭的唯一原因是因为它是警告，而不是错误。 为此，我们将<code>mode.chained_assignment</code>选项设置为<code>None</code>：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.set_option(<span class="string">'mode.chained_assignment'</span>, <span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<p>不建议使用此解决方案，因为这可能会影响我们的运营结果。 解决此警告的另一种方法是使用<code>is_copy</code>方法。 在这里，我们创建数据帧的新副本并将<code>is_copy</code>设置为<code>None</code>，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data1 = data.loc[data.Age.isnull()]</span><br><span class="line">data1.is_copy = <span class="literal">None</span></span><br></pre></td></tr></table></figure>
<p>现在让我们看一下如何将函数应用于 Pandas 序列或数据帧。</p>
<h1 id="将函数应用于-Pandas-序列或数据帧"><a href="#将函数应用于-Pandas-序列或数据帧" class="headerlink" title="将函数应用于 Pandas 序列或数据帧"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/3?id=将函数应用于-pandas-序列或数据帧" target="_blank" rel="noopener">将函数应用于 Pandas 序列或数据帧</a></h1><p>在本节中，我们将学习如何将 Python 的预构建函数和自构建函数应用于 pandas 数据对象。 我们还将学习有关将函数应用于 Pandas 序列和 Pandas 数据帧的知识。</p>
<p>首先，将<code>pandas</code>模块导入 Jupyter 笔记本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd </span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure>
<p>我们将读取我们的 CSV 数据集：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data = pd.read_csv(<span class="string">'data-titanic.csv'</span>)</span><br><span class="line">data.head()</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/75b18b47-cf3d-48f0-b9df-43a6c93a3e03.png" alt="img"></p>
<p>让我们继续使用 Pandas 的<code>apply</code>方法来应用函数。 在此示例中，我们将使用<code>lambda</code>创建一个函数，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func_lower = <span class="keyword">lambda</span> x: x.lower()</span><br></pre></td></tr></table></figure>
<p>在这里，我们传递一个值<code>x</code>并将其转换为小写。 然后，我们使用<code>apply()</code>方法将此函数应用于数据集中的<code>Name</code>字段，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.Name.apply(func_lower)</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/82b77d45-3183-45d7-941d-ffb1ea134237.png" alt="img"></p>
<p>如果仔细观察，<code>Name</code>字段中的值已转换为小写。 接下来，我们了解如何将函数应用于多个列或整个数据帧中的值。 我们可以使用<code>applymap()</code>方法。 它以类似于<code>apply()</code>方法的方式工作，但是在多列或整个数据帧上。 以下代码描述了如何将<code>applymap()</code>方法应用于<code>Age</code>和<code>Pclass</code>列：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data[[<span class="string">'Age'</span>, <span class="string">'Pclass'</span>]].applymap(np.square)</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/25049645-a0d2-478a-8f8e-1112922709d2.png" alt="img"></p>
<p>我们还将 Numpy 的<code>secure</code>方法应用于这两个列。</p>
<p>前面的步骤用于预定义函数。 现在，让我们继续创建自己的函数，然后将其应用于值，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_func</span><span class="params">(i)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> i + <span class="number">20</span></span><br></pre></td></tr></table></figure>
<p>创建的函数是一个简单的函数，它带有一个值，将<code>20</code>添加到其中，然后返回结果。 我们使用<code>applymap()</code>将此函数应用于<code>Age</code>和<code>Pclass</code>列中的每个值，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data[[<span class="string">'Age'</span>, <span class="string">'Pclass'</span>]].applymap(my_func)</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/dcf93f0e-69c4-49fc-bcc1-65940f91727a.png" alt="img"></p>
<p>让我们继续学习有关将多个数据帧合并和连接在一起的知识。</p>
<h1 id="将多个数据帧合并并连接成一个"><a href="#将多个数据帧合并并连接成一个" class="headerlink" title="将多个数据帧合并并连接成一个"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/3?id=将多个数据帧合并并连接成一个" target="_blank" rel="noopener">将多个数据帧合并并连接成一个</a></h1><p>本节重点介绍如何使用 Pandas <code>merge()</code>和<code>concat()</code>方法组合两个或多个数据帧。 我们还将探讨<code>merge()</code>方法以各种方式加入数据帧的用法。</p>
<p>我们将从导入<code>pandas</code>模块开始。 让我们创建两个数据帧，其中两个都包含具有相同数据但具有不同记录的相同参数：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">dataset1 = pd.DataFrame(&#123;<span class="string">'Age'</span>: [<span class="string">'32'</span>, <span class="string">'26'</span>, <span class="string">'29'</span>],</span><br><span class="line">                         <span class="string">'Sex'</span>: [<span class="string">'F'</span>, <span class="string">'M'</span>, <span class="string">'F'</span>],</span><br><span class="line">                         <span class="string">'State'</span>: [<span class="string">'CA'</span>, <span class="string">'NY'</span>, <span class="string">'OH'</span>]&#125;,</span><br><span class="line">                         index=[<span class="string">'Jane'</span>, <span class="string">'John'</span>, <span class="string">'Cathy'</span>])</span><br><span class="line">dataset2 = pd.DataFrame(&#123;<span class="string">'Age'</span>: [<span class="string">'34'</span>, <span class="string">'23'</span>, <span class="string">'24'</span>, <span class="string">'21'</span>],</span><br><span class="line">                         <span class="string">'Sex'</span>: [<span class="string">'M'</span>, <span class="string">'F'</span>, <span class="string">'F'</span>, <span class="string">'F'</span>],</span><br><span class="line">                         State<span class="string">': ['</span>AZ<span class="string">', '</span>OR<span class="string">', '</span>CA<span class="string">', '</span>WA<span class="string">']&#125;, </span></span><br><span class="line"><span class="string">                         index=['</span>Dave<span class="string">', '</span>Kris<span class="string">', '</span>Xi<span class="string">', '</span>Jo<span class="string">'])</span></span><br><span class="line"><span class="string">dataset1</span></span><br><span class="line"><span class="string">dataset2</span></span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/d036cee8-9597-4df6-b031-ff704a088768.png" alt="img"></p>
<p>在此示例中，让我们将这两个数据帧垂直放置在一起。 使用 pandas <code>concat()</code>方法通过传递两个数据帧作为其参数来执行此操作：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.concat([dataset1, dataset2])</span><br></pre></td></tr></table></figure>
<p>我们可以看到<code>dataset2</code>已垂直附加到<code>dataset1</code>。</p>
<p>连接数据集的另一种方法是使用<code>append()</code>方法。 使用此方法获得的结果将与以前的方法相同：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataset1.append(dataset2)</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/e16e7fcc-5772-4f83-8ce3-d7963df43ac7.png" alt="img"></p>
<p>到目前为止，我们已经连接了数据集中的行，但是也可以连接列。 对于此示例，让我们创建两个新的数据集，它们具有相同的行级别但具有不同的列，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dataset1 = pd.DataFrame(&#123;<span class="string">'Age'</span>: [<span class="string">'32'</span>, <span class="string">'26'</span>, <span class="string">'29'</span>],</span><br><span class="line">                         <span class="string">'Sex'</span>: [<span class="string">'F'</span>, <span class="string">'M'</span>, <span class="string">'F'</span>],</span><br><span class="line">                         <span class="string">'State'</span>: [<span class="string">'CA'</span>, <span class="string">'NY'</span>, <span class="string">'OH'</span>]&#125;,</span><br><span class="line">                         index=[<span class="string">'Jane'</span>, <span class="string">'John'</span>, <span class="string">'Cathy'</span>])</span><br><span class="line">dataset2 = pd.DataFrame(&#123;<span class="string">'City'</span>: [<span class="string">'SF'</span>, <span class="string">'NY'</span>, <span class="string">'Columbus'</span>],</span><br><span class="line">                         <span class="string">'Work Status'</span>: [<span class="string">'No'</span>, <span class="string">'Yes'</span>, <span class="string">'Yes'</span>]&#125;,</span><br><span class="line">                         index=[<span class="string">'Jane'</span>, <span class="string">'John'</span>, <span class="string">'Cathy'</span>])</span><br></pre></td></tr></table></figure>
<p>在这种情况下，我们将水平连接。 要按列连接，我们需要将<code>axis</code>参数传递为<code>1</code>：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.concat([dataset1, dataset2], axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/cb6c49ea-455d-4c80-b0de-084fb965c0c7.png" alt="img"></p>
<p>数据集连接的第三个变体是连接具有不同行和列的数据集。 我们首先创建两个具有不同参数的数据集，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dataset1 = pd.DataFrame(&#123;<span class="string">'Age'</span>: [<span class="string">'32'</span>, <span class="string">'26'</span>, <span class="string">'29'</span>],</span><br><span class="line">                         <span class="string">'Sex'</span>: [<span class="string">'F'</span>, <span class="string">'M'</span>, <span class="string">'F'</span>],</span><br><span class="line">                         <span class="string">'State'</span>: [<span class="string">'CA'</span>, <span class="string">'NY'</span>, <span class="string">'OH'</span>]&#125;,</span><br><span class="line">                         index=[<span class="string">'Jane'</span>, <span class="string">'John'</span>, <span class="string">'Cathy'</span>])</span><br><span class="line">dataset2 = pd.DataFrame(&#123;<span class="string">'City'</span>: [<span class="string">'SF'</span>, <span class="string">'NY'</span>, <span class="string">'Columbus'</span>],</span><br><span class="line">                         <span class="string">'Work Status'</span>: [<span class="string">'No'</span>, <span class="string">'Yes'</span>, <span class="string">'Yes'</span>]&#125;,</span><br><span class="line">                         index=[<span class="string">'Jane'</span>, <span class="string">'John'</span>, <span class="string">'Cathy'</span>])</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/70527ac5-3a00-4086-b993-596369d77585.png" alt="img"></p>
<p>为了对这些数据集执行内部合并，我们将数据帧传递给<code>merge()</code>方法。 我们还指定必须在其上进行合并的列，同时确保我们指定它是内部合并。 您的数据集应类似于下表：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.merge(dataset1, dataset2, on=<span class="string">'Name'</span>, how=<span class="string">'inner'</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/f3fe6209-6803-4a1f-bf0c-16d8d93d92d3.png" alt="img"></p>
<p>现在，这意味着我们将两个数据集中的数据放在一起。 它仅包含在两个数据帧中具有通用标签的那些行。 接下来，我们进行外部合并。 这是通过将<code>how</code>参数作为<code>left</code>传递给<code>merge()</code>方法来完成的：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.merge(dataset1, dataset2, on=<span class="string">'Name'</span>, how=<span class="string">'left'</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/15f8c78a-4dd8-4940-b37b-42adbdde7d88.png" alt="img"></p>
<p>此操作的结果是将保留两个数据集中的行以及仅在第一个数据集中存在的行。 第二个数据集中仅存在的行将被丢弃。 为了进行右合并，我们将<code>how</code>参数设置为<code>right</code>：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.merge(dataset1, dataset2, on=<span class="string">'name'</span>, how=<span class="string">'right'</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/383cabaa-c2e8-472e-adcb-cdc50361b69a.png" alt="img"></p>
<p>为了保留所有内容，我们进行了完整的外部合并。 通过将<code>how</code>参数传递为<code>outer</code>来完成完整的外部合并：</p>
<p>现在，即使对于没有值并标记为<code>NaN</code>的列，它也包含所有行，而不管它们是否存在于一个或另一个数据集中，或存在于两个数据集中。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/3?id=总结" target="_blank" rel="noopener">总结</a></h1><p>在本章中，我们学习了各种 Pandas 技术来操纵和重塑数据。 我们学习了如何使用<code>inplace</code>参数修改 Pandas 数据帧。 我们还学习了可以使用<code>groupby</code>方法的方案。 我们看到了如何处理 Pandas 中缺失的值。 我们探索了 Pandas 数据帧中的索引，以及重命名和删除 Pandas 数据帧中的列。 我们学习了如何处理和转换日期和时间数据。 我们学习了如何处理<code>SettingWithCopyWarning</code>，还了解了如何将函数应用于 Pandas 序列或数据帧。 最后，我们学习了如何合并和连接多个数据帧。</p>
<p>在下一章中，我们将学习使用<code>seaborn</code> Python 库将数据可视化的技术，像一个专家一样。</p>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2020/12/29/精通Pandas探索性分析（二）：数据选择/" itemprop="url">精通Pandas探索性分析（二）：数据选择</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2020-12-29T07:14:38.000Z" itemprop="datePublished">1 天前</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Technology/">Technology</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            19 分钟 读完 (约 2919 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>在本章中，我们将学习使用 Pandas 进行数据选择的高级技术，如何选择数据子集，如何从数据集中选择多个行和列，如何对 Pandas 数据帧或一序列数据进行排序，如何过滤 Pandas 数据帧的角色，还学习如何将多个过滤器应用于 Pandas 数据帧。 我们还将研究如何在 Pandas 中使用<code>axis</code>参数以及在 Pandas 中使用字符串方法。 最后，我们将学习如何更改 Pandas 序列的数据类型。</p>
<p>首先，我们将学习如何从 Pandas 数据帧中选择数据子集并创建序列对象。 我们将从导入真实数据集开始。 我们将介绍一些 Pandas 数据选择方法，并将这些方法应用于实际数据集，以演示数据子集的选择。</p>
<p>在本章中，我们将讨论以下主题：</p>
<ul>
<li>从数据集中选择数据</li>
<li>排序数据集</li>
<li>使用 Pandas 数据帧过滤行</li>
<li>使用多个条件（例如 AND，OR 和 ISIN）过滤数据</li>
<li>在 Pandas 中使用<code>axis</code>参数</li>
<li>更改 Pandas 序列的数据类型</li>
</ul>
<h2 id="数据集简介"><a href="#数据集简介" class="headerlink" title="数据集简介"></a>数据集简介</h2><p>我们将使用 <a href="https://www.zillow.com/" target="_blank" rel="noopener">zillow.com</a> 的真实数据集，这是一个在线房地产市场，其发布房价数据集是他们研究工作的一部分。 这些数据集可在公共领域获得，并在归属于 <a href="https://www.zillow.com/" target="_blank" rel="noopener">zillow.com</a> 后可免费使用。 我们将使用<a href="https://www.zillow.com/research/data/" target="_blank" rel="noopener">有关美国地区平均房价的最新数据</a>。 它是 CSV 数据集，或带有 CSV 的文本文件。 让我们首先将 pandas 模块导入到 Jupyter 笔记本中，如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">data = pd.read_csv(<span class="string">'data-zillow.csv'</span>, sep=<span class="string">','</span>)</span><br></pre></td></tr></table></figure>
<h2 id="从数据集中选择数据"><a href="#从数据集中选择数据" class="headerlink" title="从数据集中选择数据"></a>从数据集中选择数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">regions = data[<span class="string">'RegionName'</span>] <span class="comment">#根据列名选择</span></span><br><span class="line">type(regions) <span class="comment">#series对象</span></span><br></pre></td></tr></table></figure>
<h2 id="多列选择"><a href="#多列选择" class="headerlink" title="多列选择"></a>多列选择</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">region_n_state = data[[<span class="string">'RegionName'</span>, <span class="string">'State'</span>]] <span class="comment">#传递列名数组，选择多个列</span></span><br><span class="line">region_n_state.head() </span><br><span class="line">type(region_n_state)<span class="comment">#DataFrame对象</span></span><br></pre></td></tr></table></figure>
<h2 id="点表示法"><a href="#点表示法" class="headerlink" title="点表示法"></a>点表示法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data.State<span class="comment">#选择单列</span></span><br><span class="line">data[<span class="string">'Address'</span>] = data.County + <span class="string">', '</span> + data.Metro + <span class="string">', '</span> + data.State<span class="comment">#生成新列</span></span><br></pre></td></tr></table></figure>
<h2 id="从-Pandas-数据帧中选择多个行和列"><a href="#从-Pandas-数据帧中选择多个行和列" class="headerlink" title="从 Pandas 数据帧中选择多个行和列"></a>从 Pandas 数据帧中选择多个行和列</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zillow.loc[<span class="number">7</span>, <span class="string">'Metro'</span>] <span class="comment">#行索引7，列名为Metro</span></span><br><span class="line">zillow.iloc[<span class="number">7</span>,<span class="number">4</span>]<span class="comment">#行索引7，列索引4</span></span><br></pre></td></tr></table></figure>
<h2 id="选择单行和多列"><a href="#选择单行和多列" class="headerlink" title="选择单行和多列"></a>选择单行和多列</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zillow.loc[<span class="number">7</span>, [<span class="string">'Metro'</span>, <span class="string">'County'</span>]] </span><br><span class="line">zillow.iloc[<span class="number">7</span>,[<span class="number">4</span>,<span class="number">5</span>]]</span><br><span class="line">zillow.loc[<span class="number">11</span>,:]</span><br></pre></td></tr></table></figure>
<h2 id="选择多行和单列"><a href="#选择多行和单列" class="headerlink" title="选择多行和单列"></a>选择多行和单列</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zillow.loc[<span class="number">101</span>:<span class="number">105</span>, <span class="string">'Metro'</span>]</span><br></pre></td></tr></table></figure>
<h2 id="选择多行和多列"><a href="#选择多行和多列" class="headerlink" title="选择多行和多列"></a>选择多行和多列</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zillow.loc[<span class="number">201</span>:<span class="number">204</span>, <span class="string">"State"</span>:<span class="string">"County"</span>] </span><br><span class="line">zillow.iloc[<span class="number">201</span>:<span class="number">205</span>, <span class="number">3</span>:<span class="number">6</span>] </span><br><span class="line">zillow.loc[<span class="number">201</span>:<span class="number">205</span>, [<span class="string">'RegionName'</span>, <span class="string">'State'</span>]]</span><br></pre></td></tr></table></figure>
<h2 id="从行和所有列的范围中选择值"><a href="#从行和所有列的范围中选择值" class="headerlink" title="从行和所有列的范围中选择值"></a>从行和所有列的范围中选择值</h2><p>在这里，我们将使用<code>loc</code>方法查看行和列序列中的值。 为此，<code>loc</code>方法的第一个参数是要选择的行的范围索引。 由于我们需要所有列中的值，因此我们将冒号（<code>:</code>）作为第二个参数，如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zillow.loc[<span class="number">201</span>:<span class="number">205</span>, :] </span><br><span class="line">zillow.loc[[<span class="number">0</span>,<span class="number">5</span>,<span class="number">10</span>], :]  <span class="comment">#选择不连续的行</span></span><br><span class="line">zillow.loc[zillow.County==<span class="string">"Queens"</span>] <span class="comment">#选择County列的值为Queens的行</span></span><br><span class="line">zillow.loc[zillow.Metro==<span class="string">"New York"</span>, <span class="string">"County"</span>] <span class="comment">#从County列中选择Metro列为New York的行</span></span><br></pre></td></tr></table></figure>
<h2 id="对pandas数据帧排序"><a href="#对pandas数据帧排序" class="headerlink" title="对pandas数据帧排序"></a>对pandas数据帧排序</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">zillow.sort_values(<span class="string">'Metro'</span>) <span class="comment">#对Metro列排序（默认升序）</span></span><br><span class="line">sorted = zillow.sort_values(<span class="string">'Metro'</span>, ascending=<span class="literal">False</span>) <span class="comment">#降序排序</span></span><br><span class="line">sorted = zillow.sort_values(by=[<span class="string">'Metro'</span>,<span class="string">'County'</span>]) <span class="comment">#按Metro首先对数据进行排序，然后按County列进行排</span></span><br><span class="line">sorted = zillow.sort_values(by=[<span class="string">'Metro'</span>,<span class="string">'County'</span>, <span class="string">'Zhvi'</span>], ascending=[<span class="literal">True</span>, <span class="literal">True</span>, <span class="literal">False</span>]) </span><br><span class="line">regions = zillow.RegionID</span><br><span class="line">regions.sort_values() <span class="comment">#对Series对象排序</span></span><br></pre></td></tr></table></figure>
<h2 id="过滤-Pandas-数据帧的行"><a href="#过滤-Pandas-数据帧的行" class="headerlink" title="过滤 Pandas 数据帧的行"></a>过滤 Pandas 数据帧的行</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">filtered_data = data.filter(items=[<span class="string">'State'</span>, <span class="string">'Metro'</span>]) <span class="comment">#使用filter方法过滤列</span></span><br><span class="line">filtered_data = data.filter(regex=<span class="string">'Region'</span>, axis=<span class="number">1</span>) <span class="comment">#使用正则表达式过滤列名称</span></span><br><span class="line">price_filter_series = data[<span class="string">'Zhvi'</span>] &gt; <span class="number">500000</span> </span><br><span class="line">data[price_filter_series]</span><br><span class="line">data[data.Zhvi &gt;= <span class="number">1000000</span>]  <span class="comment">#过滤Zhvi列大于1000000的行</span></span><br></pre></td></tr></table></figure>
<h2 id="将多个过滤条件应用于-Pandas-数据帧"><a href="#将多个过滤条件应用于-Pandas-数据帧" class="headerlink" title="将多个过滤条件应用于 Pandas 数据帧"></a>将多个过滤条件应用于 Pandas 数据帧</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data[(data[<span class="string">'Zhvi'</span>] &gt; <span class="number">1000000</span>) &amp; (data[<span class="string">'State'</span>] == <span class="string">'NY'</span>)]  <span class="comment">#选择价格值大于 1,000,000 且State为New York的行</span></span><br><span class="line">data[((data[<span class="string">'State'</span>] == <span class="string">'CA'</span>) | (data[<span class="string">'State'</span>] == <span class="string">'NY'</span>))]</span><br></pre></td></tr></table></figure>
<h2 id="使用isin方法进行过滤"><a href="#使用isin方法进行过滤" class="headerlink" title="使用isin方法进行过滤"></a>使用<code>isin</code>方法进行过滤</h2><p>筛选数据的另一种方法是使用<code>isin</code>方法。 我们可以使用<code>isin</code>方法通过一个或多个特定列的值列表来过滤数据集。 在这里，我们仅从<code>Metro</code>列中选择值<code>New York</code>或<code>San Francisco</code>的那些记录。</p>
<p>我们在<code>Metro</code>列上调用<code>isin</code>方法，并将其传递给包含我们要选择的城市的列表。 这将创建一个布尔序列。 然后，我们将布尔序列传递给数据集数据帧进行必要的过滤和选择，如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filter = data[<span class="string">'Metro'</span>].isin([<span class="string">'New York'</span>, <span class="string">'San Francisco'</span>]) </span><br><span class="line">data[filter].head()</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/7b51ee0f-ccbe-4363-a616-5a693a8e4b30.png" alt="img"></p>
<h2 id="在多个条件下使用isin方法"><a href="#在多个条件下使用isin方法" class="headerlink" title="在多个条件下使用isin方法"></a>在多个条件下使用<code>isin</code>方法</h2><p>我们还可以使用<code>isin</code>方法根据来自多列的值过滤行。 为了执行此操作，我们传递了一个字典对象，其中的键是列名，而值是我们要从中选择记录的那些列的值的列表。</p>
<p>举个例子，让我们选择<code>State</code>参数为<code>California</code>和<code>Metro</code>参数为<code>San Francisco</code>的值。 我们使用包含要选择的值的这两列创建一个字典对象，然后将该字典项传递给<code>isin</code>方法，并在数据集上调用<code>isin</code>方法。 然后，将过滤器传递给数据帧并选择我们的记录，如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filter = data.isin(&#123;<span class="string">'State'</span>: [<span class="string">'CA'</span>], <span class="string">'Metro'</span>: [<span class="string">'San Francisco'</span>]&#125;) </span><br><span class="line">data[filter].head()</span><br></pre></td></tr></table></figure>
<h2 id="在-Pandas-中使用axis参数"><a href="#在-Pandas-中使用axis参数" class="headerlink" title="在 Pandas 中使用axis参数"></a>在 Pandas 中使用<code>axis</code>参数</h2><p>在本节中，我们将学习在 Pandas 中进行数据分析时何时何地使用<code>axis</code>参数或关键字。 我们将介绍<code>axis</code>参数，并逐步介绍可以将<code>axis</code>关键字设置为的各种值。 我们将演示如何将<code>axis</code>设置为行或列来改变方法的行为。 我们还将展示一些使用<code>axis</code>关键字的代码示例。</p>
<h2 id="axis参数的用法"><a href="#axis参数的用法" class="headerlink" title="axis参数的用法"></a><code>axis</code>参数的用法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.axes</span><br></pre></td></tr></table></figure>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/25d4ab25-5e9f-4de6-a627-76f9c2d5b2d4.png" alt="img"></p>
<p>在<code>axis</code>用法示例中，我们计算数据集中值的平均值。 我们已将<code>axis</code>传递为<code>0</code>。 这意味着将沿着行<code>axis</code>计算平均值，如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.mean(axis=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/a764a72c-d397-4f59-bcac-229a1a5924ef.png" alt="img"></p>
<p>接下来，我们将<code>axis</code>设置为<code>1</code>。 我们在同一数据集上使用完全相同的方法； 但是，我们正在将<code>axis</code>从<code>0</code>更改为<code>1</code>。 由于我们将<code>axis</code>设置为<code>1</code>，因此<code>mean</code>的计算如下：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.mean(axis=<span class="number">1</span>).head()</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/193b4742-a7e8-4868-9053-147075cb3dbf.png" alt="img"></p>
<p>有时很难记住<code>0</code>或<code>1</code>是用于行还是用于列。 因此，您可以将<code>axis</code>设置为<code>rows</code>而不是使用<code>axis0</code>：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.mean(axis=<span class="string">'rows'</span>)</span><br></pre></td></tr></table></figure>
<p>输出为以下内容：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/7f4de7ab-7c2c-48c0-8603-8e931992a1d5.png" alt="img"></p>
<p>对于列，您可以将<code>axis</code>设置为<code>columns</code>。 与使用<code>0</code>或<code>1</code>具有相同的效果：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.mean(axis=<span class="string">'columns'</span>).head()</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/e1672cd1-4c1d-4905-a005-1360a6a3b98e.png" alt="img"></p>
<h2 id="axis关键字的更多示例"><a href="#axis关键字的更多示例" class="headerlink" title="axis关键字的更多示例"></a><code>axis</code>关键字的更多示例</h2><p>在这里，我们使用<code>drop</code>方法删除行或记录。 我们通过将关键字<code>axis</code>传递为<code>0</code>来告诉<code>drop</code>方法将记录删除到<code>0</code>的索引处：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data.drop(<span class="number">0</span>, axis=<span class="number">0</span>) <span class="comment">#删除第0行</span></span><br><span class="line">data.drop(<span class="string">'Date'</span>, axis=<span class="number">1</span>).head <span class="comment">#删除带有Date标签的列</span></span><br></pre></td></tr></table></figure>
<h2 id="axis关键字"><a href="#axis关键字" class="headerlink" title="axis关键字"></a><code>axis</code>关键字</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.filter(regex=<span class="string">'Region'</span>, axis=<span class="number">1</span>) <span class="comment">#过滤列名为正则表达式'Region'的列</span></span><br></pre></td></tr></table></figure>
<h2 id="在-Pandas-中使用字符串方法"><a href="#在-Pandas-中使用字符串方法" class="headerlink" title="在 Pandas 中使用字符串方法"></a>在 Pandas 中使用字符串方法</h2><p>在本节中，我们将学习在 Pandas 序列中使用各种字符串方法。 我们将把真实的数据集读入 Pandas。 我们将探索一些字符串方法，并将使用这些字符串方法从数据集中选择和更改值。</p>
<h2 id="检查子串"><a href="#检查子串" class="headerlink" title="检查子串"></a>检查子串</h2><p>为了学习如何使用字符串方法检查 Pandas 序列的子字符串，我们使用<code>str</code>包中的<code>contains</code>方法。</p>
<p>在这里，我们从数据集中调用<code>RegionName</code>序列上的<code>str.contains</code>方法。 我们正在寻找包含<code>New</code>子字符串的记录。 它打印出一个布尔序列，打印<code>True</code>找到一个子字符串，而<code>False</code>找到一个子字符串：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data[data.RegionName.str.contains(<span class="string">'New'</span>)] <span class="comment">#过滤RegionName列中包含New字符串的行</span></span><br></pre></td></tr></table></figure>
<h2 id="将序列或列值更改为大写"><a href="#将序列或列值更改为大写" class="headerlink" title="将序列或列值更改为大写"></a>将序列或列值更改为大写</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.RegionName.str.upper()</span><br></pre></td></tr></table></figure>
<h2 id="将值更改为小写"><a href="#将值更改为小写" class="headerlink" title="将值更改为小写"></a>将值更改为小写</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data.County.str.lower()</span><br><span class="line">data.County.str.len()<span class="comment">#查找列中每个值的长度</span></span><br><span class="line">data.RegionName.str.lstrip()<span class="comment">#删除空格</span></span><br><span class="line">data.RegionName.str.replace(<span class="string">' '</span>,<span class="string">''</span>)<span class="comment">#空格替换为无空格</span></span><br></pre></td></tr></table></figure>
<h2 id="更改-Pandas-序列的数据类型"><a href="#更改-Pandas-序列的数据类型" class="headerlink" title="更改 Pandas 序列的数据类型"></a>更改 Pandas 序列的数据类型</h2><p>在本节中，我们将学习如何更改 Pandas 序列的数据类型。 我们将看到读取其中的数据后如何更改数据类型。 我们还将学习在读取 Pandas 数据时如何更改数据类型。 我们将通过一个示例将<code>int</code>列更改为<code>float</code>。 我们还将看到如何将字符串值列转换为<code>datetime</code>数据类型。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data[<span class="string">'Zhvi'</span>] = data.Zhvi.astype(float) <span class="comment">#将int数据类型列更改为float</span></span><br></pre></td></tr></table></figure>
<h2 id="读取数据时更改数据类型"><a href="#读取数据时更改数据类型" class="headerlink" title="读取数据时更改数据类型"></a>读取数据时更改数据类型</h2><p>在将数据读入 pandas 之后，我们只是更改了列的数据类型。 另外，我们可以在读取数据时更改数据类型。 为此，我们将列名和数据类型传递到要更改为<code>read</code>数据方法的列中。 我们想要的<code>float</code>列已导入为<code>float64</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data2 = pd.read_csv(<span class="string">'data-zillow.csv'</span>, sep=<span class="string">','</span>, dtype=&#123;<span class="string">'Zhvi'</span>:float&#125;) </span><br><span class="line">data2.dtypes</span><br></pre></td></tr></table></figure>
<h2 id="将字符串转换为日期时间"><a href="#将字符串转换为日期时间" class="headerlink" title="将字符串转换为日期时间"></a>将字符串转换为日期时间</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.to_datetime(data2.Date,infer_datetime_format=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/2?id=总结" target="_blank" rel="noopener">总结</a></h1><p>在本章中，我们学习了从 Pandas 数据帧中选择数据子集的方法。 我们还了解了如何将这些方法应用于真实数据集。 我们还了解了从已读入 Pandas 的数据集中选择多个行和列的方法，并将这些方法应用于实际数据集以演示选择数据子集的方法。 我们了解了 Pandas <code>sort_values</code>方法。 我们看到了使用<code>sort_values</code>方法对 Pandas 数据帧中的数据进行排序的各种方法。 我们还学习了如何对 Pandas 序列对象进行排序。 我们了解了用于从 Pandas 数据帧过滤行和列的方法。 我们介绍了几种方法来实现此目的。 我们了解了 Pandas 的<code>filter</code>方法以及如何在实际数据集中使用它。 我们还学习了根据从数据创建的布尔序列过滤数据的方法，并且学习了如何将过滤数据的条件直接传递给数据帧。 我们学习了 Pandas 数据选择的各种技术，以及如何选择数据子集。 我们还学习了如何从数据集中选择多个角色和列。 我们学习了如何对 Pandas 数据帧或序列进行排序。 我们逐步介绍了如何过滤 Pandas 数据帧的行，如何对此类数据帧应用多个过滤器以及如何在 Pandas 中使用<code>axis</code>参数。 我们还研究了字符串方法在 Pandas 中的使用，最后，我们学习了如何更改 Pandas 序列的数据类型。</p>
<p>在下一章中，我们将学习处理，转换和重塑数据的技术。</p>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2020/12/28/精通Pandas探索性分析（一）：处理不同种类的数据集/" itemprop="url">精通Pandas探索性分析（一）：处理不同种类的数据集</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2020-12-28T15:19:36.000Z" itemprop="datePublished">2 天前</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Technology/">Technology</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            1 小时 读完 (约 10577 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2 id="从-CSV-文件读取数据时使用高级选项"><a href="#从-CSV-文件读取数据时使用高级选项" class="headerlink" title="从 CSV 文件读取数据时使用高级选项"></a>从 CSV 文件读取数据时使用高级选项</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">df = pd.read_csv(<span class="string">'IMDB.csv'</span>, encoding=<span class="string">"UTF-8"</span>,</span><br><span class="line">                 header=<span class="number">2</span>,<span class="comment">#指定行为列名</span></span><br><span class="line">                 index_col=<span class="string">"Title"</span>,<span class="comment">#指定列为索引</span></span><br><span class="line">                 usecols=[<span class="string">'Title'</span>,<span class="string">'Genre1'</span>],<span class="comment">#选择要读取的列的子集</span></span><br><span class="line">                 na_values[<span class="string">''</span>],<span class="comment">#将视为NaN的值列表传递给读取函数</span></span><br><span class="line">                 skip_blank_lines=<span class="literal">False</span>,<span class="comment">#默认情况下，read_csv会忽略空白行，但是我们可以通过将skip_blank_lines设置为False来关闭此行</span></span><br><span class="line">                 skiprows=[<span class="number">1</span>,<span class="number">3</span>,<span class="number">7</span>],<span class="comment">#选择跳过哪些行</span></span><br><span class="line">                 skipfooter=<span class="number">2</span>,<span class="comment">#从页脚或文件末尾跳过行</span></span><br><span class="line">                 nrows=<span class="number">100</span>,<span class="comment">#仅读取数据集中的前一百行</span></span><br><span class="line">                )</span><br></pre></td></tr></table></figure>
<h3 id="查看数据"><a href="#查看数据" class="headerlink" title="查看数据"></a>查看数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df.head()</span><br><span class="line">df.tail()</span><br><span class="line">df.shape</span><br></pre></td></tr></table></figure>
<h2 id="从-Excel-文件读取数据"><a href="#从-Excel-文件读取数据" class="headerlink" title="从 Excel 文件读取数据"></a>从 Excel 文件读取数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>, sheetname=<span class="number">0</span>)</span><br><span class="line">xls_file = pd.ExcelFile(<span class="string">'IMDB.xlsx'</span>)</span><br><span class="line">xls_file.sheet_names</span><br><span class="line"><span class="comment">#读取多个工作表</span></span><br><span class="line">df1 = xls_file.parse(<span class="string">'movies'</span>)</span><br><span class="line">df2 = xls_file.parse(<span class="string">'by genre'</span>)</span><br><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>, </span><br><span class="line">                   sheetname=<span class="number">1</span>, <span class="comment">#读取第2个表格</span></span><br><span class="line">                   header=<span class="number">3</span>,<span class="comment">#第4行为标题</span></span><br><span class="line">                   header=<span class="literal">None</span>,<span class="comment">#没有标题</span></span><br><span class="line">                   skiprows=<span class="number">7</span>,<span class="comment">#跳过开头的行</span></span><br><span class="line">                   ski_footer=<span class="number">10</span>,<span class="comment">#跳过末尾的行</span></span><br><span class="line">                   parse_cols=<span class="number">2</span>,<span class="comment">#读取前三列</span></span><br><span class="line">                   names=[<span class="string">'X'</span>,<span class="string">'Title'</span>,<span class="string">'Rating'</span>],<span class="comment">#设置列名</span></span><br><span class="line">                   index_col=<span class="string">'Title'</span>,<span class="comment">#设置索引列</span></span><br><span class="line">                   na_values=[<span class="string">' '</span>],<span class="comment">#将列表中的数据视为丢失数据</span></span><br><span class="line">                  )</span><br></pre></td></tr></table></figure>
<h2 id="将-JSON-数据读入-Pandas"><a href="#将-JSON-数据读入-Pandas" class="headerlink" title="将 JSON 数据读入 Pandas"></a>将 JSON 数据读入 Pandas</h2><p>为了读取 JSON 数据，pandas 提供了一种名为<code>read_json</code>的方法，其中我们传递了要读取的 JSON 数据文件的文件名和位置。 文件位置可以是本地文件，甚至可以是具有有效 URL 方案的互联网。 我们将结果数据帧分配给变量<code>DF</code>。</p>
<p><code>read_json</code>方法读取 JSON 数据并将其转换为 Pandas 数据帧对象，即表格数据格式，如以下代码所示。 JSON 数据现在可以以数据帧格式轻松访问，可以更轻松地进行操作和浏览：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">movies_json = pd.read_json(<span class="string">'IMDB.json'</span>)</span><br><span class="line">movies_json.head()</span><br></pre></td></tr></table></figure>
<h2 id="读取-HTML-数据"><a href="#读取-HTML-数据" class="headerlink" title="读取 HTML 数据"></a>读取 HTML 数据</h2><p>pandas 内部使用<code>lxml</code> Python 模块读取 HTML 数据。 您可以通过执行<code>conda install lxml</code>，从命令行程序安装它，如以下屏幕截图所示：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/7b60aa19-d51d-43a7-bd80-bd26473a7a62.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.read_html(<span class="string">'IMDB.html'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="读取-PICKLE-文件"><a href="#读取-PICKLE-文件" class="headerlink" title="读取 PICKLE 文件"></a>读取 PICKLE 文件</h2><p>PICKLE 是将任何类型的 Python 对象（包括列表，字典等）转换为字符串的一种方式。 这个想法是，该字符串包含在另一个 Python 脚本中重构对象所需的所有信息。</p>
<p>我们使用<code>read_pickle</code>方法读取我们的 PICKLE 文件，如以下代码所示。 与其他数据格式一样，Pandas 根据读取的数据创建数据帧：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_pickle(<span class="string">'IMDB.p'</span>)</span><br><span class="line">df.head()</span><br></pre></td></tr></table></figure>
<h2 id="ApacheCN-数据科学和机器学习译文集"><a href="#ApacheCN-数据科学和机器学习译文集" class="headerlink" title="ApacheCN 数据科学和机器学习译文集"></a><a href="https://ds.apachecn.org/" target="_blank" rel="noopener">ApacheCN 数据科学和机器学习译文集</a></h2><ul>
<li><a href="https://ds.apachecn.org/#/docs/tutorialspoint-numpy" target="_blank" rel="noopener">TutorialsPoint NumPy 教程</a></li>
<li>NumPy 秘籍中文第二版<ul>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch00" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch01" target="_blank" rel="noopener">一、使用 IPython</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch02" target="_blank" rel="noopener">二、高级索引和数组概念</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch03" target="_blank" rel="noopener">三、掌握常用函数</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch04" target="_blank" rel="noopener">四、将 NumPy 与世界的其他地方连接</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch05" target="_blank" rel="noopener">五、音频和图像处理</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch06" target="_blank" rel="noopener">六、特殊数组和通用函数</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch07" target="_blank" rel="noopener">七、性能分析和调试</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch08" target="_blank" rel="noopener">八、质量保证</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch09" target="_blank" rel="noopener">九、使用 Cython 加速代码</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch10" target="_blank" rel="noopener">十、Scikits 的乐趣</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch11" target="_blank" rel="noopener">十一、最新最强的 NumPy</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-cookbook-2e/ch12" target="_blank" rel="noopener">十二、使用 NumPy 进行探索性和预测性数据分析</a></li>
</ul>
</li>
<li>NumPy 初学者指南中文第三版<ul>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch00" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch01" target="_blank" rel="noopener">一、NumPy 快速入门</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch02" target="_blank" rel="noopener">二、从 NumPy 基本原理开始</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch03" target="_blank" rel="noopener">三、熟悉常用函数</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch04" target="_blank" rel="noopener">四、为您带来便利的便利函数</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch05" target="_blank" rel="noopener">五、使用矩阵和 ufunc</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch06" target="_blank" rel="noopener">六、深入探索 NumPy 模块</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch07" target="_blank" rel="noopener">七、了解特殊例程</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch08" target="_blank" rel="noopener">八、通过测试确保质量</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch09" target="_blank" rel="noopener">九、matplotlib 绘图</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch10" target="_blank" rel="noopener">十、当 NumPy 不够用时 - SciPy 及更多</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch11" target="_blank" rel="noopener">十一、玩转 Pygame</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch12" target="_blank" rel="noopener">附录 A：小测验答案</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch13" target="_blank" rel="noopener">附录 B：其他在线资源</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-beginners-guide-3e/ch14" target="_blank" rel="noopener">附录 C：NumPy 函数的参考</a></li>
</ul>
</li>
<li>NumPy 基础知识<ul>
<li><a href="https://ds.apachecn.org/#/docs/numpy-essentials/0" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-essentials/1" target="_blank" rel="noopener">一、NumPy 简介</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-essentials/2" target="_blank" rel="noopener">二、NumPy <code>ndarray</code>对象</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-essentials/3" target="_blank" rel="noopener">三、使用 NumPy 数组</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-essentials/4" target="_blank" rel="noopener">四、NumPy 核心和子模块</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-essentials/5" target="_blank" rel="noopener">五、NumPy 中的线性代数</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-essentials/6" target="_blank" rel="noopener">六、NumPy 中的傅立叶分析</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-essentials/7" target="_blank" rel="noopener">七、构建和分发 NumPy 代码</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-essentials/8" target="_blank" rel="noopener">八、使用 Cython 加速 NumPy</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-essentials/9" target="_blank" rel="noopener">九、NumPy C-API 简介</a></li>
<li><a href="https://ds.apachecn.org/#/docs/numpy-essentials/10" target="_blank" rel="noopener">十、扩展阅读</a></li>
</ul>
</li>
<li>精通 NumPy 数值分析<ul>
<li><a href="https://ds.apachecn.org/#/docs/master-num-comp-numpy/0" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-num-comp-numpy/1" target="_blank" rel="noopener">一、使用 NumPy 数组</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-num-comp-numpy/2" target="_blank" rel="noopener">二、NumPy 线性代数</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-num-comp-numpy/3" target="_blank" rel="noopener">三、使用 NumPy 统计函数对波士顿住房数据进行探索性数据分析</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-num-comp-numpy/4" target="_blank" rel="noopener">四、使用线性回归预测房价</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-num-comp-numpy/5" target="_blank" rel="noopener">五、使用 NumPy 对批发分销商的客户进行聚类</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-num-comp-numpy/6" target="_blank" rel="noopener">六、NumPy，SciPy，Pandas 和 Scikit-Learn</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-num-comp-numpy/7" target="_blank" rel="noopener">七、高级 NumPy</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-num-comp-numpy/8" target="_blank" rel="noopener">八、高性能数值计算库概述</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-num-comp-numpy/9" target="_blank" rel="noopener">九、性能基准</a></li>
</ul>
</li>
<li>NumPy 数组学习手册<ul>
<li><a href="https://ds.apachecn.org/#/docs/learn-numpy-array/0" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learn-numpy-array/1" target="_blank" rel="noopener">一、NumPy 入门</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learn-numpy-array/2" target="_blank" rel="noopener">二、NumPy 基础</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learn-numpy-array/3" target="_blank" rel="noopener">三、使用 NumPy 的基本数据分析</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learn-numpy-array/4" target="_blank" rel="noopener">四、使用 NumPy 的简单预测性分析</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learn-numpy-array/5" target="_blank" rel="noopener">五、信号处理技术</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learn-numpy-array/6" target="_blank" rel="noopener">六、性能分析，调试和测试</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learn-numpy-array/7" target="_blank" rel="noopener">七、Python 科学生态系统</a></li>
</ul>
</li>
<li>精通 SciPy<ul>
<li><a href="https://ds.apachecn.org/#/docs/master-scipy/0" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-scipy/1" target="_blank" rel="noopener">一、数值线性代数</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-scipy/2" target="_blank" rel="noopener">二、插值和近似</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-scipy/3" target="_blank" rel="noopener">三、微分与积分</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-scipy/4" target="_blank" rel="noopener">四、非线性方程式和最优化</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-scipy/5" target="_blank" rel="noopener">五、常微分方程的初值问题</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-scipy/6" target="_blank" rel="noopener">六、计算几何</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-scipy/7" target="_blank" rel="noopener">七、描述性统计</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-scipy/8" target="_blank" rel="noopener">八、推断和数据分析</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-scipy/9" target="_blank" rel="noopener">九、数字图像处理</a></li>
</ul>
</li>
<li>Pandas 秘籍<ul>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch00" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch01" target="_blank" rel="noopener">一、Pandas 基础</a></li>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch02" target="_blank" rel="noopener">二、数据帧基本操作</a></li>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch03" target="_blank" rel="noopener">三、开始数据分析</a></li>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch04" target="_blank" rel="noopener">四、选择数据子集</a></li>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch05" target="_blank" rel="noopener">五、布尔索引</a></li>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch06" target="_blank" rel="noopener">六、索引对齐</a></li>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch07" target="_blank" rel="noopener">七、分组以进行汇总，过滤和转换</a></li>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch08" target="_blank" rel="noopener">八、将数据重组为整齐的表格</a></li>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch09" target="_blank" rel="noopener">九、组合 Pandas 对象</a></li>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch10" target="_blank" rel="noopener">十、时间序列分析</a></li>
<li><a href="https://ds.apachecn.org/#/docs/pandas-cookbook/ch11" target="_blank" rel="noopener">十一、Pandas，Matplotlib 和 Seaborn 的可视化</a></li>
</ul>
</li>
<li>Pandas 学习手册中文第二版<ul>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/0" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/1" target="_blank" rel="noopener">一、Pandas 与数据分析</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/2" target="_blank" rel="noopener">二、启动和运行 Pandas</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/3" target="_blank" rel="noopener">三、用序列表示单变量数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/4" target="_blank" rel="noopener">四、用数据帧表示表格和多元数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/5" target="_blank" rel="noopener">五、数据帧的结构操作</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/6" target="_blank" rel="noopener">六、索引数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/7" target="_blank" rel="noopener">七、类别数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/8" target="_blank" rel="noopener">八、数值统计方法</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/9" target="_blank" rel="noopener">九、存取数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/10" target="_blank" rel="noopener">十、整理数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/11" target="_blank" rel="noopener">十一、合并，连接和重塑数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/12" target="_blank" rel="noopener">十二、数据聚合</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/13" target="_blank" rel="noopener">十三、时间序列建模</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/14" target="_blank" rel="noopener">十四、可视化</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-pandas-2e/15" target="_blank" rel="noopener">十五、历史股价分析</a></li>
</ul>
</li>
<li>精通 Pandas<ul>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/0" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/1" target="_blank" rel="noopener">一、Pandas 和数据分析简介</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/2" target="_blank" rel="noopener">二、Pandas 安装和支持软件</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/3" target="_blank" rel="noopener">三、Pandas 数据结构</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/4" target="_blank" rel="noopener">四、Pandas 的操作，第一部分 – 索引和选择</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/5" target="_blank" rel="noopener">五、Pandas 的操作，第二部分 – 数据的分组，合并和重塑</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/6" target="_blank" rel="noopener">六、处理缺失数据，时间序列和 Matplotlib 绘图</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/7" target="_blank" rel="noopener">七、统计之旅 – 经典方法</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/8" target="_blank" rel="noopener">八、贝叶斯统计简介</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/9" target="_blank" rel="noopener">九、Pandas 库体系结构</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/10" target="_blank" rel="noopener">十、R 与 Pandas 的比较</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-pandas/11" target="_blank" rel="noopener">十一、机器学习简介</a></li>
</ul>
</li>
<li>NumPy 和 Pandas 数据分析实用指南<ul>
<li><a href="https://ds.apachecn.org/#/docs/handson-data-analysis-numpy-pandas/0" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/handson-data-analysis-numpy-pandas/1" target="_blank" rel="noopener">一、配置 Python 数据分析环境</a></li>
<li><a href="https://ds.apachecn.org/#/docs/handson-data-analysis-numpy-pandas/2" target="_blank" rel="noopener">二、探索 NumPy</a></li>
<li><a href="https://ds.apachecn.org/#/docs/handson-data-analysis-numpy-pandas/3" target="_blank" rel="noopener">三、NumPy 数组上的运算</a></li>
<li><a href="https://ds.apachecn.org/#/docs/handson-data-analysis-numpy-pandas/4" target="_blank" rel="noopener">四、Pandas 很有趣！ 什么是 Pandas？</a></li>
<li><a href="https://ds.apachecn.org/#/docs/handson-data-analysis-numpy-pandas/5" target="_blank" rel="noopener">五、Pandas 的算术，函数应用以及映射</a></li>
<li><a href="https://ds.apachecn.org/#/docs/handson-data-analysis-numpy-pandas/6" target="_blank" rel="noopener">六、排序，索引和绘图</a></li>
</ul>
</li>
<li>精通 Pandas 探索性分析<ul>
<li><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/0" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1" target="_blank" rel="noopener">一、处理不同种类的数据集</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/2" target="_blank" rel="noopener">二、数据选择</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/3" target="_blank" rel="noopener">三、处理，转换和重塑数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/4" target="_blank" rel="noopener">四、像专业人士一样可视化数据</a></li>
</ul>
</li>
<li>Matplotlib 3.0 秘籍<ul>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/0" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/1" target="_blank" rel="noopener">一、Matplotlib 的剖析</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/2" target="_blank" rel="noopener">二、基本绘图入门</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/3" target="_blank" rel="noopener">三、绘制多个图表和子图</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/4" target="_blank" rel="noopener">四、开发可视化来提高发布质量</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/5" target="_blank" rel="noopener">五、使用高级功能的绘图</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/6" target="_blank" rel="noopener">六、嵌入文本和表达式</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/7" target="_blank" rel="noopener">七、以不同格式保存图形</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/8" target="_blank" rel="noopener">八、开发交互式绘图</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/9" target="_blank" rel="noopener">九、在图形用户界面中嵌入绘图</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/10" target="_blank" rel="noopener">十、使用<code>mplot3d</code>工具包绘制 3D 图形</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/11" target="_blank" rel="noopener">十一、使用<code>axisartist</code>工具包</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/12" target="_blank" rel="noopener">十二、使用<code>axes_grid1</code>工具包</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/13" target="_blank" rel="noopener">十三、使用 Cartopy 工具包绘制地理地图</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-30-cookbook/14" target="_blank" rel="noopener">十四、使用 Seaborn 工具包的探索性数据分析</a></li>
</ul>
</li>
<li>Matplotlib 绘图秘籍<ul>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-plot-cookbook/ch00" target="_blank" rel="noopener">零、前言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-plot-cookbook/ch01" target="_blank" rel="noopener">一、第一步</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-plot-cookbook/ch02" target="_blank" rel="noopener">二、自定义颜色和样式</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-plot-cookbook/ch03" target="_blank" rel="noopener">三、处理标注</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-plot-cookbook/ch04" target="_blank" rel="noopener">四、处理图形</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-plot-cookbook/ch05" target="_blank" rel="noopener">五、文件输出</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-plot-cookbook/ch06" target="_blank" rel="noopener">六、处理地图</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-plot-cookbook/ch07" target="_blank" rel="noopener">七、处理 3D 图形</a></li>
<li><a href="https://ds.apachecn.org/#/docs/matplotlib-plot-cookbook/ch08" target="_blank" rel="noopener">八、用户界面</a></li>
</ul>
</li>
<li>Sklearn 秘籍<ul>
<li><a href="https://ds.apachecn.org/#/docs/sklearn-cookbook/1" target="_blank" rel="noopener">第一章 模型预处理</a></li>
<li><a href="https://ds.apachecn.org/#/docs/sklearn-cookbook/2" target="_blank" rel="noopener">第二章 处理线性模型</a></li>
<li><a href="https://ds.apachecn.org/#/docs/sklearn-cookbook/3" target="_blank" rel="noopener">第三章 使用距离向量构建模型</a></li>
<li><a href="https://ds.apachecn.org/#/docs/sklearn-cookbook/4" target="_blank" rel="noopener">第四章 使用 scikit-learn 对数据分类</a></li>
<li><a href="https://ds.apachecn.org/#/docs/sklearn-cookbook/5" target="_blank" rel="noopener">第五章 模型后处理</a></li>
</ul>
</li>
<li>Sklearn 学习手册<ul>
<li><a href="https://ds.apachecn.org/#/docs/learning-sklearn/ch01" target="_blank" rel="noopener">一、机器学习 - 温和的介绍</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-sklearn/ch02" target="_blank" rel="noopener">二、监督学习</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-sklearn/ch03" target="_blank" rel="noopener">三、无监督学习</a></li>
<li><a href="https://ds.apachecn.org/#/docs/learning-sklearn/ch04" target="_blank" rel="noopener">四、高级功能</a></li>
</ul>
</li>
<li>UCSD COGS108 数据科学实战中文笔记<ul>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/00-Introduction" target="_blank" rel="noopener">零、数据科学实战</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/01-JupyterNotebooks" target="_blank" rel="noopener">一、Jupyter 笔记本</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/02-DataAnalysis" target="_blank" rel="noopener">二、数据分析</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/03-Python" target="_blank" rel="noopener">三、Python</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/04-DataSciencePython" target="_blank" rel="noopener">四、Python 中的数据科学</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/05-DataGathering" target="_blank" rel="noopener">五、数据收集</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/06-DataWrangling" target="_blank" rel="noopener">六、数据整理</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/07-DataCleaning" target="_blank" rel="noopener">七、数据清理</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/08-DataPrivacy&amp;Anonymization" target="_blank" rel="noopener">八、数据隐私和匿名化</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/09-DataVisualization" target="_blank" rel="noopener">九、使用 Python 进行数据可视化</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/10-Distributions" target="_blank" rel="noopener">十、分布</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/11-TestingDistributions" target="_blank" rel="noopener">十一、检验分布</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/13-OrdinaryLeastSquares" target="_blank" rel="noopener">十三、普通最小二乘</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/14-LinearModels" target="_blank" rel="noopener">十四、线性模型</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/15-Clustering" target="_blank" rel="noopener">十五、聚类</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/16-DimensionalityReduction" target="_blank" rel="noopener">十六、降维</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/17-Classification" target="_blank" rel="noopener">十七、分类</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/18-NaturalLanguageProcessing" target="_blank" rel="noopener">十八、自然语言处理</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/A1-PythonPackages" target="_blank" rel="noopener">附录一、有用的 Python 数据科学包</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ucsd-cogs108-notes/A2-Git" target="_blank" rel="noopener">附录二、git/Github 版本控制工具</a></li>
</ul>
</li>
<li>USF MSDS501 计算数据科学中文讲义<ul>
<li>一、起步<ul>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/1.1_sound" target="_blank" rel="noopener">1.1 一些动机（音频处理）</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/1.2_hello" target="_blank" rel="noopener">1.2 Python 工具的初次尝试</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/1.3_sound" target="_blank" rel="noopener">1.3 播放声音</a></li>
</ul>
</li>
<li>二、设计和构建程序<ul>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/2.1_programming" target="_blank" rel="noopener">2.1 编程导论</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/2.2_data-in-memory" target="_blank" rel="noopener">2.2 在内存中表示数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/2.3_computation" target="_blank" rel="noopener">2.3 计算模型</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/2.4_python-patterns" target="_blank" rel="noopener">2.4 Python 中的编程模式</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/2.5_aliasing" target="_blank" rel="noopener">2.5 数据别名</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/2.6_functions" target="_blank" rel="noopener">2.6 使用函数组织你的代码</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/2.7_reading-code" target="_blank" rel="noopener">2.7 如何阅读代码</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/2.8_OO" target="_blank" rel="noopener">2.8 面向对象编程</a></li>
</ul>
</li>
<li>三、关键编程模式<ul>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/3.1_files" target="_blank" rel="noopener">3.1 加载文件</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/3.2_dataframes" target="_blank" rel="noopener">3.2 数据帧</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/3.3_data" target="_blank" rel="noopener">3.3 操纵和可视化数据</a></li>
</ul>
</li>
<li>四、用于计算和优化的迭代式方法<ul>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/4.1_random-uniform" target="_blank" rel="noopener">4.1 生成均匀的随机数</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/4.2_sqrt" target="_blank" rel="noopener">4.2 近似平方根</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/4.3_gradient-descent" target="_blank" rel="noopener">4.3 单变量梯度下降</a></li>
</ul>
</li>
<li>五、常见编程工具<ul>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/5.1_bash-intro" target="_blank" rel="noopener">5.1 使用 bash 走向胜利</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/5.2_git" target="_blank" rel="noopener">5.2 使用 git 版本控制工具</a></li>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/5.3_aws" target="_blank" rel="noopener">5.3 在 Amazon Web Services 上启动虚拟机</a></li>
</ul>
</li>
<li>六、可选<ul>
<li><a href="https://ds.apachecn.org/#/docs/usf-msds501-notes/6.1_linked-list" target="_blank" rel="noopener">6.1 链表</a></li>
</ul>
</li>
</ul>
</li>
<li>fast.ai 数值线性代数讲义中文版 v2<ul>
<li><a href="https://ds.apachecn.org/#/docs/fastai-num-linalg-v2/1" target="_blank" rel="noopener">一、我们为什么在这里</a></li>
<li><a href="https://ds.apachecn.org/#/docs/fastai-num-linalg-v2/2" target="_blank" rel="noopener">二、SVD 背景消除</a></li>
<li><a href="https://ds.apachecn.org/#/docs/fastai-num-linalg-v2/3" target="_blank" rel="noopener">三、使用 NMF 和 SVD 的主题建模</a></li>
<li><a href="https://ds.apachecn.org/#/docs/fastai-num-linalg-v2/4" target="_blank" rel="noopener">四、随机化 SVD</a></li>
<li><a href="https://ds.apachecn.org/#/docs/fastai-num-linalg-v2/5" target="_blank" rel="noopener">五、LU 分解</a></li>
<li><a href="https://ds.apachecn.org/#/docs/fastai-num-linalg-v2/6" target="_blank" rel="noopener">六、使用鲁棒回归的 CT 扫描的压缩感知</a></li>
<li><a href="https://ds.apachecn.org/#/docs/fastai-num-linalg-v2/7" target="_blank" rel="noopener">七、线性回归和健康结果</a></li>
<li><a href="https://ds.apachecn.org/#/docs/fastai-num-linalg-v2/8" target="_blank" rel="noopener">八、如何实现线性回归</a></li>
<li><a href="https://ds.apachecn.org/#/docs/fastai-num-linalg-v2/9" target="_blank" rel="noopener">九、PageRank 和特征值分解</a></li>
<li><a href="https://ds.apachecn.org/#/docs/fastai-num-linalg-v2/10" target="_blank" rel="noopener">十、实现 QR 分解</a></li>
</ul>
</li>
<li>SciPyCon 2018 sklearn 教程<ul>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/1" target="_blank" rel="noopener">一、Python 机器学习简介</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/2" target="_blank" rel="noopener">二、Python 中的科学计算工具</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/3" target="_blank" rel="noopener">三、数据表示和可视化</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/4" target="_blank" rel="noopener">四、训练和测试数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/5" target="_blank" rel="noopener">五、监督学习第一部分：分类</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/6" target="_blank" rel="noopener">六、监督学习第二部分：回归分析</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/7" target="_blank" rel="noopener">七、无监督学习第一部分：变换</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/8" target="_blank" rel="noopener">八、无监督学习第二部分：聚类</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/9" target="_blank" rel="noopener">九、sklearn 估计器接口回顾</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/10" target="_blank" rel="noopener">十、案例学习：泰坦尼克幸存者</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/11" target="_blank" rel="noopener">十一、文本特征提取</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/12" target="_blank" rel="noopener">十二、案例学习：用于 SMS 垃圾检测的文本分类</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/13" target="_blank" rel="noopener">十三、交叉验证和得分方法</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/14" target="_blank" rel="noopener">十四、参数选择、验证和测试</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/15" target="_blank" rel="noopener">十五、估计器流水线</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/16" target="_blank" rel="noopener">十六、模型评估、得分指标和处理不平衡类别</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/17" target="_blank" rel="noopener">十七、深入：线性模型</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/18" target="_blank" rel="noopener">十八、深入：决策树与森林</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/19" target="_blank" rel="noopener">十九、自动特征选择</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/20" target="_blank" rel="noopener">二十、无监督学习：层次和基于密度的聚类算法</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/21" target="_blank" rel="noopener">二十一、无监督学习：非线性降维</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/22" target="_blank" rel="noopener">二十二、无监督学习：异常检测</a></li>
<li><a href="https://ds.apachecn.org/#/docs/scipycon-2018-sklearn-tut/23" target="_blank" rel="noopener">二十三、核外学习 - 用于语义分析的大规模文本分类</a></li>
</ul>
</li>
<li>社交媒体挖掘<ul>
<li>第一部分 数据挖掘<ul>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/1" target="_blank" rel="noopener">1 应了解的编程语言</a></li>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/2" target="_blank" rel="noopener">2 从哪里获取数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/3" target="_blank" rel="noopener">3 用代码获取数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/4" target="_blank" rel="noopener">4 收集自己的 FACEBOOK 数据</a></li>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/5" target="_blank" rel="noopener">5 抓取实时站点</a></li>
</ul>
</li>
<li>第二部分 数据分析<ul>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/6" target="_blank" rel="noopener">6 数据分析导论</a></li>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/7" target="_blank" rel="noopener">7 数据可视化</a></li>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/8" target="_blank" rel="noopener">8 数据分析的高级工具</a></li>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/8" target="_blank" rel="noopener">9 在 REDDIT 数据中寻找趋势</a></li>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/10" target="_blank" rel="noopener">10 测量公众人物的 Twitter 活动</a></li>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/11" target="_blank" rel="noopener">11 何去何从</a></li>
</ul>
</li>
<li>附录<ul>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/101" target="_blank" rel="noopener">1 编写程序通过 API 获取网站的信息</a></li>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/102" target="_blank" rel="noopener">2 通过解析网页直接获取哔哩某播主的详细信息</a></li>
<li><a href="https://ds.apachecn.org/#/docs/social-media-mining/103" target="_blank" rel="noopener">3 在离线表格软件中打开和处理 csv 文件</a></li>
</ul>
</li>
</ul>
</li>
<li>Python 机器学习在线指南<ul>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/3" target="_blank" rel="noopener">作者</a></li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/5" target="_blank" rel="noopener">引言</a></li>
<li>核心概念<ul>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/7" target="_blank" rel="noopener">交叉验证</a></li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/8" target="_blank" rel="noopener">线性回归</a></li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/9" target="_blank" rel="noopener">过拟合和欠拟合</a></li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/10" target="_blank" rel="noopener">正则化</a></li>
</ul>
</li>
<li>监督学习<ul>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/12" target="_blank" rel="noopener">逻辑回归</a></li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/13" target="_blank" rel="noopener">朴素贝叶斯分类</a></li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/14" target="_blank" rel="noopener">决策树</a></li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/15" target="_blank" rel="noopener">k 最近邻</a></li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/16" target="_blank" rel="noopener">线性支持向量机</a></li>
</ul>
</li>
<li>无监督学习<ul>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/18" target="_blank" rel="noopener">聚类</a></li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/19" target="_blank" rel="noopener">主成分分析</a></li>
</ul>
</li>
<li>深度学习<ul>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/21" target="_blank" rel="noopener">多层感知机</a></li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/22" target="_blank" rel="noopener">卷积神经网络</a></li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/23" target="_blank" rel="noopener">自编码器</a></li>
</ul>
</li>
<li><a href="https://ds.apachecn.org/#/docs/vt-cs4624-pyml/25" target="_blank" rel="noopener">原文的协议</a></li>
</ul>
</li>
<li>数据科学和人工智能技术笔记<ul>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/1" target="_blank" rel="noopener">一、向量、矩阵和数组</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/2" target="_blank" rel="noopener">二、数据准备</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/3" target="_blank" rel="noopener">三、数据预处理</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/4" target="_blank" rel="noopener">四、图像预处理</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/5" target="_blank" rel="noopener">五、文本预处理</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/6" target="_blank" rel="noopener">六、日期时间预处理</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/7" target="_blank" rel="noopener">七、特征工程</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/8" target="_blank" rel="noopener">八、特征选择</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/9" target="_blank" rel="noopener">九、模型验证</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/10" target="_blank" rel="noopener">十、模型选择</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/11" target="_blank" rel="noopener">十一、线性回归</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/12" target="_blank" rel="noopener">十二、逻辑回归</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/13" target="_blank" rel="noopener">十三、树和森林</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/14" target="_blank" rel="noopener">十四、K 最近邻</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/15" target="_blank" rel="noopener">十五、支持向量机</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/16" target="_blank" rel="noopener">十六、朴素贝叶斯</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/17" target="_blank" rel="noopener">十七、聚类</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/18" target="_blank" rel="noopener">十八、Keras</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/19.1" target="_blank" rel="noopener">十九、数据整理（上）</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/19.2" target="_blank" rel="noopener">十九、数据整理（下）</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/20" target="_blank" rel="noopener">二十、数据可视化</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ds-ai-tech-notes/21" target="_blank" rel="noopener">二十一、统计学</a></li>
</ul>
</li>
<li>写给人类的机器学习<ul>
<li><a href="https://ds.apachecn.org/#/docs/ml-for-humans/1" target="_blank" rel="noopener">一、为什么机器学习重要</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ml-for-humans/2.1" target="_blank" rel="noopener">2.1 监督学习</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ml-for-humans/2.2" target="_blank" rel="noopener">2.2 监督学习 II</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ml-for-humans/2.3" target="_blank" rel="noopener">2.3 监督学习 III</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ml-for-humans/3" target="_blank" rel="noopener">三、无监督学习</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ml-for-humans/4" target="_blank" rel="noopener">四、神经网络和深度学习</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ml-for-humans/5" target="_blank" rel="noopener">五、强化学习</a></li>
<li><a href="https://ds.apachecn.org/#/docs/ml-for-humans/6" target="_blank" rel="noopener">六、最好的机器学习资源</a></li>
</ul>
</li>
<li><a href="https://ds.apachecn.org/#/docs/super-machine-learning-revision-notes/README" target="_blank" rel="noopener">机器学习超级复习笔记</a></li>
</ul>
<h1 id="一、处理不同种类的数据集"><a href="#一、处理不同种类的数据集" class="headerlink" title="一、处理不同种类的数据集"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=一、处理不同种类的数据集" target="_blank" rel="noopener">一、处理不同种类的数据集</a></h1><p>在本章中，我们将学习如何在 Pandas 中使用不同种类的数据集格式。 我们将学习如何使用 Pandas 导入的 CSV 文件提供的高级选项。 我们还将研究如何在 Pandas 中使用 Excel 文件，以及如何使用<code>read_excel</code>方法的高级选项。 我们将探讨其他一些使用流行数据格式的 Pandas 方法，例如 HTML，JSON，PKL 文件，SQL 等。</p>
<h1 id="从-CSV-文件读取数据时使用高级选项-1"><a href="#从-CSV-文件读取数据时使用高级选项-1" class="headerlink" title="从 CSV 文件读取数据时使用高级选项"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=从-csv-文件读取数据时使用高级选项" target="_blank" rel="noopener">从 CSV 文件读取数据时使用高级选项</a></h1><p>在本部分中，我们将 CSV 和 Pandas 结合使用，并学习如何使用<code>read_csv</code>方法读取 CSV 数据集以及高级选项。</p>
<h1 id="导入模块"><a href="#导入模块" class="headerlink" title="导入模块"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=导入模块" target="_blank" rel="noopener">导入模块</a></h1><p>首先，我们将使用以下命令导入<code>pandas</code>模块：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>要读取 CSV 文件，我们使用<code>read_csv</code>方法，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'IMDB.csv'</span>, encoding = <span class="string">"ISO-8859-1"</span>)</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>为了执行基本导入，请将数据集的文件名传递给<code>read_csv</code>，并将结果数据帧分配给变量。 在以下屏幕截图中，我们可以看到 Pandas 已将数据集转换为表格格式：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/cfe3ed2e-29c2-480d-8033-c65564c39388.png" alt="img"></p>
<h1 id="高级读取选项"><a href="#高级读取选项" class="headerlink" title="高级读取选项"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=高级读取选项" target="_blank" rel="noopener">高级读取选项</a></h1><p>在 Python 中，pandas 具有<code>read_csv</code>方法的许多高级选项，您可以在其中控制如何从 CSV 文件读取数据。</p>
<h1 id="处理列，索引位置和名称"><a href="#处理列，索引位置和名称" class="headerlink" title="处理列，索引位置和名称"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=处理列，索引位置和名称" target="_blank" rel="noopener">处理列，索引位置和名称</a></h1><p>默认情况下，<code>read_csv</code>将 CSV 文件第一行中的条目视为列名。 我们可以通过将<code>header</code>设置为<code>None</code>来关闭此功能，如以下代码块所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'IMDB.csv'</span>, encoding = <span class="string">"ISO-8859-1"</span>, header=<span class="literal">None</span>)</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/e1f24ca1-344b-4700-bb36-38a6102167a3.png" alt="img"></p>
<h1 id="指定另一行作为标题"><a href="#指定另一行作为标题" class="headerlink" title="指定另一行作为标题"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=指定另一行作为标题" target="_blank" rel="noopener">指定另一行作为标题</a></h1><p>您还可以通过将行号传递给<code>header</code>选项，从而从其他行（而不是默认的第一行）设置列名，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'IMDB.csv'</span>, encoding = <span class="string">"ISO-8859-1"</span>, header=<span class="number">2</span>)</span><br><span class="line">df.head()</span><br><span class="line">复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/7bf7d1c8-8b22-4fe1-bdcf-82a45d868d85.png" alt="img"></p>
<h1 id="将列指定为索引"><a href="#将列指定为索引" class="headerlink" title="将列指定为索引"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=将列指定为索引" target="_blank" rel="noopener">将列指定为索引</a></h1><p>默认情况下，<code>read_csv</code>在读取数据时分配一个默认的数字索引，该索引从零开始。 但是，您可以通过将列名传递给索引列选项来更改此行为。 然后，Pandas 会将索引设置为此列，如以下代码所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'IMDB.csv'</span>, encoding = <span class="string">"ISO-8859-1"</span>, index_col=<span class="string">'Title'</span>)</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>在这里，我们传递了电影标题作为索引名称。 现在，索引名称为<code>Title</code>，而不是默认的数字索引，如以下屏幕截图所示：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/478b7fde-0165-48fc-a2a6-9b8207751094.png" alt="img"></p>
<h1 id="选择要读取的列的子集"><a href="#选择要读取的列的子集" class="headerlink" title="选择要读取的列的子集"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=选择要读取的列的子集" target="_blank" rel="noopener">选择要读取的列的子集</a></h1><p>我们还可以选择读取 CSV 文件中特定列的子集。 为此，我们将列名作为列表传递，以使用<code>columns</code>选项，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'IMDB.csv'</span>, encoding = <span class="string">"ISO-8859-1"</span>, usecols=[<span class="string">'Title'</span>, <span class="string">'Genre1'</span>])</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>前面的代码段的输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/0f20610e-b198-4572-9084-ab850b82c096.png" alt="img"></p>
<h1 id="处理缺失和不适用的数据"><a href="#处理缺失和不适用的数据" class="headerlink" title="处理缺失和不适用的数据"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=处理缺失和不适用的数据" target="_blank" rel="noopener">处理缺失和不适用的数据</a></h1><p>接下来，我们将看到如何通过读取 CSV 文件来处理丢失的数据。 默认情况下，<code>read_csv</code>认为缺少以下值并将其标记为<code>NaN</code>：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/c330d7f5-b1c0-4fc8-8fb2-d4bf7a5eb8a7.png" alt="img"></p>
<p>但是，您可以添加到此列表。 为此，只需将要视为<code>NaN</code>的值列表传递给，如以下代码所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'IMDB.csv'</span>, encoding = <span class="string">"ISO-8859-1"</span>, na_values=[<span class="string">''</span>])复制ErrorOK!</span><br></pre></td></tr></table></figure>
<h1 id="选择是否跳过空白行"><a href="#选择是否跳过空白行" class="headerlink" title="选择是否跳过空白行"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=选择是否跳过空白行" target="_blank" rel="noopener">选择是否跳过空白行</a></h1><p>有时整行没有值； 因此，我们可以在读取数据时选择处理这些行。 默认情况下，<code>read_csv</code>会忽略空白行，但是我们可以通过将<code>skip_blank_lines</code>设置为<code>False</code>来关闭此行，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'IMDB.csv'</span>, encoding = <span class="string">"ISO-8859-1"</span>, skip_blank_lines=<span class="literal">False</span>)复制ErrorOK!</span><br></pre></td></tr></table></figure>
<h1 id="数据解析选项"><a href="#数据解析选项" class="headerlink" title="数据解析选项"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=数据解析选项" target="_blank" rel="noopener">数据解析选项</a></h1><p>我们可以通过读取 CSV 文件来选择跳过哪些行。 我们可以将行号作为列表传递给<code>skiprows</code>选项。 第一行的索引为零，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'IMDB.csv'</span>, encoding = <span class="string">"ISO-8859-1"</span>, skiprows = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">7</span>])</span><br><span class="line">df.head()</span><br><span class="line">复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/80076b18-0c73-4252-b86f-f088e6ed6dad.png" alt="img"></p>
<h1 id="从文件的页脚或结尾跳过行"><a href="#从文件的页脚或结尾跳过行" class="headerlink" title="从文件的页脚或结尾跳过行"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=从文件的页脚或结尾跳过行" target="_blank" rel="noopener">从文件的页脚或结尾跳过行</a></h1><p>要从页脚或文件末尾跳过行，请使用<code>skipfooter</code>选项并传递一个数字，该数字指定要跳过的行数。 在以下代码中，我们通过了<code>2</code>。 如我们所见，在跳过最后两行之后，我们创建的上一个数据帧与我们创建的数据帧之间存在差异：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df.tail(<span class="number">2</span>)</span><br><span class="line">df = pd.read_csv(<span class="string">'IMDB.csv'</span>, encoding = <span class="string">"ISO-8859-1"</span>, skipfooter=<span class="number">2</span>, engine=<span class="string">'python'</span>)</span><br><span class="line">df.tail(<span class="number">2</span>)复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>以下屏幕截图显示了输出：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/c874e464-2cf3-4677-9828-2202c05a536b.png" alt="img"></p>
<h1 id="读取文件的子集或一定数量的行"><a href="#读取文件的子集或一定数量的行" class="headerlink" title="读取文件的子集或一定数量的行"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=读取文件的子集或一定数量的行" target="_blank" rel="noopener">读取文件的子集或一定数量的行</a></h1><p>有时数据文件太大，我们只想看一下前几行。 我们可以通过将要导入的行数传递到<code>nrows</code>选项来做到这一点，如以下代码所示。 在这里，我们将<code>100</code>传递给<code>nrows</code>，然后<code>nrows</code>仅读取数据集中的前一百行：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv(<span class="string">'IMDB.csv'</span>, encoding = <span class="string">"ISO-8859-1"</span>, nrows=<span class="number">100</span>)</span><br><span class="line">df.shape复制ErrorOK!</span><br></pre></td></tr></table></figure>
<h1 id="从-Excel-文件读取数据-1"><a href="#从-Excel-文件读取数据-1" class="headerlink" title="从 Excel 文件读取数据"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=从-excel-文件读取数据" target="_blank" rel="noopener">从 Excel 文件读取数据</a></h1><p>在本节中，我们将学习如何使用 Pandas 使用 Excel 数据来处理表格，以及如何使用 Pandas 的<code>read_excel</code>方法从 Excel 文件中读取数据。 我们将阅读并探索一个真实的 Excel 数据集，并使用 xplore 解析一些可用于解析 Excel 数据的高级选项。</p>
<p>熊猫内部使用 Python Excel 库<code>rd</code>从 Excel 文件中提取数据。 我们可以通过执行<code>conda install xlrd</code>来安装它。</p>
<p>首先，请确保命令行程序在安装前以管理员模式运行，如以下屏幕截图所示：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/aa1344e7-c572-4fdf-add1-89fc1e472e84.png" alt="img"></p>
<p>以下屏幕截图显示了我们将使用 Pandas 阅读和探索的 Excel 数据集：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/184c0d1e-e396-4c78-91af-0ba3ee54aaab.png" alt="img"></p>
<p>上一个屏幕截图是电影分级的集合，<a href="https://github.com/saipranava/IMDB" target="_blank" rel="noopener">可以在这里找到它</a>。</p>
<h1 id="基本的-Excel-读取"><a href="#基本的-Excel-读取" class="headerlink" title="基本的 Excel 读取"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=基本的-excel-读取" target="_blank" rel="noopener">基本的 Excel 读取</a></h1><p>我们正在使用 Pandas 的<code>read_excel</code>方法读取此数据。 以最简单的格式，我们只是将想要的 Excel 数据集的文件名传递给<code>read_excel</code>方法。 pandas 将 Excel 文件中的数据转换为 Pandas 数据帧。 Pandas 内部为此使用 Excel <code>rd</code>库。 在这里，Pandas 已读取数据并在内存中创建了表格数据对象，我们可以在我们的代码中访问，浏览和操作，如以下代码所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>)</span><br><span class="line">df.head()</span><br><span class="line">复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>前一个代码块的输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/2815fd21-3be7-4ffa-829b-85e735677409.png" alt="img"></p>
<p>pandas 有很多高级选项，我们可以使用它们来控制应如何读取数据。如以下屏幕截图所示：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/5a286568-dfd0-4d26-8ce9-1805adc4690b.png" alt="img"></p>
<h1 id="指定应读取的工作表"><a href="#指定应读取的工作表" class="headerlink" title="指定应读取的工作表"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=指定应读取的工作表" target="_blank" rel="noopener">指定应读取的工作表</a></h1><p>要指定应读取的纸张，请将值传递给<code>sheetname</code>选项。 如下面的屏幕快照所示，我们只是传递<code>0</code>，它是 Excel 工作表中第一张工作表的索引值。 这非常方便，尤其是当我们不知道确切的工作表名称时：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>, sheetname=<span class="number">0</span>)</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/821fc1c4-66e5-4d78-8833-5a18bd54d4dd.png" alt="img"></p>
<h1 id="从多张表读取数据"><a href="#从多张表读取数据" class="headerlink" title="从多张表读取数据"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=从多张表读取数据" target="_blank" rel="noopener">从多张表读取数据</a></h1><p>Excel 数据集文件附带数据和多个工作表。 实际上，这是许多用户更喜欢 Excel 而不是 CSV 的主要原因之一。 幸运的是，Pandas 支持从多张纸中读取数据。</p>
<h1 id="查找工作表名称"><a href="#查找工作表名称" class="headerlink" title="查找工作表名称"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=查找工作表名称" target="_blank" rel="noopener">查找工作表名称</a></h1><p>要找出工作表的名称，请将 Excel 文件传递到<code>ExcelFile</code>类，然后在结果对象上调用<code>sheet_names</code>属性。 该类将 Excel 文件中的图纸名称打印为列表。 如果我们想从名为<code>data-movies</code>的工作表中读取数据，它将类似于以下代码片段：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xls_file = pd.ExcelFile(<span class="string">'IMDB.xlsx'</span>)</span><br><span class="line">xls_file.sheet_names复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>接下来，我们在之前创建的 Excel 文件对象上调用<code>parse</code>方法，并传入我们想要读取的工作表名称。 然后我们将结果分配给两个单独的数据帧对象，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df1 = xls_file.parse(<span class="string">'movies'</span>)</span><br><span class="line">df2 = xls_file.parse(<span class="string">'by genre'</span>)</span><br><span class="line">df1.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>现在，我们从两个单独的数据帧，中的两个工作表中获取数据，如以下屏幕截图所示：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/51df758b-0331-47f7-9f5a-d53195e29b7f.png" alt="img"></p>
<h1 id="选择标题或列标签"><a href="#选择标题或列标签" class="headerlink" title="选择标题或列标签"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=选择标题或列标签" target="_blank" rel="noopener">选择标题或列标签</a></h1><p>默认情况下，pandas 会将列名称或标题设置为 Excel 文件中第一个非空白行的值。 但是，我们可以更改此行为。 在以下屏幕截图中，我们将值<code>3</code>传递给<code>header</code>选项，该选项告诉<code>read_excel</code>方法设置索引行<code>3</code>中的标题名称：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>, sheetname=<span class="number">1</span>, header=<span class="number">3</span>)</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>前面代码的输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/12d7f628-5b08-4cfa-9919-306cca42da97.png" alt="img"></p>
<h1 id="没有标题"><a href="#没有标题" class="headerlink" title="没有标题"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=没有标题" target="_blank" rel="noopener">没有标题</a></h1><p>我们还可以告诉<code>read_excel</code>忽略标题并将所有行都视为记录。 只要 Excel 没有标题行，就很方便。 为此，我们将<code>header</code>设置为<code>None</code>和，如以下代码所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>, sheetname=<span class="number">1</span>, header=<span class="literal">None</span>)</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/a1b88a66-420f-4bb6-ac46-103fd63509d4.png" alt="img"></p>
<h1 id="在开头跳过行"><a href="#在开头跳过行" class="headerlink" title="在开头跳过行"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=在开头跳过行" target="_blank" rel="noopener">在开头跳过行</a></h1><p>要跳过文件开头的行，只需将<code>skiprows</code>设置为要跳过的行数，如以下代码所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>, sheetname=<span class="number">1</span>, skiprows=<span class="number">7</span>)复制ErrorOK!</span><br></pre></td></tr></table></figure>
<h1 id="在末尾跳过行"><a href="#在末尾跳过行" class="headerlink" title="在末尾跳过行"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=在末尾跳过行" target="_blank" rel="noopener">在末尾跳过行</a></h1><p>为此，我们使用<code>skip_footer</code>选项，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>, sheetname=<span class="number">1</span>, ski_footer=<span class="number">10</span>)复制ErrorOK!</span><br></pre></td></tr></table></figure>
<h1 id="选择列"><a href="#选择列" class="headerlink" title="选择列"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=选择列" target="_blank" rel="noopener">选择列</a></h1><p>我们还可以选择只读取列的子集。 这是通过将<code>parse_cols</code>选项设置为数值来完成的，这将导致将列从<code>0</code>读取到我们设置解析列值的任何索引。 我们在这种情况下设置了<code>parse_cols=2</code>，它将读取 Excel 文件中的前三列，如以下代码片段所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>, sheetname= <span class="number">0</span>, parse_cols=<span class="number">2</span>)</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>以下是输出：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/cbc17e06-e0cb-4693-a19d-1d2e8101bc39.png" alt="img"></p>
<h1 id="列名"><a href="#列名" class="headerlink" title="列名"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=列名" target="_blank" rel="noopener">列名</a></h1><p>我们可以选择给列使用不同的名称，而不是标题行中提供的默认名称。 为此，我们将列名列表传递给<code>names</code>参数，如下所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>, sheetname=<span class="number">0</span>, parse_cols = <span class="number">2</span>, names=[<span class="string">'X'</span>,<span class="string">'Title'</span>,</span><br><span class="line">   <span class="string">'Rating'</span>], )</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>在下面的屏幕截图中，我们将列名设置为读取时传递的名称：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/cb689dbe-dff6-448e-ad42-896429b363f3.png" alt="img"></p>
<h1 id="读取数据时设置索引"><a href="#读取数据时设置索引" class="headerlink" title="读取数据时设置索引"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=读取数据时设置索引" target="_blank" rel="noopener">读取数据时设置索引</a></h1><p>默认情况下，<code>read_excel</code>用数字索引标记零，从<code>0</code>开始。 我们可以将索引或行标签设置为更高的值或我们的选择。 为此，我们将数据集的列名传递给<code>index_col</code>选项。 在以下代码中，我们将索引设置为<code>Title</code>列：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>, sheetname=<span class="number">0</span>, index_col=<span class="string">'Title'</span>)</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/75fb95a9-93d5-4196-aff7-d4bfa3c1541e.png" alt="img"></p>
<h1 id="读取时处理丢失的数据"><a href="#读取时处理丢失的数据" class="headerlink" title="读取时处理丢失的数据"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=读取时处理丢失的数据" target="_blank" rel="noopener">读取时处理丢失的数据</a></h1><p><code>read_excel</code>方法有一个值列表，它将被视为丢失，然后将其设置为<code>NaN</code>。 我们可以在使用<code>na_values</code>参数传递值列表时添加此代码，如以下代码所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_excel(<span class="string">'IMDB.xlsx'</span>, sheetname= <span class="number">0</span>, na_values=[<span class="string">' '</span>])复制ErrorOK!</span><br></pre></td></tr></table></figure>
<h1 id="读取其他流行格式的数据"><a href="#读取其他流行格式的数据" class="headerlink" title="读取其他流行格式的数据"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=读取其他流行格式的数据" target="_blank" rel="noopener">读取其他流行格式的数据</a></h1><p>在本节中，我们将探索 Pandas 的功能，以读取和使用各种流行的数据格式。 我们还将学习如何从 JSON 格式，HTML 文件和 PICKLE 数据集中读取数据，并且可以从基于 SQL 的数据库中读取数据。</p>
<h1 id="读取-JSON-文件"><a href="#读取-JSON-文件" class="headerlink" title="读取 JSON 文件"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=读取-json-文件" target="_blank" rel="noopener">读取 JSON 文件</a></h1><p>JSON 是用于结构化数据的最小可读格式。 它主要用于在服务器和 Web 应用之间传输数据，以替代 XML，如以下屏幕快照所示：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/c67f9d24-a64c-43d4-9f07-d5eccf714d35.png" alt="img"></p>
<h1 id="将-JSON-数据读入-Pandas-1"><a href="#将-JSON-数据读入-Pandas-1" class="headerlink" title="将 JSON 数据读入 Pandas"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=将-json-数据读入-pandas" target="_blank" rel="noopener">将 JSON 数据读入 Pandas</a></h1><p>为了读取 JSON 数据，pandas 提供了一种名为<code>read_json</code>的方法，其中我们传递了要读取的 JSON 数据文件的文件名和位置。 文件位置可以是本地文件，甚至可以是具有有效 URL 方案的互联网。 我们将结果数据帧分配给变量<code>DF</code>。</p>
<p><code>read_json</code>方法读取 JSON 数据并将其转换为 Pandas 数据帧对象，即表格数据格式，如以下代码所示。 JSON 数据现在可以以数据帧格式轻松访问，可以更轻松地进行操作和浏览：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">movies_json = pd.read_json(<span class="string">'IMDB.json'</span>)</span><br><span class="line">movies_json.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>上一个代码块将产生以下输出：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/4a1818ca-391b-48cb-9593-35960d5553bf.png" alt="img"></p>
<h1 id="读取-HTML-数据-1"><a href="#读取-HTML-数据-1" class="headerlink" title="读取 HTML 数据"></a><a href="https://ds.apachecn.org/#/docs/master-exp-analysis-pandas/1?id=读取-html-数据" target="_blank" rel="noopener">读取 HTML 数据</a></h1><p>pandas 内部使用<code>lxml</code> Python 模块读取 HTML 数据。 您可以通过执行<code>conda install lxml</code>，从命令行程序安装它，如以下屏幕截图所示：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/7b60aa19-d51d-43a7-bd80-bd26473a7a62.png" alt="img"></p>
<p>我们还可以从本地文件甚至直接从互联网导入 HTML 数据：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/5ef932a6-3683-46dd-ac95-62d223a07840.png" alt="img"></p>
<p>在这里，我们将 HTML 文件或 URL 的位置传递给<code>read_html</code>方法。<code>read_html</code>从 HTML 提取表格数据，然后将其转换为 Pandas 数据帧。 在以下代码中，我们以表格格式获取了从 HTML 文件提取的数据：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.read_html(<span class="string">'IMDB.html'</span>)复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/86a8b673-bec2-4b09-82aa-a733b9ab7cdc.png" alt="img"></p>
<h2 id="读取-PICKLE-文件-1"><a href="#读取-PICKLE-文件-1" class="headerlink" title="读取 PICKLE 文件"></a>读取 PICKLE 文件</h2><p>酸洗是将任何类型的 Python 对象（包括列表，字典等）转换为字符串的一种方式。 这个想法是，该字符串包含在另一个 Python 脚本中重构对象所需的所有信息。</p>
<p>我们使用<code>read_pickle</code>方法读取我们的 PICKLE 文件，如以下代码所示。 与其他数据格式一样，Pandas 根据读取的数据创建数据帧：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_pickle(<span class="string">'IMDB.p'</span>)</span><br><span class="line">df.head()复制ErrorOK!</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<p><img src="https://ds.apachecn.org/docs/master-exp-analysis-pandas/img/db67347d-5356-40ff-a4ec-38485abb9f6b.png" alt="img"></p>
<h2 id="读取-SQL-数据"><a href="#读取-SQL-数据" class="headerlink" title="读取 SQL 数据"></a>读取 SQL 数据</h2><p>在这里，我们将从流行的数据库浏览器 SQLite 中读取 SQL 数据，可以通过执行以下命令进行安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install sqlite</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line">conn = sqlite3.connect(<span class="string">"IMDB.sqlite"</span>)</span><br><span class="line">df = pd.read_sql_query(<span class="string">"SELECT * FROM IMDB;"</span>, conn)</span><br><span class="line">df.head()</span><br></pre></td></tr></table></figure>
<h2 id="从剪贴板读取数据"><a href="#从剪贴板读取数据" class="headerlink" title="从剪贴板读取数据"></a>从剪贴板读取数据</h2><p>使用 pandas 的<code>read_clipboard</code>方法读取数据并创建一个数据帧，如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_clipboard()</span><br><span class="line">df.head()</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在本章中，我们学习了如何在 Pandas 中使用不同种类的数据集格式。 我们学习了在导入 CSV 文件时如何使用 Pandas 提供的高级选项。 我们还看到了如何使用 Excel 数据集，并且探讨了可用于处理各种数据格式（例如 HTML，JSON，PICKLE 文件，SQL 等）的方法。</p>
<p>在下一章中，我们将学习如何在高级数据选择中使用 Pandas 技术。</p>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2020/12/02/使用Raml构建Restful-API/" itemprop="url">使用Raml构建Restful-API</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2020-12-02T15:19:36.000Z" itemprop="datePublished">1 个月前</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Technology/">Technology</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            15 分钟 读完 (约 2202 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>本文重点介绍如何使用Raml来构建RESTful API，从而来提高微服务团队开发人员的合作，涵盖了以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 恰到好处的Raml。</span><br><span class="line">2. 十分钟快速上手。</span><br><span class="line">3. 搭建Mock Server。</span><br><span class="line">4. 使用Docker分离数据和构建过程。</span><br></pre></td></tr></table></figure>
<p>本文的目的是在决策支持系统房地产调控专题中应用RAML，提高前后端开发效率及软件质量。</p>
<h2 id="恰到好处的Raml"><a href="#恰到好处的Raml" class="headerlink" title="恰到好处的Raml"></a>恰到好处的Raml</h2><p>在前后端分离的架构中，一个经典的优秀实践是<code>CDCD</code>（Consumer Driven Contract Development），即消费者驱动契约开发。该实践的两个核心点是：<code>消费者驱动</code>+ <code>契约</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. 消费者驱动。Service所提供的API是给不同的消费者去使用的，所以消费端需要消费什么数据，API就应该返回什么数据。剩下就是合同了，通俗的将就是API契约，</span><br><span class="line">2. 契约。通俗的讲是一个API契约，Service和Consumer（Consumer可以是前端或另一个Service）的API结构需要一个契约来统一管理，这样一来，负责Service和Consumer的开发人员都能参照同一套API契约独立并行开发，双方完成后进行集成联调。</span><br></pre></td></tr></table></figure>
<p>优秀的实践（CDCD）总是离不开优秀工具来做支撑，<a href="https://link.jianshu.com/?t=http://raml.org" target="_blank" rel="noopener">Raml</a>以及其生态群恰到好处地提供了我们想要的合同功能。<a href="https://link.jianshu.com/?t=http://raml.org" target="_blank" rel="noopener">Raml</a>是什么，先看一张官网：</p>
<img src="/2020/12/02/使用Raml构建Restful-API/raml.png" title="RAML">
<p><code>Design</code>、<code>Build</code>、<code>Test</code>、<code>Document</code>、<code>Share</code>，我们选择 <a href="https://link.jianshu.com/?t=http://raml.org" target="_blank" rel="noopener">Raml</a>，究根结底也是因为它这几大优秀的特性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 设计API。你可以快速的构造你的API，并以人类友好的格式将它呈现出来。它涵盖了一些重要设计的最佳实践，如建模、模式、模板以及代码重用。</span><br><span class="line">2. 构建API。一旦设计好你的API，你就可以借助一些开发工具，将设计好的静态API文档，变成一个服务器端来提供服务。</span><br><span class="line">3. 测试API。引入单元测试可以有效地保证API实现的正确性，你可以通过运行一些脚本来测试你服务端是否涵盖了你设计好的API。</span><br><span class="line">4. 文档化API。Raml可以帮助你脱离同步维护一份额外文档的痛苦。RAML是一门API描述语言，所以你的API一旦被描述，它就是一份现成的API文档。你可以借助一些工具将它生成可视化的文档。</span><br><span class="line">5. 分享以及维护你的API。你可以借助一个基本的JavaScript来生成一些交互式工具（API Consoles或API Nodebooks），这样其他开发者可以使用标准格式与你的维护团队进行交流。</span><br></pre></td></tr></table></figure>
<p>接下来，我们主要针对 <a href="https://link.jianshu.com/?t=http://raml.org" target="_blank" rel="noopener">Raml</a> 的前四个特性进行一个实践尝试。</p>
<h2 id="窥探Raml"><a href="#窥探Raml" class="headerlink" title="窥探Raml"></a>窥探Raml</h2><blockquote>
<p><code>共享</code>俨然成为了一个非常时髦的词汇。共享单车、共享汽车这些产品雨后春笋般的兴起。它们有一个共性：<code>商家集中提供大规模的服务，用户可以付出极低的价格就可以享用这种服务。</code>不可否认，这些产品正在促进社会进步（绿色出行），而真的共享了吗？我是持有怀疑态度的…</p>
</blockquote>
<p>我们要开发一款产品<code>共享图书馆</code>，一句话描述该产品的理念：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">任何注册用户都可以将自己拥有的图书共享到一个集中的虚拟图书馆，同时可以从这个图书馆中借阅任何图书。</span><br></pre></td></tr></table></figure>
<p>产品立项进入了开发期，第一个迭代（敏捷开发的术语，关于敏捷开发推荐阅读 <a href="https://link.jianshu.com/?t=http://www.infoq.com/cn/articles/my-agile-practice-in-thoughtworks" target="_blank" rel="noopener">我在ThoughtWorks的敏捷实践</a>），团队目标是用户管理的功能。我们将以用户故事的形式展开展开：</p>
<p><strong>作为管理员，ta可以查阅用户列表:</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">/users:</span><br><span class="line">  get:</span><br><span class="line">  description: 查看用户列表</span><br><span class="line">  queryParameters:</span><br><span class="line">    gender:</span><br><span class="line">      description: "性别"</span><br><span class="line">      required: false</span><br><span class="line">      type: string</span><br><span class="line">      pattern: "MALE|FEMALE"</span><br><span class="line">  responses:</span><br><span class="line">    200:</span><br><span class="line">      body:</span><br><span class="line">        application/json:</span><br><span class="line">          example: |</span><br><span class="line">            [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">"id"</span>: <span class="string">"2nldksfr4f2ifoa4g43rvfsdfdsfdaf2"</span>,</span><br><span class="line">                <span class="attr">"account"</span>: <span class="string">"sjyuan"</span>,</span><br><span class="line">                <span class="attr">"phoneNumber"</span>: <span class="string">"18192235667"</span>,</span><br><span class="line">                <span class="attr">"gender"</span>: <span class="string">"MALE"</span>,</span><br><span class="line">                <span class="attr">"name"</span>: <span class="string">"张三"</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br></pre></td></tr></table></figure>
<p>该API表示：操作资源<code>/users</code>，<code>get</code>表示使用的是HTTP GET方法。<code>queryParameters</code>定义了查询参数，<code>responses</code>定义了返回值，<code>example</code>描述了response body，它是一个JSON数组。</p>
<p><strong>作为普通用户，ta首先要注册一个账号：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">/users:</span><br><span class="line">  post:</span><br><span class="line">  description: 注册一个新用户</span><br><span class="line">  body:</span><br><span class="line">    application/json:</span><br><span class="line">      schema: |</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"type"</span>: <span class="string">"object"</span>,</span><br><span class="line">          <span class="string">"$schema"</span>: <span class="string">"http://json-schema.org/draft-03/schema"</span>,</span><br><span class="line">          <span class="string">"required"</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="string">"properties"</span>: &#123;</span><br><span class="line">            <span class="string">"account"</span>: &#123;</span><br><span class="line">              <span class="string">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">              <span class="string">"required"</span>: <span class="literal">true</span>,</span><br><span class="line">              <span class="string">"minLength"</span>: <span class="number">2</span>,</span><br><span class="line">              <span class="string">"maxLength"</span>: <span class="number">20</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"password"</span>: &#123;</span><br><span class="line">              <span class="string">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">              <span class="string">"required"</span>: <span class="literal">true</span>,</span><br><span class="line">              <span class="string">"minLength"</span>: <span class="number">6</span>,</span><br><span class="line">              <span class="string">"maxLength"</span>: <span class="number">32</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"phoneNumber"</span>: &#123;</span><br><span class="line">              <span class="string">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">              <span class="string">"required"</span>: <span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"name"</span>: &#123;</span><br><span class="line">              <span class="string">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">              <span class="string">"required"</span>: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">  responses:</span><br><span class="line">    <span class="number">201</span>:</span><br><span class="line">      body:</span><br><span class="line">        application/json:</span><br><span class="line">          example: |</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="string">"id"</span>: <span class="string">"2nldksfr4f2ifoa4g43rvfsdfdsfdaf2"</span>,</span><br><span class="line">              <span class="string">"account"</span>: <span class="string">"sjyuan"</span>,</span><br><span class="line">              <span class="string">"phoneNumber"</span>: <span class="string">"18192235667"</span>,</span><br><span class="line">              <span class="string">"name"</span>: <span class="string">"张三"</span></span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<p>该API使用了HTTP POST请求，<code>schema</code>定义了request body的校验格式。</p>
<p><strong>作为普通用户，ta可以查看自己的详情：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/users:</span><br><span class="line">  /&#123;account&#125;:</span><br><span class="line">    <span class="keyword">get</span>:</span><br><span class="line">    description: 查看给定账户名的用户信息</span><br><span class="line">    responses:</span><br><span class="line">      200:</span><br><span class="line">        body:</span><br><span class="line">          application/json:</span><br><span class="line">            example: |</span><br><span class="line">              [</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="string">"id"</span>: <span class="string">"2nldksfr4f2ifoa4g43rvfsdfdsfdaf2"</span>,</span><br><span class="line">                  <span class="string">"account"</span>: <span class="string">"sjyuan"</span>,</span><br><span class="line">                  <span class="string">"phoneNumber"</span>: <span class="string">"18192235667"</span>,</span><br><span class="line">                  <span class="string">"gender"</span>: <span class="string">"MALE"</span>,</span><br><span class="line">                  <span class="string">"name"</span>: <span class="string">"袁慎建"</span></span><br><span class="line">                &#125;</span><br><span class="line">              ]</span><br></pre></td></tr></table></figure>
<p><code>/{account}</code>是一个URI参数，传入的是用户的账号。</p>
<p><strong>作为普通用户，ta可以编辑自己的信息：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">/users:</span><br><span class="line">  /&#123;account&#125;:</span><br><span class="line">    put:</span><br><span class="line">    description: 更新给定账户名的用户信息</span><br><span class="line">    body:</span><br><span class="line">      application/json:</span><br><span class="line">        schema: |</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"object"</span>,</span><br><span class="line">            <span class="string">"$schema"</span>: <span class="string">"http://json-schema.org/draft-03/schema"</span>,</span><br><span class="line">            <span class="string">"required"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"properties"</span>: &#123;</span><br><span class="line">              <span class="string">"password"</span>: &#123;</span><br><span class="line">                <span class="string">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">                <span class="string">"required"</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"minLength"</span>: <span class="number">6</span>,</span><br><span class="line">                <span class="string">"maxLength"</span>: <span class="number">32</span></span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="string">"name"</span>: &#123;</span><br><span class="line">                <span class="string">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">                <span class="string">"required"</span>: <span class="literal">false</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">    responses:</span><br><span class="line">      <span class="number">301</span>:</span><br></pre></td></tr></table></figure>
<p>更新一个用户信息，我们使用了HTTP POST 请求。</p>
<p><strong>作为一个管理员，ta可以禁用或删除某些违规操作的用户：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/users:</span><br><span class="line">  /&#123;account&#125;:</span><br><span class="line">    <span class="keyword">delete</span>:</span><br><span class="line">      description: 删除给定账户名的用户</span><br><span class="line">      responses:</span><br><span class="line">        <span class="number">204</span>:</span><br></pre></td></tr></table></figure>
<p>删除一个用户，我们使用了HTTP DELETE请求。</p>
<p>到此为止，我们完成了简单的User增删改查的API设计。我们只是做一个快速的窥探，真实业务场景中的API远比这要复杂得多，我们会利用<code>include</code>来提高代码的复用，而一些Raml的高级特性，诸如：<code>data type</code>、<code>seurity</code>、<code>Resource Types</code>、<code>Traits</code>等，也将成为强有力的工具。关于Raml更多详细指南，可参阅： <a href="https://link.jianshu.com/?t=https://github.com/raml-org/raml-spec/blob/master/versions/raml-10/raml-10.md/" target="_blank" rel="noopener">Raml-spec</a>。</p>
<p>完整源代码保存在我的GitHub的 <a href="https://link.jianshu.com/?t=https://github.com/sjyuan-cc/restful-api-raml/tree/for-blog" target="_blank" rel="noopener">restful-api-raml</a>。</p>
<h2 id="构建你的API"><a href="#构建你的API" class="headerlink" title="构建你的API"></a>构建你的API</h2><p>我们已经完成了API的设计（用户的增删改查），API契约（合同）定好了。前、后端开发人员开始进入开发阶段。</p>
<p>接下来有新的需求：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. API设计好了，如何将其文档化，提供用户有好的阅读格式呢？</span><br><span class="line">2. API设计好，如何搭建基于设计API的Web Server，给前端的集成测试提供支持呢？</span><br></pre></td></tr></table></figure>
<p>问题一是前文提到的Raml的一大特性：<code>文档化API</code>。</p>
<p>问题二就需要我们将设计好API文档转变成一个Web Server，它也是Raml一大特性的体现：<code>构建API</code>。我们需要借助一些工具来完成这两件事情。</p>
<h3 id="文档化API"><a href="#文档化API" class="headerlink" title="文档化API"></a>文档化API</h3><p>在Raml官方文档中提及了三种工具，<a href="https://link.jianshu.com/?t=https://github.com/mulesoft/api-console" target="_blank" rel="noopener">API Console</a>、<a href="https://link.jianshu.com/?t=https://github.com/raml2html/raml2html" target="_blank" rel="noopener">RAML to HTML</a>、<a href="https://link.jianshu.com/?t=https://github.com/mikestowe/php-raml2html" target="_blank" rel="noopener">RAML2HTML for PHP</a>，我们将使用 <a href="https://link.jianshu.com/?t=https://github.com/raml2html/raml2html" target="_blank" rel="noopener">RAML to HTML</a>去做Raml到html的转换，再利用 <a href="https://link.jianshu.com/?t=https://github.com/tapio/live-server" target="_blank" rel="noopener">Live Server</a> run起一个静态文件服务，提供在浏览器查阅API文档的功能。</p>
<p>在开始之前，我们需要安装 <a href="https://link.jianshu.com/?t=https://www.npmjs.com/" target="_blank" rel="noopener">npm</a>。使用npm下载依赖，并定义一个任务：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  "dependencies": &#123;</span><br><span class="line">    "raml2html": "^6.1.0",</span><br><span class="line">  &#125;</span><br><span class="line">  "scripts": &#123;</span><br><span class="line">    "docs-generator": "raml2html data/api.raml &gt; api.html"</span><br><span class="line">    "docs-server": "live-server --port=8081 --watch=api.html --entry-file=api.html"</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>docs-generator 任务是用来将raml文档转换成html文档，docs-server 启动了一个轻量的静态文件服务，它可以监听api.html文件的变化（只需要刷新浏览器），运行下面命令，之后访问<code>http://127.0.0.1:8081</code>之后，可以看到：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm run docs-generator</span><br><span class="line">$ npm run docs-server</span><br></pre></td></tr></table></figure>
    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2020/03/04/使用Debezium和Kafka为MySQL数据库设置变化数据捕捉CDC/" itemprop="url">使用Debezium和Kafka为MySQL数据库设置变化数据捕捉CDC</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2020-03-04T05:51:00.000Z" itemprop="datePublished">10 个月前</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Technology/">Technology</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            2 小时 读完 (约 16243 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h1 id="讲解"><a href="#讲解" class="headerlink" title="讲解"></a>讲解</h1><p>本教程将引导您逐步运行Debezium 1.0.2.Final，以进行更改数据捕获（CDC）。您将使用Docker（1.9或更高版本）启动Debezium服务，运行带有简单示例数据库的MySQL数据库服务器，使用Debezium监视数据库，并查看结果事件流随着数据库中数据的更改而响应。</p>
<table>
<thead>
<tr>
<th></th>
<th>您已经完成了教程？使用Docker Compose 尝试<a href="https://debezium.io/documentation/reference/1.0/tutorial.html#docker-compose" target="_blank" rel="noopener">快速</a>入门，包括Debezium支持的所有数据库（MySQL，Postgres，MongoDB，SQL Server和Oracle）的示例设置。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<h2 id="什么是Debezium？"><a href="#什么是Debezium？" class="headerlink" title="什么是Debezium？"></a>什么是Debezium？</h2><p>Debezium是一个分布式平台，可将您现有的数据库转换为事件流，因此应用程序可以查看数据库中的每个行级更改并立即对其做出响应。Debezium建立在<a href="http://kafka.apache.org/" target="_blank" rel="noopener">Apache Kafka</a>之上，并提供<a href="http://kafka.apache.org/documentation.html#connect" target="_blank" rel="noopener">Kafka Connect</a>兼容连接器，用于监视特定的数据库管理系统。Debezium在Kafka日志中记录数据更改的历史记录，您的应用程序从该位置开始使用它们。这使您的应用程序可以轻松，正确，完全使用所有事件。即使您的应用程序停止（或崩溃），在重新启动后，它也会开始使用中断处的事件，因此不会丢失任何内容。</p>
<p>Debezium 1.0.2.Final通过其<a href="https://debezium.io/documentation/reference/1.0/connectors/mysql.html" target="_blank" rel="noopener">MySQL连接器</a>支持监视MySQL数据库服务器，这就是本演示中将使用的内容。在将来的版本中将添加对其他DBMS的支持。</p>
<h2 id="使用Docker运行Debezium"><a href="#使用Docker运行Debezium" class="headerlink" title="使用Docker运行Debezium"></a>使用Docker运行Debezium</h2><p>运行Debezium涉及三项主要服务：<a href="http://zookeeper.apache.org/" target="_blank" rel="noopener">ZooKeeper</a>，Kafka和Debezium的连接器服务。本教程将引导您使用<a href="http://docker.com/" target="_blank" rel="noopener">Docker</a>和<a href="https://hub.docker.com/u/debezium/" target="_blank" rel="noopener">Debezium的Docker映像</a>启动这些服务的单个实例。另一方面，生产环境要求运行每个服务的多个实例以提供性能，可靠性，复制和容错能力。这可以通过<a href="https://www.openshift.com/" target="_blank" rel="noopener">OpenShift</a>和<a href="http://kubernetes.io/" target="_blank" rel="noopener">Kubernetes之</a>类的平台来完成，该平台管理在多个主机和机器上运行的多个Docker容器，但是通常您需要将其<a href="https://debezium.io/documentation/reference/1.0/install.html" target="_blank" rel="noopener">安装在专用硬件上</a>。</p>
<h2 id="启动Docker"><a href="#启动Docker" class="headerlink" title="启动Docker"></a>启动Docker</h2><p>确保Docker已<a href="https://docs.docker.com/engine/installation/" target="_blank" rel="noopener">安装并</a>在Linux，OS X或Windows上运行。我们强烈建议在这些平台上使用最新版本的Docker，并且牢记这些说明。（通过Docker Machine在虚拟机中运行Docker不再是首选方法，Docker建议您升级。）</p>
<h2 id="从Debezium开始简单"><a href="#从Debezium开始简单" class="headerlink" title="从Debezium开始简单"></a>从Debezium开始简单</h2><p>为了进行简单的评估和实验，本教程将引导您在本地计算机上的单独容器中启动每个服务的单个实例。ZooKeeper和Kafka都在容器内部本地存储数据，正常使用需要将主机目录作为卷安装在主机上，以便在容器停止时保留持久数据。尽管我们的<a href="https://hub.docker.com/r/debezium/" target="_blank" rel="noopener">Docker映像</a>的文档描述了如何执行此操作，但在本教程中我们将跳过该操作。这意味着，当删除容器时，所有持久数据将丢失。这实际上是我们实验的理想选择，因为完成后您的计算机上将没有任何东西，而且您可以多次运行此实验，而不必清理它们之间的任何内容。</p>
<p>在本地运行多个服务可能会造成混乱，因此我们将使用一个单独的终端在前台运行每个容器。这样，容器的所有输出将显示在用于运行它的终端中。</p>
<table>
<thead>
<tr>
<th></th>
<th>这不是运行Docker容器的唯一方法。<code>-it</code>Docker无需在前台运行容器（使用），而是让您以<em>分离</em>模式运行容器（使用<code>-d</code>），在该模式下，容器已启动，并且Docker命令立即返回。分离模式容器不会在终端中显示其输出，尽管您始终可以使用来查看输出<code>docker logs --follow --name &lt;container-name&gt;</code>。这是我们为运行的每个容器命名的原因之一。有关更多详细信息，请参阅Docker文档。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<h3 id="启动ZooKeeper"><a href="#启动ZooKeeper" class="headerlink" title="启动ZooKeeper"></a>启动ZooKeeper</h3><p>在组成Debezium的所有不同服务/过程中，第一个启动的是ZooKeeper。运行以下命令，启动一个新的终端并使用ZooKeeper启动一个容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --name zookeeper -p 2181:2181 -p 2888:2888 -p 3888:3888 debezium/zookeeper:1.0</span><br></pre></td></tr></table></figure>
<p>这将使用<code>debezium/zookeeper</code>映像的1.0版运行一个新容器，并将名称分配<code>zookeeper</code>给该容器。该<code>-it</code>标志使容器具有交互性，这意味着它将终端的标准输入和输出附加到容器，以便您可以看到容器中正在发生的事情。该<code>--rm</code>标志指示Docker在停止时删除容器。这三个<code>-p</code>选项将容器的三个端口（例如2181、2888和3888）映射到Docker主机上的相同端口，以便其他容器（和容器外部的软件）可以与ZooKeeper进行通信。</p>
<p>您应该在终端中看到ZooKeeper的典型输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Starting up <span class="keyword">in</span> standalone mode</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /zookeeper/conf/zoo.cfg</span><br><span class="line">2017-09-21 07:15:55,417 - INFO  [main:QuorumPeerConfig@134] - Reading configuration from: /zookeeper/conf/zoo.cfg</span><br><span class="line">2017-09-21 07:15:55,419 - INFO  [main:DatadirCleanupManager@78] - autopurge.snapRetainCount <span class="built_in">set</span> to 3</span><br><span class="line">2017-09-21 07:15:55,419 - INFO  [main:DatadirCleanupManager@79] - autopurge.purgeInterval <span class="built_in">set</span> to 1</span><br><span class="line">2017-09-21 07:15:55,420 - WARN  [main:QuorumPeerMain@113] - Either no config or no quorum defined <span class="keyword">in</span> config, running  <span class="keyword">in</span> standalone mode</span><br><span class="line">2017-09-21 07:15:55,420 - INFO  [PurgeTask:DatadirCleanupManager<span class="variable">$PurgeTask</span>@138] - Purge task started.</span><br><span class="line">2017-09-21 07:15:55,425 - INFO  [PurgeTask:DatadirCleanupManager<span class="variable">$PurgeTask</span>@144] - Purge task completed.</span><br><span class="line">2017-09-21 07:15:55,427 - INFO  [main:QuorumPeerConfig@134] - Reading configuration from: /zookeeper/conf/zoo.cfg</span><br><span class="line">2017-09-21 07:15:55,427 - INFO  [main:ZooKeeperServerMain@96] - Starting server</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:zookeeper.version=3.4.10-39d3a4f269333c922ed3db283be479f9deacaa0f, built on 03/23/2017 10:13 GMT</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:host.name=51b46dd211d0</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:java.version=1.8.0_131</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:java.vendor=Oracle Corporation</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:java.home=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.131-3.b12.el7_3.x86_64/jre</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:java.class.path=/zookeeper/bin/../build/classes:/zookeeper/bin/../build/lib/*.jar:/zookeeper/bin/../lib/slf4j-log4j12-1.6.1.jar:/zookeeper/bin/../lib/slf4j-api-1.6.1.jar:/zookeeper/bin/../lib/netty-3.10.5.Final.jar:/zookeeper/bin/../lib/log4j-1.2.16.jar:/zookeeper/bin/../lib/jline-0.9.94.jar:/zookeeper/bin/../zookeeper-3.4.10.jar:/zookeeper/bin/../src/java/lib/*.jar:/zookeeper/conf:</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib</span><br><span class="line">2017-09-21 07:15:55,432 - INFO  [main:Environment@100] - Server environment:java.io.tmpdir=/tmp</span><br><span class="line">2017-09-21 07:15:55,433 - INFO  [main:Environment@100] - Server environment:java.compiler=&lt;NA&gt;</span><br><span class="line">2017-09-21 07:15:55,433 - INFO  [main:Environment@100] - Server environment:os.name=Linux</span><br><span class="line">2017-09-21 07:15:55,433 - INFO  [main:Environment@100] - Server environment:os.arch=amd64</span><br><span class="line">2017-09-21 07:15:55,433 - INFO  [main:Environment@100] - Server environment:os.version=4.4.0-93-generic</span><br><span class="line">2017-09-21 07:15:55,433 - INFO  [main:Environment@100] - Server environment:user.name=zookeeper</span><br><span class="line">2017-09-21 07:15:55,433 - INFO  [main:Environment@100] - Server environment:user.home=/zookeeper</span><br><span class="line">2017-09-21 07:15:55,433 - INFO  [main:Environment@100] - Server environment:user.dir=/zookeeper</span><br><span class="line">2017-09-21 07:15:55,435 - INFO  [main:ZooKeeperServer@829] - tickTime <span class="built_in">set</span> to 2000</span><br><span class="line">2017-09-21 07:15:55,435 - INFO  [main:ZooKeeperServer@838] - minSessionTimeout <span class="built_in">set</span> to -1</span><br><span class="line">2017-09-21 07:15:55,435 - INFO  [main:ZooKeeperServer@847] - maxSessionTimeout <span class="built_in">set</span> to -1</span><br><span class="line">2017-09-21 07:15:55,440 - INFO  [main:NIOServerCnxnFactory@89] - binding to port 0.0.0.0/0.0.0.0:2181</span><br></pre></td></tr></table></figure>
<p>最后一行很重要，它报告ZooKeeper已准备就绪并且正在侦听端口2181。在ZooKeeper生成该终端时，终端将继续显示其他输出。</p>
<h3 id="启动卡夫卡"><a href="#启动卡夫卡" class="headerlink" title="启动卡夫卡"></a>启动卡夫卡</h3><p>打开一个新终端，并通过运行以下命令使用它在新容器中启动Kafka：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --name kafka -p 9092:9092 --link zookeeper:zookeeper debezium/kafka:1.0</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th></th>
<th>在本教程中，我们总是从Docker容器中连接到Kafka，<code>kafka</code>只要我们链接到该<code>kafka</code>容器，他们就始终能够看到该容器并与之通信。如果我们想从Docker容器<em>外部</em>连接到Kafka ，则希望Kafka 通过Docker主机<em>发布</em>其地址，我们可以通过添加Docker主机<code>-e ADVERTISED_HOST_NAME=</code>的IP地址或可解析的主机名来实现， Mac上的Linux或Docker，这是主机的IP地址（不是<code>localhost</code>）。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>这将使用<code>debezium/kafka</code>映像的1.0版运行一个新容器，并将名称分配<code>kafka</code>给该容器。该<code>-it</code>标志使容器具有交互性，这意味着它将终端的标准输入和输出附加到容器，以便您可以看到容器中正在发生的事情。该<code>--rm</code>标志指示Docker在停止时删除容器。该命令将容器中的端口9092映射到Docker主机上的同一端口，以便容器外部的软件可以与Kafka进行通信。最后，命令使用<code>--link zookeeper:zookeeper</code>参数告诉容器它可以在<code>zookeeper</code>运行在同一Docker主机上的容器中找到ZooKeeper 。</p>
<p>您应该在终端中看到Kafka的典型输出，结尾为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:16:59,085 - INFO  [main-EventThread:ZkClient@713] - zookeeper state changed (SyncConnected)</span><br><span class="line">2017-09-21 07:16:59,218 - INFO  [main:Logging$class@70] - Cluster ID = LPtcBFxzRvOzDSXhc6AamA</span><br><span class="line">2017-09-21 07:16:59,221 - WARN  [main:Logging$class@85] - No meta.properties file under dir /kafka/data/1/meta.properties</span><br><span class="line">2017-09-21 07:16:59,247 - INFO  [ThrottledRequestReaper-Fetch:Logging$class@70] - [ThrottledRequestReaper-Fetch]: Starting</span><br><span class="line">2017-09-21 07:16:59,247 - INFO  [ThrottledRequestReaper-Produce:Logging$class@70] - [ThrottledRequestReaper-Produce]: Starting</span><br><span class="line">2017-09-21 07:16:59,248 - INFO  [ThrottledRequestReaper-Request:Logging$class@70] - [ThrottledRequestReaper-Request]: Starting</span><br><span class="line">2017-09-21 07:16:59,308 - INFO  [main:Logging$class@70] - Loading logs.</span><br><span class="line">2017-09-21 07:16:59,312 - INFO  [main:Logging$class@70] - Logs loading complete in 4 ms.</span><br><span class="line">2017-09-21 07:16:59,349 - INFO  [main:Logging$class@70] - Starting log cleanup with a period of 300000 ms.</span><br><span class="line">2017-09-21 07:16:59,353 - INFO  [main:Logging$class@70] - Starting log flusher with a default period of 9223372036854775807 ms.</span><br><span class="line">2017-09-21 07:16:59,385 - INFO  [main:Logging$class@70] - Awaiting socket connections on 172.17.0.4:9092.</span><br><span class="line">2017-09-21 07:16:59,387 - INFO  [main:Logging$class@70] - [Socket Server on Broker 1], Started 1 acceptor threads</span><br><span class="line">2017-09-21 07:16:59,394 - INFO  [ExpirationReaper-1-Produce:Logging$class@70] - [ExpirationReaper-1-Produce]: Starting</span><br><span class="line">2017-09-21 07:16:59,395 - INFO  [ExpirationReaper-1-Fetch:Logging$class@70] - [ExpirationReaper-1-Fetch]: Starting</span><br><span class="line">2017-09-21 07:16:59,395 - INFO  [ExpirationReaper-1-DeleteRecords:Logging$class@70] - [ExpirationReaper-1-DeleteRecords]: Starting</span><br><span class="line">2017-09-21 07:16:59,435 - INFO  [ExpirationReaper-1-topic:Logging$class@70] - [ExpirationReaper-1-topic]: Starting</span><br><span class="line">2017-09-21 07:16:59,441 - INFO  [ExpirationReaper-1-Heartbeat:Logging$class@70] - [ExpirationReaper-1-Heartbeat]: Starting</span><br><span class="line">2017-09-21 07:16:59,442 - INFO  [controller-event-thread:Logging$class@70] - Creating /controller (is it secure? false)</span><br><span class="line">2017-09-21 07:16:59,447 - INFO  [ExpirationReaper-1-Rebalance:Logging$class@70] - [ExpirationReaper-1-Rebalance]: Starting</span><br><span class="line">2017-09-21 07:16:59,456 - INFO  [controller-event-thread:Logging$class@70] - Result of znode creation is: OK</span><br><span class="line">2017-09-21 07:16:59,458 - INFO  [main:Logging$class@70] - [GroupCoordinator 1]: Starting up.</span><br><span class="line">2017-09-21 07:16:59,459 - INFO  [main:Logging$class@70] - [GroupCoordinator 1]: Startup complete.</span><br><span class="line">2017-09-21 07:16:59,460 - INFO  [group-metadata-manager-0:Logging$class@70] - [Group Metadata Manager on Broker 1]: Removed 0 expired offsets in 1 milliseconds.</span><br><span class="line">2017-09-21 07:16:59,487 - INFO  [main:Logging$class@70] - [ProducerId Manager 1]: Acquired new producerId block (brokerId:1,blockStartProducerId:0,blockEndProducerId:999) by writing to Zk with path version 1</span><br><span class="line">2017-09-21 07:16:59,530 - INFO  [main:Logging$class@70] - [Transaction Coordinator 1]: Starting up.</span><br><span class="line">2017-09-21 07:16:59,532 - INFO  [TxnMarkerSenderThread-1:Logging$class@70] - [Transaction Marker Channel Manager 1]: Starting</span><br><span class="line">2017-09-21 07:16:59,532 - INFO  [main:Logging$class@70] - [Transaction Coordinator 1]: Startup complete.</span><br><span class="line">2017-09-21 07:16:59,551 - INFO  [main:Logging$class@70] - Will not load MX4J, mx4j-tools.jar is not in the classpath</span><br><span class="line">2017-09-21 07:16:59,590 - INFO  [main:Logging$class@70] - Creating /brokers/ids/1 (is it secure? false)</span><br><span class="line">2017-09-21 07:16:59,604 - INFO  [main:Logging$class@70] - Result of znode creation is: OK</span><br><span class="line">2017-09-21 07:16:59,605 - INFO  [main:Logging$class@70] - Registered broker 1 at path /brokers/ids/1 with addresses: EndPoint(172.17.0.4,9092,ListenerName(PLAINTEXT),PLAINTEXT)</span><br><span class="line">2017-09-21 07:16:59,606 - WARN  [main:Logging$class@85] - No meta.properties file under dir /kafka/data/1/meta.properties</span><br><span class="line">2017-09-21 07:16:59,648 - INFO  [main:AppInfoParser$AppInfo@83] - Kafka version : 0.11.0.0</span><br><span class="line">2017-09-21 07:16:59,648 - INFO  [main:AppInfoParser$AppInfo@84] - Kafka commitId : cb8625948210849f</span><br><span class="line">2017-09-21 07:16:59,649 - INFO  [main:Logging$class@70] - [Kafka Server 1], started</span><br></pre></td></tr></table></figure>
<p>上面显示的最后一行报告说，Kafka代理已成功启动并且已准备好进行客户端连接。随着Kafka的生成，终端将继续显示其他输出。</p>
<table>
<thead>
<tr>
<th></th>
<th>Debezium 1.0.2.Final需要Kafka Connect 2.4.0，在本教程中，我们还将使用Kafka Broker的2.4.0版本。查看有关不同版本的Kafka Connect和Kafka代理之间兼容性的<a href="http://kafka.apache.org/documentation.html" target="_blank" rel="noopener">Kafka文档</a>。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<h3 id="启动一个MySQL数据库"><a href="#启动一个MySQL数据库" class="headerlink" title="启动一个MySQL数据库"></a>启动一个MySQL数据库</h3><p>至此，我们已经启动了ZooKeeper和Kafka，但是还没有Debezium可以从中捕获更改的数据库服务器。现在，让我们用示例数据库启动一个MySQL服务器。</p>
<p>打开一个新终端，并使用它来启动一个新容器，该容器运行一个预先配置有<code>inventory</code>数据库的MySQL数据库服务器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=debezium -e MYSQL_USER=mysqluser -e MYSQL_PASSWORD=mysqlpw debezium/example-mysql:1.0</span><br></pre></td></tr></table></figure>
<p>这将运行使用的版本1.0中的新的容器<code>debezium/example-mysql</code>的图像，这是<a href="https://github.com/debezium/docker-images/blob/master/examples/mysql/0.1/Dockerfile" target="_blank" rel="noopener">基于</a>所述<a href="https://hub.docker.com/r/_/mysql/" target="_blank" rel="noopener">的MySQL：5.7</a>图像，限定并填充的样品的“库存”数据库，并创建一个<code>debezium</code>用户与密码<code>dbz</code>具有由Debezium的MySQL的连接器所需的最小特权。该命令将名称分配给<code>mysql</code>容器，以便以后可以方便地引用它。该<code>-it</code>标志使容器具有交互性，这意味着它将终端的标准输入和输出附加到容器，以便您可以看到容器中正在发生的事情。的<code>--rm</code>标志指示Docker在停止时删除容器。该命令将容器中的端口3306（默认的MySQL端口）映射到Docker主机上的同一端口，以便容器外部的软件可以连接到数据库服务器。最后，该机还采用了<code>-e</code>选项三次的设置<code>MYSQL_ROOT_PASSWORD</code>，<code>MYSQL_USER</code>以及<code>MYSQL_PASSWORD</code>环境变量设置为特定值。</p>
<p>您应该在终端中看到以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">017-09-21T07:18:50.824629Z 0 [Note] mysqld: ready for connections.</span><br><span class="line">Version: &apos;5.7.19-log&apos;  socket: &apos;/var/run/mysqld/mysqld.sock&apos;  port: 3306  MySQL Community Server (GPL)</span><br></pre></td></tr></table></figure>
<p>请注意，随着修改配置，MySQL服务器会启动和停止几次。上面列出的最后一行报告MySQL服务器正在运行并且可以使用。</p>
<h3 id="启动MySQL命令行客户端"><a href="#启动MySQL命令行客户端" class="headerlink" title="启动MySQL命令行客户端"></a>启动MySQL命令行客户端</h3><p>打开一个新终端，并使用它为MySQL命令行客户端启动一个新容器，并将其连接到在该<code>mysql</code>容器中运行的MySQL服务器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --name mysqlterm --link mysql --rm mysql:5.7 sh -c <span class="string">'exec mysql -h"$MYSQL_PORT_3306_TCP_ADDR" -P"$MYSQL_PORT_3306_TCP_PORT" -uroot -p"$MYSQL_ENV_MYSQL_ROOT_PASSWORD"'</span></span><br></pre></td></tr></table></figure>
<p>在这里，我们使用<a href="https://hub.docker.com/r/_/mysql/" target="_blank" rel="noopener">mysql：5.7</a>映像启动容器，命名该容器<code>mysqlterm</code>并将其链接到<code>mysql</code>运行数据库服务器的容器。该<code>--rm</code>选项告诉Docker在停止时删除容器，该命令的其余部分定义了容器应运行的shell命令。此shell命令运行MySQL命令行客户端，并指定正确的选项，以便可以正确连接。</p>
<p>容器应输出类似于以下内容的行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql: [Warning] Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 3</span><br><span class="line">Server version: 5.7.17-log MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">'\c'</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>
<p>与其他容器不同，此容器运行一个产生提示的过程。我们将使用提示与数据库进行交互。首先，切换到“库存”数据库：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use inventory;</span><br></pre></td></tr></table></figure>
<p>然后列出数据库中的表：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br></pre></td></tr></table></figure>
<p>然后应显示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+<span class="comment">---------------------+</span></span><br><span class="line">| Tables_in_inventory |</span><br><span class="line">+<span class="comment">---------------------+</span></span><br><span class="line">| customers           |</span><br><span class="line">| orders              |</span><br><span class="line">| products            |</span><br><span class="line">| products_on_hand    |</span><br><span class="line">+<span class="comment">---------------------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>使用MySQL命令行客户端浏览数据库并查看数据库中预加载的数据。例如：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM customers;</span><br></pre></td></tr></table></figure>
<h3 id="启动Kafka-Connect"><a href="#启动Kafka-Connect" class="headerlink" title="启动Kafka Connect"></a>启动Kafka Connect</h3><p>打开一个新终端，并通过运行以下命令使用它在新容器中启动Kafka Connect服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --name connect -p 8083:8083 -e GROUP_ID=1 -e CONFIG_STORAGE_TOPIC=my_connect_configs -e OFFSET_STORAGE_TOPIC=my_connect_offsets -e STATUS_STORAGE_TOPIC=my_connect_statuses --link zookeeper:zookeeper --link kafka:kafka --link mysql:mysql debezium/connect:1.0</span><br></pre></td></tr></table></figure>
<p>这将运行一个<code>connect</code>使用该<code>debezium/connect</code>映像的1.0版命名的新Docker容器。该<code>-it</code>标志使容器具有交互性，这意味着它将终端的标准输入和输出附加到容器，以便您可以看到容器中正在发生的事情。该<code>--rm</code>标志指示Docker在停止时删除容器。该命令将容器中的端口8083映射到Docker主机上的相同端口，以便容器外部的软件可以使用Kafka Connect的REST API来设置和管理新的连接器实例。该命令使用<code>--link zookeeper:zookeeper</code>，<code>--link kafka:kafka</code>以及<code>--link mysql:mysql</code>，参数告诉容器，它可以找到的ZooKeeper中指定的容器中运行<code>zookeeper</code>，卡夫卡经纪人在名为容器中运行<code>kafka</code>，以及在名为的容器中运行的MySQL服务器<code>mysql</code>，它们均在同一Docker主机上运行。最后，该机还采用了<code>-e</code>选择三次设置<code>GROUP_ID</code>，<code>CONFIG_STORAGE_TOPIC</code>，<code>OFFSET_STORAGE_TOPIC</code>，和<code>STATUS_STORAGE_TOPIC</code>环境变量，它们都通过这个Debezium图像所需（尽管您可以根据需要使用不同的值）。</p>
<p>您应该在终端中看到Kafka Connect终端的典型输出，结尾为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:21:14,912 INFO   ||  Kafka version : 0.11.0.0   [org.apache.kafka.common.utils.AppInfoParser]</span><br><span class="line">2017-09-21 07:21:14,912 INFO   ||  Kafka commitId : cb8625948210849f   [org.apache.kafka.common.utils.AppInfoParser]</span><br><span class="line">2017-09-21 07:21:14,929 INFO   ||  Discovered coordinator 172.17.0.4:9092 (id: 2147483646 rack: null) for group 1.   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:21:14,931 INFO   ||  Finished reading KafkaBasedLog for topic my_connect_configs   [org.apache.kafka.connect.util.KafkaBasedLog]</span><br><span class="line">2017-09-21 07:21:14,932 INFO   ||  Started KafkaBasedLog for topic my_connect_configs   [org.apache.kafka.connect.util.KafkaBasedLog]</span><br><span class="line">2017-09-21 07:21:14,932 INFO   ||  Started KafkaConfigBackingStore   [org.apache.kafka.connect.storage.KafkaConfigBackingStore]</span><br><span class="line">2017-09-21 07:21:14,932 INFO   ||  Herder started   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:21:14,938 INFO   ||  Discovered coordinator 172.17.0.4:9092 (id: 2147483646 rack: null) for group 1.   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:21:14,940 INFO   ||  (Re-)joining group 1   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:21:15,022 INFO   ||  Successfully joined group 1 with generation 1   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:21:15,022 INFO   ||  Joined group and got assignment: Assignment&#123;error=0, leader=&apos;connect-1-4d60cb71-cb93-4388-8908-6f0d299a9d94&apos;, leaderUrl=&apos;http://172.17.0.7:9092/&apos;, offset=-1, connectorIds=[], taskIds=[]&#125;   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:21:15,023 INFO   ||  Starting connectors and tasks using config offset -1   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:21:15,023 INFO   ||  Finished starting connectors and tasks   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br></pre></td></tr></table></figure>
<p>上面显示的最后几行报告该服务已启动并且已准备好进行连接。随着Kafka Connect服务生成该终端，该终端将继续显示其他输出。</p>
<h4 id="使用Kafka-Connect-REST-API"><a href="#使用Kafka-Connect-REST-API" class="headerlink" title="使用Kafka Connect REST API"></a>使用Kafka Connect REST API</h4><p>Kafka Connect服务公开了RESTful API来管理连接器集，因此让我们通过<code>curl</code>命令行工具使用该API 。因为我们已将<code>connect</code>容器（运行Kafka Connect服务的端口）中的端口8083 映射到Docker主机上的端口8083，所以我们可以通过将请求发送到Docker主机上的端口8083来与该服务进行通信，然后将请求转发到Docker主机上。 Kafka Connect服务。我们<code>localhost</code>在示例中使用的是非本地Docker平台的用户（例如Windows和OS X上的Docker Toolbox用户），应替换<code>localhost</code>为其Docker主机的IP地址。</p>
<p>打开一个新终端，并使用它来检查Kafka Connect服务的状态：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -H <span class="string">"Accept:application/json"</span> localhost:8083/</span><br></pre></td></tr></table></figure>
<p>Kafka Connect服务应返回类似于以下内容的JSON响应消息：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"version"</span>:<span class="string">"2.4.0"</span>,<span class="attr">"commit"</span>:<span class="string">"cb8625948210849f"</span>&#125;</span><br></pre></td></tr></table></figure>
<p>这表明我们正在运行Kafka Connect 2.4.0版本。接下来，再次检查连接器列表，再次使用您的IP地址代替<code>localhost</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -H <span class="string">"Accept:application/json"</span> localhost:8083/connectors/</span><br></pre></td></tr></table></figure>
<p>应该返回以下内容：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[]</span><br></pre></td></tr></table></figure>
<p>这确认Kafka Connect服务正在运行，我们可以与之交谈，并且当前没有连接器。让我们补救一下，方法是启动一个连接器，该连接器将从MySQL数据库中捕获更改。</p>
<h3 id="监控MySQL数据库"><a href="#监控MySQL数据库" class="headerlink" title="监控MySQL数据库"></a>监控MySQL数据库</h3><p>此时，我们正在运行Debezium服务，带有示例<code>inventory</code>数据库的MySQL数据库服务器以及连接到数据库的MySQL命令行客户端。下一步是注册一个连接器，该连接器将开始监视MySQL数据库服务器的binlog，并为已更改（或将要更改）的每一行生成更改事件。由于这是一个新的连接器，因此在启动时它将从MySQL二进制日志的开头开始读取，该日志记录了所有事务，包括单个行的更改和对模式的更改。</p>
<table>
<thead>
<tr>
<th></th>
<th>通常，我们可能希望使用Kafka工具来手动创建必要的主题，包括指定副本数。但是，对于本教程，Kafka配置为仅使用1个副本自动创建主题。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>在同一终端上，我们将使用<code>curl</code>我们要启动的连接器信息向我们的Kafka Connect服务提交JSON请求消息。由于此命令将不在Docker容器中，因此我们需要使用Docker主机的IP地址（因此Windows和OS X上的Docker Toolbox用户应替换<code>localhost</code>为其IP地址）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -i -X POST -H <span class="string">"Accept:application/json"</span> -H <span class="string">"Content-Type:application/json"</span> localhost:8083/connectors/ -d <span class="string">'&#123; "name": "inventory-connector", "config": &#123; "connector.class": "io.debezium.connector.mysql.MySqlConnector", "tasks.max": "1", "database.hostname": "mysql", "database.port": "3306", "database.user": "debezium", "database.password": "dbz", "database.server.id": "184054", "database.server.name": "dbserver1", "database.whitelist": "inventory", "database.history.kafka.bootstrap.servers": "kafka:9092", "database.history.kafka.topic": "dbhistory.inventory" &#125; &#125;'</span></span><br></pre></td></tr></table></figure>
<p>|      | Windows用户可能需要转义双引号，如下所示：<figure class="highlight bash"><figcaption><span>$ curl -i -X POST -H "Accept:application/json" -H "Content-Type:application/json" localhost:8083/connectors/ -d '&#123; \"name\": \"inventory-connector\", \"config\": &#123; \"connector.class\": \"io.debezium.connector.mysql.MySqlConnector\", \"tasks.max\": \"1\", \"database.hostname\": \"mysql\", \"database.port\": \"3306\", \"database.user\": \"debezium\", \"database.password\": \"dbz\", \"database.server.id\": \"184054\", \"database.server.name\": \"dbserver1\", \"database.whitelist\": \"inventory\", \"database.history.kafka.bootstrap.servers\": \"kafka:9092\", \"database.history.kafka.topic\": \"dbhistory.inventory\" &#125; &#125;'`为避免此错误：`&#123;"error_code":500,"message":"Unexpected character ('n' (code 110)): was expecting double-quote to start field name\n at [Source: (org.glassfish.jersey.message.internal.ReaderInterceptorExecutor$UnCloseableInputStream); line: 1, column: 4]"&#125;``` |</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">| ---- | ------------------------------------------------------------ |</span><br><span class="line">|      | ```json &#123;<span class="string">"error_code"</span>:500,<span class="string">"message"</span>:<span class="string">"Unexpected character ('n' (code 110)): was expecting double-quote to start field name\n at [Source: (org.glassfish.jersey.message.internal.ReaderInterceptorExecutor<span class="variable">$UnCloseableInputStream</span>); line: 1, column: 4]"</span>&#125;``` |</span><br><span class="line"></span><br><span class="line">此命令使用Kafka Connect服务的RESTful API提交带有描述我们新连接器的JSON文档的资源`POST`请求`/connectors`。这是一条更具可读性的JSON消息：</span><br><span class="line"></span><br><span class="line">```json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"inventory-connector"</span>,</span><br><span class="line">  <span class="string">"config"</span>: &#123;</span><br><span class="line">    <span class="string">"connector.class"</span>: <span class="string">"io.debezium.connector.mysql.MySqlConnector"</span>,</span><br><span class="line">    <span class="string">"tasks.max"</span>: <span class="string">"1"</span>,</span><br><span class="line">    <span class="string">"database.hostname"</span>: <span class="string">"mysql"</span>,</span><br><span class="line">    <span class="string">"database.port"</span>: <span class="string">"3306"</span>,</span><br><span class="line">    <span class="string">"database.user"</span>: <span class="string">"debezium"</span>,</span><br><span class="line">    <span class="string">"database.password"</span>: <span class="string">"dbz"</span>,</span><br><span class="line">    <span class="string">"database.server.id"</span>: <span class="string">"184054"</span>,</span><br><span class="line">    <span class="string">"database.server.name"</span>: <span class="string">"dbserver1"</span>,</span><br><span class="line">    <span class="string">"database.whitelist"</span>: <span class="string">"inventory"</span>,</span><br><span class="line">    <span class="string">"database.history.kafka.bootstrap.servers"</span>: <span class="string">"kafka:9092"</span>,</span><br><span class="line">    <span class="string">"database.history.kafka.topic"</span>: <span class="string">"schema-changes.inventory"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>JSON消息将连接器名称指定为<code>inventory-connector</code>，并提供<a href="https://debezium.io/documentation/reference/1.0/connectors/mysql.html#connector-properties" target="_blank" rel="noopener">我们的MySQL连接器</a>的详细<a href="https://debezium.io/documentation/reference/1.0/connectors/mysql.html#connector-properties" target="_blank" rel="noopener">配置属性</a>：</p>
<ul>
<li>一项任务应该恰好在任何时候运行。由于MySQL连接读取MySQL服务器的binlog，因此使用单个连接器任务是确保正确顺序和所有事件得到正确处理的唯一方法。</li>
<li>数据库主机指定为<code>mysql</code>，这是运行MySQL服务器的Docker容器的名称。回想一下，Docker在我们的容器中操纵了网络堆栈，以便可以通过<code>/etc/hosts</code>使用容器名称作为主机名来解析每个链接的容器。如果MySQL在正常网络上运行，我们只需为此值指定IP地址或可解析的主机名即可。</li>
<li>指定了MySQL服务器的端口。</li>
<li>我们正在运行的MySQL数据库已<code>debezium</code>为我们的目的明确设置了一个用户，因此我们在此处指定该用户名和密码。</li>
<li>给出了唯一的服务器ID和名称。服务器名称是MySQL服务器或服务器集群的逻辑标识符，将用作所有Kafka主题的前缀。</li>
<li>我们只想检测<code>inventory</code>数据库中的更改，因此我们使用白名单。</li>
<li>连接器应使用命名的代理（与我们将事件发送到的代理相同）和主题名称在Kafka中存储数据库架构的历史记录。重新启动后，连接器将恢复连接器应开始读取时二进制日志中存在的时间点的数据库模式。</li>
</ul>
<p>此命令应产生类似于以下内容的响应（也许更紧凑）：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">201</span> Created</span><br><span class="line"><span class="attribute">Date</span>: Tue, 07 Feb 2017 20:49:34 GMT</span><br><span class="line"><span class="attribute">Location</span>: http://localhost:8083/connectors/inventory-connector</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json</span><br><span class="line"><span class="attribute">Content-Length</span>: 471</span><br><span class="line"><span class="attribute">Server</span>: Jetty(9.2.15.v20160210)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "name": "inventory-connector",</span><br><span class="line">  "config": &#123;</span><br><span class="line">    "connector.class": "io.debezium.connector.mysql.MySqlConnector",</span><br><span class="line">    "tasks.max": "1",</span><br><span class="line">    "database.hostname": "mysql",</span><br><span class="line">    "database.port": "3306",</span><br><span class="line">    "database.user": "debezium",</span><br><span class="line">    "database.password": "dbz",</span><br><span class="line">    "database.server.id": "184054",</span><br><span class="line">    "database.server.name": "dbserver1",</span><br><span class="line">    "database.whitelist": "inventory",</span><br><span class="line">    "database.history.kafka.bootstrap.servers": "kafka:9092",</span><br><span class="line">    "database.history.kafka.topic": "dbhistory.inventory",</span><br><span class="line">    "name": "inventory-connector"</span><br><span class="line">  &#125;,</span><br><span class="line">  "tasks": []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此响应描述了<code>/connectors/inventory-connector</code>服务刚刚创建的连接器资源，并包括连接器的配置和有关任务的信息。由于连接器是刚刚创建的，因此该服务尚未完成启动任务。</p>
<p>我们甚至可以使用RESTful API来验证我们的连接器是否包含在连接器列表中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -H <span class="string">"Accept:application/json"</span> localhost:8083/connectors/</span><br></pre></td></tr></table></figure>
<p>应该返回以下内容：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">"inventory-connector"</span>]</span><br></pre></td></tr></table></figure>
<p>回想一下，Kafka Connect服务使用连接器启动一个或多个完成该任务的任务，并且它将自动在Kafka Connect服务群集中分配正在运行的任务。如果任何服务停止或崩溃，这些任务将重新分配给正在运行的服务。当我们获得连接器的状态时，我们可以看到任务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -i -X GET -H <span class="string">"Accept:application/json"</span> localhost:8083/connectors/inventory-connector</span><br></pre></td></tr></table></figure>
<p>返回：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Date</span>: Mon, 27 Mar 2017 17:09:28 GMT</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json</span><br><span class="line"><span class="attribute">Content-Length</span>: 515</span><br><span class="line"><span class="attribute">Server</span>: Jetty(9.2.15.v20160210)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "name": "inventory-connector",</span><br><span class="line">  "config": &#123;</span><br><span class="line">    "name": "inventory-connector",</span><br><span class="line">    "connector.class": "io.debezium.connector.mysql.MySqlConnector",</span><br><span class="line">    "tasks.max": "1",</span><br><span class="line">    "database.hostname": "mysql",</span><br><span class="line">    "database.port": "3306",</span><br><span class="line">    "database.user": "debezium",</span><br><span class="line">    "database.password": "dbz",</span><br><span class="line">    "database.server.id": "184054",</span><br><span class="line">    "database.server.name": "dbserver1",</span><br><span class="line">    "database.whitelist": "inventory",</span><br><span class="line">    "database.history.kafka.bootstrap.servers": "kafka:9092",</span><br><span class="line">    "database.history.kafka.topic": "dbhistory.inventory"</span><br><span class="line">  &#125;,</span><br><span class="line">  "tasks": [</span><br><span class="line">    &#123;</span><br><span class="line">      "connector": "inventory-connector",</span><br><span class="line">      "task": 0</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这里，我们可以看到连接器正在运行一个任务（例如任务0）以完成其工作。MySQL连接器仅支持一个任务，因为MySQL将其所有活动记录在一个连续的二进制日志中，因此MySQL连接器仅需要一个读取器即可获得所有这些事件的一致且完全有序的视图。</p>
<p>如果我们查看<code>connect</code>容器的输出，我们会看到连接器产生了很多输出。与我们的连接器相关的前几行是由Kafka Connect输出的，并以以下内容开头：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:23:59,051 INFO   ||  Connector inventory-connector config updated   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:23:59,550 INFO   ||  Rebalance started   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:23:59,550 INFO   ||  Finished stopping tasks in preparation for rebalance   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:23:59,550 INFO   ||  (Re-)joining group 1   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:23:59,556 INFO   ||  Successfully joined group 1 with generation 2   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:23:59,556 INFO   ||  Joined group and got assignment: Assignment&#123;error=0, leader=&apos;connect-1-4d60cb71-cb93-4388-8908-6f0d299a9d94&apos;, leaderUrl=&apos;http://172.17.0.7:9092/&apos;, offset=1, connectorIds=[inventory-connector], taskIds=[]&#125;   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:23:59,557 INFO   ||  Starting connectors and tasks using config offset 1   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">2017-09-21 07:23:59,557 INFO   ||  Starting connector inventory-connector   [org.apache.kafka.connect.runtime.distributed.DistributedHerder]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>接下来是Kafka Connect的大量输出，内容涉及启动此连接器以及各种生产者和消费者配置。最终，我们<em>从MySQL连接器</em>看到以下输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:24:01,151 INFO   MySQL|dbserver1|task  Kafka version : 0.11.0.0   [org.apache.kafka.common.utils.AppInfoParser]</span><br><span class="line">2017-09-21 07:24:01,151 INFO   MySQL|dbserver1|task  Kafka commitId : cb8625948210849f   [org.apache.kafka.common.utils.AppInfoParser]</span><br><span class="line">2017-09-21 07:24:01,584 INFO   MySQL|dbserver1|task  Found no existing offset, so preparing to perform a snapshot   [io.debezium.connector.mysql.MySqlConnectorTask]</span><br><span class="line">2017-09-21 07:24:01,614 INFO   ||  Source task WorkerSourceTask&#123;id=inventory-connector-0&#125; finished initialization and start   [org.apache.kafka.connect.runtime.WorkerSourceTask]</span><br><span class="line">2017-09-21 07:24:01,615 INFO   MySQL|dbserver1|snapshot  Starting snapshot for jdbc:mysql://mysql:3306/?useInformationSchema=true&amp;nullCatalogMeansCurrent=false&amp;useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;characterSetResults=UTF-8&amp;zeroDateTimeBehavior=convertToNull with user &apos;debezium&apos;   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,617 INFO   MySQL|dbserver1|snapshot  Snapshot is using user &apos;debezium&apos; with these MySQL grants:   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,618 INFO   MySQL|dbserver1|snapshot         GRANT SELECT, RELOAD, SHOW DATABASES, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &apos;debezium&apos;@&apos;%&apos;   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>首先，Debezium日志输出使用<em>映射的诊断上下文</em>（即MDC），它允许日志消息包括特定于线程的信息，例如连接器类型（例如，<code>MySQL</code>在上面的“ INFO”或“ WARN”字段之后的日志消息中），连接器（例如，逻辑名<code>dbserver1</code>同上），并且连接器的活动（例如，<code>task</code>，<code>snapshot</code>和<code>binlog</code>）。希望这些将使您更容易理解多线程Kafka Connect服务中的情况。</p>
<p>前几行涉及<code>task</code>连接器的活动，并且基本上报告一些簿记信息，以使连接器在没有任何偏移的情况下启动。新的三行内容涉及<code>snapshot</code>连接器的活动，特别是正在使用<code>debezium</code>MySQL用户以及与该用户关联的MySQL授权启动快照。</p>
<table>
<thead>
<tr>
<th></th>
<th>如果连接器无法连接或看不到任何表或Binlog，请检查这些授予以确保包括上面列出的所有授予。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>连接器输出的下一条消息如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:24:01,618 INFO   MySQL|dbserver1|snapshot  MySQL server variables related to change data capture:   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,625 INFO   MySQL|dbserver1|snapshot  	binlog_cache_size                             = 32768                                           [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,625 INFO   MySQL|dbserver1|snapshot  	binlog_checksum                               = CRC32                                           [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,625 INFO   MySQL|dbserver1|snapshot  	binlog_direct_non_transactional_updates       = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,625 INFO   MySQL|dbserver1|snapshot  	binlog_error_action                           = ABORT_SERVER                                    [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_format                                 = ROW                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_group_commit_sync_delay                = 0                                               [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_group_commit_sync_no_delay_count       = 0                                               [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_gtid_simple_recovery                   = ON                                              [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_max_flush_queue_time                   = 0                                               [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_order_commits                          = ON                                              [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_row_image                              = FULL                                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_rows_query_log_events                  = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	binlog_stmt_cache_size                        = 32768                                           [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_set_client                          = utf8                                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_set_connection                      = utf8                                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_set_database                        = latin1                                          [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_set_filesystem                      = binary                                          [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_set_results                         = utf8                                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_set_server                          = latin1                                          [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_set_system                          = utf8                                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	character_sets_dir                            = /usr/share/mysql/charsets/                      [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	collation_connection                          = utf8_general_ci                                 [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	collation_database                            = latin1_swedish_ci                               [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	collation_server                              = latin1_swedish_ci                               [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	enforce_gtid_consistency                      = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,626 INFO   MySQL|dbserver1|snapshot  	gtid_executed_compression_period              = 1000                                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	gtid_mode                                     = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	gtid_next                                     = AUTOMATIC                                       [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	gtid_owned                                    =                                                 [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	gtid_purged                                   =                                                 [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	innodb_api_enable_binlog                      = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	innodb_locks_unsafe_for_binlog                = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	innodb_version                                = 5.7.19                                          [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	log_statements_unsafe_for_binlog              = ON                                              [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	max_binlog_cache_size                         = 18446744073709547520                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	max_binlog_size                               = 1073741824                                      [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	max_binlog_stmt_cache_size                    = 18446744073709547520                            [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	protocol_version                              = 10                                              [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	session_track_gtids                           = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	slave_type_conversions                        =                                                 [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	sync_binlog                                   = 1                                               [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	system_time_zone                              = UTC                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	time_zone                                     = SYSTEM                                          [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	tls_version                                   = TLSv1,TLSv1.1                                   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	tx_isolation                                  = REPEATABLE-READ                                 [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	tx_read_only                                  = OFF                                             [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	version                                       = 5.7.19-log                                      [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	version_comment                               = MySQL Community Server (GPL)                    [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,627 INFO   MySQL|dbserver1|snapshot  	version_compile_machine                       = x86_64                                          [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,628 INFO   MySQL|dbserver1|snapshot  	version_compile_os                            = Linux                                           [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>这将报告由我们的MySQL连接器找到的相关MySQL服务器设置。最重要的一项是<code>binlog_format</code>，它被设置为<code>ROW</code>。这些行之后是构成快照操作的9个步骤的输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:24:01,628 INFO   MySQL|dbserver1|snapshot  Step 0: disabling autocommit and enabling repeatable <span class="built_in">read</span> transactions   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,631 INFO   MySQL|dbserver1|snapshot  Step 1: start transaction with consistent snapshot   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,634 INFO   MySQL|dbserver1|snapshot  Step 2: flush and obtain global <span class="built_in">read</span> lock to prevent writes to database   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,636 INFO   MySQL|dbserver1|snapshot  Step 3: <span class="built_in">read</span> binlog position of MySQL master   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,638 INFO   MySQL|dbserver1|snapshot  	 using binlog <span class="string">'mysql-bin.000003'</span> at position <span class="string">'154'</span> and gtid <span class="string">''</span>   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,638 INFO   MySQL|dbserver1|snapshot  Step 4: <span class="built_in">read</span> list of available databases   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,638 INFO   MySQL|dbserver1|snapshot  	 list of available databases is: [information_schema, inventory, mysql, performance_schema, sys]   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,639 INFO   MySQL|dbserver1|snapshot  Step 5: <span class="built_in">read</span> list of available tables <span class="keyword">in</span> each database   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,641 INFO   MySQL|dbserver1|snapshot  	 including <span class="string">'inventory.customers'</span>   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,641 INFO   MySQL|dbserver1|snapshot  	 including <span class="string">'inventory.orders'</span>   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,641 INFO   MySQL|dbserver1|snapshot  	 including <span class="string">'inventory.products'</span>   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,641 INFO   MySQL|dbserver1|snapshot  	 including <span class="string">'inventory.products_on_hand'</span>   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,642 INFO   MySQL|dbserver1|snapshot  	 <span class="string">'mysql.columns_priv'</span> is filtered out, discarding   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">...</span><br><span class="line">2017-09-21 07:24:01,670 INFO   MySQL|dbserver1|snapshot  	snapshot continuing with database(s): [inventory]   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,670 INFO   MySQL|dbserver1|snapshot  Step 6: generating DROP and CREATE statements to reflect current database schemas:   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,679 INFO   MySQL|dbserver1|snapshot  	SET character_set_server=latin1, collation_server=latin1_swedish_ci;   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,724 WARN   MySQL|dbserver1|task  Error <span class="keyword">while</span> fetching metadata with correlation id 1 : &#123;dbhistory.inventory=LEADER_NOT_AVAILABLE&#125;   [org.apache.kafka.clients.NetworkClient]</span><br><span class="line">2017-09-21 07:24:01,853 INFO   MySQL|dbserver1|snapshot  	DROP TABLE IF EXISTS `inventory`.`products_on_hand`   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,861 INFO   MySQL|dbserver1|snapshot  	DROP TABLE IF EXISTS `inventory`.`customers`   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,864 INFO   MySQL|dbserver1|snapshot  	DROP TABLE IF EXISTS `inventory`.`orders`   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,866 INFO   MySQL|dbserver1|snapshot  	DROP TABLE IF EXISTS `inventory`.`products`   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,881 INFO   MySQL|dbserver1|snapshot  	DROP DATABASE IF EXISTS `inventory`   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,889 INFO   MySQL|dbserver1|snapshot  	CREATE DATABASE `inventory`   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,893 INFO   MySQL|dbserver1|snapshot  	USE `inventory`   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,914 INFO   MySQL|dbserver1|snapshot  	CREATE TABLE `customers` (</span><br><span class="line">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `first_name` varchar(255) NOT NULL,</span><br><span class="line">  `last_name` varchar(255) NOT NULL,</span><br><span class="line">  `email` varchar(255) NOT NULL,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  UNIQUE KEY `email` (`email`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1005 DEFAULT CHARSET=latin1   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,932 INFO   MySQL|dbserver1|snapshot  	CREATE TABLE `orders` (</span><br><span class="line">  `order_number` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `order_date` date NOT NULL,</span><br><span class="line">  `purchaser` int(11) NOT NULL,</span><br><span class="line">  `quantity` int(11) NOT NULL,</span><br><span class="line">  `product_id` int(11) NOT NULL,</span><br><span class="line">  PRIMARY KEY (`order_number`),</span><br><span class="line">  KEY `order_customer` (`purchaser`),</span><br><span class="line">  KEY `ordered_product` (`product_id`),</span><br><span class="line">  CONSTRAINT `orders_ibfk_1` FOREIGN KEY (`purchaser`) REFERENCES `customers` (`id`),</span><br><span class="line">  CONSTRAINT `orders_ibfk_2` FOREIGN KEY (`product_id`) REFERENCES `products` (`id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=10005 DEFAULT CHARSET=latin1   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,937 INFO   MySQL|dbserver1|snapshot  	CREATE TABLE `products` (</span><br><span class="line">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `name` varchar(255) NOT NULL,</span><br><span class="line">  `description` varchar(512) DEFAULT NULL,</span><br><span class="line">  `weight` <span class="built_in">float</span> DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=110 DEFAULT CHARSET=latin1   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,941 INFO   MySQL|dbserver1|snapshot  	CREATE TABLE `products_on_hand` (</span><br><span class="line">  `product_id` int(11) NOT NULL,</span><br><span class="line">  `quantity` int(11) NOT NULL,</span><br><span class="line">  PRIMARY KEY (`product_id`),</span><br><span class="line">  CONSTRAINT `products_on_hand_ibfk_1` FOREIGN KEY (`product_id`) REFERENCES `products` (`id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=latin1   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,947 INFO   MySQL|dbserver1|snapshot  Step 7: releasing global <span class="built_in">read</span> lock to <span class="built_in">enable</span> MySQL writes   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,949 INFO   MySQL|dbserver1|snapshot  Step 7: blocked writes to MySQL <span class="keyword">for</span> a total of 00:00:00.312   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,950 INFO   MySQL|dbserver1|snapshot  Step 8: scanning contents of 4 tables <span class="keyword">while</span> still <span class="keyword">in</span> transaction   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,953 INFO   MySQL|dbserver1|snapshot  Step 8: - scanning table <span class="string">'inventory.customers'</span> (1 of 4 tables)   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,958 INFO   MySQL|dbserver1|snapshot  Step 8: - Completed scanning a total of 4 rows from table <span class="string">'inventory.customers'</span> after 00:00:00.005   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:01,959 INFO   MySQL|dbserver1|snapshot  Step 8: - scanning table <span class="string">'inventory.orders'</span> (2 of 4 tables)   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,014 INFO   MySQL|dbserver1|snapshot  Step 8: - Completed scanning a total of 4 rows from table <span class="string">'inventory.orders'</span> after 00:00:00.055   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,016 INFO   MySQL|dbserver1|snapshot  Step 8: - scanning table <span class="string">'inventory.products'</span> (3 of 4 tables)   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,017 INFO   MySQL|dbserver1|snapshot  Step 8: - Completed scanning a total of 9 rows from table <span class="string">'inventory.products'</span> after 00:00:00.001   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,018 INFO   MySQL|dbserver1|snapshot  Step 8: - scanning table <span class="string">'inventory.products_on_hand'</span> (4 of 4 tables)   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,019 INFO   MySQL|dbserver1|snapshot  Step 8: - Completed scanning a total of 9 rows from table <span class="string">'inventory.products_on_hand'</span> after 00:00:00.001   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,020 INFO   MySQL|dbserver1|snapshot  Step 8: scanned 26 rows <span class="keyword">in</span> 4 tables <span class="keyword">in</span> 00:00:00.069   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,020 INFO   MySQL|dbserver1|snapshot  Step 9: committing transaction   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">2017-09-21 07:24:02,021 INFO   MySQL|dbserver1|snapshot  Completed snapshot <span class="keyword">in</span> 00:00:00.405   [io.debezium.connector.mysql.SnapshotReader]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>这些步骤中的每一个都报告连接器正在执行的操作，以执行一致的快照。例如，步骤6涉及对捕获的表的DDL create语句进行反向工程；步骤7在获取全局写锁后仅0.3秒就释放了它，步骤8读取每个表中的所有行，并报告花费的时间和找到的行数。请注意，在我们的示例数据库中，MySQL连接器仅用0.38秒即可完成其一致的快照。</p>
<table>
<thead>
<tr>
<th></th>
<th>对于您的数据库，此过程将花费更长的时间，但是连接器将输出足够的日志消息，以便即使表具有大量行，您也可以跟踪其正在执行的操作。而且，尽管在快照过程开始时使用了排他写锁定，但即使对于大型数据库，此锁定也应该很短。在复制任何数据之前，将释放此锁定。有关更多详细信息，请参见<a href="https://debezium.io/documentation/reference/1.0/connectors/mysql.html" target="_blank" rel="noopener">MySQL连接器文档</a>。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>Kafka Connect的新五行听起来不祥，但基本上告诉我们，已经创建了<em>新的</em> Kafka主题，而Kafka必须为每一个主题指定新的领导者：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:24:02,632 WARN   ||  Error <span class="keyword">while</span> fetching metadata with correlation id 1 : &#123;dbserver1=LEADER_NOT_AVAILABLE&#125;   [org.apache.kafka.clients.NetworkClient]</span><br><span class="line">2017-09-21 07:24:02,775 WARN   ||  Error <span class="keyword">while</span> fetching metadata with correlation id 5 : &#123;dbserver1.inventory.customers=LEADER_NOT_AVAILABLE&#125;   [org.apache.kafka.clients.NetworkClient]</span><br><span class="line">2017-09-21 07:24:02,910 WARN   ||  Error <span class="keyword">while</span> fetching metadata with correlation id 9 : &#123;dbserver1.inventory.orders=LEADER_NOT_AVAILABLE&#125;   [org.apache.kafka.clients.NetworkClient]</span><br><span class="line">2017-09-21 07:24:03,045 WARN   ||  Error <span class="keyword">while</span> fetching metadata with correlation id 13 : &#123;dbserver1.inventory.products=LEADER_NOT_AVAILABLE&#125;   [org.apache.kafka.clients.NetworkClient]</span><br><span class="line">2017-09-21 07:24:03,179 WARN   ||  Error <span class="keyword">while</span> fetching metadata with correlation id 17 : &#123;dbserver1.inventory.products_on_hand=LEADER_NOT_AVAILABLE&#125;   [org.apache.kafka.clients.NetworkClient]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>最后，我们看到一行报告，表明连接器已从其快照模式转换为连续读取MySQL服务器的binlog：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">Sep 21, 2017 7:24:03 AM com.github.shyiko.mysql.binlog.BinaryLogClient connect</span><br><span class="line">INFO: Connected to mysql:3306 at mysql-bin.000003/154 (sid:184054, cid:7)</span><br><span class="line">2017-09-21 07:24:03,373 INFO   MySQL|dbserver1|binlog  Connected to MySQL binlog at mysql:3306, starting at binlog file <span class="string">'mysql-bin.000003'</span>, pos=154, skipping 0 events plus 0 rows   [io.debezium.connector.mysql.BinlogReader]</span><br><span class="line">2017-09-21 07:25:01,096 INFO   ||  Finished WorkerSourceTask&#123;id=inventory-connector-0&#125; commitOffsets successfully <span class="keyword">in</span> 18 ms   [org.apache.kafka.connect.runtime.WorkerSourceTask]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="查看变更事件"><a href="#查看变更事件" class="headerlink" title="查看变更事件"></a>查看变更事件</h3><p>我们在连接器的输出中看到，事件被写入五个主题：</p>
<ul>
<li><code>dbserver1</code></li>
<li><code>dbserver1.inventory.products</code></li>
<li><code>dbserver1.inventory.products_on_hand</code></li>
<li><code>dbserver1.inventory.customers</code></li>
<li><code>dbserver1.inventory.orders</code></li>
</ul>
<p>如<a href="https://debezium.io/documentation/reference/1.0/connectors/mysql.html#topic-names" target="_blank" rel="noopener">MySQL连接器文档中所述</a>，每个主题名称均以开头<code>dbserver1</code>，这是我们为连接器赋予的逻辑名称。第一个是我们所有DDL语句都写入到的<a href="https://debezium.io/documentation/reference/1.0/connectors/mysql.html#schema-change-topic" target="_blank" rel="noopener">架构更改主题</a>。其余四个主题用于捕获四个表中每个表的更改事件，它们的主题名称包括数据库名称（例如<code>inventory</code>）和表名称。</p>
<p>让我们看一下该<code>dbserver1.inventory.customers</code>主题中的所有数据更改事件。我们将使用<code>debezium/kafka</code>Docker映像来启动一个新容器，该容器运行Kafka的一个实用程序来从主题开始观看该主题：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --name watcher --rm --link zookeeper:zookeeper --link kafka:kafka debezium/kafka:1.0 watch-topic -a -k dbserver1.inventory.customers</span><br></pre></td></tr></table></figure>
<p>再次使用<code>--rm</code>标记，因为我们希望容器在停止时被删除，并且使用<code>-a</code>标记on <code>watch-topic</code>表示我们希望查看自主题开始以来的<em>所有</em>事件。（如果要删除该<code>-a</code>标志，则在开始观看<em>之后</em>，我们只会看到记录在主题中的事件。）该<code>-k</code>标志指定输出应包含事件的键，在我们的例子中，该键包含该行的主键。这是输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Using ZOOKEEPER_CONNECT=172.17.0.3:2181</span><br><span class="line">Using KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://172.17.0.8:9092</span><br><span class="line">Contents of topic dbserver1.inventory.customers:</span><br><span class="line">Using the ConsoleConsumer with old consumer is deprecated and will be removed <span class="keyword">in</span> a future major release. Consider using the new consumer by passing [bootstrap-server] instead of [zookeeper].</span><br><span class="line">&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Key"</span>&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"id"</span>:1001&#125;&#125;	&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"before"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"after"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"version"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"server_id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"ts_sec"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"gtid"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"file"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"pos"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"row"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"boolean"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"snapshot"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"thread"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"db"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"table"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"io.debezium.connector.mysql.Source"</span>,<span class="string">"field"</span>:<span class="string">"source"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"op"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"ts_ms"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Envelope"</span>,<span class="string">"version"</span>:1&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"before"</span>:null,<span class="string">"after"</span>:&#123;<span class="string">"id"</span>:1001,<span class="string">"first_name"</span>:<span class="string">"Sally"</span>,<span class="string">"last_name"</span>:<span class="string">"Thomas"</span>,<span class="string">"email"</span>:<span class="string">"sally.thomas@acme.com"</span>&#125;,<span class="string">"source"</span>:&#123;<span class="string">"version"</span>:<span class="string">"1.0.2.Final"</span>,<span class="string">"name"</span>:<span class="string">"dbserver1"</span>,<span class="string">"server_id"</span>:0,<span class="string">"ts_sec"</span>:0,<span class="string">"gtid"</span>:null,<span class="string">"file"</span>:<span class="string">"mysql-bin.000003"</span>,<span class="string">"pos"</span>:154,<span class="string">"row"</span>:0,<span class="string">"snapshot"</span>:<span class="literal">true</span>,<span class="string">"thread"</span>:null,<span class="string">"db"</span>:<span class="string">"inventory"</span>,<span class="string">"table"</span>:<span class="string">"customers"</span>&#125;,<span class="string">"op"</span>:<span class="string">"c"</span>,<span class="string">"ts_ms"</span>:1490634537160&#125;&#125;</span><br><span class="line">&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Key"</span>&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"id"</span>:1002&#125;&#125;	&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"before"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"after"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"version"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"server_id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"ts_sec"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"gtid"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"file"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"pos"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"row"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"boolean"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"snapshot"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"thread"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"db"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"table"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"io.debezium.connector.mysql.Source"</span>,<span class="string">"field"</span>:<span class="string">"source"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"op"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"ts_ms"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Envelope"</span>,<span class="string">"version"</span>:1&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"before"</span>:null,<span class="string">"after"</span>:&#123;<span class="string">"id"</span>:1002,<span class="string">"first_name"</span>:<span class="string">"George"</span>,<span class="string">"last_name"</span>:<span class="string">"Bailey"</span>,<span class="string">"email"</span>:<span class="string">"gbailey@foobar.com"</span>&#125;,<span class="string">"source"</span>:&#123;<span class="string">"version"</span>:<span class="string">"1.0.2.Final"</span>,<span class="string">"name"</span>:<span class="string">"dbserver1"</span>,<span class="string">"server_id"</span>:0,<span class="string">"ts_sec"</span>:0,<span class="string">"gtid"</span>:null,<span class="string">"file"</span>:<span class="string">"mysql-bin.000003"</span>,<span class="string">"pos"</span>:154,<span class="string">"row"</span>:0,<span class="string">"snapshot"</span>:<span class="literal">true</span>,<span class="string">"thread"</span>:null,<span class="string">"db"</span>:<span class="string">"inventory"</span>,<span class="string">"table"</span>:<span class="string">"customers"</span>&#125;,<span class="string">"op"</span>:<span class="string">"c"</span>,<span class="string">"ts_ms"</span>:1490634537160&#125;&#125;</span><br><span class="line">&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Key"</span>&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"id"</span>:1003&#125;&#125;	&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"before"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"after"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"version"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"server_id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"ts_sec"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"gtid"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"file"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"pos"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"row"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"boolean"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"snapshot"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"thread"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"db"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"table"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"io.debezium.connector.mysql.Source"</span>,<span class="string">"field"</span>:<span class="string">"source"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"op"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"ts_ms"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Envelope"</span>,<span class="string">"version"</span>:1&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"before"</span>:null,<span class="string">"after"</span>:&#123;<span class="string">"id"</span>:1003,<span class="string">"first_name"</span>:<span class="string">"Edward"</span>,<span class="string">"last_name"</span>:<span class="string">"Walker"</span>,<span class="string">"email"</span>:<span class="string">"ed@walker.com"</span>&#125;,<span class="string">"source"</span>:&#123;<span class="string">"version"</span>:<span class="string">"1.0.2.Final"</span>,<span class="string">"name"</span>:<span class="string">"dbserver1"</span>,<span class="string">"server_id"</span>:0,<span class="string">"ts_sec"</span>:0,<span class="string">"gtid"</span>:null,<span class="string">"file"</span>:<span class="string">"mysql-bin.000003"</span>,<span class="string">"pos"</span>:154,<span class="string">"row"</span>:0,<span class="string">"snapshot"</span>:<span class="literal">true</span>,<span class="string">"thread"</span>:null,<span class="string">"db"</span>:<span class="string">"inventory"</span>,<span class="string">"table"</span>:<span class="string">"customers"</span>&#125;,<span class="string">"op"</span>:<span class="string">"c"</span>,<span class="string">"ts_ms"</span>:1490634537160&#125;&#125;</span><br><span class="line">&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Key"</span>&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"id"</span>:1004&#125;&#125;	&#123;<span class="string">"schema"</span>:&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"before"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"email"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="string">"field"</span>:<span class="string">"after"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"struct"</span>,<span class="string">"fields"</span>:[&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"version"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"name"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"server_id"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"ts_sec"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"gtid"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"file"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"pos"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int32"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"row"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"boolean"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"snapshot"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"thread"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"db"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"table"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"io.debezium.connector.mysql.Source"</span>,<span class="string">"field"</span>:<span class="string">"source"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"string"</span>,<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"field"</span>:<span class="string">"op"</span>&#125;,&#123;<span class="string">"type"</span>:<span class="string">"int64"</span>,<span class="string">"optional"</span>:<span class="literal">true</span>,<span class="string">"field"</span>:<span class="string">"ts_ms"</span>&#125;],<span class="string">"optional"</span>:<span class="literal">false</span>,<span class="string">"name"</span>:<span class="string">"dbserver1.inventory.customers.Envelope"</span>,<span class="string">"version"</span>:1&#125;,<span class="string">"payload"</span>:&#123;<span class="string">"before"</span>:null,<span class="string">"after"</span>:&#123;<span class="string">"id"</span>:1004,<span class="string">"first_name"</span>:<span class="string">"Anne"</span>,<span class="string">"last_name"</span>:<span class="string">"Kretchmar"</span>,<span class="string">"email"</span>:<span class="string">"annek@noanswer.org"</span>&#125;,<span class="string">"source"</span>:&#123;<span class="string">"version"</span>:<span class="string">"1.0.2.Final"</span>,<span class="string">"name"</span>:<span class="string">"dbserver1"</span>,<span class="string">"server_id"</span>:0,<span class="string">"ts_sec"</span>:0,<span class="string">"gtid"</span>:null,<span class="string">"file"</span>:<span class="string">"mysql-bin.000003"</span>,<span class="string">"pos"</span>:154,<span class="string">"row"</span>:0,<span class="string">"snapshot"</span>:<span class="literal">true</span>,<span class="string">"thread"</span>:null,<span class="string">"db"</span>:<span class="string">"inventory"</span>,<span class="string">"table"</span>:<span class="string">"customers"</span>&#125;,<span class="string">"op"</span>:<span class="string">"c"</span>,<span class="string">"ts_ms"</span>:1490634537160&#125;&#125;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th></th>
<th>该实用程序一直在监视，因此只要该实用程序继续运行，任何新事件都会自动出现。而且该<code>watch-topic</code>实用程序非常简单，并且功能和实用性受到限制-我们在这里使用它只是为了了解我们的连接器生成的事件的种类。想要使用事件的应用程序将改为使用Kafka使用者，而这些使用者库提供了更大的灵活性和功能。实际上，正确配置的客户端使我们的应用程序永远不会错过任何事件，即使那些应用程序崩溃或正常关闭也是如此。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>这些事件碰巧是用JSON编码的，因为这就是我们配置Kafka Connect服务的方式。每个事件都包含一个JSON文档作为密钥，并包含一个JSON文档。让我们通过首先重新格式化事件的<em>键</em>使其更易于阅读来更详细地查看最后一个事件：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schema"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Key"</span></span><br><span class="line">    <span class="string">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"fields"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"id"</span>,</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"payload"</span>: &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">1004</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>事件的键分为两部分：a <code>schema</code>和<code>payload</code>。该<code>schema</code>包含卡夫卡连接架构描述什么是有效载荷，并在我们的情况下这意味着<code>payload</code>是一个命名结构<code>dbserver1.inventory.customers.Key</code>是不可选的，有一个名为必填字段<code>id</code>类型<code>int32</code>。</p>
<p>如果我们查看键<code>payload</code>字段的值，就会发现它确实是一个结构（在JSON中只是一个对象），只有一个<code>id</code>字段，其值为<code>1004</code>。</p>
<p>因此，我们将此事件解释为适用于主键列的值为的<code>inventory.customers</code>表中的行（来自名为的连接器的输出<code>dbserver1</code>）。<code>id`</code>1004`</p>
<p>现在让我们看一下同一事件的<em>value</em>，我们再次将其重新格式化以使其更易于阅读：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schema"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">    <span class="attr">"fields"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">        <span class="attr">"fields"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"id"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"first_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"last_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"email"</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Value"</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"before"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">        <span class="attr">"fields"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"id"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"first_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"last_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"email"</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Value"</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"after"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">        <span class="attr">"fields"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"version"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"server_id"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"ts_sec"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"gtid"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"file"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"pos"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"row"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"boolean"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"snapshot"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"thread"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"db"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"table"</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"io.debezium.connector.mysql.Source"</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"source"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"op"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"ts_ms"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Envelope"</span>,</span><br><span class="line">    <span class="attr">"version"</span>: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"payload"</span>: &#123;</span><br><span class="line">    <span class="attr">"before"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"after"</span>: &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="number">1004</span>,</span><br><span class="line">      <span class="attr">"first_name"</span>: <span class="string">"Anne"</span>,</span><br><span class="line">      <span class="attr">"last_name"</span>: <span class="string">"Kretchmar"</span>,</span><br><span class="line">      <span class="attr">"email"</span>: <span class="string">"annek@noanswer.org"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"source"</span>: &#123;</span><br><span class="line">      <span class="attr">"version"</span>: <span class="string">"1.0.2.Final"</span>,</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"dbserver1"</span>,</span><br><span class="line">      <span class="attr">"server_id"</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">"ts_sec"</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">"gtid"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"file"</span>: <span class="string">"mysql-bin.000003"</span>,</span><br><span class="line">      <span class="attr">"pos"</span>: <span class="number">154</span>,</span><br><span class="line">      <span class="attr">"row"</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">"snapshot"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">"thread"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"db"</span>: <span class="string">"inventory"</span>,</span><br><span class="line">      <span class="attr">"table"</span>: <span class="string">"customers"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"op"</span>: <span class="string">"c"</span>,</span><br><span class="line">    <span class="attr">"ts_ms"</span>: <span class="number">1486500577691</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>事件的这一部分要大得多，但是像事件的<em>键一样</em>，它也有a <code>schema</code>和a <code>payload</code>。<code>schema</code>包含一个名为<code>dbserver1.inventory.customers.Envelope</code>（版本1）的Kafka Connect模式，该模式可以包含5个字段：</p>
<ul>
<li><code>op</code>是必填字段，其中包含描述操作类型的字符串值。MySQL连接器的值用于<code>c</code>创建（或插入），<code>u</code>用于更新，<code>d</code>用于删除和<code>r</code>用于读取（在非初始快照的情况下）。</li>
<li><code>before</code>是一个可选字段，如果存在，则包含事件发生<em>之前</em>行的状态。该结构将由<code>dbserver1.inventory.customers.Value</code>Kafka Connect模式描述，连接<code>dbserver1</code>器将其用于<code>inventory.customers</code>表中的所有行。</li>
<li><code>after</code>是一个可选字段，如果存在，则包含事件发生<em>后行</em>的状态。该结构由中使用的相同的<code>dbserver1.inventory.customers.Value</code>Kafka Connect模式描述<code>before</code>。</li>
<li><code>source</code> 是必填字段，包含描述事件源元数据的结构，在MySQL中，该字段包含多个字段：连接器名称，记录事件的binlog文件的名称，binlog文件在其中的位置。事件出现，事件中的行（如果有多个），受影响的数据库和表的名称，进行更改的MySQL线程ID，此事件是否是快照的一部分以及MySQL服务器（如果有） ID，以及以秒为单位的时间戳。</li>
<li><code>ts_ms</code> 是可选的，如果存在，则包含连接器处理事件的时间（使用运行Kafka Connect任务的JVM中的系统时钟）。</li>
</ul>
<p>如果我们看一下<code>payload</code>事件的的<em>价值</em>，我们可以看到在事件的信息，即它是在描述该行的创建，包含<code>id</code>，<code>first_name</code>，<code>last_name</code>和<code>email</code>插入行。</p>
<table>
<thead>
<tr>
<th></th>
<th>您可能已经注意到，事件的JSON表示比它们描述的行大得多。这是因为Kafka Connect附带了每个事件密钥，并重视描述<em>有效负载</em>的<em>架构</em>。随着时间的流逝，这种结构可能会发生变化，并且事件本身具有键和值的架构会使得使用应用程序的用户更容易理解消息，尤其是随着时间的发展。Debezium MySQL连接器根据数据库表的结构来构造这些模式。如果使用DDL语句更改MySQL数据库中的表定义，则连接器将读取这些DDL语句并更新其Kafka Connect模式。这是每个事件的结构完全类似于事件发生时的来源表的唯一方式。但是包含单个表的所有事件的Kafka主题可能具有与表定义的每种状态相对应的事件。JSON转换器确实会产生非常冗长的事件，因为它在每条消息中都包含键和值模式。该<a href="http://docs.confluent.io/3.1.2/schema-registry/docs/index.html" target="_blank" rel="noopener">Avro的转换器</a>，在另一方面，是远远聪明，结果小得多事件消息。Avro转换器将每个Kafka Connect架构转换为Avro架构，并将Avro架构存储在单独的架构注册表服务中。因此，当Avro转换器对事件消息进行序列化时，它将仅放置该模式的唯一标识符以及该值的Avro编码的二进制表示形式。因此，通过网络传输并存储在Kafka中的序列化消息比上面显示的要小得多。实际上，Avro Converter能够使用Avro模式演变技术来维护模式注册表中每个模式的历史记录。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>我们可以将它们与数据库状态进行比较。返回到运行MySQL命令行客户端的终端，并运行以下语句：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM customers;</span><br></pre></td></tr></table></figure>
<p>产生以下输出：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+<span class="comment">------+------------+-----------+-----------------------+</span></span><br><span class="line">| id   | first_name | last_name | email                 |</span><br><span class="line">+<span class="comment">------+------------+-----------+-----------------------+</span></span><br><span class="line">| 1001 | Sally      | Thomas    | sally.thomas@acme.com |</span><br><span class="line">| 1002 | George     | Bailey    | gbailey@foobar.com    |</span><br><span class="line">| 1003 | Edward     | Walker    | ed@walker.com         |</span><br><span class="line">| 1004 | Anne       | Kretchmar | annek@noanswer.org    |</span><br><span class="line">+<span class="comment">------+------------+-----------+-----------------------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>如我们所见，所有事件记录都与数据库匹配。</p>
<p>现在我们正在监视更改，<strong>更改</strong>数据库中的记录之一会发生什么？在MySQL命令行客户端中运行以下语句：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; UPDATE customers SET first_name='Anne Marie' WHERE id=1004;</span><br></pre></td></tr></table></figure>
<p>产生以下输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Query OK, 1 row affected (0.05 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br></pre></td></tr></table></figure>
<p>重新运行该<code>select …</code>语句以查看更新的表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from customers;</span><br><span class="line">+<span class="comment">------+------------+-----------+-----------------------+</span></span><br><span class="line">| id   | first_name | last_name | email                 |</span><br><span class="line">+<span class="comment">------+------------+-----------+-----------------------+</span></span><br><span class="line">| 1001 | Sally      | Thomas    | sally.thomas@acme.com |</span><br><span class="line">| 1002 | George     | Bailey    | gbailey@foobar.com    |</span><br><span class="line">| 1003 | Edward     | Walker    | ed@walker.com         |</span><br><span class="line">| 1004 | Anne Marie | Kretchmar | annek@noanswer.org    |</span><br><span class="line">+<span class="comment">------+------------+-----------+-----------------------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>现在，回到终端运行<code>watch-topic</code>，我们应该看到一个<em>新的</em>第五事件：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"schema"</span>:&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Key"</span>&#125;,<span class="attr">"payload"</span>:&#123;<span class="attr">"id"</span>:<span class="number">1004</span>&#125;&#125;	&#123;<span class="attr">"schema"</span>:&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"email"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="attr">"field"</span>:<span class="string">"before"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"email"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="attr">"field"</span>:<span class="string">"after"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"version"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"server_id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"ts_sec"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"gtid"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"file"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"pos"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"row"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"boolean"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"snapshot"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"thread"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"db"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"table"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"io.debezium.connector.mysql.Source"</span>,<span class="attr">"field"</span>:<span class="string">"source"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"op"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"ts_ms"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Envelope"</span>,<span class="attr">"version"</span>:<span class="number">1</span>&#125;,<span class="attr">"payload"</span>:&#123;<span class="attr">"before"</span>:&#123;<span class="attr">"id"</span>:<span class="number">1004</span>,<span class="attr">"first_name"</span>:<span class="string">"Anne"</span>,<span class="attr">"last_name"</span>:<span class="string">"Kretchmar"</span>,<span class="attr">"email"</span>:<span class="string">"annek@noanswer.org"</span>&#125;,<span class="attr">"after"</span>:&#123;<span class="attr">"id"</span>:<span class="number">1004</span>,<span class="attr">"first_name"</span>:<span class="string">"Anne Marie"</span>,<span class="attr">"last_name"</span>:<span class="string">"Kretchmar"</span>,<span class="attr">"email"</span>:<span class="string">"annek@noanswer.org"</span>&#125;,<span class="attr">"source"</span>:&#123;<span class="attr">"version"</span>:<span class="string">"1.0.2.Final"</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1"</span>,<span class="attr">"server_id"</span>:<span class="number">223344</span>,<span class="attr">"ts_sec"</span>:<span class="number">1490635059</span>,<span class="attr">"gtid"</span>:<span class="literal">null</span>,<span class="attr">"file"</span>:<span class="string">"mysql-bin.000003"</span>,<span class="attr">"pos"</span>:<span class="number">364</span>,<span class="attr">"row"</span>:<span class="number">0</span>,<span class="attr">"snapshot"</span>:<span class="literal">null</span>,<span class="attr">"thread"</span>:<span class="number">3</span>,<span class="attr">"db"</span>:<span class="string">"inventory"</span>,<span class="attr">"table"</span>:<span class="string">"customers"</span>&#125;,<span class="attr">"op"</span>:<span class="string">"u"</span>,<span class="attr">"ts_ms"</span>:<span class="number">1490635059389</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>让我们重新格式化新事件的<em>键</em>，以便于阅读：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schema"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Key"</span></span><br><span class="line">    <span class="string">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"fields"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"id"</span>,</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"payload"</span>: &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">1004</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该密钥与我们在第四条记录中看到的密钥完全相同。这是新事件的<em>值，其</em>格式设置为更易于阅读：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schema"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">    <span class="attr">"fields"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">        <span class="attr">"fields"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"id"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"first_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"last_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"email"</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Value"</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"before"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">        <span class="attr">"fields"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"id"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"first_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"last_name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"email"</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Value"</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"after"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">        <span class="attr">"fields"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"version"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"name"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"server_id"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"ts_sec"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"gtid"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"file"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"pos"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"row"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"boolean"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"snapshot"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"thread"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"db"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">            <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"field"</span>: <span class="string">"table"</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"io.debezium.connector.mysql.Source"</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"source"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"op"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"int64"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"ts_ms"</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Envelope"</span>,</span><br><span class="line">    <span class="attr">"version"</span>: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"payload"</span>: &#123;</span><br><span class="line">    <span class="attr">"before"</span>: &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="number">1004</span>,</span><br><span class="line">      <span class="attr">"first_name"</span>: <span class="string">"Anne"</span>,</span><br><span class="line">      <span class="attr">"last_name"</span>: <span class="string">"Kretchmar"</span>,</span><br><span class="line">      <span class="attr">"email"</span>: <span class="string">"annek@noanswer.org"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"after"</span>: &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="number">1004</span>,</span><br><span class="line">      <span class="attr">"first_name"</span>: <span class="string">"Anne Marie"</span>,</span><br><span class="line">      <span class="attr">"last_name"</span>: <span class="string">"Kretchmar"</span>,</span><br><span class="line">      <span class="attr">"email"</span>: <span class="string">"annek@noanswer.org"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"source"</span>: &#123;</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"1.0.2.Final"</span>,</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"dbserver1"</span>,</span><br><span class="line">      <span class="attr">"server_id"</span>: <span class="number">223344</span>,</span><br><span class="line">      <span class="attr">"ts_sec"</span>: <span class="number">1486501486</span>,</span><br><span class="line">      <span class="attr">"gtid"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"file"</span>: <span class="string">"mysql-bin.000003"</span>,</span><br><span class="line">      <span class="attr">"pos"</span>: <span class="number">364</span>,</span><br><span class="line">      <span class="attr">"row"</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">"snapshot"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"thread"</span>: <span class="number">3</span>,</span><br><span class="line">      <span class="attr">"db"</span>: <span class="string">"inventory"</span>,</span><br><span class="line">      <span class="attr">"table"</span>: <span class="string">"customers"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"op"</span>: <span class="string">"u"</span>,</span><br><span class="line">    <span class="attr">"ts_ms"</span>: <span class="number">1486501486308</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们将其与第四个事件中的值进行比较时，在该<code>schema</code>部分中没有看到任何更改，而在该部分中看到了一些更改<code>payload</code>：</p>
<ul>
<li>该<code>op</code>字段的值是现在<code>u</code>，表示此行被更改，因为更新</li>
<li><code>before</code>现在，该字段具有行状态以及数据库提交前的值</li>
<li><code>after</code>现在，该字段具有该行的更新状态，在这里可以看到该<code>first_name</code>值是now <code>Anne Marie</code>。</li>
<li>该<code>source</code>场结构具有许多相同的价值观和以前一样，除了<code>ts_sec</code>和<code>pos</code>领域发生了变化（而<code>file</code>可能在其他情况下发生了变化）。</li>
<li>该<code>ts_ms</code>节目的时间戳Debezium处理此事件。</li>
</ul>
<p>仅看本<code>payload</code>节，我们可以学到几件事。我们可以比较<code>before</code>和<code>after</code>结构，以确定由于提交而实际更改的内容。该<code>source</code>结构告诉我们有关MySQL更改记录的信息（提供可追溯性），但更重要的是，它具有可以与本主题和其他主题中的其他事件进行比较的信息，以了解此事件是在同一MySQL之前，之后还是作为其一部分发生的像其他事件一样提交。</p>
<p>到目前为止，我们已经看到了<em>创建</em>和<em>更新</em>事件的示例。现在，让我们看一下<em>删除</em>事件。由于Anne Marie尚未下任何订单，因此我们可以使用MySQL命令行客户端从数据库中删除她的记录：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; DELETE FROM customers WHERE id=1004;</span><br></pre></td></tr></table></figure>
<p>|      | 如果以上命令因违反外键约束而失败，则必须使用以下语句从<em>地址</em>表中删除客户地址的引用：<figure class="highlight plain"><figcaption><span>DELETE FROM addresses WHERE customer_id</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">| ---- | ------------------------------------------------------------ |</span><br><span class="line">|      |                                                              |</span><br><span class="line"></span><br><span class="line">在运行的终端中`watch-topic`，我们看到*两个*新事件：</span><br><span class="line"></span><br><span class="line">```json</span><br><span class="line">&#123;&quot;schema&quot;:&#123;&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[&#123;&quot;type&quot;:&quot;int32&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;id&quot;&#125;],&quot;optional&quot;:false,&quot;name&quot;:&quot;dbserver1.inventory.customers.Key&quot;&#125;,&quot;payload&quot;:&#123;&quot;id&quot;:1004&#125;&#125;	&#123;&quot;schema&quot;:&#123;&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[&#123;&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[&#123;&quot;type&quot;:&quot;int32&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;id&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;first_name&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;last_name&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;email&quot;&#125;],&quot;optional&quot;:true,&quot;name&quot;:&quot;dbserver1.inventory.customers.Value&quot;,&quot;field&quot;:&quot;before&quot;&#125;,&#123;&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[&#123;&quot;type&quot;:&quot;int32&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;id&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;first_name&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;last_name&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;email&quot;&#125;],&quot;optional&quot;:true,&quot;name&quot;:&quot;dbserver1.inventory.customers.Value&quot;,&quot;field&quot;:&quot;after&quot;&#125;,&#123;&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;version&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;name&quot;&#125;,&#123;&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;server_id&quot;&#125;,&#123;&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;ts_sec&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;gtid&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;file&quot;&#125;,&#123;&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;pos&quot;&#125;,&#123;&quot;type&quot;:&quot;int32&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;row&quot;&#125;,&#123;&quot;type&quot;:&quot;boolean&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;snapshot&quot;&#125;,&#123;&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;thread&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;db&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;table&quot;&#125;],&quot;optional&quot;:false,&quot;name&quot;:&quot;io.debezium.connector.mysql.Source&quot;,&quot;field&quot;:&quot;source&quot;&#125;,&#123;&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;op&quot;&#125;,&#123;&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;ts_ms&quot;&#125;],&quot;optional&quot;:false,&quot;name&quot;:&quot;dbserver1.inventory.customers.Envelope&quot;,&quot;version&quot;:1&#125;,&quot;payload&quot;:&#123;&quot;before&quot;:&#123;&quot;id&quot;:1004,&quot;first_name&quot;:&quot;Anne Marie&quot;,&quot;last_name&quot;:&quot;Kretchmar&quot;,&quot;email&quot;:&quot;annek@noanswer.org&quot;&#125;,&quot;after&quot;:null,&quot;source&quot;:&#123;&quot;version&quot;:&quot;1.0.2.Final&quot;,&quot;name&quot;:&quot;dbserver1&quot;,&quot;server_id&quot;:223344,&quot;ts_sec&quot;:1490635100,&quot;gtid&quot;:null,&quot;file&quot;:&quot;mysql-bin.000003&quot;,&quot;pos&quot;:725,&quot;row&quot;:0,&quot;snapshot&quot;:null,&quot;thread&quot;:3,&quot;db&quot;:&quot;inventory&quot;,&quot;table&quot;:&quot;customers&quot;&#125;,&quot;op&quot;:&quot;d&quot;,&quot;ts_ms&quot;:1490635100301&#125;&#125;</span><br><span class="line">&#123;&quot;schema&quot;:&#123;&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[&#123;&quot;type&quot;:&quot;int32&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;id&quot;&#125;],&quot;optional&quot;:false,&quot;name&quot;:&quot;dbserver1.inventory.customers.Key&quot;&#125;,&quot;payload&quot;:&#123;&quot;id&quot;:1004&#125;&#125;	&#123;&quot;schema&quot;:null,&quot;payload&quot;:null&#125;</span><br></pre></td></tr></table></figure></p>
<p>发生了什么？我们只删除了一行，但是现在有两个事件。要了解MySQL连接器的作用，让我们看一下两个新消息中的第一个。重新格式化后的<em>键</em>更易于阅读：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schema"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Key"</span></span><br><span class="line">    <span class="string">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"fields"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"id"</span>,</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"payload"</span>: &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">1004</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再次，此密钥与我们查看的前两个事件完全相同。这是第一个新事件的<em>值</em>，其格式设置为更易于阅读：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "schema": &#123;...&#125;,</span><br><span class="line">  "payload": &#123;</span><br><span class="line">    "before": &#123;</span><br><span class="line">      "id": 1004,</span><br><span class="line">      "first_name": "Anne Marie",</span><br><span class="line">      "last_name": "Kretchmar",</span><br><span class="line">      "email": "annek@noanswer.org"</span><br><span class="line">    &#125;,</span><br><span class="line">    "after": null,</span><br><span class="line">    "source": &#123;</span><br><span class="line">      "name": "1.0.2.Final",</span><br><span class="line">      "name": "dbserver1",</span><br><span class="line">      "server_id": 223344,</span><br><span class="line">      "ts_sec": 1486501558,</span><br><span class="line">      "gtid": null,</span><br><span class="line">      "file": "mysql-bin.000003",</span><br><span class="line">      "pos": 725,</span><br><span class="line">      "row": 0,</span><br><span class="line">      "snapshot": null,</span><br><span class="line">      "thread": 3,</span><br><span class="line">      "db": "inventory",</span><br><span class="line">      "table": "customers"</span><br><span class="line">    &#125;,</span><br><span class="line">    "op": "d",</span><br><span class="line">    "ts_ms": 1486501558315</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再次，<code>schema</code>与前面的消息相同，但是该<code>payload</code>片段有一些注意事项：</p>
<ul>
<li>该<code>op</code>字段的值是现在<code>d</code>，这标志着该行已被删除</li>
<li><code>before</code>现在，该字段具有通过数据库提交删除的行的状态</li>
<li>该<code>after</code>字段为空，表示该行不再存在</li>
<li>该<code>source</code>场结构具有许多相同的价值观和以前一样，除了<code>ts_sec</code>和<code>pos</code>领域发生了变化（而<code>file</code>可能在其他情况下发生了变化）。</li>
<li>该<code>ts_ms</code>节目的时间戳Debezium处理此事件。</li>
</ul>
<p>此事件为使用者提供了可用于处理删除此行的各种信息。我们之所以包含旧值，是因为某些消费者可能会要求他们以正确处理删除内容，而没有删除它们，他们可能不得不诉诸更为复杂的行为。</p>
<p>还记得删除行时看到的两个事件吗？让我们看看第二个事件。这是活动的<em>关键</em>：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schema"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"struct"</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"dbserver1.inventory.customers.Key"</span></span><br><span class="line">    <span class="string">"optional"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"fields"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"field"</span>: <span class="string">"id"</span>,</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"int32"</span>,</span><br><span class="line">        <span class="attr">"optional"</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"payload"</span>: &#123;</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">1004</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再次，此密钥与我们查看的前三个事件完全相同。这是同一事件的<em>值</em>：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"schema"</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">"payload"</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>是什么赋予了？好吧，可以将MySQL连接器写入的所有Kafka主题设置为<em>日志压缩</em>，这意味着Kafka可以从该主题中删除较旧的消息，只要该主题后面至少有一条消息完全相同即可。键。这是卡夫卡收集垃圾的方法。这最后一个事件是Debezium所谓的<em>逻辑删除</em>事件，并且由于它具有一个键和一个空值，Kafka理解它可以使用此键删除所有先前的消息。</p>
<p>Kafka日志压缩很棒，因为它仍然允许消费者从一开始就阅读主题，而不会错过任何事件。</p>
<h3 id="重新启动Kafka-Connect服务"><a href="#重新启动Kafka-Connect服务" class="headerlink" title="重新启动Kafka Connect服务"></a>重新启动Kafka Connect服务</h3><p>Kafka Connect服务的一项功能是，它可以自动管理已注册连接器的任务。并且，由于它将数据存储在Kafka中，因此如果正在运行的服务停止或完全消失，则在重新启动（可能在另一台主机上）时，服务器将启动所有非运行任务。为了说明这一点，让我们停止我们的Kafka Connect服务，更改数据库中的某些数据，然后重新启动我们的服务。</p>
<p>在新的终端中，使用以下Docker命令停止<code>connect</code>运行我们的Kafka Connect服务的容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker stop connect</span><br></pre></td></tr></table></figure>
<p>像这样停止容器将停止在其中运行的进程，但是Kafka Connect服务会通过正常关闭来处理该过程。并且由于我们使用<code>--rm</code>标志运行容器，因此Docker在停止容器后将其删除。</p>
<p>服务关闭时，让我们回到MySQL命令行客户端并添加一些记录：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; INSERT INTO customers VALUES (default, "Sarah", "Thompson", "kitt@acme.com");</span><br><span class="line">mysql&gt; INSERT INTO customers VALUES (default, "Kenneth", "Anderson", "kander@acme.com");</span><br></pre></td></tr></table></figure>
<p>注意，在我们运行的终端中<code>watch-topic</code>，没有更新。另外，由于Kafka仍在运行，因此我们仍然可以观看该主题。</p>
<table>
<thead>
<tr>
<th></th>
<th>在生产系统中，您将有足够的代理来处理生产者和使用者，并为每个主题维护最少数量的同步副本。因此，如果有足够的经纪人失败，以致没有最小的ISR，Kafka应该变得不可用。生产商（例如Debezium连接器）和消费者将只耐心地等待Kafka群集或网络恢复。是的，这意味着您的使用者在数据库中更改数据时可能暂时看不到任何更改事件，但这是因为未生成任何更改事件。一旦Kafka群集重新启动或网络恢复，Debezium将继续产生变更事件，而您的使用者将继续使用中断的事件。</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>现在，在新终端中，使用之前使用的<em>相同</em>命令启动新容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it --rm --name connect -p 8083:8083 -e GROUP_ID=1 -e CONFIG_STORAGE_TOPIC=my_connect_configs -e OFFSET_STORAGE_TOPIC=my_connect_offsets -e STATUS_STORAGE_TOPIC=my_connect_statuses --link zookeeper:zookeeper --link kafka:kafka --link mysql:mysql debezium/connect:1.0</span><br></pre></td></tr></table></figure>
<p>这将创建一个运行Kafka Connect分布式服务的全新容器，并且由于我们已使用相同的主题信息对其进行了初始化，因此该新服务将连接到Kafka，读取先前服务的配置，并启动已注册的连接器，该连接器将继续在他们最后一次离开。</p>
<p>这是此重启服务的最后几行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">2017-09-21 07:38:48,385 INFO   MySQL|dbserver1|task  Kafka version : 0.11.0.0   [org.apache.kafka.common.utils.AppInfoParser]</span><br><span class="line">2017-09-21 07:38:48,386 INFO   MySQL|dbserver1|task  Kafka commitId : cb8625948210849f   [org.apache.kafka.common.utils.AppInfoParser]</span><br><span class="line">2017-09-21 07:38:48,390 INFO   MySQL|dbserver1|task  Discovered coordinator 172.17.0.4:9092 (id: 2147483646 rack: null) <span class="keyword">for</span> group inventory-connector-dbhistory.   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:38:48,390 INFO   MySQL|dbserver1|task  Revoking previously assigned partitions [] <span class="keyword">for</span> group inventory-connector-dbhistory   [org.apache.kafka.clients.consumer.internals.ConsumerCoordinator]</span><br><span class="line">2017-09-21 07:38:48,391 INFO   MySQL|dbserver1|task  (Re-)joining group inventory-connector-dbhistory   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:38:48,402 INFO   MySQL|dbserver1|task  Successfully joined group inventory-connector-dbhistory with generation 1   [org.apache.kafka.clients.consumer.internals.AbstractCoordinator]</span><br><span class="line">2017-09-21 07:38:48,403 INFO   MySQL|dbserver1|task  Setting newly assigned partitions [dbhistory.inventory-0] <span class="keyword">for</span> group inventory-connector-dbhistory   [org.apache.kafka.clients.consumer.internals.ConsumerCoordinator]</span><br><span class="line">2017-09-21 07:38:48,888 INFO   MySQL|dbserver1|task  Step 0: Get all known binlogs from MySQL   [io.debezium.connector.mysql.MySqlConnectorTask]</span><br><span class="line">2017-09-21 07:38:48,903 INFO   MySQL|dbserver1|task  MySQL has the binlog file <span class="string">'mysql-bin.000003'</span> required by the connector   [io.debezium.connector.mysql.MySqlConnectorTask]</span><br><span class="line">Sep 21, 2017 7:38:49 AM com.github.shyiko.mysql.binlog.BinaryLogClient connect</span><br><span class="line">INFO: Connected to mysql:3306 at mysql-bin.000003/154 (sid:184054, cid:10)</span><br><span class="line">2017-09-21 07:38:49,045 INFO   MySQL|dbserver1|binlog  Connected to MySQL binlog at mysql:3306, starting at binlog file <span class="string">'mysql-bin.000003'</span>, pos=154, skipping 0 events plus 0 rows   [io.debezium.connector.mysql.BinlogReader]</span><br><span class="line">2017-09-21 07:38:49,046 INFO   ||  Source task WorkerSourceTask&#123;id=inventory-connector-0&#125; finished initialization and start   [org.apache.kafka.connect.runtime.WorkerSourceTask]</span><br></pre></td></tr></table></figure>
<p>如您所见，这些行显示该服务在关闭之前找到了上一个任务先前记录的偏移量，然后它连接到MySQL数据库，开始从该位置读取binlog，并根据任何更改生成事件从那时起在MySQL数据库中运行。</p>
<p>跳回到运行中的终端<code>watch-topic</code>，您现在应该看到两个新记录的事件：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"schema"</span>:&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Key"</span>&#125;,<span class="attr">"payload"</span>:&#123;<span class="attr">"id"</span>:<span class="number">1005</span>&#125;&#125;	&#123;<span class="attr">"schema"</span>:&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"email"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="attr">"field"</span>:<span class="string">"before"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"email"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="attr">"field"</span>:<span class="string">"after"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"version"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"server_id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"ts_sec"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"gtid"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"file"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"pos"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"row"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"boolean"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"snapshot"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"thread"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"db"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"table"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"io.debezium.connector.mysql.Source"</span>,<span class="attr">"field"</span>:<span class="string">"source"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"op"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"ts_ms"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Envelope"</span>,<span class="attr">"version"</span>:<span class="number">1</span>&#125;,<span class="attr">"payload"</span>:&#123;<span class="attr">"before"</span>:<span class="literal">null</span>,<span class="attr">"after"</span>:&#123;<span class="attr">"id"</span>:<span class="number">1005</span>,<span class="attr">"first_name"</span>:<span class="string">"Sarah"</span>,<span class="attr">"last_name"</span>:<span class="string">"Thompson"</span>,<span class="attr">"email"</span>:<span class="string">"kitt@acme.com"</span>&#125;,<span class="attr">"source"</span>:&#123;<span class="attr">"version"</span>:<span class="string">"1.0.2.Final"</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1"</span>,<span class="attr">"server_id"</span>:<span class="number">223344</span>,<span class="attr">"ts_sec"</span>:<span class="number">1490635153</span>,<span class="attr">"gtid"</span>:<span class="literal">null</span>,<span class="attr">"file"</span>:<span class="string">"mysql-bin.000003"</span>,<span class="attr">"pos"</span>:<span class="number">1046</span>,<span class="attr">"row"</span>:<span class="number">0</span>,<span class="attr">"snapshot"</span>:<span class="literal">null</span>,<span class="attr">"thread"</span>:<span class="number">3</span>,<span class="attr">"db"</span>:<span class="string">"inventory"</span>,<span class="attr">"table"</span>:<span class="string">"customers"</span>&#125;,<span class="attr">"op"</span>:<span class="string">"c"</span>,<span class="attr">"ts_ms"</span>:<span class="number">1490635181455</span>&#125;&#125;</span><br><span class="line">&#123;<span class="attr">"schema"</span>:&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Key"</span>&#125;,<span class="attr">"payload"</span>:&#123;<span class="attr">"id"</span>:<span class="number">1006</span>&#125;&#125;	&#123;<span class="attr">"schema"</span>:&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"email"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="attr">"field"</span>:<span class="string">"before"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"first_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"last_name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"email"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Value"</span>,<span class="attr">"field"</span>:<span class="string">"after"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"struct"</span>,<span class="attr">"fields"</span>:[&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"version"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"name"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"server_id"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"ts_sec"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"gtid"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"file"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"pos"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int32"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"row"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"boolean"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"snapshot"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"thread"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"db"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"table"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"io.debezium.connector.mysql.Source"</span>,<span class="attr">"field"</span>:<span class="string">"source"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"string"</span>,<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"field"</span>:<span class="string">"op"</span>&#125;,&#123;<span class="attr">"type"</span>:<span class="string">"int64"</span>,<span class="attr">"optional"</span>:<span class="literal">true</span>,<span class="attr">"field"</span>:<span class="string">"ts_ms"</span>&#125;],<span class="attr">"optional"</span>:<span class="literal">false</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1.inventory.customers.Envelope"</span>,<span class="attr">"version"</span>:<span class="number">1</span>&#125;,<span class="attr">"payload"</span>:&#123;<span class="attr">"before"</span>:<span class="literal">null</span>,<span class="attr">"after"</span>:&#123;<span class="attr">"id"</span>:<span class="number">1006</span>,<span class="attr">"first_name"</span>:<span class="string">"Kenneth"</span>,<span class="attr">"last_name"</span>:<span class="string">"Anderson"</span>,<span class="attr">"email"</span>:<span class="string">"kander@acme.com"</span>&#125;,<span class="attr">"source"</span>:&#123;<span class="attr">"version"</span>:<span class="string">"1.0.2.Final"</span>,<span class="attr">"name"</span>:<span class="string">"dbserver1"</span>,<span class="attr">"server_id"</span>:<span class="number">223344</span>,<span class="attr">"ts_sec"</span>:<span class="number">1490635160</span>,<span class="attr">"gtid"</span>:<span class="literal">null</span>,<span class="attr">"file"</span>:<span class="string">"mysql-bin.000003"</span>,<span class="attr">"pos"</span>:<span class="number">1356</span>,<span class="attr">"row"</span>:<span class="number">0</span>,<span class="attr">"snapshot"</span>:<span class="literal">null</span>,<span class="attr">"thread"</span>:<span class="number">3</span>,<span class="attr">"db"</span>:<span class="string">"inventory"</span>,<span class="attr">"table"</span>:<span class="string">"customers"</span>&#125;,<span class="attr">"op"</span>:<span class="string">"c"</span>,<span class="attr">"ts_ms"</span>:<span class="number">1490635181456</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>这些事件是与我们之前看到的事件类似的<em>创建</em>事件。但是，需要理解的重要一点是，只要在MySQL数据库开始清除我们从其binlog中错过的提交之前重新启动，即使Debezium仍在运行时，它仍将报告数据库中的所有更改。</p>
<h3 id="探索"><a href="#探索" class="headerlink" title="探索"></a>探索</h3><p>继续并使用MySQL命令行客户端在数据库表中添加，修改和删除行，然后查看对主题的影响。您可能需要<code>watch-topic</code>为每个主题运行单独的命令。请记住，您不能删除外键引用的行。玩得开心！</p>
<h3 id="清理"><a href="#清理" class="headerlink" title="清理"></a>清理</h3><p>您可以使用Docker停止所有正在运行的容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker stop mysqlterm watcher connect mysql kafka zookeeper</span><br></pre></td></tr></table></figure>
<p>同样，由于我们<code>--rm</code>在启动连接器时使用了该标志，因此Docker应该在停止连接器后立即将其删除。我们可以验证所有其他进程都已停止并删除：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps -a</span><br></pre></td></tr></table></figure>
<p>当然，如果仍在运行，只需使用<code>docker stop &lt;name&gt;</code>或停止它们<code>docker stop &lt;containerId&gt;</code>。</p>
<h2 id="Docker-Compose设置"><a href="#Docker-Compose设置" class="headerlink" title="Docker Compose设置"></a>Docker Compose设置</h2><p>如果您已经完成了本教程，并且想快速进行设置，那么可以使用<a href="https://github.com/debezium/debezium-examples/tree/master/tutorial" target="_blank" rel="noopener">示例存储库中</a>的本教程的<a href="https://docs.docker.com/compose/" target="_blank" rel="noopener">Docker Compose</a>版本。我们提供Docker Compose文件，用于与MySQL，Postgres，MongoDB，SQL Server和Oracle一起运行本教程。请按照<a href="https://github.com/debezium/debezium-examples/blob/master/tutorial/README.md" target="_blank" rel="noopener">自述文件中</a>描述的步骤进行<a href="https://github.com/debezium/debezium-examples/blob/master/tutorial/README.md" target="_blank" rel="noopener">操作</a>。</p>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2020/02/23/spark读取和处理Excel数据/" itemprop="url">spark读取和处理Excel数据</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2020-02-23T14:34:45.000Z" itemprop="datePublished">10 个月前</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Technology/">Technology</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            3 分钟 读完 (约 482 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>spark-excel是一个使用spark读取Excel2007格式的插件，注意只支持.xlsx格式（.xls不行）。</p>
<p>下面使用pyspark在命令行窗口中进行使用：</p>
<p>This package can be added to Spark using the <code>--packages</code> command line option. For example, to include it when starting the spark shell:</p>
<h3 id="Spark-compiled-with-Scala-2-12"><a href="#Spark-compiled-with-Scala-2-12" class="headerlink" title="Spark compiled with Scala 2.12"></a>Spark compiled with Scala 2.12</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">SPARK_HOME/bin/spark-shell --packages com.crealytics:spark-excel_2.12:0.12.5</span></span><br></pre></td></tr></table></figure>
<h3 id="Spark-compiled-with-Scala-2-11"><a href="#Spark-compiled-with-Scala-2-11" class="headerlink" title="Spark compiled with Scala 2.11"></a>Spark compiled with Scala 2.11</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">SPARK_HOME/bin/spark-shell --packages com.crealytics:spark-excel_2.11:0.12.5</span></span><br></pre></td></tr></table></figure>
<p>###读取Excel文件创建一个DataFrame</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">df = spark.read</span><br><span class="line">    .format(<span class="string">"com.crealytics.spark.excel"</span>)</span><br><span class="line">    .option(<span class="string">"dataAddress"</span>, <span class="string">"'My Sheet'!B3:C35"</span>) // Optional, default: <span class="string">"A1"</span></span><br><span class="line">    .option(<span class="string">"useHeader"</span>, <span class="string">"true"</span>) // Required</span><br><span class="line">    .option(<span class="string">"treatEmptyValuesAsNulls"</span>, <span class="string">"false"</span>) // Optional, default: true</span><br><span class="line">    .option(<span class="string">"inferSchema"</span>, <span class="string">"false"</span>) // Optional, default: false</span><br><span class="line">    .option(<span class="string">"addColorColumns"</span>, <span class="string">"true"</span>) // Optional, default: false</span><br><span class="line">    .option(<span class="string">"timestampFormat"</span>, <span class="string">"MM-dd-yyyy HH:mm:ss"</span>) // Optional, default: yyyy-mm-dd hh:mm:ss[.fffffffff]</span><br><span class="line">    .option(<span class="string">"maxRowsInMemory"</span>, <span class="number">20</span>) // Optional, default <span class="literal">None</span>. If set, uses a streaming reader which can help <span class="keyword">with</span> big files</span><br><span class="line">    .option(<span class="string">"excerptSize"</span>, <span class="number">10</span>) // Optional, default: <span class="number">10.</span> If set <span class="keyword">and</span> <span class="keyword">if</span> schema inferred, number of rows to infer schema <span class="keyword">from</span></span><br><span class="line">    .option(<span class="string">"workbookPassword"</span>, <span class="string">"pass"</span>) // Optional, default <span class="literal">None</span>. Requires unlimited strength JCE <span class="keyword">for</span> older JVMs</span><br><span class="line">    .schema(myCustomSchema) // Optional, default: Either inferred schema, <span class="keyword">or</span> all columns are Strings</span><br><span class="line">    .load(<span class="string">"Worktime.xlsx"</span>)</span><br></pre></td></tr></table></figure>
<p>为了简化操作，spark-excel的Scala版本包括一个装饰了spark.read返回的DataFrameReader的implicit，并提供一个.excel方法，接受默认和可选的属性。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql._</span><br><span class="line"><span class="keyword">import</span> com.crealytics.spark.excel._</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> spark: <span class="type">SparkSession</span> = ???</span><br><span class="line"><span class="keyword">val</span> df = spark.read.excel(</span><br><span class="line">    useHeader = <span class="literal">true</span>,  <span class="comment">// Required</span></span><br><span class="line">    dataAddress = <span class="string">"'My Sheet'!B3:C35"</span>, <span class="comment">// Optional, default: "A1"</span></span><br><span class="line">    treatEmptyValuesAsNulls = <span class="literal">false</span>,  <span class="comment">// Optional, default: true</span></span><br><span class="line">    inferSchema = <span class="literal">false</span>,  <span class="comment">// Optional, default: false</span></span><br><span class="line">    addColorColumns = <span class="literal">true</span>,  <span class="comment">// Optional, default: false</span></span><br><span class="line">    timestampFormat = <span class="string">"MM-dd-yyyy HH:mm:ss"</span>,  <span class="comment">// Optional, default: yyyy-mm-dd hh:mm:ss[.fffffffff]</span></span><br><span class="line">    maxRowsInMemory = <span class="number">20</span>,  <span class="comment">// Optional, default None. If set, uses a streaming reader which can help with big files</span></span><br><span class="line">    excerptSize = <span class="number">10</span>,  <span class="comment">// Optional, default: 10. If set and if schema inferred, number of rows to infer schema from</span></span><br><span class="line">    workbookPassword = <span class="string">"pass"</span>  <span class="comment">// Optional, default None. Requires unlimited strength JCE for older JVMs</span></span><br><span class="line">).schema(myCustomSchema) <span class="comment">// Optional, default: Either inferred schema, or all columns are Strings</span></span><br><span class="line"> .load(<span class="string">"Worktime.xlsx"</span>)</span><br></pre></td></tr></table></figure>
<p>###DataFrame保存为Excel</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">df.write</span><br><span class="line">  .format(<span class="string">"com.crealytics.spark.excel"</span>)</span><br><span class="line">  .option(<span class="string">"dataAddress"</span>, <span class="string">"'My Sheet'!B3:C35"</span>)</span><br><span class="line">  .option(<span class="string">"useHeader"</span>, <span class="string">"true"</span>)</span><br><span class="line">  .option(<span class="string">"dateFormat"</span>, <span class="string">"yy-mmm-d"</span>) // Optional, default: yy-m-d h:mm</span><br><span class="line">  .option(<span class="string">"timestampFormat"</span>, <span class="string">"mm-dd-yyyy hh:mm:ss"</span>) // Optional, default: yyyy-mm-dd hh:mm:ss<span class="number">.000</span></span><br><span class="line">  .mode(<span class="string">"append"</span>) // Optional, default: overwrite.</span><br><span class="line">  .save(<span class="string">"Worktime2.xlsx"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="DataFrame-Join"><a href="#DataFrame-Join" class="headerlink" title="DataFrame Join"></a>DataFrame Join</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">joined=excel1.join(excel2, excel1[<span class="string">"id"</span>]==excel2[<span class="string">"id"</span>]) </span><br><span class="line"><span class="comment">#或者以下格式</span></span><br><span class="line">joined=excel1.join(excel2, excel1.id==excel2.id)</span><br></pre></td></tr></table></figure>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2020/02/16/表批量读取和写入/" itemprop="url">表批量读取和写入</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2020-02-16T13:17:17.000Z" itemprop="datePublished">10 个月前</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Technology/">Technology</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            11 分钟 读完 (约 1598 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <p>Delta Lake支持Apache Spark DataFrame读取和写入API提供的大多数选项，用于对表执行批量读取和写入。</p>
<h1 id="建立表格"><a href="#建立表格" class="headerlink" title="建立表格"></a>建立表格</h1><p>使用<code>DataFrameWriter</code>（<a href="https://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.sql.DataFrameWriter" target="_blank" rel="noopener">Scala或Java</a> / <a href="https://spark.apache.org/docs/2.1.0/api/python/pyspark.sql.html#pyspark.sql.DataFrameWriter" target="_blank" rel="noopener">Python</a>）将数据作为原子操作写入Delta Lake。至少必须指定格式<code>delta</code>：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.write.format(<span class="string">"delta"</span>).save(<span class="string">"/delta/events"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="分区数据"><a href="#分区数据" class="headerlink" title="## 分区数据"></a>## 分区数据</h2><p>您可以对数据进行分区以加快查询或对分区列执行的带有谓词的DML。要在创建增量表时，指定分区的列对数据进行分区。常见的模式是按日期分区，例如：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.write.format(<span class="string">"delta"</span>).partitionBy(<span class="string">"date"</span>).save(<span class="string">"/delta/events"</span>)</span><br></pre></td></tr></table></figure>
<h1 id="读取表"><a href="#读取表" class="headerlink" title="读取表"></a>读取表</h1><p>您可以通过指定路径将Delta表作为DataFrame加载：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spark.read.format(<span class="string">"delta"</span>).load(<span class="string">"/delta/events"</span>)</span><br></pre></td></tr></table></figure>
<h1 id="查询表的旧快照（时间旅行）"><a href="#查询表的旧快照（时间旅行）" class="headerlink" title="查询表的旧快照（时间旅行）"></a>查询表的旧快照（时间旅行）</h1><p>Delta Lake时间旅行允许您查询Delta表的旧快照。时间旅行有许多用例，包括：</p>
<ul>
<li>重新创建分析，报告或输出（例如，机器学习模型的输出）。这对于调试或审核尤其有用，特别是在受管制的行业中。</li>
<li>编写复杂的时间查询。</li>
<li>修正数据中的错误。</li>
<li>为快速更改表的一组查询提供快照隔离。</li>
</ul>
<p>本节介绍了查询表的较旧版本时所支持的方法，数据保留问题并提供了示例。</p>
<h2 id="句法"><a href="#句法" class="headerlink" title="句法"></a>句法</h2><p>有几种查询旧版Delta表的方法。</p>
<h5 id="DataFrameReader选项"><a href="#DataFrameReader选项" class="headerlink" title="DataFrameReader选项"></a>DataFrameReader选项</h5><p>DataFrameReader选项允许您从固定到表的特定版本的Delta表创建DataFrame。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df1 = spark.read.format(<span class="string">"delta"</span>).option(<span class="string">"timestampAsOf"</span>, timestamp_string).load(<span class="string">"/delta/events"</span>)</span><br><span class="line">df2 = spark.read.format(<span class="string">"delta"</span>).option(<span class="string">"versionAsOf"</span>, version).load(<span class="string">"/delta/events"</span>)</span><br></pre></td></tr></table></figure>
<p>对于<code>timestamp_string</code>，仅接受日期或时间戳记字符串。例如<code>&quot;2019-01-01&quot;</code>和<code>&quot;2019-01-01&#39;T&#39;00:00:00.000Z&quot;</code>。</p>
<p>一种常见的模式是在执行Databricks作业期间使用Delta表的最新状态来更新下游应用程序。</p>
<h1 id="写入表格"><a href="#写入表格" class="headerlink" title="写入表格"></a>写入表格</h1><p>使用<code>append</code>模式，您可以将新数据原子添加到现有的Delta表中：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.write.format(<span class="string">"delta"</span>).mode(<span class="string">"append"</span>).save(<span class="string">"/delta/events"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="使用DataFrames覆盖"><a href="#使用DataFrames覆盖" class="headerlink" title="使用DataFrames覆盖"></a>使用DataFrames覆盖</h2><p>要自动替换表中的所有数据，可以使用<code>overwrite</code>模式：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.write.format(<span class="string">"delta"</span>).mode(<span class="string">"overwrite"</span>).save(<span class="string">"/delta/events"</span>)</span><br></pre></td></tr></table></figure>
<p>您可以有选择地仅覆盖分区列上与谓词匹配的数据。以下命令用中的数据原子替换一月<code>df</code>：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">df.write</span><br><span class="line">  .format(<span class="string">"delta"</span>)</span><br><span class="line">  .mode(<span class="string">"overwrite"</span>)</span><br><span class="line">  .option(<span class="string">"replaceWhere"</span>, <span class="string">"date &gt;= '2017-01-01' AND date &lt;= '2017-01-31'"</span>)</span><br><span class="line">  .save(<span class="string">"/delta/events"</span>)</span><br></pre></td></tr></table></figure>
<p>此示例代码将数据写入<code>df</code>，验证所有数据均位于指定分区内，并执行原子替换。</p>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>与Apache Spark中的文件API不同，Delta Lake会记住并强制执行表的架构。这意味着默认情况下，覆盖<em>不会</em>替换现有表的架构。</p>
<p>有关Delta Lake支持更新表的信息，请参阅<a href="https://docs.delta.io/latest/delta-update.html#-delta-update" target="_blank" rel="noopener">更新表</a>。</p>
<h1 id="模式验证"><a href="#模式验证" class="headerlink" title="模式验证"></a>模式验证</h1><p>Delta Lake自动验证正在写入的DataFrame的架构与表的架构兼容。Delta Lake使用以下规则来确定从DataFrame到表的写入是否兼容：</p>
<ul>
<li>所有DataFrame列都必须存在于目标表中。如果表中不存在DataFrame中的列，则会引发异常。表中存在但DataFrame中不存在的列设置为null。</li>
<li>DataFrame列数据类型必须与目标表中的列数据类型匹配。如果它们不匹配，则会引发异常。</li>
<li>DataFrame列名称不能只是大小写不同（而文字相同）。这意味着您不能在同一表中定义诸如“ Foo”和“ foo”之类的列。虽然可以在区分大小写或不区分大小写（默认）模式下使用Spark，但在存储和返回列信息时，<strong>Parquet区分大小写</strong>。Delta Lake保留大小写，但在存储模式时不敏感，并且具有此限制以避免潜在的错误，数据损坏或丢失问题。</li>
</ul>
<p>如果您指定其他选项（例如<code>partitionBy</code>与附加模式结合使用），则Delta Lake会验证它们是否匹配，并为任何不匹配项引发错误。如果<code>partitionBy</code>不存在，则append操作将自动继续按原有数据的分区。</p>
<h1 id="自动模式更新"><a href="#自动模式更新" class="headerlink" title="自动模式更新"></a>自动模式更新</h1><p>Delta Lake可以作为DML事务的一部分（附加或覆盖）自动更新表的架构，并使该架构与正在写入的数据兼容。</p>
<h2 id="添加列"><a href="#添加列" class="headerlink" title="添加列"></a>添加列</h2><p>在以下情况下，DataFrame中存在但表中缺失的列将作为写事务的一部分自动添加：</p>
<ul>
<li><code>write</code>或<code>writeStream</code>有<code>.option(&quot;mergeSchema&quot;, &quot;true&quot;)</code></li>
</ul>
<p>添加的列将追加到它们所在的结构的末尾。追加新列时将保留大小写。</p>
<h2 id="NullType-列"><a href="#NullType-列" class="headerlink" title="NullType 列"></a><code>NullType</code> 列</h2><p>由于Parquet不支持<code>NullType</code>，在写入Delta表时<code>NullType</code>会从DataFrame中被删除，但仍存储在模式中。当为该列接收到其他不同的数据类型时，Delta Lake会将模式合并到新的数据类型。如果Delta Lake收到<code>NullType</code>更换现有列，则在写入过程中将保留原有旧模式，并删除新列。</p>
<p><code>NullType</code>不支持流式传输。由于必须在使用流式传输时设置模式，因此这种情况很少见。<code>NullType</code>也不适用于诸如<code>ArrayType</code>和<code>MapType</code>等复杂类型。</p>
<h1 id="替换表架构"><a href="#替换表架构" class="headerlink" title="替换表架构"></a>替换表架构</h1><p>默认情况下，覆盖表中的数据不会覆盖架构。当使用mode(“overwrite”)<code>覆盖表而没有</code>replaceWhere<code>，你可能仍然要覆盖写入的数据的架构。通过将</code>overwriteSchema<code>选项设置为</code>true`，可以替换表的模式和分区：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.write.option(<span class="string">"overwriteSchema"</span>, <span class="string">"true"</span>)</span><br></pre></td></tr></table></figure>
<h1 id="表的视图"><a href="#表的视图" class="headerlink" title="表的视图"></a>表的视图</h1><p>Delta Lake支持在Delta表之上创建视图，就像使用数据源表一样。</p>
<p>使用视图进行操作时的核心挑战是解析模式。如果更改Delta表模式，则必须重新创建派生视图以说明对该模式的任何添加。例如，如果将新列添加到Delta表中，则必须确保该列在该基表之上构建的有关视图中可用。</p>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2020/02/16/基于Spark的新一代数据湖产品：DELTA-LAKE/" itemprop="url">基于Spark的新一代数据湖产品：DELTA LAKE</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2020-02-16T12:36:09.000Z" itemprop="datePublished">10 个月前</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Technology/">Technology</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            2 分钟 读完 (约 366 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p><a href="https://delta.io/" target="_blank" rel="noopener">Delta Lake</a>是一个<a href="https://github.com/delta-io/delta" target="_blank" rel="noopener">开源存储层</a>，可为数据湖带来可靠性。Delta Lake提供ACID事务，可伸缩的元数据处理，并统一流和批处理数据处理。Delta Lake在您现有的数据湖之上运行，并且与Apache Spark API完全兼容。</p>
<img src="/2020/02/16/基于Spark的新一代数据湖产品：DELTA-LAKE/Delta-Lake.png" title="Delta-Lake">
<p>具体来说，Delta Lake提供：</p>
<ul>
<li>Spark上的ACID事务：可序列化的隔离级别确保读者永远不会看到不一致的数据。</li>
<li>可扩展的元数据处理：利用Spark的分布式处理能力，可以轻松处理数十亿个文件的PB级表的所有元数据。</li>
<li>流和批处理的统一：Delta Lake中的表既是批处理表，又是流的源和接收器。流数据提取，批处理历史回填，交互式查询都可以直接使用。</li>
<li>模式实施：自动处理模式变化，以防止在摄取过程中插入不良记录。</li>
<li>时间旅行：数据版本控制支持回滚，完整的历史审核跟踪以及可重复的机器学习实验。</li>
<li>Upserts和Deletes：支持合并（Merge），更新和删除操作，以启用复杂的用例，例如更改数据捕获，缓慢维度变化（SCD）操作，流化Upserts等。</li>
</ul>

    
    </div>
    
    
</article>




    
        <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            <a href="/2019/08/22/Presto（一）用例指南/" itemprop="url">Presto（一）用例指南</a>
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-08-22T15:07:01.000Z" itemprop="datePublished">1 年前</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Technology/">Technology</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            7 分钟 读完 (约 999 字)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h1 id="Presto不是什么"><a href="#Presto不是什么" class="headerlink" title="Presto不是什么"></a>Presto不是什么</h1><p>因为网上很多人错误地认为Presto是一个数据库，所以首先从反面定义Presto不是什么更有意义。</p>
<p>不要以为Presto能够解析并执行SQL就将其与标准的数据库混为一谈。Presto并不是一个普遍意义上的关系数据库。它无法替代诸如Mysql、PostgreSQL和Oracle这样的关系型数据库。Presto的设计目标不是为了处理OLTP工作，这与很多其他为优化数据仓库和分析型数据库而设计的数据库一样。</p>
<h1 id="Presto是什么"><a href="#Presto是什么" class="headerlink" title="Presto是什么"></a>Presto是什么</h1><p>Presto是一个面向大规模数据集通过分布式查询任务进行高效查询的工具。需要处理TB或PB级数据时，会经常使用与Hadoop和HDFS交互的工具。Presto的设计目标是为替换诸如Hive、Pig等使用MapReduce管道查询HDFS的工具提供另一种选择。Presto通过扩展还能够处理其他类型的数据源，包括传统关系型数据看看和其他No-SQL数据库例如Cassandra。</p>
<p>Presto设计用于处理数据仓库和数据分析业务：例如数据分析、聚合大规模数据和制作报表。这类应用场景经常被划分为OLAP范围。</p>
<h1 id="Presto核心概念"><a href="#Presto核心概念" class="headerlink" title="Presto核心概念"></a>Presto核心概念</h1><h2 id="连接器Connector"><a href="#连接器Connector" class="headerlink" title="连接器Connector"></a>连接器Connector</h2><p>连接器将Presto适配到一个数据源，例如Hive或关系型数据库。可以将连接器视为一个连接数据库的驱动。它实现了Presto的SPI，Presto依靠SPI标准接口与数据源进行互动。</p>
<p>Presto包括几个内置的连接器：JMX连接器，作为一个系统连接器提供对内置系统表的访问。Hive连接器。以及一个TPCH连接器用于服务TPC-H基准测试数据。第三方开发人员贡献了很多其他连接器，所以Presto能够适配许多不同类型的数据源。</p>
<p>每一个catalog都对应一个连接器。如果你查看catalog配置文件，会看到每个catalog都会有一个必需的配置项connector.name，它被catalog manager用于创建与catalog想匹配的连接器。可以为多个catalog指定相同的连接器，用于访问同类数据库的不同实例。例如你有两个Hive集群，你可以在一个Presto集群中配置两个catalog都使用Hive连接器，是你能够从两个Hive集群中查询数据。</p>
<h2 id="Catalog"><a href="#Catalog" class="headerlink" title="Catalog"></a>Catalog</h2><p>Presto的catalog包含schema模式和指向数据源的连接器的引用。例如，你可以配置一个JMX catalog，通过JMX连接器提供对JMX信息的访问。Presto可以在一个或多个catalog上运行SQL。其他catalog类型包括连接到Hive数据源的Hive catalog。</p>
<p>当使用Presto在解析表时，使用表的完全限定（fully-qualified）名，完全限定名以catalog为根。例如hive.test_data.test的完全限定名，表示hive库中的test_data模式中的test表。</p>
<p>catalog通过Presto配置文件目录下的属性文件进行定义。</p>
<h2 id="Schema"><a href="#Schema" class="headerlink" title="Schema"></a>Schema</h2><p>schema是一种组织表的方式。一个catalog和模式定义了一组可以被查询的表。当使用Presto访问Hive或关系型数据库例如MySQL时，schema跟目标数据库中的具有相同的概念。其他类型的连接器可能会选择以一种对底层数据源有意义的方式将表组织为模式。</p>
<h2 id="Table"><a href="#Table" class="headerlink" title="Table"></a>Table</h2><p>一个表是一组无序的行，这些行由不同类型的列组成。这与关系型数据库概念相同。源数据到表的映射关系由连接器进行定义。</p>

    
    </div>
    
    
</article>




    
    
        
<nav class="pagination is-centered is-rounded" role="navigation" aria-label="pagination">
    <div class="pagination-previous is-invisible is-hidden-mobile">
        <a href="/categories/Technology/page/0/">上一页</a>
    </div>
    <div class="pagination-next">
        <a href="/categories/Technology/page/2/">下一页</a>
    </div>
    <ul class="pagination-list is-hidden-mobile">
        
        <li><a class="pagination-link is-current" href="/categories/Technology/">1</a></li>
        
        <li><a class="pagination-link" href="/categories/Technology/page/2/">2</a></li>
        
        <li><span class="pagination-ellipsis">&hellip;</span></li>
        
        <li><a class="pagination-link" href="/categories/Technology/page/5/">5</a></li>
        
    </ul>
</nav>
    
    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2020 肖飞&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow has-text-black" href="https://github.com/xyfigo">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        //plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {matchFontHeight: false},
        SVG: {matchFontHeight: false},
        CommonHTML: {matchFontHeight: false}
    });
</script>

    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    

    


<script src="/js/script.js"></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="站内搜索">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js"></script>
    
</body>
</html>